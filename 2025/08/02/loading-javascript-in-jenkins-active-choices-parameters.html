<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:url" content="https://kinoshita.eti.br/2025/08/02/loading-javascript-in-jenkins-active-choices-parameters.html"><meta property="og:site_name" content="kinow"><meta property="og:title" content="Loading JavaScript in Jenkins Active Choices parameters"><meta property="og:description" content="Be aware that what&rsquo;s described here may introduce a security risk to your environment, and you must only do it if you really know what you are doing. You will be breaking a few security fixes of Jenkins, such as:
SECURITY-440 https://github.com/jenkinsci/active-choices-plugin/commit/720af532b0a2c69465824af5735be2859d7c3492 Jenkins XSS prevention https://wiki.jenkins-ci.org/JENKINS/Jelly-and-XSS-prevention.html Some years ago, the Jenkins Active Choices plug-in had a security bug reported as a Groovy script could have malicious code that would trigger an XSS attack in Jenkins (i.e. run some arbitrary JS code in Jenkins). The plug-in got removed from the update site until we fixed it, and the solution was to sanitize the output of the Groovy script used to render the Jenkins parameters.
"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-08-02T21:59:52+03:00"><meta property="article:modified_time" content="2025-12-17T18:55:56+01:00"><meta property="article:tag" content="Opensource"><meta property="article:tag" content="Java"><meta property="article:tag" content="Programming"><meta property="article:tag" content="Security"><meta property="og:image" content="https://kinoshita.eti.br/assets/posts/2025-08-02-loading-javascript-in-jenkins-active-choice-parameters/no-security-result.png"><meta property="fb:admins" content="bruno.kinoshita"><meta name=twitter:title content="Loading JavaScript in Jenkins Active Choices parameters"><meta name=twitter:description content="Be aware that what&rsquo;s described here may introduce a security risk to your
environment, and you must only do it if you really know what you are doing.
You will be breaking a few security fixes of Jenkins, such as:

SECURITY-440 https://github.com/jenkinsci/active-choices-plugin/commit/720af532b0a2c69465824af5735be2859d7c3492
Jenkins XSS prevention https://wiki.jenkins-ci.org/JENKINS/Jelly-and-XSS-prevention.html

Some years ago, the Jenkins Active Choices plug-in had a security bug
reported as a Groovy script could have malicious code that would trigger
an XSS attack in Jenkins (i.e. run some arbitrary JS code in Jenkins).
The plug-in got removed from the update site until we fixed it, and the
solution was to sanitize the output of the Groovy script used to render
the Jenkins parameters."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kinoshita.eti.br/assets/posts/2025-08-02-loading-javascript-in-jenkins-active-choice-parameters/no-security-result.png"><meta name=twitter:site content="@kinow"><link rel=alternate type=application/rss+xml href=https://kinoshita.eti.br/2025/08/02/loading-javascript-in-jenkins-active-choices-parameters/feed.xml title=kinow><link rel=stylesheet type=text/css href=https://kinoshita.eti.br/sass/main.2bf0e81b866986f8e894e04d30e6e1e76e2829c06afda356b6fca355d1000a94.css integrity="sha256-K/DoG4ZphvjolOBNMObh524oKcBq/aNWtvyjVdEACpQ="><title>kinow | Loading JavaScript in Jenkins Active Choices parameters</title><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"posts","name":"Loading JavaScript in Jenkins Active Choices parameters","headline":"Loading JavaScript in Jenkins Active Choices parameters","alternativeHeadline":"","description":"\u003cp\u003e\u003cstrong\u003eBe aware that what\u0026rsquo;s described here may introduce a security risk to your\nenvironment, and you must only do it if you really know what you are doing.\nYou will be breaking a few security fixes of Jenkins, such as\u003c\/strong\u003e:\u003c\/p\u003e\n\u003cul\u003e\n\u003cli\u003eSECURITY-440 \u003ca href=\u0022https:\/\/github.com\/jenkinsci\/active-choices-plugin\/commit\/720af532b0a2c69465824af5735be2859d7c3492\u0022\u003ehttps:\/\/github.com\/jenkinsci\/active-choices-plugin\/commit\/720af532b0a2c69465824af5735be2859d7c3492\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003eJenkins XSS prevention \u003ca href=\u0022https:\/\/wiki.jenkins-ci.org\/JENKINS\/Jelly-and-XSS-prevention.html\u0022\u003ehttps:\/\/wiki.jenkins-ci.org\/JENKINS\/Jelly-and-XSS-prevention.html\u003c\/a\u003e\u003c\/li\u003e\n\u003c\/ul\u003e\n\u003cp\u003eSome years ago, the Jenkins Active Choices plug-in had a security bug\nreported as a Groovy script could have malicious code that would trigger\nan XSS attack in Jenkins (i.e. run some arbitrary JS code in Jenkins).\nThe plug-in got removed from the update site until we fixed it, and the\nsolution was to sanitize the output of the Groovy script used to render\nthe Jenkins parameters.\u003c\/p\u003e","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/kinoshita.eti.br\/2025\/08\/02\/loading-javascript-in-jenkins-active-choices-parameters.html"},"author":{"@type":"Person","name":""},"creator":{"@type":"Person","name":""},"accountablePerson":{"@type":"Person","name":""},"copyrightHolder":"kinow","copyrightYear":"2025","dateCreated":"2025-08-02T21:59:52.00Z","datePublished":"2025-08-02T21:59:52.00Z","dateModified":"2025-12-17T18:55:56.00Z","publisher":{"@type":"Organization","name":"kinow","url":"https://kinoshita.eti.br/","logo":{"@type":"ImageObject","url":"https:\/\/kinoshita.eti.br\/","width":"32","height":"32"}},"image":["https://kinoshita.eti.br/assets/posts/2025-08-02-loading-javascript-in-jenkins-active-choice-parameters/no-security-result.png"],"url":"https:\/\/kinoshita.eti.br\/2025\/08\/02\/loading-javascript-in-jenkins-active-choices-parameters.html","wordCount":"868","genre":["opensource","java","programming","security"],"keywords":[]}</script></head><body><header role=banner class=content><nav id=nav aria-label=Main role=navigation class=content><ul style=position:relative><li><a href=/><i data-feather=about></i> About</a></li><li><a href=/blog/><i data-feather=blog></i> Blog</a></li><li><a href=/portfolio/><i data-feather=portfolio></i> Portfolio</a></li><li style=position:absolute;right:0;bottom:-.75rem;text-align:right><span style=text-transform:uppercase;font-weight:700;font-size:3rem;color:#fffefa;line-height:normal;letter-spacing:-.1rem>Kinow</span></li></ul></nav></header><main><article class=content><h1>Loading JavaScript in Jenkins Active Choices parameters</h1><div class=metadata><i data-feather=calendar></i>
<time datetime=2025-08-02>Aug 2, 2025</time></div><aside><nav id=TableOfContents></nav></aside><p><strong>Be aware that what&rsquo;s described here may introduce a security risk to your
environment, and you must only do it if you really know what you are doing.
You will be breaking a few security fixes of Jenkins, such as</strong>:</p><ul><li>SECURITY-440 <a href=https://github.com/jenkinsci/active-choices-plugin/commit/720af532b0a2c69465824af5735be2859d7c3492>https://github.com/jenkinsci/active-choices-plugin/commit/720af532b0a2c69465824af5735be2859d7c3492</a></li><li>Jenkins XSS prevention <a href=https://wiki.jenkins-ci.org/JENKINS/Jelly-and-XSS-prevention.html>https://wiki.jenkins-ci.org/JENKINS/Jelly-and-XSS-prevention.html</a></li></ul><p>Some years ago, the Jenkins Active Choices plug-in had a security bug
reported as a Groovy script could have malicious code that would trigger
an XSS attack in Jenkins (i.e. run some arbitrary JS code in Jenkins).
The plug-in got removed from the update site until we fixed it, and the
solution was to sanitize the output of the Groovy script used to render
the Jenkins parameters.</p><p>That broke a feature of the plug-in, where users could load third-party
JavaScript files, like jQuery, D3.js, <a href=https://css-doodle.com/>CSS Doodle</a>,
etc. This post shows how one could create a version of the plug-in that
renders Jenkins parameters that load and execute any JavaScript code provided.</p><p>I tested it using <a href=https://github.com/jenkinsci/active-choices-plugin/commit/daa5837519e23377431335613661b057fe102275>a commit</a>
from the <code>master</code> branch of the plug-in:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>commit daa5837519e23377431335613661b057fe102275 <span style=color:#666>(</span>HEAD -&gt; master, upstream/master, upstream/HEAD<span style=color:#666>)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>Author: Bruno P. Kinoshita &lt;kinow@users.noreply.github.com&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>Date:   Thu Jul <span style=color:#666>31</span> 20:38:20 <span style=color:#666>2025</span> +0200
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    Update CHANGES.md
</span></span></code></pre></div><p>You will have to clone the repository of the plug-in,
<a href=https://github.com/jenkinsci/active-choices-plugin>https://github.com/jenkinsci/active-choices-plugin</a>,
and then you can start by disabling escaping text in Jelly:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>$ find src/main/ -name <span style=color:#b44>&#34;*.jelly&#34;</span> | xargs <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#b62;font-weight:700></span>  sed -i -E <span style=color:#b44>&#34;s/escape-by-default=&#39;true&#39;/escape-by-default=&#39;false&#39;/g&#34;</span>
</span></span></code></pre></div><p>There&rsquo;s one more change in <code>DynamicReferenceParameter/formattedHtml.jelly</code>
that you will have to apply:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-diff data-lang=diff><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:navy;font-weight:700>diff --git a/src/main/resources/org/biouno/unochoice/DynamicReferenceParameter/formattedHtml.jelly b/src/main/resources/org/biouno/unochoice/DynamicReferenceParameter/formattedHtml.jelly
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:navy;font-weight:700>index a853766..c047cf1 100644
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:navy;font-weight:700></span><span style=color:#a00000>--- a/src/main/resources/org/biouno/unochoice/DynamicReferenceParameter/formattedHtml.jelly
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#a00000></span><span style=color:#00a000>+++ b/src/main/resources/org/biouno/unochoice/DynamicReferenceParameter/formattedHtml.jelly
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#00a000></span><span style=color:purple;font-weight:700>@@ -1,4 +1,4 @@
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:purple;font-weight:700></span><span style=color:#a00000>-&lt;?jelly escape-by-default=&#39;true&#39; ?&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#a00000></span><span style=color:#00a000>+&lt;?jelly escape-by-default=&#39;false&#39; ?&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#00a000></span> &lt;j:jelly xmlns:j=&#34;jelly:core&#34;&gt;
</span></span><span style=display:flex;background-color:#dfdfdf><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>   &lt;j:invokeStatic var=&#34;paramName&#34; className=&#34;org.biouno.unochoice.util.Utils&#34; method=&#34;createRandomParameterName&#34;&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>     &lt;j:arg type=&#34;java.lang.String&#34; value=&#34;choice-parameter&#34; /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:purple;font-weight:700>@@ -6,6 +6,6 @@
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:purple;font-weight:700></span>   &lt;/j:invokeStatic&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>   &lt;j:set var=&#34;paramName&#34; value=&#34;${paramName}&#34; scope=&#34;parent&#34; /&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>   &lt;div id=&#39;formattedHtml_${paramName}&#39;&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#a00000>-    &lt;j:out value=&#34;${it.getChoicesAsString()}&#34;/&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#a00000></span><span style=color:#00a000>+    ${h.rawHtml(it.getChoicesAsString())}
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#00a000></span>   &lt;/div&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#a00000>-&lt;/j:jelly&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#a00000></span>\ No newline at end of file
</span></span></code></pre></div><p>You will also need to disable escaping and sanitizing in the
Java code:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-diff data-lang=diff><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:navy;font-weight:700>diff --git a/src/main/java/org/biouno/unochoice/AbstractCascadableParameter.java b/src/main/java/org/biouno/unochoice/AbstractCascadableParameter.java
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:navy;font-weight:700>index 9494779..b46f126 100644
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:navy;font-weight:700></span><span style=color:#a00000>--- a/src/main/java/org/biouno/unochoice/AbstractCascadableParameter.java
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#a00000></span><span style=color:#00a000>+++ b/src/main/java/org/biouno/unochoice/AbstractCascadableParameter.java
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#00a000></span><span style=color:purple;font-weight:700>@@ -164,7 +164,7 @@ public abstract class AbstractCascadableParameter extends AbstractScriptablePara
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:purple;font-weight:700></span>             for (String value : array) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>                 value = value.trim();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>                 if (StringUtils.isNotBlank(value)) {
</span></span><span style=display:flex;background-color:#dfdfdf><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#a00000>-                    list.add(Util.escape(value));
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#a00000></span><span style=color:#00a000>+                    list.add(value);
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#00a000></span>                 }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>             }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>             return list.toArray(new String[0]);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:navy;font-weight:700>diff --git a/src/main/java/org/biouno/unochoice/AbstractScriptableParameter.java b/src/main/java/org/biouno/unochoice/AbstractScriptableParameter.java
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:navy;font-weight:700>index 102f694..6444239 100644
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:navy;font-weight:700></span><span style=color:#a00000>--- a/src/main/java/org/biouno/unochoice/AbstractScriptableParameter.java
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#a00000></span><span style=color:#00a000>+++ b/src/main/java/org/biouno/unochoice/AbstractScriptableParameter.java
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#00a000></span><span style=color:purple;font-weight:700>@@ -306,7 +306,7 @@ public abstract class AbstractScriptableParameter extends AbstractUnoChoiceParam
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:purple;font-weight:700></span>             String valueText = ObjectUtils.toString(entry.getValue(), &#34;&#34;);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>             if (Utils.isSelected(valueText)) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>                 String keyText = ObjectUtils.toString(entry.getKey(), &#34;&#34;);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span><span style=color:#a00000>-                defaultValues.add(Utils.escapeSelectedAndDisabled(keyText));
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#a00000></span><span style=color:#00a000>+                defaultValues.add(keyText);
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span><span style=color:#00a000></span>             }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>         }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>         if (defaultValues.isEmpty()) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span><span style=color:navy;font-weight:700>diff --git a/src/main/java/org/biouno/unochoice/model/GroovyScript.java b/src/main/java/org/biouno/unochoice/model/GroovyScript.java
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span><span style=color:navy;font-weight:700>index 385aafa..c78c0a9 100644
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span><span style=color:navy;font-weight:700></span><span style=color:#a00000>--- a/src/main/java/org/biouno/unochoice/model/GroovyScript.java
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span><span style=color:#a00000></span><span style=color:#00a000>+++ b/src/main/java/org/biouno/unochoice/model/GroovyScript.java
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span><span style=color:#00a000></span><span style=color:purple;font-weight:700>@@ -188,9 +188,9 @@ public class GroovyScript extends AbstractScript {
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span><span style=color:purple;font-weight:700></span>         try {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>             Object returnValue = secureScript.evaluate(cl, context, null);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>             // sanitize the text if running script in sandbox mode
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span><span style=color:#a00000>-            if (secureScript.isSandbox()) {
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span><span style=color:#a00000>-                returnValue = resolveTypeAndSanitize(returnValue);
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span><span style=color:#a00000>-            }
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span><span style=color:#a00000></span><span style=color:#00a000>+//            if (secureScript.isSandbox()) {
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span><span style=color:#00a000>+//                returnValue = resolveTypeAndSanitize(returnValue);
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span><span style=color:#00a000>+//            }
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span><span style=color:#00a000></span>             return returnValue;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>         } catch (Exception re) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span>             if (this.secureFallbackScript != null) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span><span style=color:purple;font-weight:700>@@ -198,9 +198,9 @@ public class GroovyScript extends AbstractScript {
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span><span style=color:purple;font-weight:700></span>                     LOGGER.log(Level.FINEST, &#34;Fallback to default script...&#34;, re);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span>                     Object returnValue = secureFallbackScript.evaluate(cl, context, null);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span>                     // sanitize the text if running script in sandbox mode
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span><span style=color:#a00000>-                    if (secureFallbackScript.isSandbox()) {
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span><span><span style=color:#a00000>-                        returnValue = resolveTypeAndSanitize(returnValue);
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50</span><span><span style=color:#a00000>-                    }
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51</span><span><span style=color:#a00000></span><span style=color:#00a000>+//                    if (secureFallbackScript.isSandbox()) {
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52</span><span><span style=color:#00a000>+//                        returnValue = resolveTypeAndSanitize(returnValue);
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53</span><span><span style=color:#00a000>+//                    }
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54</span><span><span style=color:#00a000></span>                     return returnValue;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55</span><span>                 } catch (Exception e2) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56</span><span>                     LOGGER.log(Level.WARNING, &#34;Error executing fallback script&#34;, e2);
</span></span></code></pre></div><p>Now, build the project, but skip the tests since we have at least
one security test that may fail with these changes.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>$ mvn clean install -DskipTests
</span></span></code></pre></div><p>Your modified <code>.hpi</code> file should be ready to be installed in a Jenkins
server. Or you can run it locally.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>$ find . -name uno-choice.hpi
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>./target/uno-choice.hpi
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>$ mvn hpi:run
</span></span></code></pre></div><p>Finally, create your project embedding JavaScript. For instance,
create a FreeStyle project with a DynamicReferenceParameter,
rendering as formatted HTML.</p><p>Here&rsquo;s a sample Groovy script that should render an image.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a2f;font-weight:700>return</span> <span style=color:#b44>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#b44>&lt;script type=&#34;</span>module<span style=color:#b44>&#34;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#b44>  import &#39;https://esm.sh/css-doodle&#39;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#b44>&lt;/script&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#b44>&lt;css-doodle&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#b44>  @grid: 18 / 100vmax / #0a0c27;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#b44>  --hue: calc(180 + 1.5 * @x * @y);
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#b44>  background: hsl(var(--hue), 50%, 70%);
</span></span></span><span style=display:flex;background-color:#dfdfdf><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#b44>  margin: -.5px;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#b44>  transition: @r(.5s) ease;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#b44>  clip-path: polygon(@pick(
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#b44>    &#39;0 0, 100% 0, 100% 100%&#39;,
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#b44>    &#39;0 0, 100% 0, 0 100%&#39;,
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#b44>    &#39;0 0, 100% 100%, 0 100%&#39;,
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#b44>    &#39;100% 0, 100% 100%, 0 100%&#39;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#b44>  ));
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#b44>&lt;/css-doodle&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#b44>&#34;&#34;&#34;</span>
</span></span></code></pre></div><figure class=feature><img src=/assets/posts/2025-08-02-loading-javascript-in-jenkins-active-choice-parameters/no-security-configuration.png alt='Job configuration' title='Job configuration' style=width:auto width height><figcaption>Job configuration</figcaption></figure><figure class=feature><img src=/assets/posts/2025-08-02-loading-javascript-in-jenkins-active-choice-parameters/no-security-result.png alt='Result showing a CSS Doodle' title='Result showing a CSS Doodle' style=width:auto width height><figcaption>Result showing a CSS Doodle</figcaption></figure><p>Once again, this may lead to security issues if you allow users with
admin permissions over jobs, or if you pipelines that load external
Groovy code, and if these contain malicious code.</p><p>But if you have an internal server with code that is developed internally,
and meticulously reviewed, the risk might be mitigated in your case, and
you may want to be able to use JavaScript in your parameters &ndash; like
we all used to be able to do before.</p><p>Someday, we may have a new permission in the plug-in, and a flag that
allow admins to enable this per-project. Maybe that, combined with the
Jenkins In-Process Script Approval might be enough for the plug-in to
work as before, without being marked as a risk by the Jenkins CERT/security
team.</p><p>(Also, as always, remember to back up and use a testbed server!)</p><p>Categories:
<a href=/categories/blog.html>Blog</a></p><p>Tags:
<a href=/tags/opensource.html>Opensource</a>,
<a href=/tags/java.html>Java</a>,
<a href=/tags/programming.html>Programming</a>,
<a href=/tags/security.html>Security</a></p><aside class=links><a class=previous href=https://kinoshita.eti.br/2025/06/25/migrating-the-jena-editor-from-codemirror-5-to-6.html>&#171; Previous</a></aside></article></main><footer role=contentinfo><ul id=social-media-icons><li><a href=https://www.instagram.com/brunokinoshita/><img src=/assets/icons/instagram.png alt="Instagram link"></a></li><li><a href=https://bsky.app/profile/kinow.bsky.social><img src=/assets/icons/bluesky.png alt="BlueSky link"></a></li><li><a href=https://twitter.com/kinow/><img src=/assets/icons/twitter.png alt="Twitter link"></a></li><li><a href=https://github.com/kinow/><img src=/assets/icons/github.png alt="GitHub link"></a></li><li><a href=/feed.xml><img src=/assets/icons/news.png alt="RSS feed link"></a></li></ul></footer></body></html>