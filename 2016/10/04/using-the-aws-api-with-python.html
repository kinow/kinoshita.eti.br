<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:url" content="https://kinoshita.eti.br/2016/10/04/using-the-aws-api-with-python.html"><meta property="og:site_name" content="kinow"><meta property="og:title" content="Using the AWS API with Python"><meta property="og:description" content="Amazon Web Services provides a series of cloud services. When you access the web interface, most - if not all - of the actions you do there are actually translated into API calls.
They also provide SDK&amp;rsquo;s in several programming languages. With these SDK&amp;rsquo;s you are able to call the same API used by the web interface. Python has boto (or boto3) which lets you to automate several tasks in AWS."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-10-04T00:00:00+00:00"><meta property="article:modified_time" content="2024-07-14T00:30:48+02:00"><meta property="article:tag" content="Python"><meta property="article:tag" content="Aws"><meta property="og:image" content="https://kinoshita.eti.br/assets/photos/about/2023-me-closeup.png"><meta property="fb:admins" content="bruno.kinoshita"><meta name=twitter:title content="Using the AWS API with Python"><meta name=twitter:description content="Amazon Web Services provides a series of cloud services. When you access the web interface, most - if not all - of the actions you do there are actually translated into API calls.
They also provide SDK&rsquo;s in several programming languages. With these SDK&rsquo;s you are able to call the same API used by the web interface. Python has boto (or boto3) which lets you to automate several tasks in AWS."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kinoshita.eti.br/assets/photos/about/2023-me-closeup.png"><meta name=twitter:site content="@kinow"><link rel=alternate type=application/rss+xml href=https://kinoshita.eti.br/2016/10/04/using-the-aws-api-with-python/feed.xml title=kinow><link rel=stylesheet type=text/css href=https://kinoshita.eti.br/sass/main.c3626db3678f53e4a53e3e75c7b2fe34bb46566f00eb84692501404d0064c32a.css integrity="sha256-w2Jts2ePU+SlPj51x7L+NLtGVm8A64RpJQFATQBkwyo="><title>kinow | Using the AWS API with Python</title><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"posts","name":"Using the AWS API with Python","headline":"Using the AWS API with Python","alternativeHeadline":"","description":"Amazon Web Services provides a series of cloud services. When you access the web interface, most - if not all - of the actions you do there are actually translated into API calls.\nThey also provide SDK\u0026rsquo;s in several programming languages. With these SDK\u0026rsquo;s you are able to call the same API used by the web interface. Python has boto (or boto3) which lets you to automate several tasks in AWS.","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/kinoshita.eti.br\/2016\/10\/04\/using-the-aws-api-with-python.html"},"author":{"@type":"Person","name":"Bruno P. Kinoshita"},"creator":{"@type":"Person","name":"Bruno P. Kinoshita"},"accountablePerson":{"@type":"Person","name":"Bruno P. Kinoshita"},"copyrightHolder":"kinow","copyrightYear":"2016","dateCreated":"2016-10-04T00:00:00.00Z","datePublished":"2016-10-04T00:00:00.00Z","dateModified":"2024-07-14T00:30:48.00Z","publisher":{"@type":"Organization","name":"kinow","url":"https://kinoshita.eti.br/","logo":{"@type":"ImageObject","url":"https:\/\/kinoshita.eti.br\/","width":"32","height":"32"}},"image":"https://kinoshita.eti.br/","url":"https:\/\/kinoshita.eti.br\/2016\/10\/04\/using-the-aws-api-with-python.html","wordCount":"350","genre":["python","aws"],"keywords":[]}</script></head><body><header role=banner class=content><nav id=nav aria-label=Main role=navigation class=content><ul><li><a href=/><i data-feather=about></i> About</a></li><li><a href=/blog/><i data-feather=blog></i> Blog</a></li><li><a href=/portfolio/><i data-feather=portfolio></i> Portfolio</a></li></ul></nav></header><main><article class=content><h1>Using the AWS API with Python</h1><div class=metadata><i data-feather=calendar></i>
<time datetime=2016-10-04>Oct 4, 2016</time></div><aside><nav id=TableOfContents></nav></aside><p>Amazon Web Services provides a series of cloud services. When you access the web interface, most - if not all - of the actions you do there are actually translated into API calls.</p><p>They also provide SDK&rsquo;s in several programming languages. With these SDK&rsquo;s you are able to call the same API used by the web interface. Python has <a href=https://github.com/boto/boto3>boto</a> (or boto3) which lets you to automate several tasks in AWS.</p><p>But before you start using the API, you will need to <a href=https://web.archive.org/web/20160818112016/http://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSGettingStartedGuide/AWSCredentials.html>set up your access key</a>.</p><p>It is likely that with time you will have different roles, and may have different permissions with each role. You have to configure your local environment so that you can either use the command line Python utility (installed via <code>pip install awscli</code>) or with boto.</p><p>The awscli is a dependency for using boto3. After you install it, you need to run <code>aws configure</code>. It will create the <em>~/.aws/config</em> and <em>~/.aws/credentials</em> files. You can tweak these files to support multiple roles.</p><p>I followed the tutorials, but got all sorts of different issues. Then after debugging some locally installed dependencies, in special awscli files, I found that the following settings work for my environment.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#177500># File: config</span>
</span></span><span style=display:flex><span><span style=color:#000>[</span>profile default<span style=color:#000>]</span>
</span></span><span style=display:flex><span><span style=color:#000>region</span> <span style=color:#000>=</span> ap-southeast-2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>[</span>profile profile1<span style=color:#000>]</span>
</span></span><span style=display:flex><span><span style=color:#000>region</span> <span style=color:#000>=</span> ap-southeast-2
</span></span><span style=display:flex><span><span style=color:#000>source_profile</span> <span style=color:#000>=</span> default
</span></span><span style=display:flex><span><span style=color:#000>role_arn</span> <span style=color:#000>=</span> arn:aws:iam::123:role/Developer
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>[</span>profile profile2<span style=color:#000>]</span>
</span></span><span style=display:flex><span><span style=color:#000>region</span> <span style=color:#000>=</span> ap-southeast-2
</span></span><span style=display:flex><span><span style=color:#000>source_profile</span> <span style=color:#000>=</span> default
</span></span><span style=display:flex><span><span style=color:#000>role_arn</span> <span style=color:#000>=</span> arn:aws:iam::456:role/Sysops
</span></span><span style=display:flex><span><span style=color:#000>mfa_serial</span> <span style=color:#000>=</span> arn:aws:iam::789:mfa/user@domain.blabla
</span></span></code></pre></div><p>and</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#177500># File: credentials</span>
</span></span><span style=display:flex><span><span style=color:#000>[</span>default<span style=color:#000>]</span>
</span></span><span style=display:flex><span><span style=color:#000>aws_access_key_id</span> <span style=color:#000>=</span> YOU_KEY_ID
</span></span><span style=display:flex><span><span style=color:#000>aws_secret_access_key</span> <span style=color:#000>=</span> YOUR_SECRET
</span></span></code></pre></div><p>And once it is done you can, for example, confirm it is working with some S3 commands in Python.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#177500>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>import</span> <span style=color:#000>os</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>import</span> <span style=color:#000>boto3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>session</span> <span style=color:#000>=</span> <span style=color:#000>boto3</span><span style=color:#000>.</span><span style=color:#000>Session</span>(<span style=color:#000>profile_name</span><span style=color:#000>=</span><span style=color:#c41a16>&#39;profile2&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#000>s3</span> <span style=color:#000>=</span> <span style=color:#000>session</span><span style=color:#000>.</span><span style=color:#000>resource</span>(<span style=color:#c41a16>&#39;s3&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>found</span> <span style=color:#000>=</span> <span style=color:#a90d91>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>name</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#39;mysuperduperbucket&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>for</span> <span style=color:#000>bucket</span> <span style=color:#000>in</span> <span style=color:#000>s3</span><span style=color:#000>.</span><span style=color:#000>buckets</span><span style=color:#000>.</span><span style=color:#000>all</span>():
</span></span><span style=display:flex><span>    <span style=color:#a90d91>if</span> <span style=color:#000>bucket</span><span style=color:#000>.</span><span style=color:#000>name</span> <span style=color:#000>==</span> <span style=color:#000>name</span>:
</span></span><span style=display:flex><span>        <span style=color:#000>found</span> <span style=color:#000>=</span> <span style=color:#a90d91>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>if</span> <span style=color:#000>not</span> <span style=color:#000>found</span>:
</span></span><span style=display:flex><span>    <span style=color:#a90d91>print</span>(<span style=color:#c41a16>&#34;Creating bucket...&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#000>s3</span><span style=color:#000>.</span><span style=color:#000>create_bucket</span>(<span style=color:#000>Bucket</span><span style=color:#000>=</span><span style=color:#000>name</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>file_location</span> <span style=color:#000>=</span> <span style=color:#000>os</span><span style=color:#000>.</span><span style=color:#000>path</span><span style=color:#000>.</span><span style=color:#000>dirname</span>(<span style=color:#000>os</span><span style=color:#000>.</span><span style=color:#000>path</span><span style=color:#000>.</span><span style=color:#000>realpath</span>(<span style=color:#000>__file__</span>)) <span style=color:#000>+</span> <span style=color:#000>os</span><span style=color:#000>.</span><span style=color:#000>path</span><span style=color:#000>.</span><span style=color:#000>sep</span> <span style=color:#000>+</span> <span style=color:#c41a16>&#39;samplefile.txt&#39;</span>
</span></span><span style=display:flex><span><span style=color:#000>s3</span><span style=color:#000>.</span><span style=color:#000>meta</span><span style=color:#000>.</span><span style=color:#000>client</span><span style=color:#000>.</span><span style=color:#000>upload_file</span>(<span style=color:#000>Filename</span><span style=color:#000>=</span><span style=color:#000>file_location</span>, <span style=color:#000>Bucket</span><span style=color:#000>=</span><span style=color:#000>name</span>, <span style=color:#000>Key</span><span style=color:#000>=</span><span style=color:#c41a16>&#39;book.txt&#39;</span>)
</span></span></code></pre></div><p>The AWS files in this example are using MFA too, the multi-factor authentication. So the first time you run this code you may be asked to generate a token, which will be cached for a short time.</p><p>That&rsquo;s it for today.</p><p>Happy hacking!</p><p>Categories:
<a href=/categories/blog.html>Blog</a></p><p>Tags:
<a href=/tags/python.html>Python</a>,
<a href=/tags/aws.html>Aws</a></p><aside class=links><a class=previous href=https://kinoshita.eti.br/2016/10/02/best-place-to-find-science-fiction-books-in-new-zealand.html>&#171; Previous</a><a class=next href=https://kinoshita.eti.br/2016/11/05/checking-the-operating-system-type-in-shell-script.html>Next &#187;</a></aside></article></main><footer role=contentinfo><ul id=social-media-icons><li><a href=https://www.instagram.com/brunokinoshita/><img src=/assets/icons/instagram.png alt="Instagram link"></a></li><li><a href=https://twitter.com/kinow/><img src=/assets/icons/twitter.png alt="Twitter link"></a></li><li><a href=https://github.com/kinow/><img src=/assets/icons/github.png alt="GitHub link"></a></li><li><a href=/feed.xml><img src=/assets/icons/news.png alt="RSS feed link"></a></li></ul></footer></body></html>