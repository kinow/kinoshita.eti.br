<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Using the AWS API with Python | kinow</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Using the AWS API with Python" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Amazon Web Services provides a series of cloud services. When you access the web interface, most - if not all - of the actions you do there are actually translated into API calls. They also provide SDK’s in several programming languages. With these SDK’s you are able to call the same API used by the web interface. Python has boto (or boto3) which lets you to automate several tasks in AWS. But before you start using the API, you will need to set up your access key. It is likely that with time you will have different roles, and may have different permissions with each role. You have to configure your local environment so that you can either use the command line Python utility (installed via pip install awscli) or with boto. The awscli is a dependency for using boto3. After you install it, you need to run aws configure. It will create the ~/.aws/config and ~/.aws/credentials files. You can tweak these files to support multiple roles. I followed the tutorials, but got all sorts of different issues. Then after debugging some locally installed dependencies, in special awscli files, I found that the following settings work for my environment. # File: config [profile default] region = ap-southeast-2 [profile profile1] region = ap-southeast-2 source_profile = default role_arn = arn:aws:iam::123:role/Developer [profile profile2] region = ap-southeast-2 source_profile = default role_arn = arn:aws:iam::456:role/Sysops mfa_serial = arn:aws:iam::789:mfa/user@domain.blabla and # File: credentials [default] aws_access_key_id = YOU_KEY_ID aws_secret_access_key = YOUR_SECRET And once it is done you can, for example, confirm it is working with some S3 commands in Python. #!/usr/bin/env python3 import os import boto3 session = boto3.Session(profile_name=&#39;profile2&#39;) s3 = session.resource(&#39;s3&#39;) found = False name = &#39;mysuperduperbucket&#39; for bucket in s3.buckets.all(): if bucket.name == name: found = True if not found: print(&quot;Creating bucket...&quot;) s3.create_bucket(Bucket=name) file_location = os.path.dirname(os.path.realpath(__file__)) + os.path.sep + &#39;samplefile.txt&#39; s3.meta.client.upload_file(Filename=file_location, Bucket=name, Key=&#39;book.txt&#39;) The AWS files in this example are using MFA too, the multi-factor authentication. So the first time you run this code you may be asked to generate a token, which will be cached for a short time. That’s it for today. Happy hacking!" />
<meta property="og:description" content="Amazon Web Services provides a series of cloud services. When you access the web interface, most - if not all - of the actions you do there are actually translated into API calls. They also provide SDK’s in several programming languages. With these SDK’s you are able to call the same API used by the web interface. Python has boto (or boto3) which lets you to automate several tasks in AWS. But before you start using the API, you will need to set up your access key. It is likely that with time you will have different roles, and may have different permissions with each role. You have to configure your local environment so that you can either use the command line Python utility (installed via pip install awscli) or with boto. The awscli is a dependency for using boto3. After you install it, you need to run aws configure. It will create the ~/.aws/config and ~/.aws/credentials files. You can tweak these files to support multiple roles. I followed the tutorials, but got all sorts of different issues. Then after debugging some locally installed dependencies, in special awscli files, I found that the following settings work for my environment. # File: config [profile default] region = ap-southeast-2 [profile profile1] region = ap-southeast-2 source_profile = default role_arn = arn:aws:iam::123:role/Developer [profile profile2] region = ap-southeast-2 source_profile = default role_arn = arn:aws:iam::456:role/Sysops mfa_serial = arn:aws:iam::789:mfa/user@domain.blabla and # File: credentials [default] aws_access_key_id = YOU_KEY_ID aws_secret_access_key = YOUR_SECRET And once it is done you can, for example, confirm it is working with some S3 commands in Python. #!/usr/bin/env python3 import os import boto3 session = boto3.Session(profile_name=&#39;profile2&#39;) s3 = session.resource(&#39;s3&#39;) found = False name = &#39;mysuperduperbucket&#39; for bucket in s3.buckets.all(): if bucket.name == name: found = True if not found: print(&quot;Creating bucket...&quot;) s3.create_bucket(Bucket=name) file_location = os.path.dirname(os.path.realpath(__file__)) + os.path.sep + &#39;samplefile.txt&#39; s3.meta.client.upload_file(Filename=file_location, Bucket=name, Key=&#39;book.txt&#39;) The AWS files in this example are using MFA too, the multi-factor authentication. So the first time you run this code you may be asked to generate a token, which will be cached for a short time. That’s it for today. Happy hacking!" />
<link rel="canonical" href="https://kinoshita.eti.br/2016/10/04/using-the-aws-api-with-python.html" />
<meta property="og:url" content="https://kinoshita.eti.br/2016/10/04/using-the-aws-api-with-python.html" />
<meta property="og:site_name" content="kinow" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-10-04T00:00:00+13:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Using the AWS API with Python" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"https://kinoshita.eti.br/2016/10/04/using-the-aws-api-with-python.html"},"description":"Amazon Web Services provides a series of cloud services. When you access the web interface, most - if not all - of the actions you do there are actually translated into API calls. They also provide SDK’s in several programming languages. With these SDK’s you are able to call the same API used by the web interface. Python has boto (or boto3) which lets you to automate several tasks in AWS. But before you start using the API, you will need to set up your access key. It is likely that with time you will have different roles, and may have different permissions with each role. You have to configure your local environment so that you can either use the command line Python utility (installed via pip install awscli) or with boto. The awscli is a dependency for using boto3. After you install it, you need to run aws configure. It will create the ~/.aws/config and ~/.aws/credentials files. You can tweak these files to support multiple roles. I followed the tutorials, but got all sorts of different issues. Then after debugging some locally installed dependencies, in special awscli files, I found that the following settings work for my environment. # File: config [profile default] region = ap-southeast-2 [profile profile1] region = ap-southeast-2 source_profile = default role_arn = arn:aws:iam::123:role/Developer [profile profile2] region = ap-southeast-2 source_profile = default role_arn = arn:aws:iam::456:role/Sysops mfa_serial = arn:aws:iam::789:mfa/user@domain.blabla and # File: credentials [default] aws_access_key_id = YOU_KEY_ID aws_secret_access_key = YOUR_SECRET And once it is done you can, for example, confirm it is working with some S3 commands in Python. #!/usr/bin/env python3 import os import boto3 session = boto3.Session(profile_name=&#39;profile2&#39;) s3 = session.resource(&#39;s3&#39;) found = False name = &#39;mysuperduperbucket&#39; for bucket in s3.buckets.all(): if bucket.name == name: found = True if not found: print(&quot;Creating bucket...&quot;) s3.create_bucket(Bucket=name) file_location = os.path.dirname(os.path.realpath(__file__)) + os.path.sep + &#39;samplefile.txt&#39; s3.meta.client.upload_file(Filename=file_location, Bucket=name, Key=&#39;book.txt&#39;) The AWS files in this example are using MFA too, the multi-factor authentication. So the first time you run this code you may be asked to generate a token, which will be cached for a short time. That’s it for today. Happy hacking!","@type":"BlogPosting","url":"https://kinoshita.eti.br/2016/10/04/using-the-aws-api-with-python.html","headline":"Using the AWS API with Python","dateModified":"2016-10-04T00:00:00+13:00","datePublished":"2016-10-04T00:00:00+13:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/main.css"><link type="application/atom+xml" rel="alternate" href="https://kinoshita.eti.br/feed.xml" title="kinow" /><link href="https://unpkg.com/pattern.css" rel="stylesheet">

</head>
<body>
<div id="mobile-menu"><div class="menu">
  <ul class="menu">
    <li class="item">
      <h1 id="kinow">KINOW</h1>
    </li>
    <li class="item">
      <a href="/" class="">About</a>
    </li>
    <li class="item">
      <a href="/blog/" class="current">Blog</a>
    </li>
    <li class="item">
      <a href="/portfolio/" class="">Portfolio</a>
    </li>
    <li class="item social-media-item">
      <a href="https://www.instagram.com/brunokinoshita/" class="inline-link">
        <img src="/assets/icons/instagram.png" class="inverted-image" />
      </a>
      <a href="https://twitter.com/kinow/" class="inline-link">
        <img src="/assets/icons/twitter.png" class="inverted-image" />
      </a>
      <a href="https://github.com/kinow/" class="inline-link">
        <img src="/assets/icons/github.png" class="inverted-image" />
      </a>
    </li>
  </ul>
</div>
</div>
<div id="wrapper">
  <div id="sidebar"><div class="menu">
  <ul class="menu">
    <li class="item">
      <h1 id="kinow">KINOW</h1>
    </li>
    <li class="item">
      <a href="/" class="">About</a>
    </li>
    <li class="item">
      <a href="/blog/" class="current">Blog</a>
    </li>
    <li class="item">
      <a href="/portfolio/" class="">Portfolio</a>
    </li>
    <li class="item social-media-item">
      <a href="https://www.instagram.com/brunokinoshita/" class="inline-link">
        <img src="/assets/icons/instagram.png" class="inverted-image" />
      </a>
      <a href="https://twitter.com/kinow/" class="inline-link">
        <img src="/assets/icons/twitter.png" class="inverted-image" />
      </a>
      <a href="https://github.com/kinow/" class="inline-link">
        <img src="/assets/icons/github.png" class="inverted-image" />
      </a>
    </li>
  </ul>
</div>
</div>
  <div id="content">
    <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Using the AWS API with Python</h1>
    <span class="post-meta">
      <time class="dt-published" datetime="2016-10-04T00:00:00+13:00" itemprop="datePublished">Oct 4, 2016
      </time>
      <span>&mdash; star date: -306158.47.</span>
      <span>
        Number of words: 496.
      </span></span>
  </header>

  


  <div class="post-content e-content" itemprop="articleBody">
    <p>Amazon Web Services provides a series of cloud services. When you access the web interface, most - if not all - of the actions you do there are actually translated into API calls.</p>

<p>They also provide SDK’s in several programming languages. With these SDK’s you are able to call the same API used by the web interface. Python has <a href="https://github.com/boto/boto3">boto</a> (or boto3) which lets you to automate several tasks in AWS.</p>

<p>But before you start using the API, you will need to <a href="https://web.archive.org/web/20160818112016/http://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSGettingStartedGuide/AWSCredentials.html">set up your access key</a>.</p>

<p>It is likely that with time you will have different roles, and may have different permissions with each role. You have to configure your local environment so that you can either use the command line Python utility (installed via <code class="language-plaintext highlighter-rouge">pip install awscli</code>) or with boto.</p>

<p>The awscli is a dependency for using boto3. After you install it, you need to run <code class="language-plaintext highlighter-rouge">aws configure</code>. It will create the <em>~/.aws/config</em> and <em>~/.aws/credentials</em> files. You can tweak these files to support multiple roles.</p>

<p>I followed the tutorials, but got all sorts of different issues. Then after debugging some locally installed dependencies, in special awscli files, I found that the following settings work for my environment.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># File: config</span>
<span class="o">[</span>profile default]
region <span class="o">=</span> ap-southeast-2

<span class="o">[</span>profile profile1]
region <span class="o">=</span> ap-southeast-2
source_profile <span class="o">=</span> default
role_arn <span class="o">=</span> arn:aws:iam::123:role/Developer

<span class="o">[</span>profile profile2]
region <span class="o">=</span> ap-southeast-2
source_profile <span class="o">=</span> default
role_arn <span class="o">=</span> arn:aws:iam::456:role/Sysops
mfa_serial <span class="o">=</span> arn:aws:iam::789:mfa/user@domain.blabla
</code></pre></div></div>

<p>and</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># File: credentials</span>
<span class="o">[</span>default]
aws_access_key_id <span class="o">=</span> YOU_KEY_ID
aws_secret_access_key <span class="o">=</span> YOUR_SECRET
</code></pre></div></div>

<p>And once it is done you can, for example, confirm it is working with some S3 commands in Python.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">boto3</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="n">Session</span><span class="p">(</span><span class="n">profile_name</span><span class="o">=</span><span class="s">'profile2'</span><span class="p">)</span>
<span class="n">s3</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="n">resource</span><span class="p">(</span><span class="s">'s3'</span><span class="p">)</span>

<span class="n">found</span> <span class="o">=</span> <span class="bp">False</span>

<span class="n">name</span> <span class="o">=</span> <span class="s">'mysuperduperbucket'</span>

<span class="k">for</span> <span class="n">bucket</span> <span class="ow">in</span> <span class="n">s3</span><span class="p">.</span><span class="n">buckets</span><span class="p">.</span><span class="nb">all</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">bucket</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">found</span> <span class="o">=</span> <span class="bp">True</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Creating bucket..."</span><span class="p">)</span>
    <span class="n">s3</span><span class="p">.</span><span class="n">create_bucket</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

<span class="n">file_location</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span> <span class="o">+</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s">'samplefile.txt'</span>
<span class="n">s3</span><span class="p">.</span><span class="n">meta</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="n">upload_file</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="n">file_location</span><span class="p">,</span> <span class="n">Bucket</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="s">'book.txt'</span><span class="p">)</span>
</code></pre></div></div>

<p>The AWS files in this example are using MFA too, the multi-factor authentication. So the first time you run this code you may be asked to generate a token, which will be cached for a short time.</p>

<p>That’s it for today.</p>

<p>Happy hacking!</p>

  </div>

  <div class="tags">
    <p>
      Published Oct 4, 2016 in &ldquo;blog&rdquo; and tagged&nbsp;<a class="label" href="/tags#python">python</a>,&nbsp;<a class="label" href="/tags#aws">aws</a>. Number of words: 496.
    </p>
  </div>

  <a class="u-url" href="/2016/10/04/using-the-aws-api-with-python.html" hidden></a>
</article>

  </div>
</div>
</body>
</html>
