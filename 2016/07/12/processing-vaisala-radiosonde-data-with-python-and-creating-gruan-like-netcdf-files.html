<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" /><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Processing Vaisala Radiosonde data with Python, and creating GRUAN-like NetCDF files | kinow</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Processing Vaisala Radiosonde data with Python, and creating GRUAN-like NetCDF files" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="One of my last projects involved parsing a few GB’s of data that was in a certain binary format, and convert it into NetCDF files. In this post I will describe what was done, what I learned about radiosonde, GRUAN and other geek stuff. Ready? Vaisala Radiosonde data When I was told the data was in some binary format, I thought it would be similar to parsing a flat file. That this would contain a fixed length entry, with the same kind of item repeated multiple times. Well, not exactly. The files had been generated by an instrument made by Vaisala, a Finnish company. This instrument is called a radiosonde. It is an instrument about the size of an old mobile phone, that is launched with a balloon into the atmosphere. I was lucky to be given the chance to release one of these balloons carrying a newer version of this equipment. The balloon can carry equipments for measuring different things, like air pressure, altitude, temperature, latitude, longitude, relative humidity, among others. Equipments like the radiosonde send the data back to a ground-level station via radio, normally in a short and constant interval." />
<meta property="og:description" content="One of my last projects involved parsing a few GB’s of data that was in a certain binary format, and convert it into NetCDF files. In this post I will describe what was done, what I learned about radiosonde, GRUAN and other geek stuff. Ready? Vaisala Radiosonde data When I was told the data was in some binary format, I thought it would be similar to parsing a flat file. That this would contain a fixed length entry, with the same kind of item repeated multiple times. Well, not exactly. The files had been generated by an instrument made by Vaisala, a Finnish company. This instrument is called a radiosonde. It is an instrument about the size of an old mobile phone, that is launched with a balloon into the atmosphere. I was lucky to be given the chance to release one of these balloons carrying a newer version of this equipment. The balloon can carry equipments for measuring different things, like air pressure, altitude, temperature, latitude, longitude, relative humidity, among others. Equipments like the radiosonde send the data back to a ground-level station via radio, normally in a short and constant interval." />
<link rel="canonical" href="https://kinoshita.eti.br/2016/07/12/processing-vaisala-radiosonde-data-with-python-and-creating-gruan-like-netcdf-files.html" />
<meta property="og:url" content="https://kinoshita.eti.br/2016/07/12/processing-vaisala-radiosonde-data-with-python-and-creating-gruan-like-netcdf-files.html" />
<meta property="og:site_name" content="kinow" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-07-12T00:00:00+12:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Processing Vaisala Radiosonde data with Python, and creating GRUAN-like NetCDF files" />
<script type="application/ld+json">
{"description":"One of my last projects involved parsing a few GB’s of data that was in a certain binary format, and convert it into NetCDF files. In this post I will describe what was done, what I learned about radiosonde, GRUAN and other geek stuff. Ready? Vaisala Radiosonde data When I was told the data was in some binary format, I thought it would be similar to parsing a flat file. That this would contain a fixed length entry, with the same kind of item repeated multiple times. Well, not exactly. The files had been generated by an instrument made by Vaisala, a Finnish company. This instrument is called a radiosonde. It is an instrument about the size of an old mobile phone, that is launched with a balloon into the atmosphere. I was lucky to be given the chance to release one of these balloons carrying a newer version of this equipment. The balloon can carry equipments for measuring different things, like air pressure, altitude, temperature, latitude, longitude, relative humidity, among others. Equipments like the radiosonde send the data back to a ground-level station via radio, normally in a short and constant interval.","headline":"Processing Vaisala Radiosonde data with Python, and creating GRUAN-like NetCDF files","dateModified":"2016-07-12T00:00:00+12:00","datePublished":"2016-07-12T00:00:00+12:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://kinoshita.eti.br/2016/07/12/processing-vaisala-radiosonde-data-with-python-and-creating-gruan-like-netcdf-files.html"},"url":"https://kinoshita.eti.br/2016/07/12/processing-vaisala-radiosonde-data-with-python-and-creating-gruan-like-netcdf-files.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/main.css" /><link type="application/atom+xml" rel="alternate" href="https://kinoshita.eti.br/feed.xml" title="kinow" /><link href="https://unpkg.com/pattern.css" rel="stylesheet" />

</head>
<body>
<div id="mobile-menu"><div class="menu">
  <ul class="menu">
    <li class="item">
      <h1 id="kinow">KINOW</h1>
    </li>
    <li class="item">
      <a href="/" class="">About</a>
    </li>
    <li class="item">
      <a href="/blog/" class="current">Blog</a>
    </li>
    <li class="item">
      <a href="/portfolio/" class="">Portfolio</a>
    </li>
    <li class="item social-media-item">
      <a href="https://www.instagram.com/brunokinoshita/" class="inline-link">
        <img src="/assets/icons/instagram.png" class="inverted-image" />
      </a>
      <a href="https://twitter.com/kinow/" class="inline-link">
        <img src="/assets/icons/twitter.png" class="inverted-image" />
      </a>
      <a href="https://github.com/kinow/" class="inline-link">
        <img src="/assets/icons/github.png" class="inverted-image" />
      </a>
    </li>
  </ul>
</div>
</div>
<div id="wrapper">
  <div id="sidebar"><div class="menu">
  <ul class="menu">
    <li class="item">
      <h1 id="kinow">KINOW</h1>
    </li>
    <li class="item">
      <a href="/" class="">About</a>
    </li>
    <li class="item">
      <a href="/blog/" class="current">Blog</a>
    </li>
    <li class="item">
      <a href="/portfolio/" class="">Portfolio</a>
    </li>
    <li class="item social-media-item">
      <a href="https://www.instagram.com/brunokinoshita/" class="inline-link">
        <img src="/assets/icons/instagram.png" class="inverted-image" />
      </a>
      <a href="https://twitter.com/kinow/" class="inline-link">
        <img src="/assets/icons/twitter.png" class="inverted-image" />
      </a>
      <a href="https://github.com/kinow/" class="inline-link">
        <img src="/assets/icons/github.png" class="inverted-image" />
      </a>
    </li>
  </ul>
</div>
</div>
  <div id="content">
    <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Processing Vaisala Radiosonde data with Python, and creating GRUAN-like NetCDF files</h1>
    <span class="post-meta">
      <time class="dt-published" datetime="2016-07-12T00:00:00+12:00" itemprop="datePublished">Jul 12, 2016
      </time>
      <span>&mdash; star date: -306387.98.</span>
      <span>
        Number of words: 1890.
      </span></span>
  </header>

  <ul>
  <li><a href="#vaisala-radiosonde-data">Vaisala Radiosonde data</a></li>
  <li><a href="#parsing-binary-data-with-python-and-construct">Parsing binary data with Python and construct</a></li>
  <li><a href="#what-is-gruan-and-why-should-i-care">What is GRUAN, and why should I care?</a></li>
  <li><a href="#producing-netcdf-files-with-python">Producing NetCDF files with Python</a></li>
</ul>


  <div class="post-content e-content" itemprop="articleBody">
    <p>One of my last projects involved parsing a few GB’s of data that was in a certain binary format,
and convert it into NetCDF files. In this post I will describe what was done, what I learned about radiosonde,
<a href="http://www.dwd.de/EN/research/international_programme/gruan/home.html">GRUAN</a> and other geek stuff. Ready?</p>

<h3 id="vaisala-radiosonde-data">Vaisala Radiosonde data</h3>

<p>When I was told the data was in some binary format, I thought it would be similar to
parsing a flat file. That this would contain a fixed length entry, with the same
kind of item repeated multiple times.</p>

<p>Well, not exactly.</p>

<p>The files had been generated by an instrument made by <a href="http://www.vaisala.com">Vaisala</a>, a Finnish company. This
instrument is called a <strong>radiosonde</strong>. It is an instrument about the size of an old
mobile phone, that is launched with a balloon into the atmosphere.</p>

<p>I was lucky to be given the chance to release one of these balloons carrying a newer
version of this equipment.</p>

<p><img class="ui centered large bordered image" src="/assets/posts/2016-07-12-processing-vaisala-radiosonde-data-with-python-and-creating-gruan-like-netcdf-files/balloon-launch.jpg" alt="Radiosonde balloon launch" /></p>

<p>The balloon can carry equipments for measuring different things, like air pressure,
altitude, temperature, latitude, longitude, relative humidity, among others. Equipments
like the radiosonde send the data back to a ground-level station via radio,
normally in a short and constant interval.</p>

<!--more-->

<p>The data that I had to parse was Vaisala radiosonde data. But in an older format. The documentation for the format
can be found online at <a href="http://badc.nerc.ac.uk/data/ukmo-rad-hires/pc-coradata.html">http://badc.nerc.ac.uk/data/ukmo-rad-hires/pc-coradata.html</a>.</p>

<p>There are four different sections. And one field in the identification section defines the
number of entries found in another field (high resolution). Each section has multiple fields,
with different data types.</p>

<p>Not so easy to parse…</p>

<h3 id="parsing-binary-data-with-python-and-construct">Parsing binary data with Python and construct</h3>

<p><a href="https://construct.readthedocs.io/">Construct</a> is a declarative parser for binary data.
You can build a parser by simply saying what you expect to be in each field. For example.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pccora_header</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="s">"pccora_header"</span><span class="p">,</span>
    <span class="n">ExprAdapter</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="s">"copyright"</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
        <span class="n">encoder</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">obj</span><span class="p">.</span><span class="n">encode</span><span class="p">(),</span>
        <span class="n">decoder</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">obj</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">,</span> <span class="s">'ignore'</span><span class="p">)</span>
    <span class="p">),</span>
    <span class="n">SLInt16</span><span class="p">(</span><span class="s">"identification_length"</span><span class="p">),</span>
    <span class="n">SLInt16</span><span class="p">(</span><span class="s">"syspar_length"</span><span class="p">),</span>
    <span class="n">SLInt16</span><span class="p">(</span><span class="s">"data_records"</span><span class="p">),</span>
    <span class="n">SLInt16</span><span class="p">(</span><span class="s">"standard_levels"</span><span class="p">),</span>
    <span class="n">SLInt16</span><span class="p">(</span><span class="s">"data_type"</span><span class="p">),</span>
    <span class="n">SLInt16</span><span class="p">(</span><span class="s">"data_length"</span><span class="p">),</span>
    <span class="n">Enum</span><span class="p">(</span><span class="n">Byte</span><span class="p">(</span><span class="s">"file_ready"</span><span class="p">),</span>
        <span class="n">READY</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">NOT_READY</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">_default_</span> <span class="o">=</span> <span class="s">"UNKNOWN"</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">Bytes</span><span class="p">(</span><span class="s">"reserved"</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p>This sample code parses the <strong>Header</strong> section of the Vaisala binary file. You define each field,
with a short name, a data type and a length. You can also have expressions to encode
or decode. And you can control how fields relate to each other, and how they repeat
in the data format.</p>

<p>A complete parser for the binary format was written with Construct, and is available
via pip as well, as a package called <a href="https://github.com/kinow/pccora">pccora</a>. You can
install it via <code class="language-plaintext highlighter-rouge">pip install pccora</code>, and use it to parse any data in this old binary
format.</p>

<p>There are utility scripts in the pccora GitHub project. One of the scripts, <strong>convert2netcdf.py</strong>,
converts the Vaisala binary data into a NetCDF that is close to what GRUAN produces.</p>

<h3 id="what-is-gruan-and-why-should-i-care">What is GRUAN, and why should I care?</h3>

<p><img class="ui centered large bordered image" src="/assets/posts/2016-07-12-processing-vaisala-radiosonde-data-with-python-and-creating-gruan-like-netcdf-files/sherlock1.png" alt="OG Sherlock Kush" /></p>

<p>This part of the post is more climate and research-oriented. So if you are more geek-savvy, feel free
to jump to the next section.</p>

<p><a href="http://www.dwd.de/EN/research/international_programme/gruan/home.html">GRUAN</a> stands for
<em>Global Climate Observing System (GCOS) Reference Upper-Air Network (GRUAN)</em>.</p>

<p>It is a group of professionals and researchers that work together to create a reference
network for climate records. They provide data in a standardised way, and with a uniform
quality control process.</p>

<p>This makes it much easier for researchers to use and share data in their work, since they can
write tools and scripts once for GRUAN data. Also, there is a quality control process, and
every data is annotated with metadata.</p>

<h3 id="producing-netcdf-files-with-python">Producing NetCDF files with Python</h3>

<p><a href="https://en.wikipedia.org/wiki/NetCDF">NetCDF</a>, the Network Common Data Form, is
a data format that supports arrays with dimensions. Version 4 of NetCDF supports
<a href="https://en.wikipedia.org/wiki/HDF5">HDF5</a> too, which is a hierarchical data format.</p>

<p>In NetCDF, you create variables, which contains an array of values - or missing values.
These variables relate to one or more dimensions, like time, or altitude.</p>

<p>As for radiosonde data, we have NetCDF files created by GRUAN certified sites. Like
<a href="http://www.esrl.noaa.gov/psd/iasoa/dataset_record/?datasetid=1111">this example from NOAA</a>.
Following the Download link you should be directed to the FTP site. There you
can grab any example GRUAN NetCDF (.nc) file and inspect with <em>ncdump</em>,
<em>Panoply</em>, <em>ncBrowse</em> or your favourite editor.</p>

<p>For the file <a href="ftp://ftp.ncdc.noaa.gov/pub/data/gruan/processing/level2/RS92-GDP/version-002/TAT/2016/TAT-RS-01_2_RS92-GDP_002_20160104T000000_1-000-001.nc"></a>
for example, the <strong>time</strong> and <strong>pressure</strong> variables are described below.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dimensions</span><span class="p">:</span>
  <span class="n">time</span> <span class="o">=</span> <span class="n">UNLIMITED</span> <span class="p">;</span> <span class="o">//</span> <span class="p">(</span><span class="mi">5735</span> <span class="n">currently</span><span class="p">)</span>
<span class="n">variables</span><span class="p">:</span>
  <span class="nb">float</span> <span class="n">time</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="p">;</span>
    <span class="n">time</span><span class="p">:</span><span class="n">standard_name</span> <span class="o">=</span> <span class="s">"time"</span> <span class="p">;</span>
    <span class="n">time</span><span class="p">:</span><span class="n">units</span> <span class="o">=</span> <span class="s">"seconds since 2016-01-03T23:30:16"</span> <span class="p">;</span>
    <span class="n">time</span><span class="p">:</span><span class="n">long_name</span> <span class="o">=</span> <span class="s">"Time"</span> <span class="p">;</span>
    <span class="n">time</span><span class="p">:</span><span class="n">g_format_type</span> <span class="o">=</span> <span class="s">"FLT"</span> <span class="p">;</span>
    <span class="n">time</span><span class="p">:</span><span class="n">g_format_format</span> <span class="o">=</span> <span class="s">"F8.1"</span> <span class="p">;</span>
    <span class="n">time</span><span class="p">:</span><span class="n">g_format_width</span> <span class="o">=</span> <span class="s">"8"</span> <span class="p">;</span>
    <span class="n">time</span><span class="p">:</span><span class="n">g_format_nan</span> <span class="o">=</span> <span class="s">"NaN"</span> <span class="p">;</span>
    <span class="n">time</span><span class="p">:</span><span class="n">g_source_desc</span> <span class="o">=</span> <span class="s">"FRAWPTU"</span> <span class="p">;</span>
    <span class="n">time</span><span class="p">:</span><span class="n">g_column_type</span> <span class="o">=</span> <span class="s">"original data"</span> <span class="p">;</span>
    <span class="n">time</span><span class="p">:</span><span class="n">g_resolution</span> <span class="o">=</span> <span class="s">"1.0 s (time)"</span> <span class="p">;</span>
    <span class="n">time</span><span class="p">:</span><span class="n">axis</span> <span class="o">=</span> <span class="s">"T"</span> <span class="p">;</span>
    <span class="n">time</span><span class="p">:</span><span class="n">calendar</span> <span class="o">=</span> <span class="s">"gregorian"</span> <span class="p">;</span>
  <span class="nb">float</span> <span class="n">press</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="p">;</span>
    <span class="n">press</span><span class="p">:</span><span class="n">standard_name</span> <span class="o">=</span> <span class="s">"air_pressure"</span> <span class="p">;</span>
    <span class="n">press</span><span class="p">:</span><span class="n">units</span> <span class="o">=</span> <span class="s">"hPa"</span> <span class="p">;</span>
    <span class="n">press</span><span class="p">:</span><span class="n">long_name</span> <span class="o">=</span> <span class="s">"Pressure"</span> <span class="p">;</span>
    <span class="n">press</span><span class="p">:</span><span class="n">g_format_type</span> <span class="o">=</span> <span class="s">"FLT"</span> <span class="p">;</span>
    <span class="n">press</span><span class="p">:</span><span class="n">g_format_format</span> <span class="o">=</span> <span class="s">"F8.3"</span> <span class="p">;</span>
    <span class="n">press</span><span class="p">:</span><span class="n">g_format_width</span> <span class="o">=</span> <span class="s">"8"</span> <span class="p">;</span>
    <span class="n">press</span><span class="p">:</span><span class="n">g_format_nan</span> <span class="o">=</span> <span class="s">"NaN"</span> <span class="p">;</span>
    <span class="n">press</span><span class="p">:</span><span class="n">g_processing_flag</span> <span class="o">=</span> <span class="s">"raw, smoothed, internal QC passed, additional QC passed"</span> <span class="p">;</span>
    <span class="n">press</span><span class="p">:</span><span class="n">g_source_desc</span> <span class="o">=</span> <span class="s">"FRAWPTU"</span> <span class="p">;</span>
    <span class="n">press</span><span class="p">:</span><span class="n">g_column_type</span> <span class="o">=</span> <span class="s">"original data"</span> <span class="p">;</span>
    <span class="n">press</span><span class="p">:</span><span class="n">g_resolution</span> <span class="o">=</span> <span class="s">"15.0 s (time)"</span> <span class="p">;</span>
    <span class="n">press</span><span class="p">:</span><span class="n">comment</span> <span class="o">=</span> <span class="s">"Barometric air pressure using silicon sensor up to 13.1 km, derived from GPS-altitude above"</span> <span class="p">;</span>
    <span class="n">press</span><span class="p">:</span><span class="n">related_columns</span> <span class="o">=</span> <span class="s">"u_press "</span> <span class="p">;</span>
    <span class="n">press</span><span class="p">:</span><span class="n">coordinates</span> <span class="o">=</span> <span class="s">"lon lat alt"</span> <span class="p">;</span>
</code></pre></div></div>

<p>You can see the unit used for time (in seconds) and that the time variable is related
to the launch time. And pressure is using hPa. Both variables are mapped against
the time dimension - you can see that by looking at the parenthesis that follow the variable name.</p>

<p>The following snippet contains an example of the metadata that is added to data
uploaded to GRUAN.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">//</span> <span class="k">global</span> <span class="n">attributes</span><span class="p">:</span>
    <span class="p">:</span><span class="n">Conventions</span> <span class="o">=</span> <span class="s">"CF-1.4"</span> <span class="p">;</span>
    <span class="p">:</span><span class="n">title</span> <span class="o">=</span> <span class="s">"RS92 GRUAN Data Product (Version 2)"</span> <span class="p">;</span>
    <span class="p">:</span><span class="n">institution</span> <span class="o">=</span> <span class="s">"JMA - Japan Meteorological Agency"</span> <span class="p">;</span>
    <span class="p">:</span><span class="n">source</span> <span class="o">=</span> <span class="s">"RS92-SGP"</span> <span class="p">;</span>
    <span class="p">:</span><span class="n">history</span> <span class="o">=</span> <span class="s">"2016-01-04 13:10:41.000Z RS92-GDP: RS92 GRUAN Data Product with gruan_DP_calcRsDataProduct.pro (GRUAN IDL Library, 2012-08)"</span> <span class="p">;</span>
    <span class="p">:</span><span class="n">references</span> <span class="o">=</span> <span class="s">"Currently no references"</span> <span class="p">;</span>
    <span class="p">:</span><span class="n">comment</span> <span class="o">=</span> <span class="s">"RS92 GRUAN Data Product"</span> <span class="p">;</span>
    <span class="p">:</span><span class="n">g</span><span class="p">.</span><span class="n">Product</span><span class="p">.</span><span class="n">ID</span> <span class="o">=</span> <span class="s">"180821"</span> <span class="p">;</span>
    <span class="p">:</span><span class="n">g</span><span class="p">.</span><span class="n">Product</span><span class="p">.</span><span class="n">Code</span> <span class="o">=</span> <span class="s">"RS92-GDP"</span> <span class="p">;</span>
    <span class="p">:</span><span class="n">g</span><span class="p">.</span><span class="n">Product</span><span class="p">.</span><span class="n">Name</span> <span class="o">=</span> <span class="s">"RS92 GRUAN Data Product"</span> <span class="p">;</span>
    <span class="p">:</span><span class="n">g</span><span class="p">.</span><span class="n">Product</span><span class="p">.</span><span class="n">Version</span> <span class="o">=</span> <span class="s">"2"</span> <span class="p">;</span>
    <span class="p">:</span><span class="n">g</span><span class="p">.</span><span class="n">Product</span><span class="p">.</span><span class="n">Level</span> <span class="o">=</span> <span class="s">"2"</span> <span class="p">;</span>
    <span class="p">:</span><span class="n">g</span><span class="p">.</span><span class="n">Product</span><span class="p">.</span><span class="n">LevelDescription</span> <span class="o">=</span> <span class="s">"Data read from original data file"</span> <span class="p">;</span>
    <span class="p">:</span><span class="n">g</span><span class="p">.</span><span class="n">Product</span><span class="p">.</span><span class="n">History</span> <span class="o">=</span> <span class="s">"2016-01-04 13:10:41.000Z RS92-GDP: RS92 GRUAN Data Product with gruan_DP_calcRsDataProduct.pro (GRUAN IDL Library, 2012-08)"</span> <span class="p">;</span>
    <span class="p">:</span><span class="n">g</span><span class="p">.</span><span class="n">Product</span><span class="p">.</span><span class="n">References</span> <span class="o">=</span> <span class="s">"Currently no references"</span> <span class="p">;</span>
    <span class="p">:</span><span class="n">g</span><span class="p">.</span><span class="n">Product</span><span class="p">.</span><span class="n">Producer</span> <span class="o">=</span> <span class="s">"GRUAN Lead Centre (Lindenberg, DWD, Germany)"</span> <span class="p">;</span>
</code></pre></div></div>

<p>For my work, the pccora Python library handled the binary data. I created a local variable,
<strong>hires_data</strong> that holds the high resolution data from the radiosonde. Then created a new
dataset, which is the NetCDF file.</p>

<p>It might be easier to explain the rest after looking at some code.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hires_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'hires_data'</span><span class="p">]</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="s">"w"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s">"NETCDF4_CLASSIC"</span><span class="p">)</span>

<span class="c1"># Dimensions
</span><span class="n">dataset</span><span class="p">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s">"time"</span><span class="p">)</span>

<span class="n">dataset</span><span class="p">.</span><span class="n">setncattr</span><span class="p">(</span><span class="s">'g.General.SiteWmoId'</span><span class="p">,</span> <span class="n">ident</span><span class="p">[</span><span class="s">'wmo_block_number'</span><span class="p">]</span> <span class="o">+</span> <span class="n">ident</span><span class="p">[</span><span class="s">'wmo_station_number'</span><span class="p">])</span>
<span class="n">dataset</span><span class="p">.</span><span class="n">setncattr</span><span class="p">(</span><span class="s">'g.MeasuringSystem.Longitude'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="s">'N/A'</span> <span class="k">if</span> <span class="bp">None</span> <span class="o">==</span> <span class="n">ident</span><span class="p">[</span><span class="s">'station_longitude'</span><span class="p">]</span> <span class="k">else</span> <span class="n">ident</span><span class="p">[</span><span class="s">'station_longitude'</span><span class="p">])</span> <span class="o">+</span> <span class="s">' degree east'</span><span class="p">)</span>
<span class="n">dataset</span><span class="p">.</span><span class="n">setncattr</span><span class="p">(</span><span class="s">'g.MeasuringSystem.Latitude'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ident</span><span class="p">[</span><span class="s">'station_latitude'</span><span class="p">])</span> <span class="o">+</span> <span class="s">' degree north'</span><span class="p">)</span>
</code></pre></div></div>

<p>In this example, a <strong>time</strong> dimension is added to our dataset, as well as some global attributes (metadata).</p>

<p>In another part of the code, we have to populate arrays with the values for the data
logged during the time, and then create variables to persist this data in the NetCDF
file.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># elapsed_time
</span><span class="n">elapsed_time_variable</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s">'elapsed_time'</span><span class="p">,</span> <span class="s">'f4'</span><span class="p">,</span> <span class="p">(</span><span class="s">"time"</span><span class="p">,</span> <span class="p">),</span> <span class="n">zlib</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=-</span><span class="mi">32768</span><span class="p">)</span>
<span class="n">elapsed_time_variable</span><span class="p">.</span><span class="n">standard_name</span> <span class="o">=</span> <span class="s">'elapsed_time'</span>
<span class="n">elapsed_time_variable</span><span class="p">.</span><span class="n">units</span> <span class="o">=</span> <span class="s">'s'</span>
<span class="n">elapsed_time_variable</span><span class="p">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s">'Elapsed time since sonde release'</span>
<span class="n">elapsed_time_variable</span><span class="p">.</span><span class="n">g_format_type</span> <span class="o">=</span> <span class="s">'FLT'</span>
<span class="n">elapsed_time_variable</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">elapsed_time</span>
</code></pre></div></div>

<p>In this example, <strong>elapsed_time</strong> is a simple Python array, with float values.</p>

<p>The complete code is available <a href="https://github.com/kinow/pccora/blob/5a47fa47c2d9009feb4c56e8daf1b8b5ca7ce7cf/scripts/convert2netcdf4.py">on GitHub</a>.</p>

<p>And once we have parsed the binary data, created the right structures in Python,
persisted the new data as NetCDF, we can use it with other tools and
programming languages.</p>

<p>The following plot was created for the temperature found in one of these files,
during the whole profiling of a radiosonde. You can see that as the radiosonde
goes up in the atmosphere, the temperature decreases, but then increases again.
Which is <a href="http://www.windows2universe.org/kids_space/temp_profile.html">normal when you move beyond the tropopause</a>.</p>

<p><img class="ui centered large bordered image" src="/assets/posts/2016-07-12-processing-vaisala-radiosonde-data-with-python-and-creating-gruan-like-netcdf-files/radiosonde_plot.png" alt="Radiosonde temperature NetCDF" /></p>

<p>That’s all for today!</p>

  </div>

  <div class="tags"><p>Tags:&nbsp;<a class="label" href="/tag/python">python</a>.<br/></p></div>

  <a class="u-url" href="/2016/07/12/processing-vaisala-radiosonde-data-with-python-and-creating-gruan-like-netcdf-files.html" hidden></a>
</article>

  </div>
</div>
</body>
</html>
