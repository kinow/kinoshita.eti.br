<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:url" content="https://kinoshita.eti.br/2016/07/12/processing-vaisala-radiosonde-data-with-python-and-creating-gruan-like-netcdf-files.html"><meta property="og:site_name" content="kinow"><meta property="og:title" content="Processing Vaisala Radiosonde data with Python, and creating GRUAN-like NetCDF files"><meta property="og:description" content="One of my last projects involved parsing a few GB&amp;rsquo;s of data that was in a certain binary format, and convert it into NetCDF files. In this post I will describe what was done, what I learned about radiosonde, GRUAN and other geek stuff. Ready?
Vaisala Radiosonde data When I was told the data was in some binary format, I thought it would be similar to parsing a flat file. That this would contain a fixed length entry, with the same kind of item repeated multiple times.
Well, not exactly.
The files had been generated by an instrument made by Vaisala, a Finnish company. This instrument is called a radiosonde. It is an instrument about the size of an old mobile phone, that is launched with a balloon into the atmosphere.
I was lucky to be given the chance to release one of these balloons carrying a newer version of this equipment.
Radiosonde balloon launch The balloon can carry equipments for measuring different things, like air pressure, altitude, temperature, latitude, longitude, relative humidity, among others. Equipments like the radiosonde send the data back to a ground-level station via radio, normally in a short and constant interval.
"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-07-12T00:00:00+00:00"><meta property="article:modified_time" content="2024-05-12T10:14:43+02:00"><meta property="article:tag" content="Python"><meta property="og:image" content="https://kinoshita.eti.br/assets/photos/about/2023-me-closeup.png"><meta property="fb:admins" content="bruno.kinoshita"><meta name=twitter:title content="Processing Vaisala Radiosonde data with Python, and creating GRUAN-like NetCDF files"><meta name=twitter:description content="One of my last projects involved parsing a few GB&rsquo;s of data that was in a certain binary format,
and convert it into NetCDF files. In this post I will describe what was done, what I learned about radiosonde,
GRUAN and other geek stuff. Ready?
Vaisala Radiosonde data
When I was told the data was in some binary format, I thought it would be similar to
parsing a flat file. That this would contain a fixed length entry, with the same
kind of item repeated multiple times.
Well, not exactly.
The files had been generated by an instrument made by Vaisala, a Finnish company. This
instrument is called a radiosonde. It is an instrument about the size of an old
mobile phone, that is launched with a balloon into the atmosphere.
I was lucky to be given the chance to release one of these balloons carrying a newer
version of this equipment.





  
  Radiosonde balloon launch




The balloon can carry equipments for measuring different things, like air pressure,
altitude, temperature, latitude, longitude, relative humidity, among others. Equipments
like the radiosonde send the data back to a ground-level station via radio,
normally in a short and constant interval."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kinoshita.eti.br/assets/photos/about/2023-me-closeup.png"><meta name=twitter:site content="@kinow"><link rel=alternate type=application/rss+xml href=https://kinoshita.eti.br/2016/07/12/processing-vaisala-radiosonde-data-with-python-and-creating-gruan-like-netcdf-files/feed.xml title=kinow><link rel=stylesheet type=text/css href=https://kinoshita.eti.br/sass/main.c3626db3678f53e4a53e3e75c7b2fe34bb46566f00eb84692501404d0064c32a.css integrity="sha256-w2Jts2ePU+SlPj51x7L+NLtGVm8A64RpJQFATQBkwyo="><title>kinow | Processing Vaisala Radiosonde data with Python, and creating GRUAN-like NetCDF files</title><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"posts","name":"Processing Vaisala Radiosonde data with Python, and creating GRUAN-like NetCDF files","headline":"Processing Vaisala Radiosonde data with Python, and creating GRUAN-like NetCDF files","alternativeHeadline":"","description":"\u003cp\u003eOne of my last projects involved parsing a few GB\u0026rsquo;s of data that was in a certain binary format,\nand convert it into NetCDF files. In this post I will describe what was done, what I learned about radiosonde,\n\u003ca href=\u0022http:\/\/www.dwd.de\/EN\/research\/international_programme\/gruan\/home.html\u0022\u003eGRUAN\u003c\/a\u003e and other geek stuff. Ready?\u003c\/p\u003e\n\u003ch3 id=\u0022vaisala-radiosonde-data\u0022\u003eVaisala Radiosonde data\u003c\/h3\u003e\n\u003cp\u003eWhen I was told the data was in some binary format, I thought it would be similar to\nparsing a flat file. That this would contain a fixed length entry, with the same\nkind of item repeated multiple times.\u003c\/p\u003e\n\u003cp\u003eWell, not exactly.\u003c\/p\u003e\n\u003cp\u003eThe files had been generated by an instrument made by \u003ca href=\u0022http:\/\/www.vaisala.com\u0022\u003eVaisala\u003c\/a\u003e, a Finnish company. This\ninstrument is called a \u003cstrong\u003eradiosonde\u003c\/strong\u003e. It is an instrument about the size of an old\nmobile phone, that is launched with a balloon into the atmosphere.\u003c\/p\u003e\n\u003cp\u003eI was lucky to be given the chance to release one of these balloons carrying a newer\nversion of this equipment.\u003c\/p\u003e\n\n\n\n\u003cfigure class=\u0022feature\u0022\u003e\n\n  \u003cimg\n    src=\u0027\/assets\/posts\/2016-07-12-processing-vaisala-radiosonde-data-with-python-and-creating-gruan-like-netcdf-files\/balloon-launch.jpg\u0027\n    alt=\u0027Radiosonde balloon launch\u0027\n    title=\u0027Radiosonde balloon launch\u0027\n    style=\u0027\u0027\n    width=\u0027\u0027\n    height=\u0027\u0027\n    \/\u003e\n  \u003cfigcaption\u003eRadiosonde balloon launch\u003c\/figcaption\u003e\n\n\u003c\/figure\u003e\n\n\n\u003cp\u003eThe balloon can carry equipments for measuring different things, like air pressure,\naltitude, temperature, latitude, longitude, relative humidity, among others. Equipments\nlike the radiosonde send the data back to a ground-level station via radio,\nnormally in a short and constant interval.\u003c\/p\u003e","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/kinoshita.eti.br\/2016\/07\/12\/processing-vaisala-radiosonde-data-with-python-and-creating-gruan-like-netcdf-files.html"},"author":{"@type":"Person","name":"Bruno P. Kinoshita"},"creator":{"@type":"Person","name":"Bruno P. Kinoshita"},"accountablePerson":{"@type":"Person","name":"Bruno P. Kinoshita"},"copyrightHolder":"kinow","copyrightYear":"2016","dateCreated":"2016-07-12T00:00:00.00Z","datePublished":"2016-07-12T00:00:00.00Z","dateModified":"2024-05-12T10:14:43.00Z","publisher":{"@type":"Organization","name":"kinow","url":"https://kinoshita.eti.br/","logo":{"@type":"ImageObject","url":"https:\/\/kinoshita.eti.br\/","width":"32","height":"32"}},"image":"https://kinoshita.eti.br/","url":"https:\/\/kinoshita.eti.br\/2016\/07\/12\/processing-vaisala-radiosonde-data-with-python-and-creating-gruan-like-netcdf-files.html","wordCount":"1303","genre":["python"],"keywords":[]}</script></head><body><header role=banner class=content><nav id=nav aria-label=Main role=navigation class=content><ul><li><a href=/><i data-feather=about></i> About</a></li><li><a href=/blog/><i data-feather=blog></i> Blog</a></li><li><a href=/portfolio/><i data-feather=portfolio></i> Portfolio</a></li></ul></nav></header><main><article class=content><h1>Processing Vaisala Radiosonde data with Python, and creating GRUAN-like NetCDF files</h1><div class=metadata><i data-feather=calendar></i>
<time datetime=2016-07-12>Jul 12, 2016</time></div><aside><nav id=TableOfContents><ul><li><ul><li><a href=#vaisala-radiosonde-data>Vaisala Radiosonde data</a></li><li><a href=#parsing-binary-data-with-python-and-construct>Parsing binary data with Python and construct</a></li><li><a href=#what-is-gruan-and-why-should-i-care>What is GRUAN, and why should I care?</a></li><li><a href=#producing-netcdf-files-with-python>Producing NetCDF files with Python</a></li></ul></li></ul></nav></aside><p>One of my last projects involved parsing a few GB&rsquo;s of data that was in a certain binary format,
and convert it into NetCDF files. In this post I will describe what was done, what I learned about radiosonde,
<a href=http://www.dwd.de/EN/research/international_programme/gruan/home.html>GRUAN</a> and other geek stuff. Ready?</p><h3 id=vaisala-radiosonde-data>Vaisala Radiosonde data</h3><p>When I was told the data was in some binary format, I thought it would be similar to
parsing a flat file. That this would contain a fixed length entry, with the same
kind of item repeated multiple times.</p><p>Well, not exactly.</p><p>The files had been generated by an instrument made by <a href=http://www.vaisala.com>Vaisala</a>, a Finnish company. This
instrument is called a <strong>radiosonde</strong>. It is an instrument about the size of an old
mobile phone, that is launched with a balloon into the atmosphere.</p><p>I was lucky to be given the chance to release one of these balloons carrying a newer
version of this equipment.</p><figure class=feature><img src=/assets/posts/2016-07-12-processing-vaisala-radiosonde-data-with-python-and-creating-gruan-like-netcdf-files/balloon-launch.jpg alt='Radiosonde balloon launch' title='Radiosonde balloon launch' width height><figcaption>Radiosonde balloon launch</figcaption></figure><p>The balloon can carry equipments for measuring different things, like air pressure,
altitude, temperature, latitude, longitude, relative humidity, among others. Equipments
like the radiosonde send the data back to a ground-level station via radio,
normally in a short and constant interval.</p><p>The data that I had to parse was Vaisala radiosonde data. But in an older format. The documentation for the format
can be found online at <a href=http://badc.nerc.ac.uk/data/ukmo-rad-hires/pc-coradata.html>http://badc.nerc.ac.uk/data/ukmo-rad-hires/pc-coradata.html</a>.</p><p>There are four different sections. And one field in the identification section defines the
number of entries found in another field (high resolution). Each section has multiple fields,
with different data types.</p><p>Not so easy to parse&mldr;</p><h3 id=parsing-binary-data-with-python-and-construct>Parsing binary data with Python and construct</h3><p><a href=https://construct.readthedocs.io/>Construct</a> is a declarative parser for binary data.
You can build a parser by simply saying what you expect to be in each field. For example.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>pccora_header</span> <span style=color:#000>=</span> <span style=color:#000>Struct</span>(<span style=color:#c41a16>&#34;pccora_header&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#000>ExprAdapter</span>(<span style=color:#000>String</span>(<span style=color:#c41a16>&#34;copyright&#34;</span>, <span style=color:#1c01ce>20</span>),
</span></span><span style=display:flex><span>        <span style=color:#000>encoder</span> <span style=color:#000>=</span> <span style=color:#a90d91>lambda</span> <span style=color:#000>obj</span>, <span style=color:#000>ctx</span>: <span style=color:#000>obj</span><span style=color:#000>.</span><span style=color:#000>encode</span>(),
</span></span><span style=display:flex><span>        <span style=color:#000>decoder</span> <span style=color:#000>=</span> <span style=color:#a90d91>lambda</span> <span style=color:#000>obj</span>, <span style=color:#000>ctx</span>: <span style=color:#000>obj</span><span style=color:#000>.</span><span style=color:#000>decode</span>(<span style=color:#c41a16>&#39;utf-8&#39;</span>, <span style=color:#c41a16>&#39;ignore&#39;</span>)
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    <span style=color:#000>SLInt16</span>(<span style=color:#c41a16>&#34;identification_length&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#000>SLInt16</span>(<span style=color:#c41a16>&#34;syspar_length&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#000>SLInt16</span>(<span style=color:#c41a16>&#34;data_records&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#000>SLInt16</span>(<span style=color:#c41a16>&#34;standard_levels&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#000>SLInt16</span>(<span style=color:#c41a16>&#34;data_type&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#000>SLInt16</span>(<span style=color:#c41a16>&#34;data_length&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#000>Enum</span>(<span style=color:#000>Byte</span>(<span style=color:#c41a16>&#34;file_ready&#34;</span>),
</span></span><span style=display:flex><span>        <span style=color:#000>READY</span> <span style=color:#000>=</span> <span style=color:#1c01ce>1</span>,
</span></span><span style=display:flex><span>        <span style=color:#000>NOT_READY</span> <span style=color:#000>=</span> <span style=color:#1c01ce>0</span>,
</span></span><span style=display:flex><span>        <span style=color:#000>_default_</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;UNKNOWN&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    <span style=color:#000>Bytes</span>(<span style=color:#c41a16>&#34;reserved&#34;</span>, <span style=color:#1c01ce>17</span>)
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>This sample code parses the <strong>Header</strong> section of the Vaisala binary file. You define each field,
with a short name, a data type and a length. You can also have expressions to encode
or decode. And you can control how fields relate to each other, and how they repeat
in the data format.</p><p>A complete parser for the binary format was written with Construct, and is available
via pip as well, as a package called <a href=https://github.com/kinow/pccora>pccora</a>. You can
install it via <code>pip install pccora</code>, and use it to parse any data in this old binary
format.</p><p>There are utility scripts in the pccora GitHub project. One of the scripts, <strong>convert2netcdf.py</strong>,
converts the Vaisala binary data into a NetCDF that is close to what GRUAN produces.</p><h3 id=what-is-gruan-and-why-should-i-care>What is GRUAN, and why should I care?</h3><figure class=feature><img src=/assets/posts/2016-07-12-processing-vaisala-radiosonde-data-with-python-and-creating-gruan-like-netcdf-files/sherlock1.png alt='OG Sherlock Kush' title='OG Sherlock Kush' width height><figcaption>OG Sherlock Kush</figcaption></figure><p>This part of the post is more climate and research-oriented. So if you are more geek-savvy, feel free
to jump to the next section.</p><p><a href=http://www.dwd.de/EN/research/international_programme/gruan/home.html>GRUAN</a> stands for
<em>Global Climate Observing System (GCOS) Reference Upper-Air Network (GRUAN)</em>.</p><p>It is a group of professionals and researchers that work together to create a reference
network for climate records. They provide data in a standardised way, and with a uniform
quality control process.</p><p>This makes it much easier for researchers to use and share data in their work, since they can
write tools and scripts once for GRUAN data. Also, there is a quality control process, and
every data is annotated with metadata.</p><h3 id=producing-netcdf-files-with-python>Producing NetCDF files with Python</h3><p><a href=https://en.wikipedia.org/wiki/NetCDF>NetCDF</a>, the Network Common Data Form, is
a data format that supports arrays with dimensions. Version 4 of NetCDF supports
<a href=https://en.wikipedia.org/wiki/HDF5>HDF5</a> too, which is a hierarchical data format.</p><p>In NetCDF, you create variables, which contains an array of values - or missing values.
These variables relate to one or more dimensions, like time, or altitude.</p><p>As for radiosonde data, we have NetCDF files created by GRUAN certified sites. Like
<a href="http://www.esrl.noaa.gov/psd/iasoa/dataset_record/?datasetid=1111">this example from NOAA</a>.
Following the Download link you should be directed to the FTP site. There you
can grab any example GRUAN NetCDF (.nc) file and inspect with <em>ncdump</em>,
<em>Panoply</em>, <em>ncBrowse</em> or your favourite editor.</p><p>For the file <a href=ftp://ftp.ncdc.noaa.gov/pub/data/gruan/processing/level2/RS92-GDP/version-002/TAT/2016/TAT-RS-01_2_RS92-GDP_002_20160104T000000_1-000-001.nc></a>for example, the <strong>time</strong> and <strong>pressure</strong> variables are described below.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>dimensions</span>:
</span></span><span style=display:flex><span>  <span style=color:#000>time</span> <span style=color:#000>=</span> <span style=color:#000>UNLIMITED</span> ; <span style=color:#000>//</span> (<span style=color:#1c01ce>5735</span> <span style=color:#000>currently</span>)
</span></span><span style=display:flex><span><span style=color:#000>variables</span>:
</span></span><span style=display:flex><span>  <span style=color:#a90d91>float</span> <span style=color:#000>time</span>(<span style=color:#000>time</span>) ;
</span></span><span style=display:flex><span>    <span style=color:#000>time</span>:<span style=color:#000>standard_name</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;time&#34;</span> ;
</span></span><span style=display:flex><span>    <span style=color:#000>time</span>:<span style=color:#000>units</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;seconds since 2016-01-03T23:30:16&#34;</span> ;
</span></span><span style=display:flex><span>    <span style=color:#000>time</span>:<span style=color:#000>long_name</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;Time&#34;</span> ;
</span></span><span style=display:flex><span>    <span style=color:#000>time</span>:<span style=color:#000>g_format_type</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;FLT&#34;</span> ;
</span></span><span style=display:flex><span>    <span style=color:#000>time</span>:<span style=color:#000>g_format_format</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;F8.1&#34;</span> ;
</span></span><span style=display:flex><span>    <span style=color:#000>time</span>:<span style=color:#000>g_format_width</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;8&#34;</span> ;
</span></span><span style=display:flex><span>    <span style=color:#000>time</span>:<span style=color:#000>g_format_nan</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;NaN&#34;</span> ;
</span></span><span style=display:flex><span>    <span style=color:#000>time</span>:<span style=color:#000>g_source_desc</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;FRAWPTU&#34;</span> ;
</span></span><span style=display:flex><span>    <span style=color:#000>time</span>:<span style=color:#000>g_column_type</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;original data&#34;</span> ;
</span></span><span style=display:flex><span>    <span style=color:#000>time</span>:<span style=color:#000>g_resolution</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;1.0 s (time)&#34;</span> ;
</span></span><span style=display:flex><span>    <span style=color:#000>time</span>:<span style=color:#000>axis</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;T&#34;</span> ;
</span></span><span style=display:flex><span>    <span style=color:#000>time</span>:<span style=color:#000>calendar</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;gregorian&#34;</span> ;
</span></span><span style=display:flex><span>  <span style=color:#a90d91>float</span> <span style=color:#000>press</span>(<span style=color:#000>time</span>) ;
</span></span><span style=display:flex><span>    <span style=color:#000>press</span>:<span style=color:#000>standard_name</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;air_pressure&#34;</span> ;
</span></span><span style=display:flex><span>    <span style=color:#000>press</span>:<span style=color:#000>units</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;hPa&#34;</span> ;
</span></span><span style=display:flex><span>    <span style=color:#000>press</span>:<span style=color:#000>long_name</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;Pressure&#34;</span> ;
</span></span><span style=display:flex><span>    <span style=color:#000>press</span>:<span style=color:#000>g_format_type</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;FLT&#34;</span> ;
</span></span><span style=display:flex><span>    <span style=color:#000>press</span>:<span style=color:#000>g_format_format</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;F8.3&#34;</span> ;
</span></span><span style=display:flex><span>    <span style=color:#000>press</span>:<span style=color:#000>g_format_width</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;8&#34;</span> ;
</span></span><span style=display:flex><span>    <span style=color:#000>press</span>:<span style=color:#000>g_format_nan</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;NaN&#34;</span> ;
</span></span><span style=display:flex><span>    <span style=color:#000>press</span>:<span style=color:#000>g_processing_flag</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;raw, smoothed, internal QC passed, additional QC passed&#34;</span> ;
</span></span><span style=display:flex><span>    <span style=color:#000>press</span>:<span style=color:#000>g_source_desc</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;FRAWPTU&#34;</span> ;
</span></span><span style=display:flex><span>    <span style=color:#000>press</span>:<span style=color:#000>g_column_type</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;original data&#34;</span> ;
</span></span><span style=display:flex><span>    <span style=color:#000>press</span>:<span style=color:#000>g_resolution</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;15.0 s (time)&#34;</span> ;
</span></span><span style=display:flex><span>    <span style=color:#000>press</span>:<span style=color:#000>comment</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;Barometric air pressure using silicon sensor up to 13.1 km, derived from GPS-altitude above&#34;</span> ;
</span></span><span style=display:flex><span>    <span style=color:#000>press</span>:<span style=color:#000>related_columns</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;u_press &#34;</span> ;
</span></span><span style=display:flex><span>    <span style=color:#000>press</span>:<span style=color:#000>coordinates</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;lon lat alt&#34;</span> ;
</span></span></code></pre></div><p>You can see the unit used for time (in seconds) and that the time variable is related
to the launch time. And pressure is using hPa. Both variables are mapped against
the time dimension - you can see that by looking at the parenthesis that follow the variable name.</p><p>The following snippet contains an example of the metadata that is added to data
uploaded to GRUAN.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>//</span> <span style=color:#a90d91>global</span> <span style=color:#000>attributes</span>:
</span></span><span style=display:flex><span>    :<span style=color:#000>Conventions</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;CF-1.4&#34;</span> ;
</span></span><span style=display:flex><span>    :<span style=color:#000>title</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;RS92 GRUAN Data Product (Version 2)&#34;</span> ;
</span></span><span style=display:flex><span>    :<span style=color:#000>institution</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;JMA - Japan Meteorological Agency&#34;</span> ;
</span></span><span style=display:flex><span>    :<span style=color:#000>source</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;RS92-SGP&#34;</span> ;
</span></span><span style=display:flex><span>    :<span style=color:#000>history</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;2016-01-04 13:10:41.000Z RS92-GDP: RS92 GRUAN Data Product with gruan_DP_calcRsDataProduct.pro (GRUAN IDL Library, 2012-08)&#34;</span> ;
</span></span><span style=display:flex><span>    :<span style=color:#000>references</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;Currently no references&#34;</span> ;
</span></span><span style=display:flex><span>    :<span style=color:#000>comment</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;RS92 GRUAN Data Product&#34;</span> ;
</span></span><span style=display:flex><span>    :<span style=color:#000>g</span><span style=color:#000>.</span><span style=color:#000>Product</span><span style=color:#000>.</span><span style=color:#000>ID</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;180821&#34;</span> ;
</span></span><span style=display:flex><span>    :<span style=color:#000>g</span><span style=color:#000>.</span><span style=color:#000>Product</span><span style=color:#000>.</span><span style=color:#000>Code</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;RS92-GDP&#34;</span> ;
</span></span><span style=display:flex><span>    :<span style=color:#000>g</span><span style=color:#000>.</span><span style=color:#000>Product</span><span style=color:#000>.</span><span style=color:#000>Name</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;RS92 GRUAN Data Product&#34;</span> ;
</span></span><span style=display:flex><span>    :<span style=color:#000>g</span><span style=color:#000>.</span><span style=color:#000>Product</span><span style=color:#000>.</span><span style=color:#000>Version</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;2&#34;</span> ;
</span></span><span style=display:flex><span>    :<span style=color:#000>g</span><span style=color:#000>.</span><span style=color:#000>Product</span><span style=color:#000>.</span><span style=color:#000>Level</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;2&#34;</span> ;
</span></span><span style=display:flex><span>    :<span style=color:#000>g</span><span style=color:#000>.</span><span style=color:#000>Product</span><span style=color:#000>.</span><span style=color:#000>LevelDescription</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;Data read from original data file&#34;</span> ;
</span></span><span style=display:flex><span>    :<span style=color:#000>g</span><span style=color:#000>.</span><span style=color:#000>Product</span><span style=color:#000>.</span><span style=color:#000>History</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;2016-01-04 13:10:41.000Z RS92-GDP: RS92 GRUAN Data Product with gruan_DP_calcRsDataProduct.pro (GRUAN IDL Library, 2012-08)&#34;</span> ;
</span></span><span style=display:flex><span>    :<span style=color:#000>g</span><span style=color:#000>.</span><span style=color:#000>Product</span><span style=color:#000>.</span><span style=color:#000>References</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;Currently no references&#34;</span> ;
</span></span><span style=display:flex><span>    :<span style=color:#000>g</span><span style=color:#000>.</span><span style=color:#000>Product</span><span style=color:#000>.</span><span style=color:#000>Producer</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;GRUAN Lead Centre (Lindenberg, DWD, Germany)&#34;</span> ;
</span></span></code></pre></div><p>For my work, the pccora Python library handled the binary data. I created a local variable,
<strong>hires_data</strong> that holds the high resolution data from the radiosonde. Then created a new
dataset, which is the NetCDF file.</p><p>It might be easier to explain the rest after looking at some code.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>hires_data</span> <span style=color:#000>=</span> <span style=color:#000>data</span>[<span style=color:#c41a16>&#39;hires_data&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>dataset</span> <span style=color:#000>=</span> <span style=color:#000>Dataset</span>(<span style=color:#000>file</span>, <span style=color:#c41a16>&#34;w&#34;</span>, <span style=color:#a90d91>format</span><span style=color:#000>=</span><span style=color:#c41a16>&#34;NETCDF4_CLASSIC&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500># Dimensions</span>
</span></span><span style=display:flex><span><span style=color:#000>dataset</span><span style=color:#000>.</span><span style=color:#000>createDimension</span>(<span style=color:#c41a16>&#34;time&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>dataset</span><span style=color:#000>.</span><span style=color:#000>setncattr</span>(<span style=color:#c41a16>&#39;g.General.SiteWmoId&#39;</span>, <span style=color:#000>ident</span>[<span style=color:#c41a16>&#39;wmo_block_number&#39;</span>] <span style=color:#000>+</span> <span style=color:#000>ident</span>[<span style=color:#c41a16>&#39;wmo_station_number&#39;</span>])
</span></span><span style=display:flex><span><span style=color:#000>dataset</span><span style=color:#000>.</span><span style=color:#000>setncattr</span>(<span style=color:#c41a16>&#39;g.MeasuringSystem.Longitude&#39;</span>, <span style=color:#a90d91>str</span>(<span style=color:#c41a16>&#39;N/A&#39;</span> <span style=color:#a90d91>if</span> <span style=color:#a90d91>None</span> <span style=color:#000>==</span> <span style=color:#000>ident</span>[<span style=color:#c41a16>&#39;station_longitude&#39;</span>] <span style=color:#a90d91>else</span> <span style=color:#000>ident</span>[<span style=color:#c41a16>&#39;station_longitude&#39;</span>]) <span style=color:#000>+</span> <span style=color:#c41a16>&#39; degree east&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#000>dataset</span><span style=color:#000>.</span><span style=color:#000>setncattr</span>(<span style=color:#c41a16>&#39;g.MeasuringSystem.Latitude&#39;</span>, <span style=color:#a90d91>str</span>(<span style=color:#000>ident</span>[<span style=color:#c41a16>&#39;station_latitude&#39;</span>]) <span style=color:#000>+</span> <span style=color:#c41a16>&#39; degree north&#39;</span>)
</span></span></code></pre></div><p>In this example, a <strong>time</strong> dimension is added to our dataset, as well as some global attributes (metadata).</p><p>In another part of the code, we have to populate arrays with the values for the data
logged during the time, and then create variables to persist this data in the NetCDF
file.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#177500># elapsed_time</span>
</span></span><span style=display:flex><span><span style=color:#000>elapsed_time_variable</span> <span style=color:#000>=</span> <span style=color:#000>dataset</span><span style=color:#000>.</span><span style=color:#000>createVariable</span>(<span style=color:#c41a16>&#39;elapsed_time&#39;</span>, <span style=color:#c41a16>&#39;f4&#39;</span>, (<span style=color:#c41a16>&#34;time&#34;</span>, ), <span style=color:#000>zlib</span><span style=color:#000>=</span><span style=color:#a90d91>True</span>, <span style=color:#000>fill_value</span><span style=color:#000>=-</span><span style=color:#1c01ce>32768</span>)
</span></span><span style=display:flex><span><span style=color:#000>elapsed_time_variable</span><span style=color:#000>.</span><span style=color:#000>standard_name</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#39;elapsed_time&#39;</span>
</span></span><span style=display:flex><span><span style=color:#000>elapsed_time_variable</span><span style=color:#000>.</span><span style=color:#000>units</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#39;s&#39;</span>
</span></span><span style=display:flex><span><span style=color:#000>elapsed_time_variable</span><span style=color:#000>.</span><span style=color:#000>long_name</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#39;Elapsed time since sonde release&#39;</span>
</span></span><span style=display:flex><span><span style=color:#000>elapsed_time_variable</span><span style=color:#000>.</span><span style=color:#000>g_format_type</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#39;FLT&#39;</span>
</span></span><span style=display:flex><span><span style=color:#000>elapsed_time_variable</span>[:] <span style=color:#000>=</span> <span style=color:#000>elapsed_time</span>
</span></span></code></pre></div><p>In this example, <strong>elapsed_time</strong> is a simple Python array, with float values.</p><p>The complete code is available <a href=https://github.com/kinow/pccora/blob/5a47fa47c2d9009feb4c56e8daf1b8b5ca7ce7cf/scripts/convert2netcdf4.py>on GitHub</a>.</p><p>And once we have parsed the binary data, created the right structures in Python,
persisted the new data as NetCDF, we can use it with other tools and
programming languages.</p><p>The following plot was created for the temperature found in one of these files,
during the whole profiling of a radiosonde. You can see that as the radiosonde
goes up in the atmosphere, the temperature decreases, but then increases again.
Which is <a href=http://www.windows2universe.org/kids_space/temp_profile.html>normal when you move beyond the tropopause</a>.</p><figure class=feature><img src=/assets/posts/2016-07-12-processing-vaisala-radiosonde-data-with-python-and-creating-gruan-like-netcdf-files/radiosonde_plot.png alt='Radiosonde temperature NetCDF' title='Radiosonde temperature NetCDF' width height><figcaption>Radiosonde temperature NetCDF</figcaption></figure><p>That&rsquo;s all for today!</p><p>Categories:
<a href=/categories/blog.html>Blog</a></p><p>Tags:
<a href=/tags/python.html>Python</a></p><aside class=links><a class=previous href=https://kinoshita.eti.br/2016/05/16/drawing-sketch-blue-hair.html>&#171; Previous</a><a class=next href=https://kinoshita.eti.br/2016/07/17/reasons-for-having-pt-and-pt-br-in-a-software.html>Next &#187;</a></aside></article></main><footer role=contentinfo><ul id=social-media-icons><li><a href=https://www.instagram.com/brunokinoshita/><img src=/assets/icons/instagram.png alt="Instagram link"></a></li><li><a href=https://twitter.com/kinow/><img src=/assets/icons/twitter.png alt="Twitter link"></a></li><li><a href=https://github.com/kinow/><img src=/assets/icons/github.png alt="GitHub link"></a></li><li><a href=/feed.xml><img src=/assets/icons/news.png alt="RSS feed link"></a></li></ul></footer></body></html>