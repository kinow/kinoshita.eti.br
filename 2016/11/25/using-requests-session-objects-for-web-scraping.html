<!doctype html><html lang=en><head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=stylesheet type=text/css href=https://kinoshita.eti.br/sass/main.5770a4bbb94587745388ea30c6a21828c384682fd7a84b8d636265cbd651d758.css integrity="sha256-V3Cku7lFh3RTiOowxqIYKMOEaC/XqEuNY2Jly9ZR11g=">
<title>kinow | Using Requests Session Objects for web scraping</title>
</head>
<body><header role=banner class=content>
<nav id=nav aria-label=Main role=navigation class=content>
<ul><li>
<a href=/>
<i data-feather=about></i> About</a>
</li><li>
<a href=/blog/>
<i data-feather=blog></i> Blog</a>
</li><li>
<a href=/portfolio/>
<i data-feather=portfolio></i> Portfolio</a>
</li><li></li>
</ul>
</nav>
</header>
<main>
<article class=content>
<h2>Using Requests Session Objects for web scraping</h2><div class=metadata>
<i data-feather=calendar></i>
<time datetime=2016-11-25>Nov 25, 2016</time>
</div>
<p>I had to write a Python script some months ago, that would retrieve Solar energy
data from a web site. It was basically a handful of HTTP calls, parse the response
that was mainly in JSON, and store the results as JSON and CSV for processing later.</p>
<p>Since it was such a small task, I used the <a href=http://docs.python-requests.org>Requests</a>
module instead of a complete web scraper. The HTTP requests had to be made with a
time out, and also pass certain headers. I started customizing each call, until
I learned about the Requests <a href=http://docs.python-requests.org/en/master/user/advanced/>Session Objects</a>.</p>
<p>You create a session, as in ORM/JPA, where you can define a context, with certain properties
and control an orthogonal behavior.</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:navy;font-weight:700>import</span> requests

<span style=color:navy;font-weight:700>def</span> get(session, url):
    <span style=color:#00f>&#34;&#34;&#34;Utility method to HTTP GET a URL&#34;&#34;&#34;</span>
    response = session.get(url, timeout=<span style=color:navy;font-weight:700>None</span>)
    <span style=color:navy;font-weight:700>return</span> response

<span style=color:navy;font-weight:700>def</span> post(session, url, data):
    <span style=color:#00f>&#34;&#34;&#34;Utility method to HTTP POST a URL with data parameters&#34;&#34;&#34;</span>
    response = session.post(url, data=data, timeout=<span style=color:navy;font-weight:700>None</span>)
    <span style=color:navy;font-weight:700>if</span> response.status_code != requests.codes.ok:
        response.raise_for_status()
    <span style=color:navy;font-weight:700>return</span> response

<span style=color:navy;font-weight:700>with</span> requests.Session() <span style=color:navy;font-weight:700>as</span> s:
    <span style=color:#080;font-style:italic># x-test header will be sent with every request</span>
    s.headers.update({<span style=color:#00f>&#39;x-test&#39;</span>: <span style=color:#00f>&#39;true&#39;</span>})

    data = {<span style=color:#00f>&#39;user&#39;</span>: user, <span style=color:#00f>&#39;password&#39;</span>: password, <span style=color:#00f>&#39;rememberne&#39;</span>: <span style=color:#00f>&#39;false&#39;</span>}
    r = post(s, <span style=color:#00f>&#39;https://portal.login.url&#39;</span>, data)

    r = get(s, <span style=color:#00f>&#39;https://portal.home.url&#39;</span>)
</code></pre></div><p>Besides the session object, that gives you ability to add headers to all requests,
you won&rsquo;t have to worry about redirects. The library by default takes care
<a href=https://github.com/kennethreitz/requests/blob/dfad00a6e84bc75b12468ca29ccf4f971c813fc8/requests/sessions.py#L110>of that</a>
with a <a href=https://github.com/kennethreitz/requests/blob/dfad00a6e84bc75b12468ca29ccf4f971c813fc8/requests/models.py#L54>default limit of up to 30</a>.</p>
<p>Happy hacking!</p>
<aside class=links>
<a class=previous href=https://kinoshita.eti.br/2016/11/21/changing-spring-boot-environment-variables-in-the-command-line.html>&#171; Previous</a>
<a class=next href=https://kinoshita.eti.br/2016/12/19/permgen-errors-and-java.lang.classcastexception-com.sun.crypto.provider.aescipher-cannot-be-cast-to-javax.crypto.cipherspi-running-jenkins-plug-in-tests-with-powermock.html>Next &#187;</a>
</aside>
</article>
</main>
<footer role=contentinfo>
<ul id=social-media-icons>
<li>
<a href=https://www.instagram.com/brunokinoshita/>
<img src=/assets/icons/instagram.png alt="Instagram link">
</a>
</li>
<li>
<a href=https://twitter.com/kinow/>
<img src=/assets/icons/twitter.png alt="Twitter link">
</a>
</li>
<li>
<a href=https://github.com/kinow/>
<img src=/assets/icons/github.png alt="GitHub link">
</a>
</li>
</ul>
</footer>
</body>
</html>