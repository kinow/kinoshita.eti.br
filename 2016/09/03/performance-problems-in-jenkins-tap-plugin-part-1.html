<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Performance problems in Jenkins TAP Plug-in — part 1 | Bruno P. Kinoshita</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Performance problems in Jenkins TAP Plug-in — part 1" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="JENKINS-17887 reports performance problems in the Jenkins TAP Plug-in. It also lists a series of suggestions on how to improve the Jenkins TAP Plug-in performance. On this initial post, we will get a general idea of how the plug-in performs for large projects. BioPerl has over 21K tests. That should be enough for giving an initial idea of CPU, memory and disk usage for the plug-in. git clone https://github.com/bioperl/bioperl-live.git cd bioperl-live sudo cpanm -vv --installdeps --notest . sudo cpanm Set::Scalar Graph::Directed XML::LibXML XML::SAX \ SVG XML::Parser::PerlSAX Convert::Binary::C XML::SAX::Writer \ XML::DOM::XPath Spreadsheet::ParseExcel XML::SAX::Writer \ XML::DOM HTML::TableExtract XML::Simple Test::Pod DBI prove -r t/ -a tests.tar.gz All tests successful. Files=325, Tests=21095, 94 wallclock secs ( 2.47 usr 0.55 sys + 88.29 cusr 3.85 csys = 95.16 CPU) Result: PASS When the test results are parsed, the plug-in also copies TAP files over to the master, in a folder called tap-master-files. The BioPerl tests are not really big, just 1.7M. It gets doubled as there will be the workspace copy, and the tap-master-files directory copy, so 3.4M. But several objects get created in memory, and persisted into the build.xml job file. BioPerl generates a build.xml file with 11M. So less than 15M. But the build.xml contains objects that are read via XStream by Jenkins and into the memory. The build page with the graph, and the other two test result pages are rendering in more than 10 seconds in my computer. But the CPU load is OK, so a closer look at the memory use would probably be more interesting. The image shows one of the screens in YourKit profiler, where it is possible to see that org.tap4j.plugin.model.TapTestResultResult has over 6 million objects. One build.xml for the BioPerl project gets over 80K entries for the TestResult object. grep &quot;org.tap4j.model.TestResult&quot; builds/1/build.xml -o | wc -l 84522 This happens because each TAP file may contain multiple test results (lines with test results). Each of these test results gets turned into a Java object and loaded by the plug-in. So when loading the test result pages, Jenkins needs to wait until all these objects have been parsed, deserialized and read into the memory. The next post will continue on code improvements, and another benchmark. Happy profiling!" />
<meta property="og:description" content="JENKINS-17887 reports performance problems in the Jenkins TAP Plug-in. It also lists a series of suggestions on how to improve the Jenkins TAP Plug-in performance. On this initial post, we will get a general idea of how the plug-in performs for large projects. BioPerl has over 21K tests. That should be enough for giving an initial idea of CPU, memory and disk usage for the plug-in. git clone https://github.com/bioperl/bioperl-live.git cd bioperl-live sudo cpanm -vv --installdeps --notest . sudo cpanm Set::Scalar Graph::Directed XML::LibXML XML::SAX \ SVG XML::Parser::PerlSAX Convert::Binary::C XML::SAX::Writer \ XML::DOM::XPath Spreadsheet::ParseExcel XML::SAX::Writer \ XML::DOM HTML::TableExtract XML::Simple Test::Pod DBI prove -r t/ -a tests.tar.gz All tests successful. Files=325, Tests=21095, 94 wallclock secs ( 2.47 usr 0.55 sys + 88.29 cusr 3.85 csys = 95.16 CPU) Result: PASS When the test results are parsed, the plug-in also copies TAP files over to the master, in a folder called tap-master-files. The BioPerl tests are not really big, just 1.7M. It gets doubled as there will be the workspace copy, and the tap-master-files directory copy, so 3.4M. But several objects get created in memory, and persisted into the build.xml job file. BioPerl generates a build.xml file with 11M. So less than 15M. But the build.xml contains objects that are read via XStream by Jenkins and into the memory. The build page with the graph, and the other two test result pages are rendering in more than 10 seconds in my computer. But the CPU load is OK, so a closer look at the memory use would probably be more interesting. The image shows one of the screens in YourKit profiler, where it is possible to see that org.tap4j.plugin.model.TapTestResultResult has over 6 million objects. One build.xml for the BioPerl project gets over 80K entries for the TestResult object. grep &quot;org.tap4j.model.TestResult&quot; builds/1/build.xml -o | wc -l 84522 This happens because each TAP file may contain multiple test results (lines with test results). Each of these test results gets turned into a Java object and loaded by the plug-in. So when loading the test result pages, Jenkins needs to wait until all these objects have been parsed, deserialized and read into the memory. The next post will continue on code improvements, and another benchmark. Happy profiling!" />
<link rel="canonical" href="https://kinoshita.eti.br/2016/09/03/performance-problems-in-jenkins-tap-plugin-part-1.html" />
<meta property="og:url" content="https://kinoshita.eti.br/2016/09/03/performance-problems-in-jenkins-tap-plugin-part-1.html" />
<meta property="og:site_name" content="Bruno P. Kinoshita" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-09-03T05:28:03-05:00" />
<script type="application/ld+json">
{"datePublished":"2016-09-03T05:28:03-05:00","headline":"Performance problems in Jenkins TAP Plug-in — part 1","description":"JENKINS-17887 reports performance problems in the Jenkins TAP Plug-in. It also lists a series of suggestions on how to improve the Jenkins TAP Plug-in performance. On this initial post, we will get a general idea of how the plug-in performs for large projects. BioPerl has over 21K tests. That should be enough for giving an initial idea of CPU, memory and disk usage for the plug-in. git clone https://github.com/bioperl/bioperl-live.git cd bioperl-live sudo cpanm -vv --installdeps --notest . sudo cpanm Set::Scalar Graph::Directed XML::LibXML XML::SAX \\ SVG XML::Parser::PerlSAX Convert::Binary::C XML::SAX::Writer \\ XML::DOM::XPath Spreadsheet::ParseExcel XML::SAX::Writer \\ XML::DOM HTML::TableExtract XML::Simple Test::Pod DBI prove -r t/ -a tests.tar.gz All tests successful. Files=325, Tests=21095, 94 wallclock secs ( 2.47 usr 0.55 sys + 88.29 cusr 3.85 csys = 95.16 CPU) Result: PASS When the test results are parsed, the plug-in also copies TAP files over to the master, in a folder called tap-master-files. The BioPerl tests are not really big, just 1.7M. It gets doubled as there will be the workspace copy, and the tap-master-files directory copy, so 3.4M. But several objects get created in memory, and persisted into the build.xml job file. BioPerl generates a build.xml file with 11M. So less than 15M. But the build.xml contains objects that are read via XStream by Jenkins and into the memory. The build page with the graph, and the other two test result pages are rendering in more than 10 seconds in my computer. But the CPU load is OK, so a closer look at the memory use would probably be more interesting. The image shows one of the screens in YourKit profiler, where it is possible to see that org.tap4j.plugin.model.TapTestResultResult has over 6 million objects. One build.xml for the BioPerl project gets over 80K entries for the TestResult object. grep &quot;org.tap4j.model.TestResult&quot; builds/1/build.xml -o | wc -l 84522 This happens because each TAP file may contain multiple test results (lines with test results). Each of these test results gets turned into a Java object and loaded by the plug-in. So when loading the test result pages, Jenkins needs to wait until all these objects have been parsed, deserialized and read into the memory. The next post will continue on code improvements, and another benchmark. Happy profiling!","mainEntityOfPage":{"@type":"WebPage","@id":"https://kinoshita.eti.br/2016/09/03/performance-problems-in-jenkins-tap-plugin-part-1.html"},"@type":"BlogPosting","url":"https://kinoshita.eti.br/2016/09/03/performance-problems-in-jenkins-tap-plugin-part-1.html","dateModified":"2016-09-03T05:28:03-05:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/main.css"><link type="application/atom+xml" rel="alternate" href="https://kinoshita.eti.br/feed.xml" title="Bruno P. Kinoshita" /></head>
<body>
<div id="wrapper">
  <div id="sidebar"><ul class="menu">
  <li class="item">
    <a href="/" aria-label="Home page link">
      <svg id="svg8" version="1.1" viewBox="0 0 58.208 9.2604" xmlns="http://www.w3.org/2000/svg" role="img" aria-labelledby="svg-logo-title svg-logo-desc">
        <title id="svg-logo-title">KINOSHITA image</title>
        <desc id="svg-logo-desc">A logo with the word KINOSHITA</desc>
        <g id="layer1" transform="translate(0 -287.74)">
          <g id="text817" transform="translate(-2.4568 -.23624)">
            <g id="logo" transform="matrix(2.6585 0 0 2.5911 -63.587 100.56)" fill="#000000" stroke-width=".26458px">
              <path role="presentation" id="path819" d="m25.178 72.637h0.54187v2.9633h-0.54187zm0.5842 1.397 1.0964-1.397h0.635l-1.1049 1.397 1.1049 1.5663h-0.635z"/>
              <path role="presentation" id="path821" d="m27.832 72.637h0.54187v2.9633h-0.54187z"/>
              <path role="presentation" id="path823" d="m29.023 72.637h0.5334l1.2658 1.9135v-1.9135h0.54187v2.9633h-0.4445l-1.3547-2.032v2.032h-0.54187z"/>
              <path role="presentation" id="path825" d="m33.298 75.66q-0.4191 0-0.75353-0.1905-0.3302-0.19473-0.5207-0.54187-0.18627-0.35137-0.18627-0.80857t0.18627-0.80433q0.1905-0.35137 0.5207-0.54187 0.33443-0.19473 0.75353-0.19473t0.7493 0.19473q0.33443 0.1905 0.5207 0.54187 0.1905 0.34713 0.1905 0.80433t-0.1905 0.80857q-0.18627 0.34713-0.5207 0.54187-0.3302 0.1905-0.7493 0.1905zm0-0.52493q0.4318 0 0.6604-0.2794 0.23283-0.2794 0.23283-0.7366t-0.23283-0.7366q-0.2286-0.2794-0.6604-0.2794t-0.66463 0.2794q-0.2286 0.2794-0.2286 0.7366t0.2286 0.7366q0.23283 0.2794 0.66463 0.2794z"/>
              <path role="presentation" id="path827" d="m36.091 75.66q-0.24977 0-0.53763-0.06773-0.28363-0.06773-0.4445-0.14817l0.0635-0.57573q0.5588 0.27093 0.98213 0.27093 0.22437 0 0.35137-0.08467 0.127-0.0889 0.127-0.25823 0-0.127-0.07197-0.20743-0.06773-0.08467-0.19897-0.1397-0.13123-0.05927-0.4191-0.16087-0.27093-0.09313-0.44873-0.19473-0.1778-0.10583-0.28363-0.2667-0.1016-0.1651-0.1016-0.40217 0-0.381 0.2794-0.61383t0.8001-0.23283q0.24553 0 0.48683 0.05503 0.24553 0.05503 0.44873 0.13547l-0.05503 0.55457q-0.26247-0.1143-0.4826-0.16933-0.2159-0.05927-0.4318-0.05927-0.2413 0-0.3683 0.08043t-0.127 0.23283q0 0.11853 0.06773 0.19473t0.18203 0.127q0.11853 0.0508 0.34713 0.12277 0.51223 0.16087 0.74507 0.37253 0.23707 0.20743 0.23707 0.5715 0 0.34713-0.2413 0.60537t-0.90593 0.25823z"/>
              <path role="presentation" id="path829" d="m37.688 72.637h0.54187v1.1726h1.3547v-1.1726h0.54187v2.9633h-0.54187v-1.2827h-1.3547v1.2827h-0.54187z"/>
              <path role="presentation" id="path831" d="m40.78 72.637h0.54187v2.9633h-0.54187z"/>
              <path role="presentation" id="path833" d="m42.546 73.162h-0.8382v-0.52493h2.2183v0.52493h-0.8382v2.4384h-0.54187z"/>
              <path role="presentation" id="path835" d="m45.632 74.898h-1.0795l-0.24553 0.70273h-0.52493l1.0541-2.9633h0.51223l1.0541 2.9633h-0.52493zm-0.16933-0.47413-0.3683-1.0583-0.37253 1.0583z"/>
            </g>
          </g>
        </g>
      </svg>
    </a>
  </li>
  <li class="item">
    <a href="/blog/" class="">Blog</a>
    <ul>
      <li class="item">
        <a href="/blog/drawing/">Drawing</a>
      </li>
      <li class="item">
        <a href="/blog/languages/">Languages</a>
      </li>
      <li class="item">
        <a href="/blog/music/">Music</a>
      </li>
      <li class="item">
        <a href="/blog/writing/">Writing</a>
      </li>
    </ul>
  </li>
  <li class="item">
    <a href="/art/" class="">Illustrations</a>
  </li>
  <li class="item">
    <a href="/maps/" class="">Maps</a>
  </li>
</ul>
<div id="menu-bottom">
  <p id="feed-subscribe">
    <a href="/feed.xml">
      <svg id="feed-icon" xmlns="http://www.w3.org/2000/svg" version="1.1" width="128px" height="128px" viewBox="0 0 256 256">
        <circle cx="68" cy="189" r="24" fill="rgba(255, 255, 255, .2)"/>
        <path d="M160 213h-34a82 82 0 0 0 -82 -82v-34a116 116 0 0 1 116 116z" fill="rgba(255, 255, 255, .2)"/>
        <path d="M184 213A140 140 0 0 0 44 73 V 38a175 175 0 0 1 175 175z" fill="rgba(255, 255, 255, .2)"/>
      </svg>
    </a>
  </p>
</div>
</div>
  <div id="content">
    <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Performance problems in Jenkins TAP Plug-in &amp;mdash; part 1</h1>
    <spab class="post-meta">
      <time class="dt-published" datetime="2016-09-03T05:28:03-05:00" itemprop="datePublished">Sep 3, 2016
      </time>
      29<span>&mdash; star date: -306248.63</span></spab>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><a href="https://issues.jenkins-ci.org/browse/JENKINS-17887">JENKINS-17887</a> reports performance problems in the <a href="https://wiki.jenkins-ci.org/display/JENKINS/TAP+Plugin">Jenkins TAP Plug-in</a>. It also lists a series of suggestions on how to improve the Jenkins TAP Plug-in performance. On this initial post, we will get a general idea of how the plug-in performs for large projects.</p>

<p><a href="http://bioperl.org/">BioPerl</a> has over 21K tests. That should be enough for giving an initial idea of CPU, memory and disk usage for the plug-in.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/bioperl/bioperl-live.git
<span class="nb">cd </span>bioperl-live
<span class="nb">sudo </span>cpanm  <span class="nt">-vv</span> <span class="nt">--installdeps</span> <span class="nt">--notest</span> <span class="nb">.</span>
<span class="nb">sudo </span>cpanm Set::Scalar Graph::Directed XML::LibXML XML::SAX <span class="se">\</span>
    SVG XML::Parser::PerlSAX Convert::Binary::C XML::SAX::Writer <span class="se">\</span>
    XML::DOM::XPath Spreadsheet::ParseExcel XML::SAX::Writer <span class="se">\</span>
    XML::DOM HTML::TableExtract XML::Simple Test::Pod DBI
prove <span class="nt">-r</span> t/ <span class="nt">-a</span> tests.tar.gz

All tests successful.
<span class="nv">Files</span><span class="o">=</span>325, <span class="nv">Tests</span><span class="o">=</span>21095, 94 wallclock secs <span class="o">(</span> 2.47 usr  0.55 sys + 88.29 cusr  3.85 csys <span class="o">=</span> 95.16 CPU<span class="o">)</span>
Result: PASS
</code></pre></div></div>

<p>When the test results are parsed, the plug-in also copies TAP files over to the master, in a folder called <em>tap-master-files</em>.</p>

<p>The BioPerl tests are not really big, just <strong>1.7M</strong>. It gets doubled as there will be the workspace copy, and the tap-master-files directory copy, so <strong>3.4M</strong>.</p>

<p>But several objects get created in memory, and persisted into the build.xml job file. BioPerl generates a build.xml file with <strong>11M</strong>. So <strong>less than 15M</strong>. But the build.xml contains objects that are read via XStream by Jenkins and into the memory.</p>

<p>The build page with the graph, and the other two test result pages are rendering in more than 10 seconds in my computer. But the CPU load is OK, so a closer look at the memory use would probably be more interesting.</p>

<p><img class="ui centered image" src="/assets/posts/2016-09-03-performance-problems-in-jenkins-tap-plug-in-mdash-part-1/JENKINS-17887-yourkit1.png" alt="JENKINS-17887 YourKit profiler" /></p>

<p>The image shows one of the screens in YourKit profiler, where it is possible to see that <strong>org.tap4j.plugin.model.TapTestResultResult</strong> has over 6 million objects.</p>

<p>One build.xml for the BioPerl project gets over 80K entries for the TestResult object.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">grep</span> <span class="s2">"org.tap4j.model.TestResult"</span> builds/1/build.xml <span class="nt">-o</span> | <span class="nb">wc</span> <span class="nt">-l</span>
84522
</code></pre></div></div>

<p>This happens because each TAP file may contain multiple test results (lines with test results). Each of these test results gets turned into a Java object and loaded by the plug-in. So when loading the test result pages, Jenkins needs to wait until all these objects have been parsed, deserialized and read into the memory.</p>

<p>The next post will continue on code improvements, and another benchmark.</p>

<p>Happy profiling!</p>

  </div>

  <div class="tags"><a class="label" href="/tags#programming">programming</a><a class="label" href="/tags#jenkins">jenkins</a><a class="label" href="/tags#software quality">software quality</a></div>

  <a class="u-url" href="/2016/09/03/performance-problems-in-jenkins-tap-plugin-part-1.html" hidden></a>
</article>

  </div>
</div>
</body>
</html>
