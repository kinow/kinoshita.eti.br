  
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head profile="http://gmpg.org/xfn/11">
    <title>Bruno P. Kinoshita &mdash; Adding coverage reports in Jenkins to GoogleTest with gcovr</title> 
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="description" content="Bruno de Paula Kinoshita personal web site" />
    <meta name="keywords"
        content="kinoshita, bruno de paula kinoshita, geek, geek stuff, java, python, c, c++, msn now playing, neural network, mackenzie, sao paulo, brasil, brazil, nerd, nerd stuff, cool, jenkins, illustration, quadrinhos, machine learning, linguistic, apache, open source, codigo livre, codigo aberto" />
    <meta name="author" content="" />
    <meta name="generator" content="PieCrust 2.0.0b5" />
    <meta name="template-engine" content="Twig" />
    <meta name="robots" content="all=index,follow" />
    <meta name="revisit-after" content="15 days" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta name="distribution" content="Global" />
    <meta name="url" content="/" />
    <meta name="copyright" content="Bruno de Paula Kinoshita" />
    <meta name="Googlebot" content="all" />
    <meta name="rating" content="general" />
    <meta http-equiv="expires" content="0" />
    <meta name="city" content="Sao Paulo" />
    <meta name="state" content="Brasil, Sao Paulo" />
    <meta http-equiv="content-language" content="en" />
    <meta http-equiv="imagetoolbar" content="no" />
    <meta id="page_favicon" href="/favicon.ico" rel="icon" type="image/x-icon" />
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link rel="alternate" type="application/rss+xml" title="Bruno P. Kinoshita &raquo; Feed" href="//feed.xml" />
    <link rel="stylesheet" href="/css/semantic/dist/semantic.min.css" type="text/css" media="screen, projection" />
    <link rel="stylesheet" href="/css/style.css" type="text/css" media="screen, projection" />
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="/css/blueprint/ie.css" type="text/css" media="screen, projection" />
    <![endif]-->
    <link rel="stylesheet" href="/css/prettyPhoto.css" type="text/css" media="all" />
</head>
<body id="body">
    <div class="ui vertical sidebar menu" id="toc">
        <div class="menu">
    <div class="item">
        <a href="/" class="main-link">Kinoshita</a>
    </div>
    <div class="item">
        <a href="/software.html">Software</a>
    </div>
    <div class="item">
        <a href="/articles.html">Articles</a>
    </div>
    <div class="item">
        <a href="/books.html">Books</a>
    </div>
    <div class="item">
        <a href="/about.html">About &#038; CV</a>
    </div>
    <div class="item">
        <a href="/contact.html">Contact</a>
    </div>
</div>
<img id="me" src="/img/bruno.jpg" title="Hmmmm" alt="Hmmmm" width="134px" height="215px" />
    </div>
    <div class="ui black big launch right attached fixed button">
        <i class="content icon"></i>
        <span class="text">Menu</span>
    </div>
    <div class="ui fixed inverted main menu">
        <div class="ui container">
            <a class="launch icon item">
                <i class="content icon"></i>
            </a>
            <div class="item">
                Adding coverage reports in Jenkins to GoogleTest with gcovr
            </div>
        </div>
    </div>
    <div class="pusher">
        <div class="full height">
            <div class="toc">
                <div class="ui vertical sticky fixed top menu">
                    <div class="menu">
    <div class="item">
        <a href="/" class="main-link">Kinoshita</a>
    </div>
    <div class="item">
        <a href="/software.html">Software</a>
    </div>
    <div class="item">
        <a href="/articles.html">Articles</a>
    </div>
    <div class="item">
        <a href="/books.html">Books</a>
    </div>
    <div class="item">
        <a href="/about.html">About &#038; CV</a>
    </div>
    <div class="item">
        <a href="/contact.html">Contact</a>
    </div>
</div>
<img id="me" src="/img/bruno.jpg" title="Hmmmm" alt="Hmmmm" width="134px" height="215px" />
                </div>
            </div>
            <div class="article">
                <div class="main container">

                
<div class="ui raised padded text container segment">
    <h1 class='post-topic'>Adding coverage reports in Jenkins to GoogleTest with gcovr</h1>
    <small></small> @
	<small>Oct 16, 2012&nbsp;16:09:33</small>
    <div class="entry">
       





<a href="https://twitter.com/share" class="twitter-share-button" data-url="/2012/10/16/adding-coverage-reports-in-jenkins-to-googletest-with-gcovr" data-text="Adding coverage reports in Jenkins to GoogleTest with gcovr" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

	   <p>After the <a href="//2012/10/11/jenkins-testlink-and-gtest-in-5-minutes-or-so" title="Jenkins, TestLink and GTest in 5 minutes (or so)">last post</a> about <a href="http://code.google.com/p/googletest/" title="GoogleTest">GoogleTest</a> and <a href="http://www.teamst.org" title="TestLink">TestLink</a> using <a href="https://wiki.jenkins-ci.org/display/JENKINS/TestLink+Plugin" title="Jenkins TestLink Plug-in">Jenkins TestLink Plug-in</a>, I received an e-mail asking about <a href="http://en.wikipedia.org/wiki/Code_coverage" title="Code Coverage">coverage</a> with GoogleTest and <a href="http://www.jenkins-ci.org" title="Jenkins CI">Jenkins</a>. I&#8217;ve just updated the <a href="https://github.com/kinow/gtest-tap-listener/blob/master/samples/Makefile">Makefile</a> in the samples directory, of the <a href="https://github.com/kinow/gtest-tap-listener" title="GTest TAP Listener">GoogleTest TAP listener project</a>, to output coverage data.</p>

<p>Basically, you have to add the compiler flags <em>-fprofile-arcs -ftest-coverage</em> and link the executable with -lgcov. Take a look at the project&#8217;s Makefile and you&#8217;ll notice how simple it is. In order to have Jenkins interpreting your coverage report, you&#8217;ll have to convert it to <a href="http://cobertura.sourceforge.net" title="Cobertura">cobertura</a> XML. There is a Python utility that can be used for this: <a href="https://software.sandia.gov/trac/fast/wiki/gcovr" title="gcovr">gcovr</a>. Download it and copy it to somewhere where Jenkins can execute it (e.g.: <em>/usr/local/bin</em>).</p>

<p>Now, if you&#8217;ve followed the instructions from the previous post, you should have a job that reports your GoogleTest tests from Jenkins to TestLink using the plug-in, and is downloading the source code from GitHub. Add an extra build step  (Shell) to execute <em>gcovr</em>.</p>

<!--more-->

<div class="highlight"><pre>gcovr -x -r samples/src &gt; coverage.xml
</pre></div>

<p><a href="/2012/10/16/adding-coverage-reports-in-jenkins-to-googletest-with-gcovr/screenshot_0031.png"><img src="/2012/10/16/adding-coverage-reports-in-jenkins-to-googletest-with-gcovr/screenshot_0031.png" alt="" title="Calling gcovr in Jenkins" width="1016" height="608" class="aligncenter size-full wp-image-1107" /></a></p>

<p>This should produce a file coverage.xml in your build workspace. The last step is add cobertura post build step. Of course you&#8217;ll need <a href="https://wiki.jenkins-ci.org/display/JENKINS/Cobertura+Plugin" title="Jenkins Cobertura Plug-in">Jenkins Cobertura Plug-in</a> (quick tip: if you are using the newest Jenkins, you can install it without restarting, it works well). Simply add the cobertura post build step and make sure to use an include pattern that matches your output file from gcovr (e.g.: **/coverage.xml).</p>

<p>Voil&agrave;Â , you should now have coverage reports in Jenkins that looks like the image below.</p>

<p><a href="/2012/10/16/adding-coverage-reports-in-jenkins-to-googletest-with-gcovr/screenshot_0011.png"><img src="/2012/10/16/adding-coverage-reports-in-jenkins-to-googletest-with-gcovr/screenshot_0011.png" alt="" title="Coverage Reports" width="1016" height="608" class="aligncenter size-full wp-image-1105" /></a></p>

<p><a href="/2012/10/16/adding-coverage-reports-in-jenkins-to-googletest-with-gcovr/screenshot_0021.png"><img src="/2012/10/16/adding-coverage-reports-in-jenkins-to-googletest-with-gcovr/screenshot_0021.png" alt="" title="Coverage Reports" width="1016" height="608" class="aligncenter size-full wp-image-1106" /></a></p>

<p>A final note, is that we used an example project bundled with GoogleTest TAP Listener, and is not very useful, as it has no other classes being tested. In a real world project, you&#8217;ll have many classes that you want to coverage, while other you&#8217;d prefer to omit from the report. You can do so by using the <em>-e</em> gcovr flag. For more, try <em>gcovr &#8212;help</em>.</p>

<p>Hope that helps, have fun!</p>
    </div>
    <p class="postmetadata">
        
        <small>tags 
         [&nbsp;<a
            href="/tag/jenkins"
            rel="tag">jenkins</a>&nbsp;]&nbsp;
        
         [&nbsp;<a
            href="/tag/c%2B%2B"
            rel="tag">c++</a>&nbsp;]&nbsp;
        
         [&nbsp;<a
            href="/tag/test%20anything%20protocol"
            rel="tag">test anything protocol</a>&nbsp;]&nbsp;
        
        </small>
        
        
        <br/>
        <small>posted in 
        [&nbsp;<a
            href="/jenkins"
            title="View all posts in jenkins"
            rel="category tag">jenkins</a>&nbsp;]&nbsp;
        category </small>
        
    </p>
    <div id="navigation">
        
            &larr;&nbsp;<a href="//2012/10/20/replacing-a-hashset-with-a-bitset" id="navigation-next">Previous post</a>
        
        
            &mdash; <a href="//2012/10/11/jenkins-testlink-and-gtest-in-5-minutes-or-so" id="navigation-next">Next Entries</a>&nbsp;&rarr;
        
    </div>
</div>

                </div>
            </div>
        </div>
        <div class="ui vertical footer segment">
            <div class="ui center aligned container">
                           <div id="copy" class="">
                <p>&copy; <a href="/about"><span
                            class="b">Bru</span><span
                            class="r">no de</span> <span
                            class="a">Paula</span> <span
                            class="s"></span><span
                            class="i">Kinos</span><span
                            class="l">hita</span></a>
                </p>
            </div>
            </div>
         </div>
    </div>
</body>
</html>
<script src="/js/jquery-2.2.3.min.js"  type="text/javascript"></script>
    <script src="/css/semantic/dist/semantic.min.js"  type="text/javascript"></script>
    <script src="/js/jquery.prettyPhoto.js"></script>
<script type="text/javascript" charset="utf-8">
  $(document).ready(function(){
    $("a[rel^='prettyPhoto']").prettyPhoto({
        social_tools: false,
        autoplay_slideshow: false, 
        hideflash: true, 
        autoplay: false, 
        overlay_gallery: false
    });

    $("#toc")
        .sidebar({
          dimPage          : true,
          transition       : 'overlay',
          mobileTransition : 'uncover'
        })
    ;

    $("#toc")
        .sidebar('attach events', '.launch.button, .view-ui, .launch.item')
    ;
  });
</script>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-32767310-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
