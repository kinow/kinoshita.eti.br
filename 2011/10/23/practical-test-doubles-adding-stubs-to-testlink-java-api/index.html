  
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head profile="http://gmpg.org/xfn/11">
    <title>Bruno P. Kinoshita &mdash; Practical test doubles: adding stubs to TestLink Java API</title> 
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="description" content="Bruno de Paula Kinoshita personal web site" />
    <meta name="keywords"
        content="kinoshita, bruno de paula kinoshita, geek, geek stuff, java, python, c, c++, msn now playing, neural network, mackenzie, sao paulo, brasil, brazil, nerd, nerd stuff, cool, jenkins, illustration, quadrinhos, machine learning, linguistic, apache, open source, codigo livre, codigo aberto" />
    <meta name="author" content="" />
    <meta name="generator" content="PieCrust 3.2.1" />
    <meta name="template-engine" content="Twig" />
    <meta name="robots" content="all=index,follow" />
    <meta name="revisit-after" content="15 days" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta name="distribution" content="Global" />
    <meta name="url" content="/" />
    <meta name="copyright" content="Bruno de Paula Kinoshita" />
    <meta name="Googlebot" content="all" />
    <meta name="rating" content="general" />
    <meta http-equiv="expires" content="0" />
    <meta name="city" content="Sao Paulo" />
    <meta name="state" content="Brasil, Sao Paulo" />
    <meta http-equiv="content-language" content="en" />
    <meta http-equiv="imagetoolbar" content="no" />
    <meta id="page_favicon" href="/favicon.ico" rel="icon" type="image/x-icon" />
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link rel="alternate" type="application/rss+xml" title="Bruno P. Kinoshita &raquo; Feed" href="/feed.xml" />
    <link rel="stylesheet" href="/css/semantic/dist/semantic.min.css" type="text/css" media="screen, projection" />
    <link rel="stylesheet" href="/css/style.css" type="text/css" media="screen, projection" />
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="/css/blueprint/ie.css" type="text/css" media="screen, projection" />
    <![endif]-->
    <link rel="stylesheet" href="/css/prettyPhoto.css" type="text/css" media="all" />
</head>
<body id="body">
    <div class="ui vertical sidebar menu" id="toc">
        <nav class="menu" role="navigation">
    <div class="item">
        <a href="/" class="main-link">Kinoshita</a>
    </div>
    <div class="item">
        <a href="/art">Art</a>
    </div>
    <div class="item">
        <a href="/contact/">Contact</a>
    </div>
    <div class="item">
        <a href="/about/">About &#038; CV</a>
    </div>
</nav>
<img src="/img/bruno.jpg" title="Hmmmm" alt="My picture" width="134px" height="215px" />
    </div>
    <div class="ui black big launch right attached fixed button">
        <i class="content icon"></i>
        <span class="text">Menu</span>
    </div>
    <div class="ui fixed inverted main menu">
        <div class="ui container">
            <a class="launch icon item">
                <i class="content icon"></i>
            </a>
            <div class="item">
                Practical test doubles: adding stubs to TestLink Java API
            </div>
        </div>
    </div>
    <div class="pusher">
        <div class="full height">
            <div class="toc">
                <div class="ui vertical sticky fixed top menu">
                    <nav class="menu" role="navigation">
    <div class="item">
        <a href="/" class="main-link">Kinoshita</a>
    </div>
    <div class="item">
        <a href="/art">Art</a>
    </div>
    <div class="item">
        <a href="/contact/">Contact</a>
    </div>
    <div class="item">
        <a href="/about/">About &#038; CV</a>
    </div>
</nav>
<img src="/img/bruno.jpg" title="Hmmmm" alt="My picture" width="134px" height="215px" />
                </div>
            </div>
            <div class="article">
                <div class="main container" role="main">

                
<div class="ui raised padded container segment">
  <h1 class='post-topic'>Practical test doubles: adding stubs to TestLink Java API</h1>
  <small>kinow</small> @
	<small>2011-10-23&nbsp;22:10:02 (<span class='stardate' data-input-date='2011-10-23'></span>)</small>
  <div class="entry">
    





<a href="https://twitter.com/share" class="twitter-share-button" data-url="https://kinoshita.eti.br/2011/10/23/practical-test-doubles-adding-stubs-to-testlink-java-api" data-text="Practical test doubles: adding stubs to TestLink Java API" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p='https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

	  <p><em>&#8220;<strong>Test Double</strong> is a generic term for any case where you replace a production object for testing purposes&#8221;</em> [<a href="#1">1</a>]. There are different types of Test Doubles: <strong>Dummy</strong>, <strong>Fake</strong>, <strong>Stubs</strong>, <strong>Spies</strong> and <strong>Mocks</strong>. In this post we will see a practical example of adding stubs to <a href="testlinkjavaapi.sourceforge.net" title="TestLink Java API">TestLink Java API</a>.</p>

<p>Stubs are objects that return canned answers to calls during tests [1]. This is useful specially when you have a system that communicates with different resources such as databases, web services, XML-RPC services and so on.</p>

<p>TestLink Java API is a small Java project created to act as an interface between <a href="http://www.teamst.org" title="TestLink">TestLink</a> XML-RPC API and a client program written in Java.</p>

<!-- more -->

<h2>Starting on the wrong foot</h2>

<p>You know when sometimes you start a project just to suppress certain necessity and then write down a long <em>TODO</em> list? Well, sooner or later you will have to start working on those items. When I wrote the first version of the API I was writing Jenkins TestLink Plug-in, and had a priority project that depended on both tools to be deployed to a customer&#8217;s site. Due to the deadlines and priorities, the tests in TestLink Java API were made to run directly against a test instance of TestLink.</p>

<p>After that the code was open sourced and, as was expected, bugs, features and enhancements started to be requested by users. You can imagine many drawbacks in this approach, such as newcomers to the project would need to install a test instance of TestLink with equal set up parameters, and to not mention how hard it would be to have Continuous Integration in a service provider like <a href="http://www.cloudbees.com" title="CloudBees">CloudBees</a>, where I wouldn&#8217;t have TestLink installed.</p>

<h2>On the right foot now&#8230;</h2>

<p>So the main issue regarding the project build was the direct access to the TestLink XML-RPC API. A neat solution for it was to use Stubs during tests. The idea was to create a stubs capable of, given a call to TestLink XML-RPC, it would then answer with a canned XML.</p>

<p>I thought I would have to dig into <a href="http://www.mortbay.org/" title="Jetty">Jetty</a>, <a href="http://winstone.sourceforge.net/" title="Winstone">Winstone</a> or some small web server by myself and include it to the project, but fortunately somebody else [<a href="#2">2</a>] has passed by it and blogged about his experience with some sample code.</p>

<p>The approach used in TestLink Java API was quite similar to the one described in [<a href="#2">2</a>]. I used <a href="http://www.wireshark.org/" title="WireShark">WireShark</a> to save the XML returned by TestLink XML-RPC API and when I create an instance of the web server, it knows which XML it must return to the caller object. Below you can see <em>BaseTest</em>, a class used as base for new tests.</p>

<script src="https://gist.github.com/1308128.js"> </script>

<p>Now anybody can simply execute <em>mvn clean test</em> to build the project. It won&#8217;t connect to any instance of TestLink, and all the tests will be executed in less then one minute. When there is a new release of TestLink, I will need to update my XML files generated with Wireshark (I will automate it with Python or Perl) and then test and work on the differences.</p>

<p>This approach can be used to test web services, XML-RPC servers and any similar environment. Hope it helps somebody else too. Cheers! :D</p>

<p><a name="1">[1]</a> <a href="http://martinfowler.com/bliki/TestDouble.html">http://martinfowler.com/bliki/TestDouble.html</a></p>

<p><a name="2">[2]</a> <a href="http://olafsblog.sysbsb.de/lightweight-testing-of-webservice-http-clients-with-junit-and-jetty/trackback/">http://olafsblog.sysbsb.de/lightweight-testing-of-webservice-http-clients-with-junit-and-jetty</a></p>
  </div>
  <p class="postmetadata">
    
    <small>tags [&nbsp;<a href="/tag/testlink" rel="tag">testlink</a>&nbsp;]&nbsp;[&nbsp;<a href="/tag/java" rel="tag">java</a>&nbsp;]&nbsp;[&nbsp;<a href="/tag/software%20quality" rel="tag">software quality</a>&nbsp;]&nbsp;</small>
    
    
    <br/>
    <small>posted in [&nbsp;<a href="/blog" title="View all posts in blog" rel="category tag">blog</a>&nbsp;]&nbsp; category </small>
    
  </p>
  
</div>

                </div>
            </div>
        </div>
        <div class="ui vertical footer segment">
            <div class="ui center aligned container">
                           <div id="copy" class="">
                <p>&copy; <a href="/about"><span
                            class="b">Bru</span><span
                            class="r">no de</span> <span
                            class="a">Paula</span> <span
                            class="s"></span><span
                            class="i">Kinos</span><span
                            class="l">hita</span></a>
                </p>
            </div>
            </div>
         </div>
    </div>
</body>
</html>
<script src="/js/jquery-2.2.3.min.js"  type="text/javascript"></script>
<script src="/css/semantic/dist/semantic.min.js"  type="text/javascript"></script>
<script src="/js/jquery.prettyPhoto.js"></script>
<script src="/js/site.js"></script>