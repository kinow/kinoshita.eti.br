  
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head profile="http://gmpg.org/xfn/11">
    <title>Bruno P. Kinoshita &mdash; Getting the maximum from TestNG with TAP</title> 
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="description" content="Bruno de Paula Kinoshita personal web site" />
    <meta name="keywords"
        content="kinoshita, bruno de paula kinoshita, geek, geek stuff, java, python, c, c++, msn now playing, neural network, mackenzie, sao paulo, brasil, brazil, nerd, nerd stuff, cool, jenkins, illustration, quadrinhos, machine learning, linguistic, apache, open source, codigo livre, codigo aberto" />
    <meta name="author" content="" />
    <meta name="generator" content="PieCrust 2.1.1" />
    <meta name="template-engine" content="Twig" />
    <meta name="robots" content="all=index,follow" />
    <meta name="revisit-after" content="15 days" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta name="distribution" content="Global" />
    <meta name="url" content="/" />
    <meta name="copyright" content="Bruno de Paula Kinoshita" />
    <meta name="Googlebot" content="all" />
    <meta name="rating" content="general" />
    <meta http-equiv="expires" content="0" />
    <meta name="city" content="Sao Paulo" />
    <meta name="state" content="Brasil, Sao Paulo" />
    <meta http-equiv="content-language" content="en" />
    <meta http-equiv="imagetoolbar" content="no" />
    <meta id="page_favicon" href="/favicon.ico" rel="icon" type="image/x-icon" />
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link rel="alternate" type="application/rss+xml" title="Bruno P. Kinoshita &raquo; Feed" href="/feed.xml" />
    <link rel="stylesheet" href="/css/semantic/dist/semantic.min.css" type="text/css" media="screen, projection" />
    <link rel="stylesheet" href="/css/style.css" type="text/css" media="screen, projection" />
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="/css/blueprint/ie.css" type="text/css" media="screen, projection" />
    <![endif]-->
    <link rel="stylesheet" href="/css/prettyPhoto.css" type="text/css" media="all" />
</head>
<body id="body">
    <div class="ui vertical sidebar menu" id="toc">
        <nav class="menu" role="navigation">
    <div class="item">
        <a href="/" class="main-link">Kinoshita</a>
    </div>
    <div class="item">
        <a href="/art">Art</a>
    </div>
    <div class="item">
        <a href="/articles/">Articles</a>
    </div>
    <div class="item">
        <a href="/books/">Books</a>
    </div>
    <div class="item">
      <a href="/presentations/">Presentations</a>
    </div>
    <div class="item">
        <a href="/software/">Software</a>
    </div>
    <div class="item">
        <a href="/contact/">Contact</a>
    </div>
    <div class="item">
        <a href="/about/">About &#038; CV</a>
    </div>
</nav>
<img src="/img/bruno.jpg" title="Hmmmm" alt="My picture" width="134px" height="215px" />
    </div>
    <div class="ui black big launch right attached fixed button">
        <i class="content icon"></i>
        <span class="text">Menu</span>
    </div>
    <div class="ui fixed inverted main menu">
        <div class="ui container">
            <a class="launch icon item">
                <i class="content icon"></i>
            </a>
            <div class="item">
                Getting the maximum from TestNG with TAP
            </div>
        </div>
    </div>
    <div class="pusher">
        <div class="full height">
            <div class="toc">
                <div class="ui vertical sticky fixed top menu">
                    <nav class="menu" role="navigation">
    <div class="item">
        <a href="/" class="main-link">Kinoshita</a>
    </div>
    <div class="item">
        <a href="/art">Art</a>
    </div>
    <div class="item">
        <a href="/articles/">Articles</a>
    </div>
    <div class="item">
        <a href="/books/">Books</a>
    </div>
    <div class="item">
      <a href="/presentations/">Presentations</a>
    </div>
    <div class="item">
        <a href="/software/">Software</a>
    </div>
    <div class="item">
        <a href="/contact/">Contact</a>
    </div>
    <div class="item">
        <a href="/about/">About &#038; CV</a>
    </div>
</nav>
<img src="/img/bruno.jpg" title="Hmmmm" alt="My picture" width="134px" height="215px" />
                </div>
            </div>
            <div class="article">
                <div class="main container" role="main">

                
<div class="ui raised padded container segment">
  <h1 class='post-topic'>Getting the maximum from TestNG with TAP</h1>
  <small>kinow</small> @
	<small>Mar 10, 2011&nbsp;01:24:38 (<span class='stardate' data-input-date='Mar 10, 2011'></span>)</small>
  <div class="entry">
    





<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://kinoshita.eti.br/2011/03/10/getting-the-maximum-from-testng-with-tap" data-text="Getting the maximum from TestNG with TAP" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

	  <p>Strangely enough, today I decided start to write about <a href="http://www.testanything.org">TAP</a> (Test Anything Protocol) and received a mail from a <a href="http://www.linkedin.com">Linkedin</a> Group with a white paper about data integration in information systems. Well, let me first explain what is TAP, or Test Anything Protocol. This protocol was created in the beginning of Perl to log test results and is still being used by Perl and other languages (<a href="https://github.com/sebastianbergmann/phpunit/">PHPUnit</a> can output TAP too, for instance).</p>

<p>Now, if you already know about TAP and YAML, or if you are like me and like trying things out before reading a long text, then go to the <a href="#hammertime">hands on part</a> of this post.</p>

<p>An output in TAP, or a TAP stream, is written in pure text in a human readable way. Like follows:</p>

<div class="highlight"><pre>TAP version 13
1..2
ok <span class="m">1</span> Test 1
not ok <span class="m">2</span> Missing <span class="nb">test </span>parameter: url
</pre></div>

<!--more-->

<p>What does the TAP Stream above tells you? It tells you that you are using <span style="font-family: courier, sans-serif">TAP version 13</span> (duh, I know), you have a test plan with 2 tests (<span style="font-family: courier, sans-serif">1..2</span>) where the first test passed successfully (<span style="font-family: courier, sans-serif">ok 1</span>) and the second test failed (<span style="font-family: courier, sans-serif">not ok 2</span>). Besides the test status, you also have a description that tells you that the second test failed for missing a test parameter.</p>

<p>And that&#8217;s it. Really? I don&#8217;t need to learn anything else? Sorry, I was kidding, but I promise it is not like learning complex dynamic systems or how to find the equilibrium point in a differential equation :-). And I am not going to get in details about all the details of TAP, probably you should check <a href="http://www.testanything.org">http://www.testanything.org</a>, the home of Test Anything Protocol, for complete specification, history and links.</p>

<p>The last thing I need explain to you before putting <a href="http://www.testng.org">TestNG</a> in the story, is <a href="http://yaml.org/">YAML</a>. YAML stands for YAML Ain&#8217;t Markup Language. It is a data serialization standard, just like <a href="http://www.json.org/">JSON</a>. The main difference you will find between both APIs is that YAML can be a little more human friendly while JSON requires more symbols like {, }, [, ] and &#8220;. And it is said too that you can parse JSON with YAML, but the contrary is not always true. Let&#8217;s see how YAML looks like.</p>

<div class="highlight"><pre>---
name: Bruno
age: 26
country: Brazil
...
</pre></div>

<p>TAP utilizes YAML to have &#8216;<i><a href="http://testanything.org/wiki/index.php/TAP_diagnostic_syntax">diagnostics</a></i>&#8216; of tests. This is the name used in TAP, but probably you will prefer think about it as a way to extend TAP by adding YAML to each test result.</p>

<div class="highlight"><pre>TAP version 13
1..2
ok <span class="m">1</span> Test 1
not ok <span class="m">2</span> Missing <span class="nb">test </span>parameter: url
---
     file:        selenium_sample_test.t
     line:        12
     description: Missing <span class="nb">test </span>parameter: url
     found:       null
     wanted:      string
     extensions:
       screenshot:     /var/tmp/selenium/cath-xp/748344874_screenshot.jpg
...
</pre></div>

<h2><a name="hammertime">So it&#8217;s hammer time!</a></h2>

<p>Ok! So you got here either because you couldn&#8217;t wait to see how you were going to use TAP, YAML and TestNG together, or because you read all the text (if you didn&#8217;t, I recommend you try reading it later). I will assume here you are familiar with Java and can create a project in your favorite IDE, import libraries and set up a basic test project. I am an Eclipse and Maven user, so all these things are pretty easy for me ;-). Here is my sample test.</p>

<div class="highlight"><pre><span class="kn">package</span> <span class="nn">br.eti.kinoshita.testngtap</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.testng.Assert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.testng.annotations.Test</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleTest</span>
<span class="o">{</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sampleTest</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="n">Assert</span><span class="o">.</span><span class="na">assertTrue</span><span class="o">(</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">1984</span> <span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>

<p>This is a test that only checks if the current time in ms is greater than 1984. If so, it will follow the normal flow and output XML and HTML. Now I challenge you! How can you make this test output TAP? Drum roll&#8230; with two simple steps: a) add <a href="http://tap4j.sourceforge.net">tap4j</a> library into your project and b) add a <a href="http://testng.org/doc/documentation-main.html#testng-listeners">Listener</a> to your test.</p>

<div class="highlight"><pre><span class="kn">package</span> <span class="nn">br.eti.kinoshita.testngtap</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.testng.Assert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.testng.annotations.Listeners</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.testng.annotations.Test</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">br.eti.kinoshita.tap4j.ext.testng.TestTAPReporter</span><span class="o">;</span>

<span class="nd">@Listeners</span><span class="o">(</span><span class="n">TestTAPReporter</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleTest</span>
<span class="o">{</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sampleTest</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="n">Assert</span><span class="o">.</span><span class="na">assertTrue</span><span class="o">(</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">1984</span> <span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>

<p>Did you find the difference between the last code and the previous one? No? Come on, what about line 9? Yeah, that is the TAP listener. You can find more information about tap4j and TestNG integration <a href="http://tap4j.sourceforge.net/testng_support.html">here</a>. Run this test again and take a look at the output directories of TestNG. You will find some .tap files. These files contain the result of your tests alongside the diagnostic information about them. But wait! You may be asking yourself what is the point in outputting TestNG in another format? Well, apart of having integration with TAP and being able to share your test results with programs that are compatible with TAP (like Perl programs, or Smolder), you can also add customized information to your TAP Stream, transforming it into a perfect evidence for your automated tests, for instance. Look at the following code.</p>

<div class="highlight"><pre><span class="kn">package</span> <span class="nn">br.eti.kinoshita.testngtap</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.testng.Assert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.testng.ITestContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.testng.annotations.Listeners</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.testng.annotations.Test</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">br.eti.kinoshita.tap4j.ext.testng.TAPAttribute</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">br.eti.kinoshita.tap4j.ext.testng.TestTAPReporter</span><span class="o">;</span>

<span class="nd">@Listeners</span><span class="o">(</span><span class="n">TestTAPReporter</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleTest</span>
<span class="o">{</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sampleTest</span><span class="o">(</span> <span class="n">ITestContext</span> <span class="n">injectedCtx</span><span class="o">,</span> <span class="n">Method</span> <span class="n">injectedMethod</span><span class="o">)</span>
    <span class="o">{</span>

        <span class="n">TAPAttribute</span> <span class="n">attribute</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TAPAttribute</span><span class="o">(</span><span class="n">injectedMethod</span><span class="o">,</span> <span class="mi">1984</span><span class="o">);</span>

        <span class="c1">// Setting an attribute in the test context for this method.</span>
        <span class="n">injectedCtx</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&quot;myBirthdayYear&quot;</span><span class="o">,</span> <span class="n">attribute</span><span class="o">);</span>

        <span class="n">Assert</span><span class="o">.</span><span class="na">assertTrue</span><span class="o">(</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">1984</span> <span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>

<p>ITestContext and Method are injected by TestNG during execution. Then you create a TAPAttribute object and add this attribute to the test context, along with an identifier for this attribute. After that you run your test again and take another look at the TAP streams that were generated. You will have two files, br.eti.kinoshita.testngtap.SampleTest.tap and br.eti.kinoshita.testngtap.SampleTest#sampleTest.tap. The first is a TAP Stream for your test class and the latter is a TAP stream for the method of your test class (it generates one TAP Stream for each method). With tap4j listeners you have support to generate TAP per method, per class, per suite or per group (thanks to Cesar Fernandes Almeida). Here is the output for the test class in TAP.</p>

<div class="highlight"><pre>1..1
ok <span class="m">1</span> - br.eti.kinoshita.testngtap.SampleTest#sampleTest
  ---
  message: TestNG Test sampleTest
  severity: <span class="s1">&#39;~&#39;</span>
  <span class="nb">source</span>: br.eti.kinoshita.testngtap.SampleTest#sampleTest
  datetime: <span class="s1">&#39;2011-03-09T23:32:42&#39;</span>
  file: br.eti.kinoshita.testngtap.SampleTest
  line: <span class="s1">&#39;~&#39;</span>
  name: sampleTest
  extensions:
    myBirthdayYear: 1984
  got: <span class="s1">&#39;~&#39;</span>
  expected: <span class="s1">&#39;~&#39;</span>
  display: <span class="s1">&#39;~&#39;</span>
  dump: <span class="s1">&#39;{param1=org.testng.TestRunner@ff2413, param2=public void br.eti.kinoshita.testngtap.SampleTest.sampleTest(org.testng.ITestContext,java.lang.reflect.Method)}&#39;</span>
  error: <span class="s1">&#39;~&#39;</span>
  backtrace: <span class="s1">&#39;~&#39;</span>
  ...
</pre></div>

<p>Each attribute is added as an YAML entry under the &#8216;extensions&#8217; entry. You have just gave voice to your TestNG tests. Now they can speak! They can add information to your test results. Perhaps you may be thinking: &#8220;Cool, but I don&#8217;t know where am I going to use it, so I&#8217;m going stop reading this bible-like post and will find something more interesting on <a href="http://www.reddit.com">reddit</a>&#8220;. Hold on, not so fast buddy.</p>

<p>I started using TAP after I had to lead a test automation project with my company. We were using <a href="http://www.teamst.org">TestLink</a> and <a href="http://www.hudson-ci.org">Hudson</a> (and now <a href="http://www.jenkins-ci.org">Jenkins</a>), and in TestLink&#8217;s forum I read the <a href="http://www.teamst.org/index.php/news-mainmenu-2/13-development/86-testlink-automation-with-tap-successful-story">case of an user</a> who successfully automated his tests with TestLink and TAP. One thing leads to another, and here we are now, with a plug-in that integrates both tools in a simple way.</p>

<p>In this example, we are using <a href="http://testng.org/doc/selenium.html">Selenium and TestNG</a>. But one particularity is that after we take the screen shot in Selenium we use TAP to output the screen shot of that test within the rest of the test report. So TestNG, with a little help of tap4j, generates a TAP Stream that contains a reference for this screenshot file. You can find a sample code that executes Selenium with TestNG and outputs TAP with Selenium screen shots. This strategy is being used in <a href="http://wiki.jenkins-ci.org/display/JENKINS/TestLink+Plugin">TestLink Jenkins Plug-in</a> to execute and update automated tests. We are planning start using TAP in other projects, and build a plug-in for Jenkins that will set Jenkins as an alternative for <a href="http://search.cpan.org/~wonko/Smolder-1.51/bin/smolder">Smolder</a>.</p>

<p>Now I believe that you are ready to have new ideas about how integrate your test data with different systems in your organization environment and take the maximum from TestNG with TAP.</p>

<p>Valeu! Cheers!</p>
  </div>
  <p class="postmetadata">
    
    <small>tags [&nbsp;<a href="/tag/test%20anything%20protocol" rel="tag">test anything protocol</a>&nbsp;]&nbsp;[&nbsp;<a href="/tag/java" rel="tag">java</a>&nbsp;]&nbsp;[&nbsp;<a href="/tag/software%20quality" rel="tag">software quality</a>&nbsp;]&nbsp;</small>
    
    
    <br/>
    <small>posted in [&nbsp;<a href="/blog" title="View all posts in blog" rel="category tag">blog</a>&nbsp;]&nbsp; category </small>
    
  </p>
</div>

                </div>
            </div>
        </div>
        <div class="ui vertical footer segment">
            <div class="ui center aligned container">
                           <div id="copy" class="">
                <p>&copy; <a href="/about"><span
                            class="b">Bru</span><span
                            class="r">no de</span> <span
                            class="a">Paula</span> <span
                            class="s"></span><span
                            class="i">Kinos</span><span
                            class="l">hita</span></a>
                </p>
            </div>
            </div>
         </div>
    </div>
</body>
</html>
<script src="/js/jquery-2.2.3.min.js"  type="text/javascript"></script>
<script src="/css/semantic/dist/semantic.min.js"  type="text/javascript"></script>
<script src="/js/jquery.prettyPhoto.js"></script>
<script src="/js/site.js"></script>