  
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head profile="http://gmpg.org/xfn/11">
    <title>Bruno P. Kinoshita &mdash; Discussing the flexibility of TAP to cover information generated by TestNG</title> 
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="description" content="Bruno de Paula Kinoshita personal web site" />
    <meta name="keywords"
        content="kinoshita, bruno de paula kinoshita, geek, geek stuff, java, python, c, c++, msn now playing, neural network, mackenzie, sao paulo, brasil, brazil, nerd, nerd stuff, cool, jenkins, illustration, quadrinhos, machine learning, linguistic, apache, open source, codigo livre, codigo aberto" />
    <meta name="author" content="" />
    <meta name="generator" content="PieCrust 3.2.1" />
    <meta name="template-engine" content="Twig" />
    <meta name="robots" content="all=index,follow" />
    <meta name="revisit-after" content="15 days" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta name="distribution" content="Global" />
    <meta name="url" content="/" />
    <meta name="copyright" content="Bruno de Paula Kinoshita" />
    <meta name="Googlebot" content="all" />
    <meta name="rating" content="general" />
    <meta http-equiv="expires" content="0" />
    <meta name="city" content="Sao Paulo" />
    <meta name="state" content="Brasil, Sao Paulo" />
    <meta http-equiv="content-language" content="en" />
    <meta http-equiv="imagetoolbar" content="no" />
    <meta id="page_favicon" href="/favicon.ico" rel="icon" type="image/x-icon" />
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link rel="alternate" type="application/rss+xml" title="Bruno P. Kinoshita &raquo; Feed" href="/feed.xml" />
    <link rel="stylesheet" href="/css/semantic/dist/semantic.min.css" type="text/css" media="screen, projection" />
    <link rel="stylesheet" href="/css/style.css" type="text/css" media="screen, projection" />
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="/css/blueprint/ie.css" type="text/css" media="screen, projection" />
    <![endif]-->
    <link rel="stylesheet" href="/css/prettyPhoto.css" type="text/css" media="all" />
</head>
<body id="body">
    <div class="ui vertical sidebar menu" id="toc">
        <nav class="menu" role="navigation">
    <div class="item">
        <a href="/" class="main-link">Kinoshita</a>
    </div>
    <div class="item">
        <a href="/art">Art</a>
    </div>
    <div class="item">
        <a href="/contact/">Contact</a>
    </div>
    <div class="item">
        <a href="/about/">About</a>
    </div>
</nav>
<img src="/img/bruno.jpg" title="Hmmmm" alt="My picture" width="134px" height="215px" />
    </div>
    <div class="ui black big launch right attached fixed button">
        <i class="content icon"></i>
        <span class="text">Menu</span>
    </div>
    <div class="ui fixed inverted main menu">
        <div class="ui container">
            <a class="launch icon item">
                <i class="content icon"></i>
            </a>
            <div class="item">
                Discussing the flexibility of TAP to cover information generated by TestNG
            </div>
        </div>
    </div>
    <div class="pusher">
        <div class="full height">
            <div class="toc">
                <div class="ui vertical sticky fixed top menu">
                    <nav class="menu" role="navigation">
    <div class="item">
        <a href="/" class="main-link">Kinoshita</a>
    </div>
    <div class="item">
        <a href="/art">Art</a>
    </div>
    <div class="item">
        <a href="/contact/">Contact</a>
    </div>
    <div class="item">
        <a href="/about/">About</a>
    </div>
</nav>
<img src="/img/bruno.jpg" title="Hmmmm" alt="My picture" width="134px" height="215px" />
                </div>
            </div>
            <div class="article">
                <div class="main container" role="main">

                
<div class="ui raised padded container segment">
  <h1 class='post-topic'>Discussing the flexibility of TAP to cover information generated by TestNG</h1>
  <small>kinow</small> @
	<small>2011-03-20&nbsp;03:34:05 (<span class='stardate' data-input-date='2011-03-20'></span>)</small>
  <div class="entry">
    





<a href="https://twitter.com/share" class="twitter-share-button" data-url="https://kinoshita.eti.br/2011/03/20/discussing-the-flexibility-of-tap-to-cover-information-generated-by-testng" data-text="Discussing the flexibility of TAP to cover information generated by TestNG" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p='https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

	  <p>In today&#8217;s post I am expanding the previous one regarding the use of <a title="TAP (Test Anything Protocol)" href="http://www.testanything.org">TAP</a> with <a title="TestNG" href="http://www.testng.org">TestNG</a>. Let&#8217;s discuss about the flexibility of TAP to cover information generated by TestNG, more specifically:</p>

<ul>
    <li>Expected Exceptions</li>
    <li>Data Providers</li>
    <li>Groups</li>
    <li>Tests that get skipped</li>
    <li>Dependencies</li>
</ul>

<p>We will be addressing these bullet points using <a title="tap4j" href="http://tap4j.sourceforge.net">tap4j</a>, a TAP implementation for Java. The integration between TAP and TestNG is done through the use of TestNG Listeners developed in tap4j project (a big thanks here to <a title="Cesar Fernandes de Almeida" href="http://www.cesinha.com">Cesar Fernandes de Almeida</a> for all his help).</p>

<p>There are two listeners in tap4j, <a title="br.eti.kinoshita.tap4j.ext.testng.TestTAPReporter" href="https://github.com/kinow/tap4j/blob/master/src/main/java/org/tap4j/ext/testng/TestTAPReporter.java">br.eti.kinoshita.tap4j.ext.testng.TestTAPReporter</a> and <a title="br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter" href="https://github.com/kinow/tap4j/blob/master/src/main/java/br/eti/kinoshita/tap4j/ext/testng/SuiteTAPReporter.java">br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter</a>. The first was created based on <a title="org.testng.reporters.TestHTMLReporter" href="https://github.com/cbeust/testng/blob/master/src/main/java/org/testng/reporters/TestHTMLReporter.java">org.testng.reporters.TestHTMLReporter</a> and the latter was created based on <a title="org.testng.reporters.SuiteHTMLReporter" href="https://github.com/cbeust/testng/blob/master/src/main/java/org/testng/reporters/SuiteHTMLReporter.java">org.testng.reporters.SuiteHTMLReporter</a>.</p>

<p style="text-align: center;"><a href="/2011/03/20/discussing-the-flexibility-of-tap-to-cover-information-generated-by-testng/unnamed0.jpg"><img class="alignnone" title="Testing Tools as producers, TAP and consumers" src="/2011/03/20/discussing-the-flexibility-of-tap-to-cover-information-generated-by-testng/unnamed0.jpg" alt="" width="553" height="474" /></a></p>

<p style="text-align: center;"><em><span style="color: #999999; font-size: 0.8em;">In this figure you have testing tools as TAP producers (left) and different types of applications as consumers (right)</span></em></p>

<!--more-->

<h2>Expected Exceptions</h2>

<p>There is no special treatment for the Expected Exceptions in the tap4j Listeners. When a test passes, tap4j listeners logs only that the test succeeded. But when it fails and the Test Result contains a Throwable object, it is logged to the TAP Stream. I am still discussing it with Cesar whether it would be a good idea to parse the Throwable message body to retrieve the &#8216;line&#8217;, &#8216;expected&#8217; and &#8216;got&#8217; values for this error (these are entries in TAP Diagnostics - YAML).</p>

<p>Particularly, I would like to have this information in TestException. Maybe it could have a constructor public TestException(String message, Throwable t, String expected, String got, long lineNumber) and TestNG could fill this information for me :-). I know I&#8217;m being lazy, but I like the description of laziness in <a title="Larry Wall's Wikipedia entry" href="http://en.wikipedia.org/wiki/Larry_Wall">Larry Wall&#8217;s WikiPedia entry</a>. The following test is expecting an exception that is never thrown, thus it raises an exception.</p>

<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">example1</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.testng.Assert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.testng.annotations.Test</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestFoo</span>
<span class="o">{</span>

 <span class="c1">// expecing npe instead of arith.</span>
 <span class="nd">@Test</span><span class="o">(</span><span class="n">expectedExceptions</span><span class="o">={</span><span class="n">NullPointerException</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span>
 <span class="o">{</span>
   <span class="n">Assert</span><span class="o">.</span><span class="na">assertTrue</span><span class="o">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">0</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">);</span> <span class="c1">// programmatic causing an error in the test</span>
 <span class="o">}</span>

<span class="o">}</span>
</pre></div>

<p>And the TAP Stream with the exception in the &#8216;backtrace&#8217; entry.</p>

<div class="highlight"><pre><span></span><span class="m">1</span>..1
not ok <span class="m">1</span> - example1.TestFoo#test
 ---
 message: TestNG Test <span class="nb">test</span>
 severity: High
 source: example1.TestFoo#test
 datetime: <span class="s1">&#39;2011-03-20T03:45:30&#39;</span>
 file: example1.TestFoo
 line: <span class="s1">&#39;&#39;</span>
 name: <span class="nb">test</span>
 extensions: <span class="s1">&#39;~&#39;</span>
 got: <span class="s1">&#39;~&#39;</span>
 expected: <span class="s1">&#39;~&#39;</span>
 display: <span class="s1">&#39;~&#39;</span>
 dump: <span class="s1">&#39;~&#39;</span>
 error: <span class="s2">&quot;\nExpected exception java.lang.NullPointerException but got org.testng.TestException:\</span>
<span class="s2"> \ \nExpected exception java.lang.NullPointerException but got java.lang.ArithmeticException:\</span>
<span class="s2"> \ / by zero&quot;</span>
 backtrace: <span class="s2">&quot;org.testng.TestException: \nExpected exception java.lang.NullPointerException\</span>
<span class="s2"> \ but got org.testng.TestException: \nExpected exception java.lang.NullPointerException\</span>
<span class="s2"> \ but got java.lang.ArithmeticException: / by zero\n\tat org.testng.internal.Invoker.handleInvocationResults(Invoker.java:1416)\n\</span>
<span class="s2"> \tat org.testng.internal.Invoker.invokeTestMethods(Invoker.java:1184)\n\tat org.testng.internal.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:125)\n\</span>
<span class="s2"> \tat org.testng.internal.TestMethodWorker.run(TestMethodWorker.java:109)\n\tat org.testng.TestRunner.runWorkers(TestRunner.java:1125)\n\</span>
<span class="s2"> \tat org.testng.TestRunner.privateRun(TestRunner.java:749)\n\tat org.testng.TestRunner.run(TestRunner.java:600)\n\</span>
<span class="s2"> \tat org.testng.SuiteRunner.runTest(SuiteRunner.java:317)\n\tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:312)\n\</span>
<span class="s2"> \tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:274)\n\tat org.testng.SuiteRunner.run(SuiteRunner.java:223)\n\</span>
<span class="s2"> \tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n\tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:86)\n\</span>
<span class="s2"> \tat org.testng.TestNG.runSuitesSequentially(TestNG.java:995)\n\tat org.testng.TestNG.runSuitesLocally(TestNG.java:920)\n\</span>
<span class="s2"> \tat org.testng.TestNG.run(TestNG.java:856)\n\tat org.testng.remote.RemoteTestNG.run(RemoteTestNG.java:110)\n\</span>
<span class="s2"> \tat org.testng.remote.RemoteTestNG.initAndRun(RemoteTestNG.java:205)\n\tat org.testng.remote.RemoteTestNG.main(RemoteTestNG.java:174)\n\</span>
<span class="s2"> Caused by: org.testng.TestException: \nExpected exception java.lang.NullPointerException\</span>
<span class="s2"> \ but got java.lang.ArithmeticException: / by zero\n\tat org.testng.internal.Invoker.handleInvocationResults(Invoker.java:1416)\n\</span>
<span class="s2"> \tat org.testng.internal.Invoker.invokeMethod(Invoker.java:722)\n\tat org.testng.internal.Invoker.invokeTestMethod(Invoker.java:846)\n\</span>
<span class="s2"> \tat org.testng.internal.Invoker.invokeTestMethods(Invoker.java:1170)\n\t... 17\</span>
<span class="s2"> \ more\nCaused by: java.lang.ArithmeticException: / by zero\n\tat example1.TestFoo.test(TestFoo.java:17)\n\</span>
<span class="s2"> \tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\</span>
<span class="s2"> \tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\</span>
<span class="s2"> \tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.testng.internal.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:74)\n\</span>
<span class="s2"> \tat org.testng.internal.Invoker.invokeMethod(Invoker.java:673)\n\t... 19 more\n&quot;</span>
 ...
</pre></div>

<p>As you can see, the Exception contains the information of what the test expected (java.lang.NullPointerException) and what the test actually got (java.lang.ArithmeticException).</p>

<h2>Data Providers</h2>

<p>In order to use a data provider with TestNG you have to add parameters to your method. Look at the code below.</p>

<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">example1</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.testng.Assert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.testng.annotations.DataProvider</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.testng.annotations.Listeners</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.testng.annotations.Test</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">br.eti.kinoshita.tap4j.ext.testng.TestTAPReporter</span><span class="o">;</span>

<span class="nd">@Listeners</span><span class="o">(</span><span class="n">value</span><span class="o">={</span><span class="n">TestTAPReporter</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestWithDataProvider</span>
<span class="o">{</span>

 <span class="nd">@DataProvider</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;names&quot;</span><span class="o">)</span>
 <span class="kd">public</span> <span class="n">Object</span><span class="o">[][]</span> <span class="nf">getNames</span><span class="o">()</span>
 <span class="o">{</span>
   <span class="k">return</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[][]</span>
   <span class="o">{</span>
     <span class="o">{</span><span class="s">&quot;Haruki&quot;</span><span class="o">},</span>
     <span class="o">{</span><span class="s">&quot;Murakami&quot;</span><span class="o">}</span>
   <span class="o">};</span>
 <span class="o">}</span>

 <span class="nd">@Test</span><span class="o">(</span><span class="n">dataProvider</span><span class="o">=</span><span class="s">&quot;names&quot;</span><span class="o">)</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span>
 <span class="o">{</span>
   <span class="n">Assert</span><span class="o">.</span><span class="na">assertNotNull</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
 <span class="o">}</span>

<span class="o">}</span>
</pre></div>

<p>Running the test above results in the following TAP Stream:</p>

<div class="highlight"><pre><span></span><span class="m">1</span>..2
ok <span class="m">1</span> - example1.TestWithDataProvider#testName
 ---
 message: TestNG Test testName
 severity: <span class="s1">&#39;~&#39;</span>
 source: example1.TestWithDataProvider#testName
 datetime: <span class="s1">&#39;2011-03-20T03:09:50&#39;</span>
 file: example1.TestWithDataProvider
 line: <span class="s1">&#39;~&#39;</span>
 name: testName
 extensions: <span class="s1">&#39;~&#39;</span>
 got: <span class="s1">&#39;~&#39;</span>
 expected: <span class="s1">&#39;~&#39;</span>
 display: <span class="s1">&#39;~&#39;</span>
 dump: <span class="s1">&#39;{param1=Haruki}&#39;</span>
 error: <span class="s1">&#39;~&#39;</span>
 backtrace: <span class="s1">&#39;~&#39;</span>
 ...
ok <span class="m">2</span> - example1.TestWithDataProvider#testName
 ---
 message: TestNG Test testName
 severity: <span class="s1">&#39;~&#39;</span>
 source: example1.TestWithDataProvider#testName
 datetime: <span class="s1">&#39;2011-03-20T03:09:50&#39;</span>
 file: example1.TestWithDataProvider
 line: <span class="s1">&#39;~&#39;</span>
 name: testName
 extensions: <span class="s1">&#39;~&#39;</span>
 got: <span class="s1">&#39;~&#39;</span>
 expected: <span class="s1">&#39;~&#39;</span>
 display: <span class="s1">&#39;~&#39;</span>
 dump: <span class="s1">&#39;{param1=Murakami}&#39;</span>
 error: <span class="s1">&#39;~&#39;</span>
 backtrace: <span class="s1">&#39;~&#39;</span>
 ...
</pre></div>

<p>As you can see, tap4j listeners output in the &#8216;dump&#8217; entry the values for parameters used in the test. This way you have both the data obtained through Data Providers and what was passed as parameters during the test execution. One issue could be that this information can&#8217;t be distinguished, i.e. you can&#8217;t tell if the params are coming from a Data Provider or if they are parameters.</p>

<h2>Groups</h2>

<p>The listener <a title="br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter" href="https://github.com/kinow/tap4j/blob/master/src/main/java/org/tap4j/ext/testng/SuiteTAPReporter.java">br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter</a> contains the logic to generate a TAP Stream for each TestNG group found in the test suite. There was a BUG in this listener that was fixed in tap4j version 1.4.5 (thanks again to Cesar). Let&#8217;s use the following code taken from TestNG documentation site.</p>

<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">example1</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.testng.annotations.BeforeClass</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.testng.annotations.Test</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleTest</span> <span class="o">{</span>

<span class="nd">@BeforeClass</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">()</span> <span class="o">{</span>
  <span class="c1">// code that will be invoked when this test is instantiated</span>
<span class="o">}</span>

<span class="nd">@Test</span><span class="o">(</span><span class="n">groups</span> <span class="o">=</span> <span class="o">{</span> <span class="s">&quot;fast&quot;</span> <span class="o">})</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">aFastTest</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Fast test&quot;</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@Test</span><span class="o">(</span><span class="n">groups</span> <span class="o">=</span> <span class="o">{</span> <span class="s">&quot;slow&quot;</span> <span class="o">})</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">aSlowTest</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Slow test&quot;</span><span class="o">);</span>
<span class="o">}</span>

<span class="o">}</span>
</pre></div>

<p>And let&#8217;s create a XML suite for running this test with tap4j SuiteTAPReporter listener.</p>

<div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE suite SYSTEM &quot;http://testng.org/testng-1.0.dtd&quot; &gt;</span>

<span class="nt">&lt;suite</span> <span class="na">name=</span><span class="s">&quot;ExampleSuite&quot;</span> <span class="na">verbose=</span><span class="s">&quot;1&quot;</span> <span class="nt">&gt;</span>
  <span class="nt">&lt;listeners&gt;</span>
    <span class="nt">&lt;listener</span> <span class="na">class-name=</span><span class="s">&quot;br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/listener&gt;</span>
  <span class="nt">&lt;test</span> <span class="na">name=</span><span class="s">&quot;Sample test&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;classes&gt;</span>
      <span class="nt">&lt;class</span> <span class="na">name=</span><span class="s">&quot;example1.SimpleTest&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/classes&gt;</span>
  <span class="nt">&lt;/test&gt;</span>
<span class="nt">&lt;/suite&gt;</span>
</pre></div>

<p>Running this XML suite will produce three files in the test-output directory.</p>

<p><pre><span style="text-decoration: underline;">ExampleSuite.tap</span></pre></p>

<div class="highlight"><pre><span></span><span class="m">1</span>..2
ok <span class="m">1</span> - example1.SimpleTest#aFastTest
 ---
 message: TestNG Test aFastTest
 severity: <span class="s1">&#39;~&#39;</span>
 source: example1.SimpleTest#aFastTest
 datetime: <span class="s1">&#39;2011-03-20T01:47:11&#39;</span>
 file: example1.SimpleTest
 line: <span class="s1">&#39;~&#39;</span>
 name: aFastTest
 extensions: <span class="s1">&#39;~&#39;</span>
 got: <span class="s1">&#39;~&#39;</span>
 expected: <span class="s1">&#39;~&#39;</span>
 display: <span class="s1">&#39;~&#39;</span>
 dump: <span class="s1">&#39;~&#39;</span>
 error: <span class="s1">&#39;~&#39;</span>
 backtrace: <span class="s1">&#39;~&#39;</span>
 ...
ok <span class="m">2</span> - example1.SimpleTest#aSlowTest
 ---
 message: TestNG Test aSlowTest
 severity: <span class="s1">&#39;~&#39;</span>
 source: example1.SimpleTest#aSlowTest
 datetime: <span class="s1">&#39;2011-03-20T01:47:11&#39;</span>
 file: example1.SimpleTest
 line: <span class="s1">&#39;~&#39;</span>
 name: aSlowTest
 extensions: <span class="s1">&#39;~&#39;</span>
 got: <span class="s1">&#39;~&#39;</span>
 expected: <span class="s1">&#39;~&#39;</span>
 display: <span class="s1">&#39;~&#39;</span>
 dump: <span class="s1">&#39;~&#39;</span>
 error: <span class="s1">&#39;~&#39;</span>
 backtrace: <span class="s1">&#39;~&#39;</span>
 ...
</pre></div>

<p><pre><span style="text-decoration: underline;">fast.tap</span></pre></p>

<div class="highlight"><pre><span></span><span class="m">1</span>..1
ok <span class="m">1</span> - example1.SimpleTest#aFastTest
 ---
 message: TestNG Test aFastTest
 severity: <span class="s1">&#39;~&#39;</span>
 source: example1.SimpleTest#aFastTest
 datetime: <span class="s1">&#39;2011-03-20T01:47:11&#39;</span>
 file: example1.SimpleTest
 line: <span class="s1">&#39;~&#39;</span>
 name: aFastTest
 extensions: <span class="s1">&#39;~&#39;</span>
 got: <span class="s1">&#39;~&#39;</span>
 expected: <span class="s1">&#39;~&#39;</span>
 display: <span class="s1">&#39;~&#39;</span>
 dump: <span class="s1">&#39;~&#39;</span>
 error: <span class="s1">&#39;~&#39;</span>
 backtrace: <span class="s1">&#39;~&#39;</span>
 ...
</pre></div>

<p><pre><span style="text-decoration: underline;">slow.tap</span></pre></p>

<div class="highlight"><pre><span></span><span class="m">1</span>..1
ok <span class="m">1</span> - example1.SimpleTest#aSlowTest
 ---
 message: TestNG Test aSlowTest
 severity: <span class="s1">&#39;~&#39;</span>
 source: example1.SimpleTest#aSlowTest
 datetime: <span class="s1">&#39;2011-03-20T01:47:11&#39;</span>
 file: example1.SimpleTest
 line: <span class="s1">&#39;~&#39;</span>
 name: aSlowTest
 extensions: <span class="s1">&#39;~&#39;</span>
 got: <span class="s1">&#39;~&#39;</span>
 expected: <span class="s1">&#39;~&#39;</span>
 display: <span class="s1">&#39;~&#39;</span>
 dump: <span class="s1">&#39;~&#39;</span>
 error: <span class="s1">&#39;~&#39;</span>
 backtrace: <span class="s1">&#39;~&#39;</span>
 ...
</pre></div>

<p>tap4j Listeners can generate TAP Streams for TestNG tests for each method, for each class, for each group and for each suite. Nice uhn? :-)</p>

<h2>Tests that get skipped</h2>

<p>In TAP there are two directives: <strong>SKIP </strong>and <strong>TODO</strong>. SKIP is used to mark a test result as skipped, and TODO says that certain method is still not completely implemented. Tests that are skipped by TestNG are then marked as &#8216;not ok&#8217; with the SKIP directive. Let&#8217;s see some sample code.</p>

<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">example1</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.testng.Assert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.testng.annotations.Listeners</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.testng.annotations.Test</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">br.eti.kinoshita.tap4j.ext.testng.TestTAPReporter</span><span class="o">;</span>

<span class="nd">@Listeners</span><span class="o">(</span><span class="n">value</span><span class="o">={</span><span class="n">TestTAPReporter</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SkipTest</span>
<span class="o">{</span>
 <span class="nd">@Test</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">aTestThatFails</span><span class="o">()</span>
 <span class="o">{</span>
   <span class="n">Assert</span><span class="o">.</span><span class="na">assertTrue</span><span class="o">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">0</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">);</span> <span class="c1">// programmatic causing an error in the test</span>
 <span class="o">}</span>

 <span class="nd">@Test</span><span class="o">(</span><span class="n">dependsOnMethods</span><span class="o">={</span><span class="s">&quot;aTestThatFails&quot;</span><span class="o">})</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">aDepedentMethod</span><span class="o">()</span> <span class="c1">// This method is always skipped</span>
 <span class="o">{</span>
   <span class="n">Assert</span><span class="o">.</span><span class="na">assertTrue</span><span class="o">(</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">);</span>
 <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<p>In the code above we are intentionally making a mistake in the method aTestThatFails (we try to divide a number by zero). The method aDepedentMethod that depends on this method is then always skipped. Here is the output TAP Stream:</p>

<p><pre><span style="text-decoration: underline;">example1.SkipTest.tap</span></pre></p>

<div class="highlight"><pre><span></span><span class="m">1</span>..2
not ok <span class="m">1</span> - example1.SkipTest#aDepedentMethod <span class="c1"># SKIP TestNG test was skipped</span>
 ---
 message: TestNG Test aDepedentMethod
 severity: <span class="s1">&#39;~&#39;</span>
 source: example1.SkipTest#aDepedentMethod
 datetime: <span class="s1">&#39;2011-03-20T02:55:34&#39;</span>
 file: example1.SkipTest
 line: <span class="s1">&#39;~&#39;</span>
 name: aDepedentMethod
 extensions: <span class="s1">&#39;~&#39;</span>
 got: <span class="s1">&#39;~&#39;</span>
 expected: <span class="s1">&#39;~&#39;</span>
 display: <span class="s1">&#39;~&#39;</span>
 dump: <span class="s1">&#39;~&#39;</span>
 error: <span class="s1">&#39;~&#39;</span>
 backtrace: <span class="s1">&#39;~&#39;</span>
 ...
not ok <span class="m">2</span> - example1.SkipTest#aTestThatFails
 ---
 message: TestNG Test aTestThatFails
 severity: High
 source: example1.SkipTest#aTestThatFails
 datetime: <span class="s1">&#39;2011-03-20T02:55:34&#39;</span>
 file: example1.SkipTest
 line: <span class="s1">&#39;&#39;</span>
 name: aTestThatFails
 extensions: <span class="s1">&#39;~&#39;</span>
 got: <span class="s1">&#39;~&#39;</span>
 expected: <span class="s1">&#39;~&#39;</span>
 display: <span class="s1">&#39;~&#39;</span>
 dump: <span class="s1">&#39;~&#39;</span>
 error: / by zero
 backtrace: <span class="s2">&quot;java.lang.ArithmeticException: / by zero\n\tat example1.SkipTest.aTestThatFails(SkipTest.java:15)\n\</span>
<span class="s2"> \tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\</span>
<span class="s2"> \tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\</span>
<span class="s2"> \tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.testng.internal.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:74)\n\</span>
<span class="s2"> \tat org.testng.internal.Invoker.invokeMethod(Invoker.java:673)\n\tat org.testng.internal.Invoker.invokeTestMethod(Invoker.java:846)\n\</span>
<span class="s2"> \tat org.testng.internal.Invoker.invokeTestMethods(Invoker.java:1170)\n\tat org.testng.internal.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:125)\n\</span>
<span class="s2"> \tat org.testng.internal.TestMethodWorker.run(TestMethodWorker.java:109)\n\tat org.testng.TestRunner.runWorkers(TestRunner.java:1125)\n\</span>
<span class="s2"> \tat org.testng.TestRunner.privateRun(TestRunner.java:749)\n\tat org.testng.TestRunner.run(TestRunner.java:600)\n\</span>
<span class="s2"> \tat org.testng.SuiteRunner.runTest(SuiteRunner.java:317)\n\tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:312)\n\</span>
<span class="s2"> \tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:274)\n\tat org.testng.SuiteRunner.run(SuiteRunner.java:223)\n\</span>
<span class="s2"> \tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n\tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:86)\n\</span>
<span class="s2"> \tat org.testng.TestNG.runSuitesSequentially(TestNG.java:995)\n\tat org.testng.TestNG.runSuitesLocally(TestNG.java:920)\n\</span>
<span class="s2"> \tat org.testng.TestNG.run(TestNG.java:856)\n\tat org.testng.remote.RemoteTestNG.run(RemoteTestNG.java:110)\n\</span>
<span class="s2"> \tat org.testng.remote.RemoteTestNG.initAndRun(RemoteTestNG.java:205)\n\tat org.testng.remote.RemoteTestNG.main(RemoteTestNG.java:174)\n&quot;</span>
 ...
</pre></div>

<p>You can use <a title="br.eti.kinoshita.tap4j.ext.testng.TestTAPReporter" href="https://github.com/kinow/tap4j/blob/master/src/main/java/org/tap4j/ext/testng/TestTAPReporter.java">br.eti.kinoshita.tap4j.ext.testng.TestTAPReporter</a> or <a title="br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter" href="https://github.com/kinow/tap4j/blob/master/src/main/java/org/tap4j/ext/testng/SuiteTAPReporter.java">br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter</a>, as both listeners generate information on skipped tests.</p>

<h2>Dependencies</h2>

<p>At moment tap4j listeners don&#8217;t give you an idea of how is the dependency among the tests in your project. It is an issue that has to be better detailed to be implemented in a new version of tap4j. I know there are methods in the TestNG API that can tell you on which method/group a test depends upon. However I would need to sit down and think where to put this information in the TAP Stream. I like checking first how is it being done in Perl and then trying to code it in a way that the information generated by Java is more similar to that generated in Perl.</p>

<p>I created the enhancement issue <a title="Add dependency information in TestNG TAP integration" href="https://sourceforge.net/tracker/?func=detail&amp;aid=3228068&amp;group_id=351793&amp;atid=1470124">3228068</a> in tap4j SF.net project to discuss about dependencies in tap4j TestNG integration. I have to work on a few things in <a title="TestLink" href="http://www.teamst.org">TestLink</a> and Jenkins prior to start developing this integration, but it is in my list of things to do before Easter (this year&#8217;s Easter, of course ;-)).</p>

<hr />

<p>That&#8217;s all folks! I hope this post clarifies a little bit more about TestNG and TAP. Although there is a lot of work to do in this integration, it is already being used by <a title="Jenkins TestLink Plug-in" href="http://wiki.jenkins-ci.org/display/JENKINS/TestLink+Plugin">Jenkins TestLink Plug-in</a> in productive environments as a way to retrieve information about the test results and update TestLink. Just for what it is worth, the plug-in reads the &#8216;extensions&#8217; entry, looking for a file entry that represents a test evidence. This way automated tests can have evidences uploaded into TestLink test executions.</p>

<p>Ah, just one last note, in the following days the classes and packages of the tap4j project may be updated. Probably I will release tap4j 2.0 with the base package org.tap4j instead of br.eti.kinoshita.tap4j. I think it makes the project more &#8216;free&#8217; and &#8216;community-oriented&#8217; rather than using my own domain in it. As the API is very new I believe it is better to take this decision now rather than when it is being used in more projects.</p>

<p>Cheers :-)</p>
  </div>
  <p class="postmetadata">
    
    <small>tags [&nbsp;<a href="/tag/test%20anything%20protocol" rel="tag">test anything protocol</a>&nbsp;]&nbsp;[&nbsp;<a href="/tag/software%20quality" rel="tag">software quality</a>&nbsp;]&nbsp;[&nbsp;<a href="/tag/java" rel="tag">java</a>&nbsp;]&nbsp;</small>
    
    
    <br/>
    <small>posted in [&nbsp;<a href="/blog" title="View all posts in blog" rel="category tag">blog</a>&nbsp;]&nbsp; category </small>
    
  </p>
  
</div>

                </div>
            </div>
        </div>
        <div class="ui vertical footer segment">
            <div class="ui center aligned container">
                           <div id="copy" class="">
                <p>&copy; <a href="/about"><span
                            class="b">Bru</span><span
                            class="r">no de</span> <span
                            class="a">Paula</span> <span
                            class="s"></span><span
                            class="i">Kinos</span><span
                            class="l">hita</span></a>
                </p>
            </div>
            </div>
         </div>
    </div>
</body>
</html>
<script src="/js/jquery-2.2.3.min.js"  type="text/javascript"></script>
<script src="/css/semantic/dist/semantic.min.js"  type="text/javascript"></script>
<script src="/js/jquery.prettyPhoto.js"></script>
<script src="/js/site.js"></script>