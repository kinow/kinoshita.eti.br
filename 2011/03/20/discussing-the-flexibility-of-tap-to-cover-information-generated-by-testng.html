<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" /><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Discussing the flexibility of TAP to cover information generated by TestNG | kinow</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Discussing the flexibility of TAP to cover information generated by TestNG" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="In today&#39;s post I am expanding the previous one regarding the use of TAP with TestNG. Let&#39;s discuss about the flexibility of TAP to cover information generated by TestNG, more specifically: Expected Exceptions Data Providers Groups Tests that get skipped Dependencies We will be addressing these bullet points using tap4j, a TAP implementation for Java. The integration between TAP and TestNG is done through the use of TestNG Listeners developed in tap4j project (a big thanks here to Cesar Fernandes de Almeida for all his help). There are two listeners in tap4j, br.eti.kinoshita.tap4j.ext.testng.TestTAPReporter and br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter. The first was created based on org.testng.reporters.TestHTMLReporter and the latter was created based on org.testng.reporters.SuiteHTMLReporter. In this figure you have testing tools as TAP producers (left) and different types of applications as consumers (right)" />
<meta property="og:description" content="In today&#39;s post I am expanding the previous one regarding the use of TAP with TestNG. Let&#39;s discuss about the flexibility of TAP to cover information generated by TestNG, more specifically: Expected Exceptions Data Providers Groups Tests that get skipped Dependencies We will be addressing these bullet points using tap4j, a TAP implementation for Java. The integration between TAP and TestNG is done through the use of TestNG Listeners developed in tap4j project (a big thanks here to Cesar Fernandes de Almeida for all his help). There are two listeners in tap4j, br.eti.kinoshita.tap4j.ext.testng.TestTAPReporter and br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter. The first was created based on org.testng.reporters.TestHTMLReporter and the latter was created based on org.testng.reporters.SuiteHTMLReporter. In this figure you have testing tools as TAP producers (left) and different types of applications as consumers (right)" />
<link rel="canonical" href="https://kinoshita.eti.br/2011/03/20/discussing-the-flexibility-of-tap-to-cover-information-generated-by-testng.html" />
<meta property="og:url" content="https://kinoshita.eti.br/2011/03/20/discussing-the-flexibility-of-tap-to-cover-information-generated-by-testng.html" />
<meta property="og:site_name" content="kinow" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2011-03-20T00:00:00+13:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Discussing the flexibility of TAP to cover information generated by TestNG" />
<script type="application/ld+json">
{"description":"In today&#39;s post I am expanding the previous one regarding the use of TAP with TestNG. Let&#39;s discuss about the flexibility of TAP to cover information generated by TestNG, more specifically: Expected Exceptions Data Providers Groups Tests that get skipped Dependencies We will be addressing these bullet points using tap4j, a TAP implementation for Java. The integration between TAP and TestNG is done through the use of TestNG Listeners developed in tap4j project (a big thanks here to Cesar Fernandes de Almeida for all his help). There are two listeners in tap4j, br.eti.kinoshita.tap4j.ext.testng.TestTAPReporter and br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter. The first was created based on org.testng.reporters.TestHTMLReporter and the latter was created based on org.testng.reporters.SuiteHTMLReporter. In this figure you have testing tools as TAP producers (left) and different types of applications as consumers (right)","headline":"Discussing the flexibility of TAP to cover information generated by TestNG","dateModified":"2011-03-20T00:00:00+13:00","datePublished":"2011-03-20T00:00:00+13:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://kinoshita.eti.br/2011/03/20/discussing-the-flexibility-of-tap-to-cover-information-generated-by-testng.html"},"url":"https://kinoshita.eti.br/2011/03/20/discussing-the-flexibility-of-tap-to-cover-information-generated-by-testng.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/main.css" /><link type="application/atom+xml" rel="alternate" href="https://kinoshita.eti.br/feed.xml" title="kinow" /><link href="https://unpkg.com/pattern.css" rel="stylesheet" />

</head>
<body>
<div id="mobile-menu"><div class="menu">
  <ul class="menu">
    <li class="item">
      <h1 id="kinow">KINOW</h1>
    </li>
    <li class="item">
      <a href="/" class="">About</a>
    </li>
    <li class="item">
      <a href="/blog/" class="current">Blog</a>
    </li>
    <li class="item">
      <a href="/portfolio/" class="">Portfolio</a>
    </li>
    <li class="item social-media-item">
      <a href="https://www.instagram.com/brunokinoshita/" class="inline-link">
        <img src="/assets/icons/instagram.png" class="inverted-image" />
      </a>
      <a href="https://twitter.com/kinow/" class="inline-link">
        <img src="/assets/icons/twitter.png" class="inverted-image" />
      </a>
      <a href="https://github.com/kinow/" class="inline-link">
        <img src="/assets/icons/github.png" class="inverted-image" />
      </a>
    </li>
  </ul>
</div>
</div>
<div id="wrapper">
  <div id="sidebar"><div class="menu">
  <ul class="menu">
    <li class="item">
      <h1 id="kinow">KINOW</h1>
    </li>
    <li class="item">
      <a href="/" class="">About</a>
    </li>
    <li class="item">
      <a href="/blog/" class="current">Blog</a>
    </li>
    <li class="item">
      <a href="/portfolio/" class="">Portfolio</a>
    </li>
    <li class="item social-media-item">
      <a href="https://www.instagram.com/brunokinoshita/" class="inline-link">
        <img src="/assets/icons/instagram.png" class="inverted-image" />
      </a>
      <a href="https://twitter.com/kinow/" class="inline-link">
        <img src="/assets/icons/twitter.png" class="inverted-image" />
      </a>
      <a href="https://github.com/kinow/" class="inline-link">
        <img src="/assets/icons/github.png" class="inverted-image" />
      </a>
    </li>
  </ul>
</div>
</div>
  <div id="content">
    <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Discussing the flexibility of TAP to cover information generated by TestNG</h1>
    <span class="post-meta">
      <time class="dt-published" datetime="2011-03-20T00:00:00+13:00" itemprop="datePublished">Mar 20, 2011
      </time>
      <span>&mdash; star date: -311701.37.</span>
      <span>
        Number of words: 2422.
      </span></span>
  </header>

  <ul>
  <li><a href="#">Expected Exceptions</a></li>
  <li><a href="#">Data Providers</a></li>
  <li><a href="#">Groups</a></li>
  <li><a href="#">Tests that get skipped</a></li>
  <li><a href="#">Dependencies</a></li>
</ul>


  <div class="post-content e-content" itemprop="articleBody">
    <p>In today's post I am expanding the previous one regarding the use of <a title="TAP (Test Anything Protocol)" href="http://www.testanything.org">TAP</a> with <a title="TestNG" href="http://www.testng.org">TestNG</a>. Let's discuss about the flexibility of TAP to cover information generated by TestNG, more specifically:</p>

<ul>
	<li>Expected Exceptions</li>
	<li>Data Providers</li>
	<li>Groups</li>
	<li>Tests that get skipped</li>
	<li>Dependencies</li>
</ul>

<p>We will be addressing these bullet points using <a title="tap4j" href="http://tap4j.sourceforge.net">tap4j</a>, a TAP implementation for Java. The integration between TAP and TestNG is done through the use of TestNG Listeners developed in tap4j project (a big thanks here to <a title="Cesar Fernandes de Almeida" href="http://www.cesinha.com">Cesar Fernandes de Almeida</a> for all his help).</p>

<p>There are two listeners in tap4j, <a title="br.eti.kinoshita.tap4j.ext.testng.TestTAPReporter" href="https://github.com/kinow/tap4j/blob/master/src/main/java/org/tap4j/ext/testng/TestTAPReporter.java">br.eti.kinoshita.tap4j.ext.testng.TestTAPReporter</a> and <a title="br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter" href="https://github.com/kinow/tap4j/blob/master/src/main/java/br/eti/kinoshita/tap4j/ext/testng/SuiteTAPReporter.java">br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter</a>. The first was created based on <a title="org.testng.reporters.TestHTMLReporter" href="https://github.com/cbeust/testng/blob/master/src/main/java/org/testng/reporters/TestHTMLReporter.java">org.testng.reporters.TestHTMLReporter</a> and the latter was created based on <a title="org.testng.reporters.SuiteHTMLReporter" href="https://github.com/cbeust/testng/blob/master/src/main/java/org/testng/reporters/SuiteHTMLReporter.java">org.testng.reporters.SuiteHTMLReporter</a>.</p>

<p><img class="ui image" src="/assets/posts/2011-03-20-discussing-the-flexibility-of-tap-to-cover-information-generated-by-testng/unnamed0.jpg" /></p>

<p style="text-align: center;"><em><span style="color: #999999; font-size: 0.8em;">In this figure you have testing tools as TAP producers (left) and different types of applications as consumers (right)</span></em></p>

<!--more-->

<h2>Expected Exceptions</h2>

<p>There is no special treatment for the Expected Exceptions in the tap4j Listeners. When a test passes, tap4j listeners logs only that the test succeeded. But when it fails and the Test Result contains a Throwable object, it is logged to the TAP Stream. I am still discussing it with Cesar whether it would be a good idea to parse the Throwable message body to retrieve the 'line', 'expected' and 'got' values for this error (these are entries in TAP Diagnostics - YAML).</p>

<p>Particularly, I would like to have this information in TestException. Maybe it could have a constructor public TestException(String message, Throwable t, String expected, String got, long lineNumber) and TestNG could fill this information for me :-). I know I'm being lazy, but I like the description of laziness in <a title="Larry Wall's Wikipedia entry" href="http://en.wikipedia.org/wiki/Larry_Wall">Larry Wall's WikiPedia entry</a>. The following test is expecting an exception that is never thrown, thus it raises an exception.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">example1</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.testng.Assert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.testng.annotations.Test</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestFoo</span>
<span class="o">{</span>

 <span class="c1">// expecing npe instead of arith.</span>
 <span class="nd">@Test</span><span class="o">(</span><span class="n">expectedExceptions</span><span class="o">={</span><span class="nc">NullPointerException</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span>
 <span class="o">{</span>
   <span class="nc">Assert</span><span class="o">.</span><span class="na">assertTrue</span><span class="o">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">0</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">);</span> <span class="c1">// programmatic causing an error in the test</span>
 <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>And the TAP Stream with the exception in the 'backtrace' entry.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1..1
not ok 1 - example1.TestFoo#test
 <span class="nt">---</span>
 message: TestNG Test <span class="nb">test
 </span>severity: High
 <span class="nb">source</span>: example1.TestFoo#test
 datetime: <span class="s1">'2011-03-20T03:45:30'</span>
 file: example1.TestFoo
 line: <span class="s1">''</span>
 name: <span class="nb">test
 </span>extensions: <span class="s1">'~'</span>
 got: <span class="s1">'~'</span>
 expected: <span class="s1">'~'</span>
 display: <span class="s1">'~'</span>
 dump: <span class="s1">'~'</span>
 error: &amp;quot<span class="p">;</span><span class="se">\n</span>Expected exception java.lang.NullPointerException but got org.testng.TestException:<span class="se">\</span>
 <span class="se">\ \n</span>Expected exception java.lang.NullPointerException but got java.lang.ArithmeticException:<span class="se">\</span>
 <span class="se">\ </span>/ by zero&amp;quot<span class="p">;</span>
 backtrace: &amp;quot<span class="p">;</span>org.testng.TestException: <span class="se">\n</span>Expected exception java.lang.NullPointerException<span class="se">\</span>
 <span class="se">\ </span>but got org.testng.TestException: <span class="se">\n</span>Expected exception java.lang.NullPointerException<span class="se">\</span>
 <span class="se">\ </span>but got java.lang.ArithmeticException: / by zero<span class="se">\n\t</span>at org.testng.internal.Invoker.handleInvocationResults<span class="o">(</span>Invoker.java:1416<span class="o">)</span><span class="se">\n\</span>
 <span class="se">\t</span>at org.testng.internal.Invoker.invokeTestMethods<span class="o">(</span>Invoker.java:1184<span class="o">)</span><span class="se">\n\t</span>at org.testng.internal.TestMethodWorker.invokeTestMethods<span class="o">(</span>TestMethodWorker.java:125<span class="o">)</span><span class="se">\n\</span>
 <span class="se">\t</span>at org.testng.internal.TestMethodWorker.run<span class="o">(</span>TestMethodWorker.java:109<span class="o">)</span><span class="se">\n\t</span>at org.testng.TestRunner.runWorkers<span class="o">(</span>TestRunner.java:1125<span class="o">)</span><span class="se">\n\</span>
 <span class="se">\t</span>at org.testng.TestRunner.privateRun<span class="o">(</span>TestRunner.java:749<span class="o">)</span><span class="se">\n\t</span>at org.testng.TestRunner.run<span class="o">(</span>TestRunner.java:600<span class="o">)</span><span class="se">\n\</span>
 <span class="se">\t</span>at org.testng.SuiteRunner.runTest<span class="o">(</span>SuiteRunner.java:317<span class="o">)</span><span class="se">\n\t</span>at org.testng.SuiteRunner.runSequentially<span class="o">(</span>SuiteRunner.java:312<span class="o">)</span><span class="se">\n\</span>
 <span class="se">\t</span>at org.testng.SuiteRunner.privateRun<span class="o">(</span>SuiteRunner.java:274<span class="o">)</span><span class="se">\n\t</span>at org.testng.SuiteRunner.run<span class="o">(</span>SuiteRunner.java:223<span class="o">)</span><span class="se">\n\</span>
 <span class="se">\t</span>at org.testng.SuiteRunnerWorker.runSuite<span class="o">(</span>SuiteRunnerWorker.java:52<span class="o">)</span><span class="se">\n\t</span>at org.testng.SuiteRunnerWorker.run<span class="o">(</span>SuiteRunnerWorker.java:86<span class="o">)</span><span class="se">\n\</span>
 <span class="se">\t</span>at org.testng.TestNG.runSuitesSequentially<span class="o">(</span>TestNG.java:995<span class="o">)</span><span class="se">\n\t</span>at org.testng.TestNG.runSuitesLocally<span class="o">(</span>TestNG.java:920<span class="o">)</span><span class="se">\n\</span>
 <span class="se">\t</span>at org.testng.TestNG.run<span class="o">(</span>TestNG.java:856<span class="o">)</span><span class="se">\n\t</span>at org.testng.remote.RemoteTestNG.run<span class="o">(</span>RemoteTestNG.java:110<span class="o">)</span><span class="se">\n\</span>
 <span class="se">\t</span>at org.testng.remote.RemoteTestNG.initAndRun<span class="o">(</span>RemoteTestNG.java:205<span class="o">)</span><span class="se">\n\t</span>at org.testng.remote.RemoteTestNG.main<span class="o">(</span>RemoteTestNG.java:174<span class="o">)</span><span class="se">\n\</span>
 Caused by: org.testng.TestException: <span class="se">\n</span>Expected exception java.lang.NullPointerException<span class="se">\</span>
 <span class="se">\ </span>but got java.lang.ArithmeticException: / by zero<span class="se">\n\t</span>at org.testng.internal.Invoker.handleInvocationResults<span class="o">(</span>Invoker.java:1416<span class="o">)</span><span class="se">\n\</span>
 <span class="se">\t</span>at org.testng.internal.Invoker.invokeMethod<span class="o">(</span>Invoker.java:722<span class="o">)</span><span class="se">\n\t</span>at org.testng.internal.Invoker.invokeTestMethod<span class="o">(</span>Invoker.java:846<span class="o">)</span><span class="se">\n\</span>
 <span class="se">\t</span>at org.testng.internal.Invoker.invokeTestMethods<span class="o">(</span>Invoker.java:1170<span class="o">)</span><span class="se">\n\t</span>... 17<span class="se">\</span>
 <span class="se">\ </span>more<span class="se">\n</span>Caused by: java.lang.ArithmeticException: / by zero<span class="se">\n\t</span>at example1.TestFoo.test<span class="o">(</span>TestFoo.java:17<span class="o">)</span><span class="se">\n\</span>
 <span class="se">\t</span>at sun.reflect.NativeMethodAccessorImpl.invoke0<span class="o">(</span>Native Method<span class="o">)</span><span class="se">\n\t</span>at sun.reflect.NativeMethodAccessorImpl.invoke<span class="o">(</span>NativeMethodAccessorImpl.java:39<span class="o">)</span><span class="se">\n\</span>
 <span class="se">\t</span>at sun.reflect.DelegatingMethodAccessorImpl.invoke<span class="o">(</span>DelegatingMethodAccessorImpl.java:25<span class="o">)</span><span class="se">\n\</span>
 <span class="se">\t</span>at java.lang.reflect.Method.invoke<span class="o">(</span>Method.java:597<span class="o">)</span><span class="se">\n\t</span>at org.testng.internal.MethodInvocationHelper.invokeMethod<span class="o">(</span>MethodInvocationHelper.java:74<span class="o">)</span><span class="se">\n\</span>
 <span class="se">\t</span>at org.testng.internal.Invoker.invokeMethod<span class="o">(</span>Invoker.java:673<span class="o">)</span><span class="se">\n\t</span>... 19 more<span class="se">\n</span>&amp;quot<span class="p">;</span>
 ...
</code></pre></div></div>

<p>As you can see, the Exception contains the information of what the test expected (java.lang.NullPointerException) and what the test actually got (java.lang.ArithmeticException).</p>

<h2>Data Providers</h2>

<p>In order to use a data provider with TestNG you have to add parameters to your method. Look at the code below.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">example1</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.testng.Assert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.testng.annotations.DataProvider</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.testng.annotations.Listeners</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.testng.annotations.Test</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">br.eti.kinoshita.tap4j.ext.testng.TestTAPReporter</span><span class="o">;</span>

<span class="nd">@Listeners</span><span class="o">(</span><span class="n">value</span><span class="o">={</span><span class="nc">TestTAPReporter</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestWithDataProvider</span>
<span class="o">{</span>

 <span class="nd">@DataProvider</span><span class="o">(</span><span class="n">name</span><span class="o">=&amp;</span><span class="n">quot</span><span class="o">;</span><span class="n">names</span><span class="o">&amp;</span><span class="n">quot</span><span class="o">;)</span>
 <span class="kd">public</span> <span class="nc">Object</span><span class="o">[][]</span> <span class="nf">getNames</span><span class="o">()</span>
 <span class="o">{</span>
   <span class="k">return</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[][]</span>
   <span class="o">{</span>
     <span class="o">{&amp;</span><span class="n">quot</span><span class="o">;</span><span class="nc">Haruki</span><span class="o">&amp;</span><span class="n">quot</span><span class="o">;},</span>
     <span class="o">{&amp;</span><span class="n">quot</span><span class="o">;</span><span class="nc">Murakami</span><span class="o">&amp;</span><span class="n">quot</span><span class="o">;}</span>
   <span class="o">};</span>
 <span class="o">}</span>

 <span class="nd">@Test</span><span class="o">(</span><span class="n">dataProvider</span><span class="o">=&amp;</span><span class="n">quot</span><span class="o">;</span><span class="n">names</span><span class="o">&amp;</span><span class="n">quot</span><span class="o">;)</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span>
 <span class="o">{</span>
   <span class="nc">Assert</span><span class="o">.</span><span class="na">assertNotNull</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
 <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>Running the test above results in the following TAP Stream:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1..2
ok 1 - example1.TestWithDataProvider#testName
 <span class="nt">---</span>
 message: TestNG Test testName
 severity: <span class="s1">'~'</span>
 <span class="nb">source</span>: example1.TestWithDataProvider#testName
 datetime: <span class="s1">'2011-03-20T03:09:50'</span>
 file: example1.TestWithDataProvider
 line: <span class="s1">'~'</span>
 name: testName
 extensions: <span class="s1">'~'</span>
 got: <span class="s1">'~'</span>
 expected: <span class="s1">'~'</span>
 display: <span class="s1">'~'</span>
 dump: <span class="s1">'{param1=Haruki}'</span>
 error: <span class="s1">'~'</span>
 backtrace: <span class="s1">'~'</span>
 ...
ok 2 - example1.TestWithDataProvider#testName
 <span class="nt">---</span>
 message: TestNG Test testName
 severity: <span class="s1">'~'</span>
 <span class="nb">source</span>: example1.TestWithDataProvider#testName
 datetime: <span class="s1">'2011-03-20T03:09:50'</span>
 file: example1.TestWithDataProvider
 line: <span class="s1">'~'</span>
 name: testName
 extensions: <span class="s1">'~'</span>
 got: <span class="s1">'~'</span>
 expected: <span class="s1">'~'</span>
 display: <span class="s1">'~'</span>
 dump: <span class="s1">'{param1=Murakami}'</span>
 error: <span class="s1">'~'</span>
 backtrace: <span class="s1">'~'</span>
 ...
</code></pre></div></div>

<p>As you can see, tap4j listeners output in the 'dump' entry the values for parameters used in the test. This way you have both the data obtained through Data Providers and what was passed as parameters during the test execution. One issue could be that this information can't be distinguished, i.e. you can't tell if the params are coming from a Data Provider or if they are parameters.</p>

<h2>Groups</h2>

<p>The listener <a title="br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter" href="https://github.com/kinow/tap4j/blob/master/src/main/java/org/tap4j/ext/testng/SuiteTAPReporter.java">br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter</a> contains the logic to generate a TAP Stream for each TestNG group found in the test suite. There was a BUG in this listener that was fixed in tap4j version 1.4.5 (thanks again to Cesar). Let's use the following code taken from TestNG documentation site.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">example1</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.testng.annotations.BeforeClass</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.testng.annotations.Test</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleTest</span> <span class="o">{</span>

<span class="nd">@BeforeClass</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">()</span> <span class="o">{</span>
  <span class="c1">// code that will be invoked when this test is instantiated</span>
<span class="o">}</span>

<span class="nd">@Test</span><span class="o">(</span><span class="n">groups</span> <span class="o">=</span> <span class="o">{</span> <span class="o">&amp;</span><span class="n">quot</span><span class="o">;</span><span class="n">fast</span><span class="o">&amp;</span><span class="n">quot</span><span class="o">;</span> <span class="o">})</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">aFastTest</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(&amp;</span><span class="n">quot</span><span class="o">;</span><span class="nc">Fast</span> <span class="n">test</span><span class="o">&amp;</span><span class="n">quot</span><span class="o">;);</span>
<span class="o">}</span>

<span class="nd">@Test</span><span class="o">(</span><span class="n">groups</span> <span class="o">=</span> <span class="o">{</span> <span class="o">&amp;</span><span class="n">quot</span><span class="o">;</span><span class="n">slow</span><span class="o">&amp;</span><span class="n">quot</span><span class="o">;</span> <span class="o">})</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">aSlowTest</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(&amp;</span><span class="n">quot</span><span class="o">;</span><span class="nc">Slow</span> <span class="n">test</span><span class="o">&amp;</span><span class="n">quot</span><span class="o">;);</span>
<span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>And let's create a XML suite for running this test with tap4j SuiteTAPReporter listener.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE suite SYSTEM &amp;quot;http://testng.org/testng-1.0.dtd&amp;quot; &gt;</span>
  
<span class="nt">&lt;suite</span> <span class="na">name=</span><span class="s">&amp;quot;ExampleSuite&amp;quot;</span> <span class="na">verbose=</span><span class="s">&amp;quot;1&amp;quot;</span> <span class="nt">&gt;</span>
  <span class="nt">&lt;listeners&gt;</span>
    <span class="nt">&lt;listener</span> <span class="na">class-name=</span><span class="s">&amp;quot;br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter&amp;quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/listener&gt;</span>
  <span class="nt">&lt;test</span> <span class="na">name=</span><span class="s">&amp;quot;Sample</span> <span class="err">test&amp;quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;classes&gt;</span>
      <span class="nt">&lt;class</span> <span class="na">name=</span><span class="s">&amp;quot;example1.SimpleTest&amp;quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/classes&gt;</span>
  <span class="nt">&lt;/test&gt;</span>
<span class="nt">&lt;/suite&gt;</span>
</code></pre></div></div>

<p>Running this XML suite will produce three files in the test-output directory.</p>

<p><pre><span style="text-decoration: underline;">ExampleSuite.tap</span></pre></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1..2
ok 1 - example1.SimpleTest#aFastTest
 <span class="nt">---</span>
 message: TestNG Test aFastTest
 severity: <span class="s1">'~'</span>
 <span class="nb">source</span>: example1.SimpleTest#aFastTest
 datetime: <span class="s1">'2011-03-20T01:47:11'</span>
 file: example1.SimpleTest
 line: <span class="s1">'~'</span>
 name: aFastTest
 extensions: <span class="s1">'~'</span>
 got: <span class="s1">'~'</span>
 expected: <span class="s1">'~'</span>
 display: <span class="s1">'~'</span>
 dump: <span class="s1">'~'</span>
 error: <span class="s1">'~'</span>
 backtrace: <span class="s1">'~'</span>
 ...
ok 2 - example1.SimpleTest#aSlowTest
 <span class="nt">---</span>
 message: TestNG Test aSlowTest
 severity: <span class="s1">'~'</span>
 <span class="nb">source</span>: example1.SimpleTest#aSlowTest
 datetime: <span class="s1">'2011-03-20T01:47:11'</span>
 file: example1.SimpleTest
 line: <span class="s1">'~'</span>
 name: aSlowTest
 extensions: <span class="s1">'~'</span>
 got: <span class="s1">'~'</span>
 expected: <span class="s1">'~'</span>
 display: <span class="s1">'~'</span>
 dump: <span class="s1">'~'</span>
 error: <span class="s1">'~'</span>
 backtrace: <span class="s1">'~'</span>
 ...
</code></pre></div></div>

<p><pre><span style="text-decoration: underline;">fast.tap</span></pre></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1..1
ok 1 - example1.SimpleTest#aFastTest
 <span class="nt">---</span>
 message: TestNG Test aFastTest
 severity: <span class="s1">'~'</span>
 <span class="nb">source</span>: example1.SimpleTest#aFastTest
 datetime: <span class="s1">'2011-03-20T01:47:11'</span>
 file: example1.SimpleTest
 line: <span class="s1">'~'</span>
 name: aFastTest
 extensions: <span class="s1">'~'</span>
 got: <span class="s1">'~'</span>
 expected: <span class="s1">'~'</span>
 display: <span class="s1">'~'</span>
 dump: <span class="s1">'~'</span>
 error: <span class="s1">'~'</span>
 backtrace: <span class="s1">'~'</span>
 ...
</code></pre></div></div>

<p><pre><span style="text-decoration: underline;">slow.tap</span></pre></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1..1
ok 1 - example1.SimpleTest#aSlowTest
 <span class="nt">---</span>
 message: TestNG Test aSlowTest
 severity: <span class="s1">'~'</span>
 <span class="nb">source</span>: example1.SimpleTest#aSlowTest
 datetime: <span class="s1">'2011-03-20T01:47:11'</span>
 file: example1.SimpleTest
 line: <span class="s1">'~'</span>
 name: aSlowTest
 extensions: <span class="s1">'~'</span>
 got: <span class="s1">'~'</span>
 expected: <span class="s1">'~'</span>
 display: <span class="s1">'~'</span>
 dump: <span class="s1">'~'</span>
 error: <span class="s1">'~'</span>
 backtrace: <span class="s1">'~'</span>
 ...
</code></pre></div></div>

<p>tap4j Listeners can generate TAP Streams for TestNG tests for each method, for each class, for each group and for each suite. Nice uhn? :-)</p>

<h2>Tests that get skipped</h2>

<p>In TAP there are two directives: <strong>SKIP </strong>and <strong>TODO</strong>. SKIP is used to mark a test result as skipped, and TODO says that certain method is still not completely implemented. Tests that are skipped by TestNG are then marked as 'not ok' with the SKIP directive. Let's see some sample code.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">example1</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.testng.Assert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.testng.annotations.Listeners</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.testng.annotations.Test</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">br.eti.kinoshita.tap4j.ext.testng.TestTAPReporter</span><span class="o">;</span>

<span class="nd">@Listeners</span><span class="o">(</span><span class="n">value</span><span class="o">={</span><span class="nc">TestTAPReporter</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SkipTest</span>
<span class="o">{</span>
 <span class="nd">@Test</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">aTestThatFails</span><span class="o">()</span>
 <span class="o">{</span>
   <span class="nc">Assert</span><span class="o">.</span><span class="na">assertTrue</span><span class="o">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">0</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">);</span> <span class="c1">// programmatic causing an error in the test</span>
 <span class="o">}</span>

 <span class="nd">@Test</span><span class="o">(</span><span class="n">dependsOnMethods</span><span class="o">={&amp;</span><span class="n">quot</span><span class="o">;</span><span class="n">aTestThatFails</span><span class="o">&amp;</span><span class="n">quot</span><span class="o">;})</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">aDepedentMethod</span><span class="o">()</span> <span class="c1">// This method is always skipped</span>
 <span class="o">{</span>
   <span class="nc">Assert</span><span class="o">.</span><span class="na">assertTrue</span><span class="o">(</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">);</span>
 <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>In the code above we are intentionally making a mistake in the method aTestThatFails (we try to divide a number by zero). The method aDepedentMethod that depends on this method is then always skipped. Here is the output TAP Stream:</p>

<p><pre><span style="text-decoration: underline;">example1.SkipTest.tap</span></pre></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1..2
not ok 1 - example1.SkipTest#aDepedentMethod <span class="c"># SKIP TestNG test was skipped</span>
 <span class="nt">---</span>
 message: TestNG Test aDepedentMethod
 severity: <span class="s1">'~'</span>
 <span class="nb">source</span>: example1.SkipTest#aDepedentMethod
 datetime: <span class="s1">'2011-03-20T02:55:34'</span>
 file: example1.SkipTest
 line: <span class="s1">'~'</span>
 name: aDepedentMethod
 extensions: <span class="s1">'~'</span>
 got: <span class="s1">'~'</span>
 expected: <span class="s1">'~'</span>
 display: <span class="s1">'~'</span>
 dump: <span class="s1">'~'</span>
 error: <span class="s1">'~'</span>
 backtrace: <span class="s1">'~'</span>
 ...
not ok 2 - example1.SkipTest#aTestThatFails
 <span class="nt">---</span>
 message: TestNG Test aTestThatFails
 severity: High
 <span class="nb">source</span>: example1.SkipTest#aTestThatFails
 datetime: <span class="s1">'2011-03-20T02:55:34'</span>
 file: example1.SkipTest
 line: <span class="s1">''</span>
 name: aTestThatFails
 extensions: <span class="s1">'~'</span>
 got: <span class="s1">'~'</span>
 expected: <span class="s1">'~'</span>
 display: <span class="s1">'~'</span>
 dump: <span class="s1">'~'</span>
 error: / by zero
 backtrace: &amp;quot<span class="p">;</span>java.lang.ArithmeticException: / by zero<span class="se">\n\t</span>at example1.SkipTest.aTestThatFails<span class="o">(</span>SkipTest.java:15<span class="o">)</span><span class="se">\n\</span>
 <span class="se">\t</span>at sun.reflect.NativeMethodAccessorImpl.invoke0<span class="o">(</span>Native Method<span class="o">)</span><span class="se">\n\t</span>at sun.reflect.NativeMethodAccessorImpl.invoke<span class="o">(</span>NativeMethodAccessorImpl.java:39<span class="o">)</span><span class="se">\n\</span>
 <span class="se">\t</span>at sun.reflect.DelegatingMethodAccessorImpl.invoke<span class="o">(</span>DelegatingMethodAccessorImpl.java:25<span class="o">)</span><span class="se">\n\</span>
 <span class="se">\t</span>at java.lang.reflect.Method.invoke<span class="o">(</span>Method.java:597<span class="o">)</span><span class="se">\n\t</span>at org.testng.internal.MethodInvocationHelper.invokeMethod<span class="o">(</span>MethodInvocationHelper.java:74<span class="o">)</span><span class="se">\n\</span>
 <span class="se">\t</span>at org.testng.internal.Invoker.invokeMethod<span class="o">(</span>Invoker.java:673<span class="o">)</span><span class="se">\n\t</span>at org.testng.internal.Invoker.invokeTestMethod<span class="o">(</span>Invoker.java:846<span class="o">)</span><span class="se">\n\</span>
 <span class="se">\t</span>at org.testng.internal.Invoker.invokeTestMethods<span class="o">(</span>Invoker.java:1170<span class="o">)</span><span class="se">\n\t</span>at org.testng.internal.TestMethodWorker.invokeTestMethods<span class="o">(</span>TestMethodWorker.java:125<span class="o">)</span><span class="se">\n\</span>
 <span class="se">\t</span>at org.testng.internal.TestMethodWorker.run<span class="o">(</span>TestMethodWorker.java:109<span class="o">)</span><span class="se">\n\t</span>at org.testng.TestRunner.runWorkers<span class="o">(</span>TestRunner.java:1125<span class="o">)</span><span class="se">\n\</span>
 <span class="se">\t</span>at org.testng.TestRunner.privateRun<span class="o">(</span>TestRunner.java:749<span class="o">)</span><span class="se">\n\t</span>at org.testng.TestRunner.run<span class="o">(</span>TestRunner.java:600<span class="o">)</span><span class="se">\n\</span>
 <span class="se">\t</span>at org.testng.SuiteRunner.runTest<span class="o">(</span>SuiteRunner.java:317<span class="o">)</span><span class="se">\n\t</span>at org.testng.SuiteRunner.runSequentially<span class="o">(</span>SuiteRunner.java:312<span class="o">)</span><span class="se">\n\</span>
 <span class="se">\t</span>at org.testng.SuiteRunner.privateRun<span class="o">(</span>SuiteRunner.java:274<span class="o">)</span><span class="se">\n\t</span>at org.testng.SuiteRunner.run<span class="o">(</span>SuiteRunner.java:223<span class="o">)</span><span class="se">\n\</span>
 <span class="se">\t</span>at org.testng.SuiteRunnerWorker.runSuite<span class="o">(</span>SuiteRunnerWorker.java:52<span class="o">)</span><span class="se">\n\t</span>at org.testng.SuiteRunnerWorker.run<span class="o">(</span>SuiteRunnerWorker.java:86<span class="o">)</span><span class="se">\n\</span>
 <span class="se">\t</span>at org.testng.TestNG.runSuitesSequentially<span class="o">(</span>TestNG.java:995<span class="o">)</span><span class="se">\n\t</span>at org.testng.TestNG.runSuitesLocally<span class="o">(</span>TestNG.java:920<span class="o">)</span><span class="se">\n\</span>
 <span class="se">\t</span>at org.testng.TestNG.run<span class="o">(</span>TestNG.java:856<span class="o">)</span><span class="se">\n\t</span>at org.testng.remote.RemoteTestNG.run<span class="o">(</span>RemoteTestNG.java:110<span class="o">)</span><span class="se">\n\</span>
 <span class="se">\t</span>at org.testng.remote.RemoteTestNG.initAndRun<span class="o">(</span>RemoteTestNG.java:205<span class="o">)</span><span class="se">\n\t</span>at org.testng.remote.RemoteTestNG.main<span class="o">(</span>RemoteTestNG.java:174<span class="o">)</span><span class="se">\n</span>&amp;quot<span class="p">;</span>
 ...
</code></pre></div></div>

<p>You can use <a title="br.eti.kinoshita.tap4j.ext.testng.TestTAPReporter" href="https://github.com/kinow/tap4j/blob/master/src/main/java/org/tap4j/ext/testng/TestTAPReporter.java">br.eti.kinoshita.tap4j.ext.testng.TestTAPReporter</a> or <a title="br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter" href="https://github.com/kinow/tap4j/blob/master/src/main/java/org/tap4j/ext/testng/SuiteTAPReporter.java">br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter</a>, as both listeners generate information on skipped tests.</p>

<h2>Dependencies</h2>

<p>At moment tap4j listeners don't give you an idea of how is the dependency among the tests in your project. It is an issue that has to be better detailed to be implemented in a new version of tap4j. I know there are methods in the TestNG API that can tell you on which method/group a test depends upon. However I would need to sit down and think where to put this information in the TAP Stream. I like checking first how is it being done in Perl and then trying to code it in a way that the information generated by Java is more similar to that generated in Perl.</p>

<p>I created the enhancement issue <a title="Add dependency information in TestNG TAP integration" href="https://sourceforge.net/tracker/?func=detail&amp;aid=3228068&amp;group_id=351793&amp;atid=1470124">3228068</a> in tap4j SF.net project to discuss about dependencies in tap4j TestNG integration. I have to work on a few things in <a title="TestLink" href="http://www.teamst.org">TestLink</a> and Jenkins prior to start developing this integration, but it is in my list of things to do before Easter (this year's Easter, of course ;-)).</p>

<hr />

<p>That's all folks! I hope this post clarifies a little bit more about TestNG and TAP. Although there is a lot of work to do in this integration, it is already being used by <a title="Jenkins TestLink Plug-in" href="http://wiki.jenkins-ci.org/display/JENKINS/TestLink+Plugin">Jenkins TestLink Plug-in</a> in productive environments as a way to retrieve information about the test results and update TestLink. Just for what it is worth, the plug-in reads the 'extensions' entry, looking for a file entry that represents a test evidence. This way automated tests can have evidences uploaded into TestLink test executions.</p>

<p>Ah, just one last note, in the following days the classes and packages of the tap4j project may be updated. Probably I will release tap4j 2.0 with the base package org.tap4j instead of br.eti.kinoshita.tap4j. I think it makes the project more 'free' and 'community-oriented' rather than using my own domain in it. As the API is very new I believe it is better to take this decision now rather than when it is being used in more projects.</p>

<p>Cheers</p>

  </div>

  <div class="tags"><p>Tags:&nbsp;<a class="label" href="/tag/test anything protocol">test anything protocol</a>,&nbsp;<a class="label" href="/tag/software quality">software quality</a>,&nbsp;<a class="label" href="/tag/java">java</a>.<br/></p></div>

  <a class="u-url" href="/2011/03/20/discussing-the-flexibility-of-tap-to-cover-information-generated-by-testng.html" hidden></a>
</article>

  </div>
</div>
</body>
</html>
