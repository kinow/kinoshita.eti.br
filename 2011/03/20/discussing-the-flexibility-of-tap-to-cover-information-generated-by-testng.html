<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta property="og:title" content="Discussing the flexibility of TAP to cover information generated by TestNG">
<meta property="og:description" content="In today's post I am expanding the previous one regarding the use of TAP with TestNG. Let's discuss about the flexibility of TAP to cover information generated by TestNG, more specifically:

	Expected Exceptions
	Data Providers
	Groups
	Tests that get skipped
	Dependencies

We will be addressing these bullet points using tap4j, a TAP implementation for Java. The integration between TAP and TestNG is done through the use of TestNG Listeners developed in tap4j project (a big thanks here to Cesar Fernandes de Almeida for all his help).
There are two listeners in tap4j, br.eti.kinoshita.tap4j.ext.testng.TestTAPReporter and br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter. The first was created based on org.testng.reporters.TestHTMLReporter and the latter was created based on org.testng.reporters.SuiteHTMLReporter.





  
  




In this figure you have testing tools as TAP producers (left) and different types of applications as consumers (right)">
<meta property="og:type" content="article">
<meta property="og:url" content="https://kinoshita.eti.br/2011/03/20/discussing-the-flexibility-of-tap-to-cover-information-generated-by-testng.html"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2011-03-20T00:00:00+00:00">
<meta property="article:modified_time" content="2024-04-05T22:01:01+02:00">
<link rel=alternate type=application/rss+xml href=https://kinoshita.eti.br/2011/03/20/discussing-the-flexibility-of-tap-to-cover-information-generated-by-testng/feed.xml title=kinow>
<link rel=stylesheet type=text/css href=https://kinoshita.eti.br/sass/main.09b56b6037e962b67cf7a7701bf2a9ee5da840a4f74b74139c4731f2156a5917.css integrity="sha256-CbVrYDfpYrZ896dwG/Kp7l2oQKT3S3QTnEcx8hVqWRc=">
<title>kinow | Discussing the flexibility of TAP to cover information generated by TestNG</title>
</head>
<body>
<header role=banner class=content>
<nav id=nav aria-label=Main role=navigation class=content>
<ul><li>
<a href=/><i data-feather=about></i> About</a>
</li><li>
<a href=/blog/><i data-feather=blog></i> Blog</a>
</li><li>
<a href=/portfolio/><i data-feather=portfolio></i> Portfolio</a>
</li>
</ul>
</nav>
</header>
<main>
<article class=content>
<h1>Discussing the flexibility of TAP to cover information generated by TestNG</h1><div class=metadata>
<i data-feather=calendar></i>
<time datetime=2011-03-20>Mar 20, 2011</time>
</div>
<aside>
<nav id=TableOfContents></nav>
</aside>
<p>In today's post I am expanding the previous one regarding the use of <a title="TAP (Test Anything Protocol)" href=http://www.testanything.org>TAP</a> with <a title=TestNG href=http://www.testng.org>TestNG</a>. Let's discuss about the flexibility of TAP to cover information generated by TestNG, more specifically:</p>
<ul>
<li>Expected Exceptions</li>
<li>Data Providers</li>
<li>Groups</li>
<li>Tests that get skipped</li>
<li>Dependencies</li>
</ul>
<p>We will be addressing these bullet points using <a title=tap4j href=http://tap4j.sourceforge.net>tap4j</a>, a TAP implementation for Java. The integration between TAP and TestNG is done through the use of TestNG Listeners developed in tap4j project (a big thanks here to <a title="Cesar Fernandes de Almeida" href=http://www.cesinha.com>Cesar Fernandes de Almeida</a> for all his help).</p>
<p>There are two listeners in tap4j, <a title=br.eti.kinoshita.tap4j.ext.testng.TestTAPReporter href=https://github.com/kinow/tap4j/blob/master/src/main/java/org/tap4j/ext/testng/TestTAPReporter.java>br.eti.kinoshita.tap4j.ext.testng.TestTAPReporter</a> and <a title=br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter href=https://github.com/kinow/tap4j/blob/master/src/main/java/br/eti/kinoshita/tap4j/ext/testng/SuiteTAPReporter.java>br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter</a>. The first was created based on <a title=org.testng.reporters.TestHTMLReporter href=https://github.com/cbeust/testng/blob/master/src/main/java/org/testng/reporters/TestHTMLReporter.java>org.testng.reporters.TestHTMLReporter</a> and the latter was created based on <a title=org.testng.reporters.SuiteHTMLReporter href=https://github.com/cbeust/testng/blob/master/src/main/java/org/testng/reporters/SuiteHTMLReporter.java>org.testng.reporters.SuiteHTMLReporter</a>.</p>
<figure class=feature>
<img src=/assets/posts/2011-03-20-discussing-the-flexibility-of-tap-to-cover-information-generated-by-testng/unnamed0.jpg alt title width height>
<figcaption></figcaption>
</figure>
<p style=text-align:center><em><span style=color:#999;font-size:.8em>In this figure you have testing tools as TAP producers (left) and different types of applications as consumers (right)</span></em></p>
<h2>Expected Exceptions</h2>
<p>There is no special treatment for the Expected Exceptions in the tap4j Listeners. When a test passes, tap4j listeners logs only that the test succeeded. But when it fails and the Test Result contains a Throwable object, it is logged to the TAP Stream. I am still discussing it with Cesar whether it would be a good idea to parse the Throwable message body to retrieve the 'line', 'expected' and 'got' values for this error (these are entries in TAP Diagnostics - YAML).</p>
<p>Particularly, I would like to have this information in TestException. Maybe it could have a constructor public TestException(String message, Throwable t, String expected, String got, long lineNumber) and TestNG could fill this information for me :-). I know I'm being lazy, but I like the description of laziness in <a title="Larry Wall's Wikipedia entry" href=http://en.wikipedia.org/wiki/Larry_Wall>Larry Wall's WikiPedia entry</a>. The following test is expecting an exception that is never thrown, thus it raises an exception.</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a90d91>package</span> <span style=color:#000>example1</span><span style=color:#000>;</span>

<span style=color:#a90d91>import</span> <span style=color:#000>org.testng.Assert</span><span style=color:#000>;</span>
<span style=color:#a90d91>import</span> <span style=color:#000>org.testng.annotations.Test</span><span style=color:#000>;</span>

<span style=color:#a90d91>public</span> <span style=color:#a90d91>class</span> <span style=color:#3f6e75>TestFoo</span>
<span style=color:#000>{</span>

 <span style=color:#177500>// expecing npe instead of arith.
</span><span style=color:#177500></span> <span style=color:#000>@Test</span><span style=color:#000>(</span><span style=color:#000>expectedExceptions</span><span style=color:#000>={</span><span style=color:#000>NullPointerException</span><span style=color:#000>.</span><span style=color:#836c28>class</span><span style=color:#000>})</span>
 <span style=color:#a90d91>public</span> <span style=color:#a90d91>void</span> <span style=color:#000>test</span><span style=color:#000>()</span>
 <span style=color:#000>{</span>
   <span style=color:#000>Assert</span><span style=color:#000>.</span><span style=color:#836c28>assertTrue</span><span style=color:#000>(</span><span style=color:#000>1</span><span style=color:#000>/</span><span style=color:#000>0</span> <span style=color:#000>&gt;</span> <span style=color:#000>0</span><span style=color:#000>);</span> <span style=color:#177500>// programmatic causing an error in the test
</span><span style=color:#177500></span> <span style=color:#000>}</span>

<span style=color:#000>}</span>
</code></pre></div><p>And the TAP Stream with the exception in the 'backtrace' entry.</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>1..1
not ok <span style=color:#1c01ce>1</span> - example1.TestFoo#test
 ---
 message: TestNG Test <span style=color:#a90d91>test</span>
 severity: High
 source: example1.TestFoo#test
 datetime: <span style=color:#c41a16>&#39;2011-03-20T03:45:30&#39;</span>
 file: example1.TestFoo
 line: <span style=color:#c41a16>&#39;&#39;</span>
 name: <span style=color:#a90d91>test</span>
 extensions: <span style=color:#c41a16>&#39;~&#39;</span>
 got: <span style=color:#c41a16>&#39;~&#39;</span>
 expected: <span style=color:#c41a16>&#39;~&#39;</span>
 display: <span style=color:#c41a16>&#39;~&#39;</span>
 dump: <span style=color:#c41a16>&#39;~&#39;</span>
 error: &amp;quot;<span style=color:#c41a16>\n</span>Expected exception java.lang.NullPointerException but got org.testng.TestException:<span style=color:#c41a16>\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\ \n</span>Expected exception java.lang.NullPointerException but got java.lang.ArithmeticException:<span style=color:#c41a16>\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\ </span>/ by zero&amp;quot;
 backtrace: &amp;quot;org.testng.TestException: <span style=color:#c41a16>\n</span>Expected exception java.lang.NullPointerException<span style=color:#c41a16>\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\ </span>but got org.testng.TestException: <span style=color:#c41a16>\n</span>Expected exception java.lang.NullPointerException<span style=color:#c41a16>\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\ </span>but got java.lang.ArithmeticException: / by zero<span style=color:#c41a16>\n\t</span>at org.testng.internal.Invoker.handleInvocationResults<span style=color:#000>(</span>Invoker.java:1416<span style=color:#000>)</span><span style=color:#c41a16>\n\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\t</span>at org.testng.internal.Invoker.invokeTestMethods<span style=color:#000>(</span>Invoker.java:1184<span style=color:#000>)</span><span style=color:#c41a16>\n\t</span>at org.testng.internal.TestMethodWorker.invokeTestMethods<span style=color:#000>(</span>TestMethodWorker.java:125<span style=color:#000>)</span><span style=color:#c41a16>\n\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\t</span>at org.testng.internal.TestMethodWorker.run<span style=color:#000>(</span>TestMethodWorker.java:109<span style=color:#000>)</span><span style=color:#c41a16>\n\t</span>at org.testng.TestRunner.runWorkers<span style=color:#000>(</span>TestRunner.java:1125<span style=color:#000>)</span><span style=color:#c41a16>\n\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\t</span>at org.testng.TestRunner.privateRun<span style=color:#000>(</span>TestRunner.java:749<span style=color:#000>)</span><span style=color:#c41a16>\n\t</span>at org.testng.TestRunner.run<span style=color:#000>(</span>TestRunner.java:600<span style=color:#000>)</span><span style=color:#c41a16>\n\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\t</span>at org.testng.SuiteRunner.runTest<span style=color:#000>(</span>SuiteRunner.java:317<span style=color:#000>)</span><span style=color:#c41a16>\n\t</span>at org.testng.SuiteRunner.runSequentially<span style=color:#000>(</span>SuiteRunner.java:312<span style=color:#000>)</span><span style=color:#c41a16>\n\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\t</span>at org.testng.SuiteRunner.privateRun<span style=color:#000>(</span>SuiteRunner.java:274<span style=color:#000>)</span><span style=color:#c41a16>\n\t</span>at org.testng.SuiteRunner.run<span style=color:#000>(</span>SuiteRunner.java:223<span style=color:#000>)</span><span style=color:#c41a16>\n\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\t</span>at org.testng.SuiteRunnerWorker.runSuite<span style=color:#000>(</span>SuiteRunnerWorker.java:52<span style=color:#000>)</span><span style=color:#c41a16>\n\t</span>at org.testng.SuiteRunnerWorker.run<span style=color:#000>(</span>SuiteRunnerWorker.java:86<span style=color:#000>)</span><span style=color:#c41a16>\n\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\t</span>at org.testng.TestNG.runSuitesSequentially<span style=color:#000>(</span>TestNG.java:995<span style=color:#000>)</span><span style=color:#c41a16>\n\t</span>at org.testng.TestNG.runSuitesLocally<span style=color:#000>(</span>TestNG.java:920<span style=color:#000>)</span><span style=color:#c41a16>\n\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\t</span>at org.testng.TestNG.run<span style=color:#000>(</span>TestNG.java:856<span style=color:#000>)</span><span style=color:#c41a16>\n\t</span>at org.testng.remote.RemoteTestNG.run<span style=color:#000>(</span>RemoteTestNG.java:110<span style=color:#000>)</span><span style=color:#c41a16>\n\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\t</span>at org.testng.remote.RemoteTestNG.initAndRun<span style=color:#000>(</span>RemoteTestNG.java:205<span style=color:#000>)</span><span style=color:#c41a16>\n\t</span>at org.testng.remote.RemoteTestNG.main<span style=color:#000>(</span>RemoteTestNG.java:174<span style=color:#000>)</span><span style=color:#c41a16>\n\
</span><span style=color:#c41a16></span> Caused by: org.testng.TestException: <span style=color:#c41a16>\n</span>Expected exception java.lang.NullPointerException<span style=color:#c41a16>\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\ </span>but got java.lang.ArithmeticException: / by zero<span style=color:#c41a16>\n\t</span>at org.testng.internal.Invoker.handleInvocationResults<span style=color:#000>(</span>Invoker.java:1416<span style=color:#000>)</span><span style=color:#c41a16>\n\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\t</span>at org.testng.internal.Invoker.invokeMethod<span style=color:#000>(</span>Invoker.java:722<span style=color:#000>)</span><span style=color:#c41a16>\n\t</span>at org.testng.internal.Invoker.invokeTestMethod<span style=color:#000>(</span>Invoker.java:846<span style=color:#000>)</span><span style=color:#c41a16>\n\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\t</span>at org.testng.internal.Invoker.invokeTestMethods<span style=color:#000>(</span>Invoker.java:1170<span style=color:#000>)</span><span style=color:#c41a16>\n\t</span>... 17<span style=color:#c41a16>\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\ </span>more<span style=color:#c41a16>\n</span>Caused by: java.lang.ArithmeticException: / by zero<span style=color:#c41a16>\n\t</span>at example1.TestFoo.test<span style=color:#000>(</span>TestFoo.java:17<span style=color:#000>)</span><span style=color:#c41a16>\n\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\t</span>at sun.reflect.NativeMethodAccessorImpl.invoke0<span style=color:#000>(</span>Native Method<span style=color:#000>)</span><span style=color:#c41a16>\n\t</span>at sun.reflect.NativeMethodAccessorImpl.invoke<span style=color:#000>(</span>NativeMethodAccessorImpl.java:39<span style=color:#000>)</span><span style=color:#c41a16>\n\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\t</span>at sun.reflect.DelegatingMethodAccessorImpl.invoke<span style=color:#000>(</span>DelegatingMethodAccessorImpl.java:25<span style=color:#000>)</span><span style=color:#c41a16>\n\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\t</span>at java.lang.reflect.Method.invoke<span style=color:#000>(</span>Method.java:597<span style=color:#000>)</span><span style=color:#c41a16>\n\t</span>at org.testng.internal.MethodInvocationHelper.invokeMethod<span style=color:#000>(</span>MethodInvocationHelper.java:74<span style=color:#000>)</span><span style=color:#c41a16>\n\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\t</span>at org.testng.internal.Invoker.invokeMethod<span style=color:#000>(</span>Invoker.java:673<span style=color:#000>)</span><span style=color:#c41a16>\n\t</span>... <span style=color:#1c01ce>19</span> more<span style=color:#c41a16>\n</span>&amp;quot;
 ...
</code></pre></div><p>As you can see, the Exception contains the information of what the test expected (java.lang.NullPointerException) and what the test actually got (java.lang.ArithmeticException).</p>
<h2>Data Providers</h2>
<p>In order to use a data provider with TestNG you have to add parameters to your method. Look at the code below.</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a90d91>package</span> <span style=color:#000>example1</span><span style=color:#000>;</span>

<span style=color:#a90d91>import</span> <span style=color:#000>org.testng.Assert</span><span style=color:#000>;</span>
<span style=color:#a90d91>import</span> <span style=color:#000>org.testng.annotations.DataProvider</span><span style=color:#000>;</span>
<span style=color:#a90d91>import</span> <span style=color:#000>org.testng.annotations.Listeners</span><span style=color:#000>;</span>
<span style=color:#a90d91>import</span> <span style=color:#000>org.testng.annotations.Test</span><span style=color:#000>;</span>

<span style=color:#a90d91>import</span> <span style=color:#000>br.eti.kinoshita.tap4j.ext.testng.TestTAPReporter</span><span style=color:#000>;</span>

<span style=color:#000>@Listeners</span><span style=color:#000>(</span><span style=color:#000>value</span><span style=color:#000>={</span><span style=color:#000>TestTAPReporter</span><span style=color:#000>.</span><span style=color:#836c28>class</span><span style=color:#000>})</span>
<span style=color:#a90d91>public</span> <span style=color:#a90d91>class</span> <span style=color:#3f6e75>TestWithDataProvider</span>
<span style=color:#000>{</span>

 <span style=color:#000>@DataProvider</span><span style=color:#000>(</span><span style=color:#000>name</span><span style=color:#000>=&amp;</span><span style=color:#000>quot</span><span style=color:#000>;</span><span style=color:#000>names</span><span style=color:#000>&amp;</span><span style=color:#000>quot</span><span style=color:#000>;)</span>
 <span style=color:#a90d91>public</span> <span style=color:#000>Object</span><span style=color:#000>[][]</span> <span style=color:#000>getNames</span><span style=color:#000>()</span>
 <span style=color:#000>{</span>
   <span style=color:#a90d91>return</span> <span style=color:#a90d91>new</span> <span style=color:#000>Object</span><span style=color:#000>[][]</span>
   <span style=color:#000>{</span>
     <span style=color:#000>{&amp;</span><span style=color:#000>quot</span><span style=color:#000>;</span><span style=color:#000>Haruki</span><span style=color:#000>&amp;</span><span style=color:#000>quot</span><span style=color:#000>;},</span>
     <span style=color:#000>{&amp;</span><span style=color:#000>quot</span><span style=color:#000>;</span><span style=color:#000>Murakami</span><span style=color:#000>&amp;</span><span style=color:#000>quot</span><span style=color:#000>;}</span>
   <span style=color:#000>};</span>
 <span style=color:#000>}</span>

 <span style=color:#000>@Test</span><span style=color:#000>(</span><span style=color:#000>dataProvider</span><span style=color:#000>=&amp;</span><span style=color:#000>quot</span><span style=color:#000>;</span><span style=color:#000>names</span><span style=color:#000>&amp;</span><span style=color:#000>quot</span><span style=color:#000>;)</span>
 <span style=color:#a90d91>public</span> <span style=color:#a90d91>void</span> <span style=color:#000>testName</span><span style=color:#000>(</span><span style=color:#000>String</span> <span style=color:#000>name</span><span style=color:#000>)</span>
 <span style=color:#000>{</span>
   <span style=color:#000>Assert</span><span style=color:#000>.</span><span style=color:#836c28>assertNotNull</span><span style=color:#000>(</span><span style=color:#000>name</span><span style=color:#000>);</span>
 <span style=color:#000>}</span>

<span style=color:#000>}</span>
</code></pre></div><p>Running the test above results in the following TAP Stream:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>1..2
ok <span style=color:#1c01ce>1</span> - example1.TestWithDataProvider#testName
 ---
 message: TestNG Test testName
 severity: <span style=color:#c41a16>&#39;~&#39;</span>
 source: example1.TestWithDataProvider#testName
 datetime: <span style=color:#c41a16>&#39;2011-03-20T03:09:50&#39;</span>
 file: example1.TestWithDataProvider
 line: <span style=color:#c41a16>&#39;~&#39;</span>
 name: testName
 extensions: <span style=color:#c41a16>&#39;~&#39;</span>
 got: <span style=color:#c41a16>&#39;~&#39;</span>
 expected: <span style=color:#c41a16>&#39;~&#39;</span>
 display: <span style=color:#c41a16>&#39;~&#39;</span>
 dump: <span style=color:#c41a16>&#39;{param1=Haruki}&#39;</span>
 error: <span style=color:#c41a16>&#39;~&#39;</span>
 backtrace: <span style=color:#c41a16>&#39;~&#39;</span>
 ...
ok <span style=color:#1c01ce>2</span> - example1.TestWithDataProvider#testName
 ---
 message: TestNG Test testName
 severity: <span style=color:#c41a16>&#39;~&#39;</span>
 source: example1.TestWithDataProvider#testName
 datetime: <span style=color:#c41a16>&#39;2011-03-20T03:09:50&#39;</span>
 file: example1.TestWithDataProvider
 line: <span style=color:#c41a16>&#39;~&#39;</span>
 name: testName
 extensions: <span style=color:#c41a16>&#39;~&#39;</span>
 got: <span style=color:#c41a16>&#39;~&#39;</span>
 expected: <span style=color:#c41a16>&#39;~&#39;</span>
 display: <span style=color:#c41a16>&#39;~&#39;</span>
 dump: <span style=color:#c41a16>&#39;{param1=Murakami}&#39;</span>
 error: <span style=color:#c41a16>&#39;~&#39;</span>
 backtrace: <span style=color:#c41a16>&#39;~&#39;</span>
 ...
</code></pre></div><p>As you can see, tap4j listeners output in the 'dump' entry the values for parameters used in the test. This way you have both the data obtained through Data Providers and what was passed as parameters during the test execution. One issue could be that this information can't be distinguished, i.e. you can't tell if the params are coming from a Data Provider or if they are parameters.</p>
<h2>Groups</h2>
<p>The listener <a title=br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter href=https://github.com/kinow/tap4j/blob/master/src/main/java/org/tap4j/ext/testng/SuiteTAPReporter.java>br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter</a> contains the logic to generate a TAP Stream for each TestNG group found in the test suite. There was a BUG in this listener that was fixed in tap4j version 1.4.5 (thanks again to Cesar). Let's use the following code taken from TestNG documentation site.</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a90d91>package</span> <span style=color:#000>example1</span><span style=color:#000>;</span>

<span style=color:#a90d91>import</span> <span style=color:#000>org.testng.annotations.BeforeClass</span><span style=color:#000>;</span>
<span style=color:#a90d91>import</span> <span style=color:#000>org.testng.annotations.Test</span><span style=color:#000>;</span>

<span style=color:#a90d91>public</span> <span style=color:#a90d91>class</span> <span style=color:#3f6e75>SimpleTest</span> <span style=color:#000>{</span>

<span style=color:#000>@BeforeClass</span>
<span style=color:#a90d91>public</span> <span style=color:#a90d91>void</span> <span style=color:#000>setUp</span><span style=color:#000>()</span> <span style=color:#000>{</span>
  <span style=color:#177500>// code that will be invoked when this test is instantiated
</span><span style=color:#177500></span><span style=color:#000>}</span>

<span style=color:#000>@Test</span><span style=color:#000>(</span><span style=color:#000>groups</span> <span style=color:#000>=</span> <span style=color:#000>{</span> <span style=color:#000>&amp;</span><span style=color:#000>quot</span><span style=color:#000>;</span><span style=color:#000>fast</span><span style=color:#000>&amp;</span><span style=color:#000>quot</span><span style=color:#000>;</span> <span style=color:#000>})</span>
<span style=color:#a90d91>public</span> <span style=color:#a90d91>void</span> <span style=color:#000>aFastTest</span><span style=color:#000>()</span> <span style=color:#000>{</span>
  <span style=color:#000>System</span><span style=color:#000>.</span><span style=color:#836c28>out</span><span style=color:#000>.</span><span style=color:#836c28>println</span><span style=color:#000>(&amp;</span><span style=color:#000>quot</span><span style=color:#000>;</span><span style=color:#000>Fast</span> <span style=color:#000>test</span><span style=color:#000>&amp;</span><span style=color:#000>quot</span><span style=color:#000>;);</span>
<span style=color:#000>}</span>

<span style=color:#000>@Test</span><span style=color:#000>(</span><span style=color:#000>groups</span> <span style=color:#000>=</span> <span style=color:#000>{</span> <span style=color:#000>&amp;</span><span style=color:#000>quot</span><span style=color:#000>;</span><span style=color:#000>slow</span><span style=color:#000>&amp;</span><span style=color:#000>quot</span><span style=color:#000>;</span> <span style=color:#000>})</span>
<span style=color:#a90d91>public</span> <span style=color:#a90d91>void</span> <span style=color:#000>aSlowTest</span><span style=color:#000>()</span> <span style=color:#000>{</span>
  <span style=color:#000>System</span><span style=color:#000>.</span><span style=color:#836c28>out</span><span style=color:#000>.</span><span style=color:#836c28>println</span><span style=color:#000>(&amp;</span><span style=color:#000>quot</span><span style=color:#000>;</span><span style=color:#000>Slow</span> <span style=color:#000>test</span><span style=color:#000>&amp;</span><span style=color:#000>quot</span><span style=color:#000>;);</span>
<span style=color:#000>}</span>

<span style=color:#000>}</span>
</code></pre></div><p>And let's create a XML suite for running this test with tap4j SuiteTAPReporter listener.</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#633820>&lt;!DOCTYPE suite SYSTEM &amp;quot;http://testng.org/testng-1.0.dtd&amp;quot; &gt;</span>
  
<span style=color:#000>&lt;suite</span> <span style=color:#836c28>name=</span><span style=color:#c41a16>&amp;quot;ExampleSuite&amp;quot;</span> <span style=color:#836c28>verbose=</span><span style=color:#c41a16>&amp;quot;1&amp;quot;</span> <span style=color:#000>&gt;</span>
  <span style=color:#000>&lt;listeners&gt;</span>
    <span style=color:#000>&lt;listener</span> <span style=color:#836c28>class-name=</span><span style=color:#c41a16>&amp;quot;br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter&amp;quot;</span> <span style=color:#000>/&gt;</span>
  <span style=color:#000>&lt;/listener&gt;</span>
  <span style=color:#000>&lt;test</span> <span style=color:#836c28>name=</span><span style=color:#c41a16>&amp;quot;Sample</span> <span style=color:#000>test&amp;quot;</span><span style=color:#000>&gt;</span>
    <span style=color:#000>&lt;classes&gt;</span>
      <span style=color:#000>&lt;class</span> <span style=color:#836c28>name=</span><span style=color:#c41a16>&amp;quot;example1.SimpleTest&amp;quot;</span> <span style=color:#000>/&gt;</span>
    <span style=color:#000>&lt;/classes&gt;</span>
  <span style=color:#000>&lt;/test&gt;</span>
<span style=color:#000>&lt;/suite&gt;</span>
</code></pre></div><p>Running this XML suite will produce three files in the test-output directory.</p>
<p><pre><span style=text-decoration:underline>ExampleSuite.tap</span></pre></p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>1..2
ok <span style=color:#1c01ce>1</span> - example1.SimpleTest#aFastTest
 ---
 message: TestNG Test aFastTest
 severity: <span style=color:#c41a16>&#39;~&#39;</span>
 source: example1.SimpleTest#aFastTest
 datetime: <span style=color:#c41a16>&#39;2011-03-20T01:47:11&#39;</span>
 file: example1.SimpleTest
 line: <span style=color:#c41a16>&#39;~&#39;</span>
 name: aFastTest
 extensions: <span style=color:#c41a16>&#39;~&#39;</span>
 got: <span style=color:#c41a16>&#39;~&#39;</span>
 expected: <span style=color:#c41a16>&#39;~&#39;</span>
 display: <span style=color:#c41a16>&#39;~&#39;</span>
 dump: <span style=color:#c41a16>&#39;~&#39;</span>
 error: <span style=color:#c41a16>&#39;~&#39;</span>
 backtrace: <span style=color:#c41a16>&#39;~&#39;</span>
 ...
ok <span style=color:#1c01ce>2</span> - example1.SimpleTest#aSlowTest
 ---
 message: TestNG Test aSlowTest
 severity: <span style=color:#c41a16>&#39;~&#39;</span>
 source: example1.SimpleTest#aSlowTest
 datetime: <span style=color:#c41a16>&#39;2011-03-20T01:47:11&#39;</span>
 file: example1.SimpleTest
 line: <span style=color:#c41a16>&#39;~&#39;</span>
 name: aSlowTest
 extensions: <span style=color:#c41a16>&#39;~&#39;</span>
 got: <span style=color:#c41a16>&#39;~&#39;</span>
 expected: <span style=color:#c41a16>&#39;~&#39;</span>
 display: <span style=color:#c41a16>&#39;~&#39;</span>
 dump: <span style=color:#c41a16>&#39;~&#39;</span>
 error: <span style=color:#c41a16>&#39;~&#39;</span>
 backtrace: <span style=color:#c41a16>&#39;~&#39;</span>
 ...
</code></pre></div><p><pre><span style=text-decoration:underline>fast.tap</span></pre></p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>1..1
ok <span style=color:#1c01ce>1</span> - example1.SimpleTest#aFastTest
 ---
 message: TestNG Test aFastTest
 severity: <span style=color:#c41a16>&#39;~&#39;</span>
 source: example1.SimpleTest#aFastTest
 datetime: <span style=color:#c41a16>&#39;2011-03-20T01:47:11&#39;</span>
 file: example1.SimpleTest
 line: <span style=color:#c41a16>&#39;~&#39;</span>
 name: aFastTest
 extensions: <span style=color:#c41a16>&#39;~&#39;</span>
 got: <span style=color:#c41a16>&#39;~&#39;</span>
 expected: <span style=color:#c41a16>&#39;~&#39;</span>
 display: <span style=color:#c41a16>&#39;~&#39;</span>
 dump: <span style=color:#c41a16>&#39;~&#39;</span>
 error: <span style=color:#c41a16>&#39;~&#39;</span>
 backtrace: <span style=color:#c41a16>&#39;~&#39;</span>
 ...
</code></pre></div><p><pre><span style=text-decoration:underline>slow.tap</span></pre></p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>1..1
ok <span style=color:#1c01ce>1</span> - example1.SimpleTest#aSlowTest
 ---
 message: TestNG Test aSlowTest
 severity: <span style=color:#c41a16>&#39;~&#39;</span>
 source: example1.SimpleTest#aSlowTest
 datetime: <span style=color:#c41a16>&#39;2011-03-20T01:47:11&#39;</span>
 file: example1.SimpleTest
 line: <span style=color:#c41a16>&#39;~&#39;</span>
 name: aSlowTest
 extensions: <span style=color:#c41a16>&#39;~&#39;</span>
 got: <span style=color:#c41a16>&#39;~&#39;</span>
 expected: <span style=color:#c41a16>&#39;~&#39;</span>
 display: <span style=color:#c41a16>&#39;~&#39;</span>
 dump: <span style=color:#c41a16>&#39;~&#39;</span>
 error: <span style=color:#c41a16>&#39;~&#39;</span>
 backtrace: <span style=color:#c41a16>&#39;~&#39;</span>
 ...
</code></pre></div><p>tap4j Listeners can generate TAP Streams for TestNG tests for each method, for each class, for each group and for each suite. Nice uhn? :-)</p>
<h2>Tests that get skipped</h2>
<p>In TAP there are two directives: <strong>SKIP </strong>and <strong>TODO</strong>. SKIP is used to mark a test result as skipped, and TODO says that certain method is still not completely implemented. Tests that are skipped by TestNG are then marked as 'not ok' with the SKIP directive. Let's see some sample code.</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a90d91>package</span> <span style=color:#000>example1</span><span style=color:#000>;</span>

<span style=color:#a90d91>import</span> <span style=color:#000>org.testng.Assert</span><span style=color:#000>;</span>
<span style=color:#a90d91>import</span> <span style=color:#000>org.testng.annotations.Listeners</span><span style=color:#000>;</span>
<span style=color:#a90d91>import</span> <span style=color:#000>org.testng.annotations.Test</span><span style=color:#000>;</span>

<span style=color:#a90d91>import</span> <span style=color:#000>br.eti.kinoshita.tap4j.ext.testng.TestTAPReporter</span><span style=color:#000>;</span>

<span style=color:#000>@Listeners</span><span style=color:#000>(</span><span style=color:#000>value</span><span style=color:#000>={</span><span style=color:#000>TestTAPReporter</span><span style=color:#000>.</span><span style=color:#836c28>class</span><span style=color:#000>})</span>
<span style=color:#a90d91>public</span> <span style=color:#a90d91>class</span> <span style=color:#3f6e75>SkipTest</span>
<span style=color:#000>{</span>
 <span style=color:#000>@Test</span>
 <span style=color:#a90d91>public</span> <span style=color:#a90d91>void</span> <span style=color:#000>aTestThatFails</span><span style=color:#000>()</span>
 <span style=color:#000>{</span>
   <span style=color:#000>Assert</span><span style=color:#000>.</span><span style=color:#836c28>assertTrue</span><span style=color:#000>(</span><span style=color:#000>1</span><span style=color:#000>/</span><span style=color:#000>0</span> <span style=color:#000>&gt;</span> <span style=color:#000>0</span><span style=color:#000>);</span> <span style=color:#177500>// programmatic causing an error in the test
</span><span style=color:#177500></span> <span style=color:#000>}</span>

 <span style=color:#000>@Test</span><span style=color:#000>(</span><span style=color:#000>dependsOnMethods</span><span style=color:#000>={&amp;</span><span style=color:#000>quot</span><span style=color:#000>;</span><span style=color:#000>aTestThatFails</span><span style=color:#000>&amp;</span><span style=color:#000>quot</span><span style=color:#000>;})</span>
 <span style=color:#a90d91>public</span> <span style=color:#a90d91>void</span> <span style=color:#000>aDepedentMethod</span><span style=color:#000>()</span> <span style=color:#177500>// This method is always skipped
</span><span style=color:#177500></span> <span style=color:#000>{</span>
   <span style=color:#000>Assert</span><span style=color:#000>.</span><span style=color:#836c28>assertTrue</span><span style=color:#000>(</span> <span style=color:#000>System</span><span style=color:#000>.</span><span style=color:#836c28>currentTimeMillis</span><span style=color:#000>()</span> <span style=color:#000>&gt;</span> <span style=color:#000>0</span> <span style=color:#000>);</span>
 <span style=color:#000>}</span>
<span style=color:#000>}</span>
</code></pre></div><p>In the code above we are intentionally making a mistake in the method aTestThatFails (we try to divide a number by zero). The method aDepedentMethod that depends on this method is then always skipped. Here is the output TAP Stream:</p>
<p><pre><span style=text-decoration:underline>example1.SkipTest.tap</span></pre></p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>1..2
not ok <span style=color:#1c01ce>1</span> - example1.SkipTest#aDepedentMethod <span style=color:#177500># SKIP TestNG test was skipped</span>
 ---
 message: TestNG Test aDepedentMethod
 severity: <span style=color:#c41a16>&#39;~&#39;</span>
 source: example1.SkipTest#aDepedentMethod
 datetime: <span style=color:#c41a16>&#39;2011-03-20T02:55:34&#39;</span>
 file: example1.SkipTest
 line: <span style=color:#c41a16>&#39;~&#39;</span>
 name: aDepedentMethod
 extensions: <span style=color:#c41a16>&#39;~&#39;</span>
 got: <span style=color:#c41a16>&#39;~&#39;</span>
 expected: <span style=color:#c41a16>&#39;~&#39;</span>
 display: <span style=color:#c41a16>&#39;~&#39;</span>
 dump: <span style=color:#c41a16>&#39;~&#39;</span>
 error: <span style=color:#c41a16>&#39;~&#39;</span>
 backtrace: <span style=color:#c41a16>&#39;~&#39;</span>
 ...
not ok <span style=color:#1c01ce>2</span> - example1.SkipTest#aTestThatFails
 ---
 message: TestNG Test aTestThatFails
 severity: High
 source: example1.SkipTest#aTestThatFails
 datetime: <span style=color:#c41a16>&#39;2011-03-20T02:55:34&#39;</span>
 file: example1.SkipTest
 line: <span style=color:#c41a16>&#39;&#39;</span>
 name: aTestThatFails
 extensions: <span style=color:#c41a16>&#39;~&#39;</span>
 got: <span style=color:#c41a16>&#39;~&#39;</span>
 expected: <span style=color:#c41a16>&#39;~&#39;</span>
 display: <span style=color:#c41a16>&#39;~&#39;</span>
 dump: <span style=color:#c41a16>&#39;~&#39;</span>
 error: / by zero
 backtrace: &amp;quot;java.lang.ArithmeticException: / by zero<span style=color:#c41a16>\n\t</span>at example1.SkipTest.aTestThatFails<span style=color:#000>(</span>SkipTest.java:15<span style=color:#000>)</span><span style=color:#c41a16>\n\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\t</span>at sun.reflect.NativeMethodAccessorImpl.invoke0<span style=color:#000>(</span>Native Method<span style=color:#000>)</span><span style=color:#c41a16>\n\t</span>at sun.reflect.NativeMethodAccessorImpl.invoke<span style=color:#000>(</span>NativeMethodAccessorImpl.java:39<span style=color:#000>)</span><span style=color:#c41a16>\n\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\t</span>at sun.reflect.DelegatingMethodAccessorImpl.invoke<span style=color:#000>(</span>DelegatingMethodAccessorImpl.java:25<span style=color:#000>)</span><span style=color:#c41a16>\n\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\t</span>at java.lang.reflect.Method.invoke<span style=color:#000>(</span>Method.java:597<span style=color:#000>)</span><span style=color:#c41a16>\n\t</span>at org.testng.internal.MethodInvocationHelper.invokeMethod<span style=color:#000>(</span>MethodInvocationHelper.java:74<span style=color:#000>)</span><span style=color:#c41a16>\n\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\t</span>at org.testng.internal.Invoker.invokeMethod<span style=color:#000>(</span>Invoker.java:673<span style=color:#000>)</span><span style=color:#c41a16>\n\t</span>at org.testng.internal.Invoker.invokeTestMethod<span style=color:#000>(</span>Invoker.java:846<span style=color:#000>)</span><span style=color:#c41a16>\n\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\t</span>at org.testng.internal.Invoker.invokeTestMethods<span style=color:#000>(</span>Invoker.java:1170<span style=color:#000>)</span><span style=color:#c41a16>\n\t</span>at org.testng.internal.TestMethodWorker.invokeTestMethods<span style=color:#000>(</span>TestMethodWorker.java:125<span style=color:#000>)</span><span style=color:#c41a16>\n\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\t</span>at org.testng.internal.TestMethodWorker.run<span style=color:#000>(</span>TestMethodWorker.java:109<span style=color:#000>)</span><span style=color:#c41a16>\n\t</span>at org.testng.TestRunner.runWorkers<span style=color:#000>(</span>TestRunner.java:1125<span style=color:#000>)</span><span style=color:#c41a16>\n\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\t</span>at org.testng.TestRunner.privateRun<span style=color:#000>(</span>TestRunner.java:749<span style=color:#000>)</span><span style=color:#c41a16>\n\t</span>at org.testng.TestRunner.run<span style=color:#000>(</span>TestRunner.java:600<span style=color:#000>)</span><span style=color:#c41a16>\n\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\t</span>at org.testng.SuiteRunner.runTest<span style=color:#000>(</span>SuiteRunner.java:317<span style=color:#000>)</span><span style=color:#c41a16>\n\t</span>at org.testng.SuiteRunner.runSequentially<span style=color:#000>(</span>SuiteRunner.java:312<span style=color:#000>)</span><span style=color:#c41a16>\n\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\t</span>at org.testng.SuiteRunner.privateRun<span style=color:#000>(</span>SuiteRunner.java:274<span style=color:#000>)</span><span style=color:#c41a16>\n\t</span>at org.testng.SuiteRunner.run<span style=color:#000>(</span>SuiteRunner.java:223<span style=color:#000>)</span><span style=color:#c41a16>\n\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\t</span>at org.testng.SuiteRunnerWorker.runSuite<span style=color:#000>(</span>SuiteRunnerWorker.java:52<span style=color:#000>)</span><span style=color:#c41a16>\n\t</span>at org.testng.SuiteRunnerWorker.run<span style=color:#000>(</span>SuiteRunnerWorker.java:86<span style=color:#000>)</span><span style=color:#c41a16>\n\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\t</span>at org.testng.TestNG.runSuitesSequentially<span style=color:#000>(</span>TestNG.java:995<span style=color:#000>)</span><span style=color:#c41a16>\n\t</span>at org.testng.TestNG.runSuitesLocally<span style=color:#000>(</span>TestNG.java:920<span style=color:#000>)</span><span style=color:#c41a16>\n\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\t</span>at org.testng.TestNG.run<span style=color:#000>(</span>TestNG.java:856<span style=color:#000>)</span><span style=color:#c41a16>\n\t</span>at org.testng.remote.RemoteTestNG.run<span style=color:#000>(</span>RemoteTestNG.java:110<span style=color:#000>)</span><span style=color:#c41a16>\n\
</span><span style=color:#c41a16></span> <span style=color:#c41a16>\t</span>at org.testng.remote.RemoteTestNG.initAndRun<span style=color:#000>(</span>RemoteTestNG.java:205<span style=color:#000>)</span><span style=color:#c41a16>\n\t</span>at org.testng.remote.RemoteTestNG.main<span style=color:#000>(</span>RemoteTestNG.java:174<span style=color:#000>)</span><span style=color:#c41a16>\n</span>&amp;quot;
 ...
</code></pre></div><p>You can use <a title=br.eti.kinoshita.tap4j.ext.testng.TestTAPReporter href=https://github.com/kinow/tap4j/blob/master/src/main/java/org/tap4j/ext/testng/TestTAPReporter.java>br.eti.kinoshita.tap4j.ext.testng.TestTAPReporter</a> or <a title=br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter href=https://github.com/kinow/tap4j/blob/master/src/main/java/org/tap4j/ext/testng/SuiteTAPReporter.java>br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter</a>, as both listeners generate information on skipped tests.</p>
<h2>Dependencies</h2>
<p>At moment tap4j listeners don't give you an idea of how is the dependency among the tests in your project. It is an issue that has to be better detailed to be implemented in a new version of tap4j. I know there are methods in the TestNG API that can tell you on which method/group a test depends upon. However I would need to sit down and think where to put this information in the TAP Stream. I like checking first how is it being done in Perl and then trying to code it in a way that the information generated by Java is more similar to that generated in Perl.</p>
<p>I created the enhancement issue <a title="Add dependency information in TestNG TAP integration" href="https://sourceforge.net/tracker/?func=detail&aid=3228068&group_id=351793&atid=1470124">3228068</a> in tap4j SF.net project to discuss about dependencies in tap4j TestNG integration. I have to work on a few things in <a title=TestLink href=http://www.teamst.org>TestLink</a> and Jenkins prior to start developing this integration, but it is in my list of things to do before Easter (this year's Easter, of course ;-)).</p>
<hr>
<p>That's all folks! I hope this post clarifies a little bit more about TestNG and TAP. Although there is a lot of work to do in this integration, it is already being used by <a title="Jenkins TestLink Plug-in" href=http://wiki.jenkins-ci.org/display/JENKINS/TestLink+Plugin>Jenkins TestLink Plug-in</a> in productive environments as a way to retrieve information about the test results and update TestLink. Just for what it is worth, the plug-in reads the 'extensions' entry, looking for a file entry that represents a test evidence. This way automated tests can have evidences uploaded into TestLink test executions.</p>
<p>Ah, just one last note, in the following days the classes and packages of the tap4j project may be updated. Probably I will release tap4j 2.0 with the base package org.tap4j instead of br.eti.kinoshita.tap4j. I think it makes the project more 'free' and 'community-oriented' rather than using my own domain in it. As the API is very new I believe it is better to take this decision now rather than when it is being used in more projects.</p>
<p>Cheers</p>
<p>
Categories:
<a href=/categories/blog.html>blog</a>
</p>
<p>
Tags:
<a href=/tags/test-anything-protocol.html>test anything protocol</a>,
<a href=/tags/software-quality.html>software quality</a>,
<a href=/tags/java.html>java</a>
</p>
<aside class=links>
<a class=previous href=https://kinoshita.eti.br/2011/03/10/getting-the-maximum-from-testng-with-tap.html>&#171; Previous</a>
<a class=next href=https://kinoshita.eti.br/2011/03/22/testlink-and-hudson-now-jenkins-short-tutorial-in-automated-software-testing-magazine-issue-march-2011.html>Next &#187;</a>
</aside>
</article>
</main>
<footer role=contentinfo>
<ul id=social-media-icons>
<li>
<a href=https://www.instagram.com/brunokinoshita/>
<img src=/assets/icons/instagram.png alt="Instagram link">
</a>
</li>
<li>
<a href=https://twitter.com/kinow/>
<img src=/assets/icons/twitter.png alt="Twitter link">
</a>
</li>
<li>
<a href=https://github.com/kinow/>
<img src=/assets/icons/github.png alt="GitHub link">
</a>
</li>
<li>
<a href=/feed.xml>
<img src=/assets/icons/news.png alt="RSS feed link">
</a>
</li>
</ul>
</footer>
</body>
</html>