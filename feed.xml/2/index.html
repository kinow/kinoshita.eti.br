<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
    xmlns:atom="http://www.w3.org/2005/Atom"
    xmlns:content="http://purl.org/rss/1.0/modules/content/"
    xmlns:dc="http://purl.org/dc/elements/1.1/">
    <channel>
        <title>Bruno P. Kinoshita</title>
        <link>/</link>
        <atom:link href="/feed.xml/2" rel="self" type="application/rss+xml" />
        
        <description>Latest news from Bruno P. Kinoshita</description>
        
        <lastBuildDate>2019-03-15T23:28:37+13:00</lastBuildDate>
        <pubDate>2019-03-15T23:28:37+13:00</pubDate>
        <generator>PieCrust 3.2.1</generator>
        
        
        

        
        
        
        <item>
            <title>Multithreaded code and Pandas</title>
            <link>/2018/07/22/multithreaded-code-and-pandas</link>
            
            <author>kinow</author>
            <dc:creator>kinow</dc:creator>
            
            
            
            <category>python</category>
            
            <category>pandas</category>
            
            <category>opensource</category>
            
            <pubDate>2018-07-22T13:22:14+12:00</pubDate>
            <guid>/2018/07/22/multithreaded-code-and-pandas</guid>
            <description>
            
            &lt;p&gt;&lt;a href=&#34;https://www.deviantart.com/kinow/art/Woman-looking-01-743551195&#34;&gt;&lt;img style=&#34;float: left; height: 300px;&#34; class=&#34;ui image&#34; src=&#34;/2018/07/22/multithreaded-code-and-pandas/woman-looking-01.png&#34; alt=&#34;Woman looking&#34; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Pandas provides high-performance data structures in Python. I think in Java there are
similar data structures in projects like Apache Commons Collections,
Google Guava, and also Trove.&lt;/p&gt;
&lt;p&gt;In the Java libraries thread-safety is always a must-have feature. Probably as it is quite
common for a Java program to have more than one thread, especially if the code runs in some
sort of web container.&lt;/p&gt;
&lt;p&gt;I recently learned that Pandas, on the other hand, does not guarantee any thread-safety.
I found that while reading an
&lt;a href=&#34;https://github.com/pandas-dev/pandas/issues/21150&#34;&gt;issue about race condition in the &lt;code&gt;IndexEngine&lt;/code&gt;&lt;/a&gt;,
and after preparing a pull request for that.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;concurrent.futures&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ThreadPoolExecutor&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;pandas&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;as&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;pd&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pd&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;date_range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2001&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;2020&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ThreadPoolExecutor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;as&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;assert&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;all&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;lambda&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;is_unique&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;When you create an index like that, it will delegate most of the hard work to the &lt;code&gt;IndexEngine&lt;/code&gt;.
Inside the &lt;code&gt;IndexEngine&lt;/code&gt;, the values passed for the index are stored, and then an empty
&lt;code&gt;Hashtable&lt;/code&gt; is created (as well as several flags for the state of the object, such as
&lt;code&gt;unique&lt;/code&gt;, which defines whether the index has unique elements or not).&lt;/p&gt;
&lt;p&gt;Once a user calls a method like &lt;code&gt;is_unique&lt;/code&gt;, then the flags are updated, the &lt;code&gt;Hashtable&lt;/code&gt;
mapping is populated, and while doing so, if not all elements are unique, the flag for
&lt;code&gt;unique&lt;/code&gt; is set to &lt;code&gt;false&lt;/code&gt;, or &lt;code&gt;true&lt;/code&gt; otherwise. But if the user does not need that
operation, we will avoid populating the mapping until we really need it.&lt;/p&gt;
&lt;p&gt;I believe it is done that way for performance. However, at the cost that the state is shared
among calls, which makes it harder to use this API in a multithreaded environment - though
still possible by moving the synchronization to your caller code.&lt;/p&gt;
&lt;p&gt;Some Apache software also do the same, asking users to synchronize, serialize, or handle
certain corner cases on their side. There is a huge cost associated with maintaining an Open
Source project that promises thread-safety.&lt;/p&gt;
&lt;p&gt;But maybe &lt;a href=&#34;http://dask.pydata.org/en/latest/&#34;&gt;Dask&lt;/a&gt; provides an alternative to use Pandas
with multiple threads. But I have not used that yet.&lt;/p&gt;
&lt;p&gt;&amp;hearts; Open Source&lt;/p&gt;
&lt;p&gt;&lt;em&gt;NB: even though Pandas is not thread-safe, it does not mean you should not use it. Just use
with care when using multiple threads&lt;/em&gt;&lt;/p&gt;
            
            </description>
        </item>
        
        
        
        <item>
            <title>Cylc Scheduler Internals - Part 1</title>
            <link>/2018/07/14/cylc-scheduler-internals-part-1</link>
            
            <author>kinow</author>
            <dc:creator>kinow</dc:creator>
            
            
            
            <category>cylc</category>
            
            <category>python</category>
            
            <category>opensource</category>
            
            <pubDate>2018-07-14T22:42:47+12:00</pubDate>
            <guid>/2018/07/14/cylc-scheduler-internals-part-1</guid>
            <description>
            
            &lt;p&gt;This is the first post in a series of three (or maybe four later) based on diagrams
I collected while debugging the Cylc scheduler. The scheduler is called by the &lt;code&gt;cylc start&lt;/code&gt;
utility.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;NB: this is a post to remember things, not really expecting to give someone enough
information to be able to hack the Cylc Scheduler (though you can and would have fun!).&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Instead of going at length on what happens (and there is quite a bit happening when
you run &lt;code&gt;cylc start my.suite&lt;/code&gt;), I will use the following diagram, followed by a few paragraphs
to highlight certain parts. The code used was based on &lt;a href=&#34;https://github.com/cylc/cylc/tree/7.7.1&#34;&gt;Cylc 7.7.1&lt;/a&gt;.&lt;/p&gt;
&lt;p style=&#39;text-align: center;&#39;&gt;
&lt;a href=&#34;/2018/07/14/cylc-scheduler-internals-part-1/cylc-scheduler_cli-workflow.png&#34;&gt;
&lt;img style=&#34;display: inline; width: 100%;&#34; class=&#34;ui image&#34; src=&#34;/2018/07/14/cylc-scheduler-internals-part-1/cylc-scheduler_cli-workflow.png&#34;  /&gt;
&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;When a Cylc command like &lt;code&gt;cylc start&lt;/code&gt; is invoked, it actually gets translated into
&lt;code&gt;bin/cylc-$command_name&lt;/code&gt;. &lt;code&gt;cylc-start&lt;/code&gt; is a Shell file, that will simply call &lt;code&gt;cylc-run&lt;/code&gt;.
&lt;code&gt;cylc-run&lt;/code&gt; then imports &lt;code&gt;scheduler_cli&lt;/code&gt;&amp;#8230; but what you need to know is that in the end
&lt;code&gt;scheduler_cli&lt;/code&gt; will create an instance of &lt;code&gt;Scheduler&lt;/code&gt; with the right constructor
arguments, and call its &lt;code&gt;start&lt;/code&gt; method.&lt;/p&gt;
&lt;p&gt;After that point, you are at the left-most lifeline, on the &lt;code&gt;Scheduler&lt;/code&gt; constructor
(i.e. the &lt;strong&gt;init&lt;/strong&gt; method of the scheduler.py&amp;#8217;s Scheduler class).&lt;/p&gt;
&lt;p&gt;If you follow the method calls - which are hopefully easy to understand and follow -
you will find that the constructor merely creates a few objects, prepares the suite
information, and the suite database.&lt;/p&gt;
&lt;p&gt;Then the &lt;code&gt;start&lt;/code&gt; method kicks things off, interacting with previously created objects,
but also with some singletons for logging and configuration. Oh, that &lt;code&gt;Cylc&lt;/code&gt; banner
is also printed here (in case you would like to customize it as in SpringBoot).&lt;/p&gt;
&lt;p&gt;After that, if you are running the suite as daemon, it will be
&lt;a href=&#34;http://code.activestate.com/recipes/66012-fork-a-daemon-process-on-unix/&#34;&gt;daemonized&lt;/a&gt;,
by forking the current process, but with Python.&lt;/p&gt;
&lt;p&gt;One important step that happens here, is the initialization of the HTTP Server. This server
will be used to communicate with the &lt;strong&gt;Suite Server Program&lt;/strong&gt;. It will be listening to
connections with the right endpoints available only after the &lt;code&gt;configure&lt;/code&gt; method.&lt;/p&gt;
&lt;p&gt;Lastly, we have &lt;code&gt;configure&lt;/code&gt; and &lt;code&gt;run&lt;/code&gt; methods, which are two very important methods to be discussed
in the next part of this series, as they are quite extensive, and deserve their own diagrams.&lt;/p&gt;
&lt;p&gt;You can download the &lt;a href=&#34;/2018/07/14/cylc-scheduler-internals-part-1/cylc-scheduler_cli-workflow-src.xml&#34;&gt;source file&lt;/a&gt; for the diagram used in this post, and edit it
with &lt;a href=&#34;https://draw.io&#34;&gt;draw.io&lt;/a&gt;.&lt;/p&gt;
            
            </description>
        </item>
        
        
        
        <item>
            <title>ImportError when debugging cylc in Eclipse</title>
            <link>/2018/07/10/import-error-when-debugging-cylc-in-eclipse</link>
            
            <author>kinow</author>
            <dc:creator>kinow</dc:creator>
            
            
            
            <category>cylc</category>
            
            <category>python</category>
            
            <category>opensource</category>
            
            <pubDate>2018-07-10T00:47:13+12:00</pubDate>
            <guid>/2018/07/10/import-error-when-debugging-cylc-in-eclipse</guid>
            <description>
            
            &lt;p&gt;Since I started reading cylc&amp;#8217;s source code in Eclipse to create some
sequence diagrams, I have not been able to debug it properly without
hitting errors in some part of the program execution.&lt;/p&gt;
&lt;p&gt;The error message was &lt;strong&gt;&lt;em&gt;&amp;ldquo;ImportError: cannot import name _remove_dead_weakref&amp;rdquo;&lt;/em&gt;&lt;/strong&gt;,
which was a bit enigmatic as I never heard about that function, but it seemed to be
something internal, or at least not from the project code base. And searching the Internet
did not help much.&lt;/p&gt;
&lt;p&gt;Here is the complete console output in Eclipse.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pydev debugger: starting &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;pid: &lt;span class=&#34;m&#34;&gt;15124&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
timeout &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt; ps -opid,args &lt;span class=&#34;m&#34;&gt;13640&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;# return 1&lt;/span&gt;

            ._.                                                       
            &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;            The Cylc Suite Engine &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;7&lt;/span&gt;.7.1-37-g09c8a&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;    
._____._. ._&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;_____.           Copyright &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;C&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;2008&lt;/span&gt;-2018 NIWA          
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; .___&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; .___&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;  _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; !___&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; !_! &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; !___.  This program comes with ABSOLUTELY NO WARRANTY&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
!_____!___. &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;_!_____!  see &lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;cylc warranty&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;.  It is free software, you 
      .___! &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;           are welcome to redistribute it under certain  
      !_____!                conditions&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; see &lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;cylc conditions&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;.       
&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-07-10T01:00:47+12 INFO - Suite starting: &lt;span class=&#34;nv&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;localhost:44444 &lt;span class=&#34;nv&#34;&gt;pid&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;15124&lt;/span&gt;
&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-07-10T01:00:47+12 INFO - Cylc version: &lt;span class=&#34;m&#34;&gt;7&lt;/span&gt;.7.1-37-g09c8a
&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-07-10T01:00:47+12 INFO - Run mode: live
&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-07-10T01:00:47+12 INFO - Initial point: &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-07-10T01:00:47+12 INFO - Final point: None
&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-07-10T01:00:47+12 INFO - Cold Start &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-07-10T01:00:47+12 DEBUG - &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;hello.1&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; -released to the task pool
&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-07-10T01:00:47+12 DEBUG - BEGIN TASK PROCESSING
&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-07-10T01:00:47+12 DEBUG - &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;hello.1&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; -waiting &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; queued
&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-07-10T01:00:47+12 DEBUG - &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; task&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;s&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; de-queued
&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-07-10T01:00:47+12 INFO - &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;hello.1&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; -submit-num&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;, owner@host&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;localhost
&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-07-10T01:00:47+12 DEBUG - &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;hello.1&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; -queued &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; ready
&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-07-10T01:00:47+12 DEBUG - END TASK PROCESSING &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;took &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.023609161377 seconds&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-07-10T01:00:48+12 DEBUG - &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;cylc&amp;#39;&lt;/span&gt;, &lt;span class=&#34;s1&#34;&gt;&amp;#39;jobs-submit&amp;#39;&lt;/span&gt;, &lt;span class=&#34;s1&#34;&gt;&amp;#39;--debug&amp;#39;&lt;/span&gt;, &lt;span class=&#34;s1&#34;&gt;&amp;#39;--&amp;#39;&lt;/span&gt;, &lt;span class=&#34;s1&#34;&gt;&amp;#39;/home/kinow/Development/python/workspace/example-suite/log/job&amp;#39;&lt;/span&gt;, &lt;span class=&#34;s1&#34;&gt;&amp;#39;1/hello/01&amp;#39;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-07-10T01:00:48+12 ERROR - &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;jobs-submit cmd&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; cylc jobs-submit --debug -- /home/kinow/Development/python/workspace/example-suite/log/job &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;/hello/01
    &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;jobs-submit ret_code&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;jobs-submit err&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
    Traceback &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;most recent call last&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;:
      File &lt;span class=&#34;s2&#34;&gt;&amp;quot;/home/kinow/Development/python/workspace/cylc/bin/cylc-jobs-submit&amp;quot;&lt;/span&gt;, line &lt;span class=&#34;m&#34;&gt;52&lt;/span&gt;, in &amp;lt;module&amp;gt;
        from cylc.batch_sys_manager import BatchSysManager
      File &lt;span class=&#34;s2&#34;&gt;&amp;quot;/home/kinow/Development/python/workspace/cylc/lib/cylc/batch_sys_manager.py&amp;quot;&lt;/span&gt;, line &lt;span class=&#34;m&#34;&gt;114&lt;/span&gt;, in &amp;lt;module&amp;gt;
        from cylc.task_message import &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;
      File &lt;span class=&#34;s2&#34;&gt;&amp;quot;/home/kinow/Development/python/workspace/cylc/lib/cylc/task_message.py&amp;quot;&lt;/span&gt;, line &lt;span class=&#34;m&#34;&gt;26&lt;/span&gt;, in &amp;lt;module&amp;gt;
        from logging import getLevelName, WARNING, ERROR, CRITICAL
      File &lt;span class=&#34;s2&#34;&gt;&amp;quot;/home/kinow/Development/python/anaconda2/lib/python2.7/logging/__init__.py&amp;quot;&lt;/span&gt;, line &lt;span class=&#34;m&#34;&gt;26&lt;/span&gt;, in &amp;lt;module&amp;gt;
        import sys, os, time, cStringIO, traceback, warnings, weakref, collections
      File &lt;span class=&#34;s2&#34;&gt;&amp;quot;/home/kinow/Development/python/anaconda2/lib/python2.7/weakref.py&amp;quot;&lt;/span&gt;, line &lt;span class=&#34;m&#34;&gt;14&lt;/span&gt;, in &amp;lt;module&amp;gt;
        from _weakref import &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;
    ImportError: cannot import name _remove_dead_weakref
&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-07-10T01:00:48+12 ERROR - &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;jobs-submit cmd&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; cylc jobs-submit --debug -- /home/kinow/Development/python/workspace/example-suite/log/job &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;/hello/01
    &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;jobs-submit ret_code&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;jobs-submit out&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-07-10T01:00:48+12&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;/hello/01&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-07-10T01:00:48+12 INFO - &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;hello.1&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; -&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;current:ready&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; submission failed at &lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-07-10T01:00:48+12
&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-07-10T01:00:48+12 ERROR - &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;hello.1&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; -submission failed
&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-07-10T01:00:48+12 DEBUG - &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;hello.1&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; -ready &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; submit-failed
&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-07-10T01:00:48+12 DEBUG - BEGIN TASK PROCESSING
&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-07-10T01:00:48+12 DEBUG - &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; task&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;s&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; de-queued
&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-07-10T01:00:48+12 DEBUG - END TASK PROCESSING &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;took &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.00175499916077 seconds&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-07-10T01:00:49+12 WARNING - suite stalled
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;As the current diagram I am working on has quite a few &lt;code&gt;if&lt;/code&gt;&amp;#8216;s and &lt;code&gt;else&lt;/code&gt;&amp;#8216;s, I decided
to investigate why this error was occurring. Then, after some elimination I found that
it was due to the missing Anaconda 2 entry in my &lt;code&gt;$PATH&lt;/code&gt; environment variable.&lt;/p&gt;
&lt;p&gt;I had this variable configured in a custom script I load whenever I decide to use
Anaconda 2. And reproducing the same behaviour in Eclipse was easy.&lt;/p&gt;
&lt;p style=&#39;text-align: center;&#39;&gt;
&lt;img style=&#34;display: inline&#34; class=&#34;ui image&#34; src=&#34;/2018/07/10/import-error-when-debugging-cylc-in-eclipse/screenshot1.png&#34; alt=&#34;A screen shot of Eclipse with source code&#34; title=&#34;Locating the bug&#34; /&gt;
&lt;br/&gt;
&lt;small&gt;Locating the bug&lt;/small&gt;
&lt;/p&gt;

&lt;p&gt;Et voil&amp;agrave;! Eclipse was happily debugging again!&lt;/p&gt;
&lt;p style=&#39;text-align: center;&#39;&gt;
&lt;img style=&#34;display: inline&#34; class=&#34;ui image&#34; src=&#34;/2018/07/10/import-error-when-debugging-cylc-in-eclipse/screenshot2.png&#34; alt=&#34;A screen shot of Eclipse with source code&#34; title=&#34;Locating the bug&#34; /&gt;
&lt;br/&gt;
&lt;small&gt;Locating the bug&lt;/small&gt;
&lt;/p&gt;

&lt;p&gt;So if you have a similar problem, try comparing your environment variables and check if you
have some entries missing, and try adding them in Eclipse Debug configuration.&lt;/p&gt;
&lt;p&gt;Happy cycling!&lt;/p&gt;
            
            </description>
        </item>
        
        
        
        <item>
            <title>A simple cylc suite</title>
            <link>/2018/07/08/a-simple-cylc-suite</link>
            
            <author>kinow</author>
            <dc:creator>kinow</dc:creator>
            
            
            
            <category>cylc</category>
            
            <category>python</category>
            
            <category>opensource</category>
            
            <pubDate>2018-07-08T18:59:13+12:00</pubDate>
            <guid>/2018/07/08/a-simple-cylc-suite</guid>
            <description>
            
            &lt;p&gt;I have been writing more suites for &lt;a href=&#34;https://cylc.github.io/cylc/&#34;&gt;cylc&lt;/a&gt; lately, and found
an example that has proved to be useful for debugging certain parts of the code.&lt;/p&gt;
&lt;p&gt;It is an extremely simple suite, similar to what is in cylc&amp;#8217;s documentation. It
sleeps for N seconds, and prints a message.&lt;/p&gt;
&lt;p&gt;What makes it extra simpler, is that it cycles through integers, and has
a limit of 1 maximum active points.&lt;/p&gt;
&lt;p&gt;It is essentially the same as running the command in your shell session. With
the difference that it will run through all cylc&amp;#8217;s internal, only once, and
allow you to debug and diagnostic parts nor related to cycling and graphs
(as for these parts you would probably need a more elaborate example).&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;scheduling&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;cycling&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;integer&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;initial&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cycle&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;point&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;max&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;active&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cycle&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;points&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;[[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dependencies&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]]&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;[[[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;P1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]]]&lt;/span&gt;
            &lt;span class=&#34;n&#34;&gt;graph&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;quot;hello&amp;quot;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;[[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hello&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]]&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;quot;sleep 10; echo PING&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;I also combine this suite with the following &lt;code&gt;global.rc&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;editors&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; 
    &lt;span class=&#34;n&#34;&gt;terminal&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;vim&lt;/span&gt; 
    &lt;span class=&#34;n&#34;&gt;gui&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;gvim&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;

&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;communication&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;base&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;port&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;44444&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;method&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;maximum&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;number&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;of&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ports&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;With &amp;#8220;base port&amp;#8221; set to 44444, and the maximum number of ports to 1, I will
be able to run only one task. But that way I can configure Wireshark and other
tools to default to 44444/HTTP, for ease of debugging.&lt;/p&gt;
&lt;p&gt;Then initialize the suite with something like: &lt;code&gt;cylc start --non-daemon --debug /home/kinow/Development/python/workspace/example-suite/&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Happy cycling!&lt;/p&gt;
            
            </description>
        </item>
        
        
        
        <item>
            <title>What happens when you create a new dataset in Apache Jena Fuseki</title>
            <link>/2018/05/29/what-happens-when-you-create-a-new-dataset-in-apache-jena-fuseki</link>
            
            <author>kinow</author>
            <dc:creator>kinow</dc:creator>
            
            
            
            <category>jena</category>
            
            <category>apache software foundation</category>
            
            <category>java</category>
            
            <category>sparql</category>
            
            <category>opensource</category>
            
            <pubDate>2018-05-29T18:59:04+12:00</pubDate>
            <guid>/2018/05/29/what-happens-when-you-create-a-new-dataset-in-apache-jena-fuseki</guid>
            <description>
            
            &lt;p&gt;&lt;a href=&#34;/2018/05/27/what-happens-when-you-upload-a-turtle-file-in-apache-jena-fuseki&#34;&gt;Last post&lt;/a&gt;
was about what happens when you upload a Turtle file to Apache Jena Fuseki. And now today&amp;#8217;s post will be about
what happens when you create a new dataset in Apache Jena Fuseki.&lt;/p&gt;
&lt;p&gt;In theory, that happens before you upload a Turtle file, but this post series won&amp;#8217;t follow a logical order.
It will be more based on what I find interesting.&lt;/p&gt;
&lt;p&gt;Oh, the dataset created is &lt;strong&gt;an in-memory dataset&lt;/strong&gt;. Here&amp;#8217;s a simplified sequence diagram. Again,
these articles are more brain-dumps, used by myself for later reference.&lt;/p&gt;
&lt;p style=&#39;text-align: center;&#39;&gt;
&lt;img style=&#34;display: inline; width: 100%;&#34; class=&#34;ui image&#34; src=&#34;/2018/05/29/what-happens-when-you-create-a-new-dataset-in-apache-jena-fuseki/sequence-diagram.png&#34;  /&gt;
&lt;/p&gt;

&lt;h3&gt;ActionDatasets#execPostContainer() (Fuseki Core)&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;ActionDatasets&lt;/code&gt;, as per the name, handles HTTP requests related to datasets. Such as when you
create a new dataset. It is also an HTTP action. The concept in Jena, as far as I could tell,
is similar to Jenkins&amp;#8217; actions, but simpler, without the UI/Jelly/Groovy part.&lt;/p&gt;
&lt;p&gt;This class also has a few static fields, which hold system information. One variable is actually
called &lt;code&gt;system&lt;/code&gt;. (wonder how well it works if you try to deploy Jena Fuseki with multiple JVM&amp;#8217;s
&lt;a href=&#34;https://markmail.org/message/xpfcgccuwgycdopw&#34;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt; &lt;a href=&#34;https://afs.github.io/rdf-delta/ha-fuseki.html&#34;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;Its first task is to create an &lt;em&gt;UUID&lt;/em&gt;, using &lt;code&gt;JenaUUID&lt;/code&gt; (from Jena Core). This class looks
very interesting, &lt;a href=&#34;/2018/08/11/uuids-in-apache-jena&#34;&gt;wonder how it works&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Then it creates a &lt;code&gt;DatasetDescriptionRegistry&lt;/code&gt;, which is a registry to keep track
of the datasets created. There is also some validation of parameters and state check, and then
the transaction is started (&lt;code&gt;system.begin()&lt;/code&gt;).&lt;/p&gt;
&lt;h3&gt;Model / (Core)&lt;/h3&gt;
&lt;p&gt;I used &lt;code&gt;Model&lt;/code&gt; and &lt;code&gt;ModelFactory&lt;/code&gt; before when working with ontologies and Prot&amp;eacute;g&amp;eacute;.
&lt;code&gt;ActionDatasets&lt;/code&gt; will create a &lt;code&gt;Model&lt;/code&gt;.&lt;/p&gt;
&lt;blockquote&gt;    An RDF Model.

    An RDF model is a set of Statements.  Methods are provided for creating
    resources, properties and literals and the Statements which link them,
    for adding statements to and removing them from a model, for
    querying a model and set operations for combining models.
&lt;/blockquote&gt;

&lt;p&gt;It also gets a &lt;code&gt;StreamRDF&lt;/code&gt; from the model (i.e. &lt;code&gt;model.getGraph()&lt;/code&gt;), which will be used
later by the &lt;code&gt;RDFParser&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;ActionDatasets#assemblerFromForm() (Fuseki)&lt;/h3&gt;
&lt;p&gt;In &lt;code&gt;#assemblerFromForm()&lt;/code&gt;, it will create a template, and then use
&lt;code&gt;RDFParser&lt;/code&gt; to parse the template and load into &lt;code&gt;SteamRFF&lt;/code&gt;. The template looks like this:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# Licensed under the terms of http://www.apache.org/licenses/LICENSE-2.0&lt;/span&gt;

&lt;span class=&#34;err&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;prefix&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;        &lt;span class=&#34;nl&#34;&gt;&amp;lt;#&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;prefix&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;fuseki&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;  &lt;span class=&#34;nl&#34;&gt;&amp;lt;http://jena.apache.org/fuseki#&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;prefix&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;rdf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;     &lt;span class=&#34;nl&#34;&gt;&amp;lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;

&lt;span class=&#34;err&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;prefix&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;rdfs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;nl&#34;&gt;&amp;lt;http://www.w3.org/2000/01/rdf-schema#&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;prefix&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;tdb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;     &lt;span class=&#34;nl&#34;&gt;&amp;lt;http://jena.hpl.hp.com/2008/tdb#&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;prefix&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;ja&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;nl&#34;&gt;&amp;lt;http://jena.hpl.hp.com/2005/11/Assembler#&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;

&lt;span class=&#34;c&#34;&gt;## ---------------------------------------------------------------&lt;/span&gt;
&lt;span class=&#34;c&#34;&gt;## Updatable in-memory dataset.&lt;/span&gt;

&lt;span class=&#34;nl&#34;&gt;&amp;lt;#service1&amp;gt;&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;rdf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;fuseki&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;Service&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;c&#34;&gt;# URI of the dataset -- http://host:port/aaa&lt;/span&gt;
    &lt;span class=&#34;nn&#34;&gt;fuseki&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;                        &lt;span class=&#34;s&#34;&gt;&amp;quot;aaa&amp;quot;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;nn&#34;&gt;fuseki&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceQuery&lt;/span&gt;                &lt;span class=&#34;s&#34;&gt;&amp;quot;sparql&amp;quot;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;nn&#34;&gt;fuseki&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceQuery&lt;/span&gt;                &lt;span class=&#34;s&#34;&gt;&amp;quot;query&amp;quot;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;nn&#34;&gt;fuseki&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceUpdate&lt;/span&gt;               &lt;span class=&#34;s&#34;&gt;&amp;quot;update&amp;quot;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;nn&#34;&gt;fuseki&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceUpload&lt;/span&gt;               &lt;span class=&#34;s&#34;&gt;&amp;quot;upload&amp;quot;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;nn&#34;&gt;fuseki&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceReadWriteGraphStore&lt;/span&gt;  &lt;span class=&#34;s&#34;&gt;&amp;quot;data&amp;quot;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;     
    &lt;span class=&#34;nn&#34;&gt;fuseki&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceReadGraphStore&lt;/span&gt;       &lt;span class=&#34;s&#34;&gt;&amp;quot;get&amp;quot;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;nn&#34;&gt;fuseki&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;dataset&lt;/span&gt;                     &lt;span class=&#34;nl&#34;&gt;&amp;lt;#dataset&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;

&lt;span class=&#34;c&#34;&gt;# Transactional, in-memory dataset. Initially empty.&lt;/span&gt;
&lt;span class=&#34;nl&#34;&gt;&amp;lt;#dataset&amp;gt;&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;rdf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;ja&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;DatasetTxnMem&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;Persisting the dataset&lt;/h3&gt;
&lt;p&gt;Jena Fuseki will create a local copy of the template, using RIOT&amp;#8217;s &lt;code&gt;RDFDataMgr&lt;/code&gt;. For my environment, running from
Eclipse, the file location was &lt;em&gt;/home/kinow/Development/java/jena/jena/jena-fuseki2/jena-fuseki-core/run/system_files/902154aa-2bb6-11b2-8053-024232e7b374&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Fuseki now will look for exactly one Service Name statement (http://jena.apache.org/fuseki#name). The
name will be validated for things like blank space, empty, &amp;#8216;/&amp;#8217;, etc.&lt;/p&gt;
&lt;p&gt;Once the validation passes, then it will persist the file in somewhere like
/home/kinow/Development/java/jena/jena/jena-fuseki2/jena-fuseki-core/run/configuration/aaa.ttl. But
not without checking first it the file existed.&lt;/p&gt;
&lt;p&gt;As this is a brand new file, the &lt;code&gt;Model&lt;/code&gt; instance will be written on the file now.&lt;/p&gt;
&lt;h3&gt;DatasetAccessPoint (ARQ)&lt;/h3&gt;
&lt;p&gt;Funny, when I wrote it I immediately put this class under Fuseki Core, but it is actually
in ARQ. &lt;strong&gt;Why not in Fuseki?&lt;/strong&gt;. Looks like ARQ has a Web layer too.&lt;/p&gt;
&lt;p&gt;Fuseki&amp;#8217;s &lt;code&gt;FusekiBuilder#buildDataAccessPoint()&lt;/code&gt; creates the &lt;code&gt;DataAccessPoint&lt;/code&gt;. The &lt;code&gt;DataAccessPoint&lt;/code&gt;&amp;#8216;s
Javadocs say: &amp;ldquo;A name in the URL space of the server&amp;rdquo;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;DataService&lt;/code&gt; contains operations, and endpoints&lt;/li&gt;
&lt;li&gt;Services are added to endpoints, such as an endpoint for the &lt;code&gt;Quads_RW&lt;/code&gt;, the &lt;code&gt;REST_Quads_RW&lt;/code&gt; from previous post&lt;/li&gt;
&lt;li&gt;The name and the data service are used to create the &lt;code&gt;DataAccessPoint&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The current &lt;code&gt;HttpAction&lt;/code&gt; in the request contains a reference to Fuseki&amp;#8217;s
&lt;code&gt;DataAccessPointRegistry&lt;/code&gt;. Fuseki&amp;#8217;s &lt;code&gt;DataAccessPointRegistry&lt;/code&gt; extends Atlas&amp;#8217;
&lt;code&gt;Registry&lt;/code&gt;, which uses a &lt;code&gt;ConcurrentHashMap&lt;/code&gt; (again, how does it work with multiple JVM&amp;#8217;s?).&lt;/p&gt;
&lt;p&gt;The new &lt;code&gt;DataAccessPoint&lt;/code&gt; is registered with Fuseki&amp;#8217;s registry (not the other registry).&lt;/p&gt;
&lt;p&gt;And then, finally, the transaction is committed, the response is prepared (a 200 OK in &lt;code&gt;text/plain&lt;/code&gt;).
And a &lt;code&gt;null&lt;/code&gt; is returned, which means empty response.&lt;/p&gt;
&lt;p&gt;And here&amp;#8217;s some of the logs produced during this experiment.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-05-28 &lt;span class=&#34;m&#34;&gt;21&lt;/span&gt;:11:43&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Config     INFO  Load configuration: file:///home/kinow/Development/java/jena/jena/jena-fuseki2/jena-fuseki-core/run/configuration/ds2.ttl
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-05-28 &lt;span class=&#34;m&#34;&gt;21&lt;/span&gt;:11:43&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Config     INFO  Load configuration: file:///home/kinow/Development/java/jena/jena/jena-fuseki2/jena-fuseki-core/run/configuration/p1.ttl
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-05-28 &lt;span class=&#34;m&#34;&gt;21&lt;/span&gt;:11:43&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Config     INFO  Register: /ds2
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-05-28 &lt;span class=&#34;m&#34;&gt;21&lt;/span&gt;:11:43&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Config     INFO  Register: /p1
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-05-28 &lt;span class=&#34;m&#34;&gt;21&lt;/span&gt;:11:43&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Server     INFO  Started &lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;/05/28 &lt;span class=&#34;m&#34;&gt;21&lt;/span&gt;:11:43 NZST on port &lt;span class=&#34;m&#34;&gt;3030&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-05-28 &lt;span class=&#34;m&#34;&gt;21&lt;/span&gt;:11:52&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Admin      INFO  &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; GET http://localhost:3030/$/server
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-05-28 &lt;span class=&#34;m&#34;&gt;21&lt;/span&gt;:11:52&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Admin      INFO  &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;11&lt;/span&gt; ms&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-05-28 &lt;span class=&#34;m&#34;&gt;21&lt;/span&gt;:12:41&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Admin      INFO  &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; GET http://localhost:3030/$/server
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-05-28 &lt;span class=&#34;m&#34;&gt;21&lt;/span&gt;:12:41&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Admin      INFO  &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; ms&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-05-28 &lt;span class=&#34;m&#34;&gt;21&lt;/span&gt;:22:33&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Admin      INFO  &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; POST http://localhost:3030/$/datasets
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-05-28 &lt;span class=&#34;m&#34;&gt;21&lt;/span&gt;:46:25&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Admin      INFO  &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Create database : &lt;span class=&#34;nv&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; /aaa
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-05-28 &lt;span class=&#34;m&#34;&gt;22&lt;/span&gt;:16:17&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Admin      INFO  &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;,224.390 s&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-05-28 &lt;span class=&#34;m&#34;&gt;22&lt;/span&gt;:16:18&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Admin      INFO  &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; GET http://localhost:3030/$/server
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt;-05-28 &lt;span class=&#34;m&#34;&gt;22&lt;/span&gt;:16:18&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Admin      INFO  &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8&lt;/span&gt; ms&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;So that&amp;#8217;s that.&lt;/p&gt;
&lt;p&gt;Happy hacking !&lt;/p&gt;
            
            </description>
        </item>
        
        
        
        <item>
            <title>What happens when you upload a Turtle file in Apache Jena Fuseki</title>
            <link>/2018/05/27/what-happens-when-you-upload-a-turtle-file-in-apache-jena-fuseki</link>
            
            <author>kinow</author>
            <dc:creator>kinow</dc:creator>
            
            
            
            <category>apache software foundation</category>
            
            <category>jena</category>
            
            <category>opensource</category>
            
            <category>programming</category>
            
            <pubDate>2018-05-27T22:42:55+12:00</pubDate>
            <guid>/2018/05/27/what-happens-when-you-upload-a-turtle-file-in-apache-jena-fuseki</guid>
            <description>
            
            &lt;p&gt;I am working on &lt;a href=&#34;https://github.com/NatLibFi/Skosmos/issues/738&#34;&gt;an issue for Skosmos&lt;/a&gt;
that involves preparing some &lt;a href=&#34;https://www.w3.org/TR/turtle/&#34;&gt;Turtle&lt;/a&gt; files and uploading
them using Apache Jena Fuseki&amp;#8217;s web interface.&lt;/p&gt;
&lt;p&gt;The issue is now pending feedback, which gives me a moment to have fun with
something else. So I decided to dig down the rabbit hole and start learning more
about certain parts of the Apache Jena code base.&lt;/p&gt;
&lt;p style=&#39;text-align: center;&#39;&gt;
&lt;img style=&#34;display: inline; width: 600px;&#34; class=&#34;ui image&#34; src=&#34;/2018/05/27/what-happens-when-you-upload-a-turtle-file-in-apache-jena-fuseki/browser.png&#34;  /&gt;
&lt;/p&gt;

&lt;p&gt;This post will be useful to myself in the future, as a note-taking in a series, so that I
remember how things work - you never know right? But hopefully this will be useful
to other wanting to understand more about the code of Apache Jena. &lt;/p&gt;
&lt;h3&gt;Where upload happens - SPARQL_Upload and Upload (Fuseki Core)&lt;/h3&gt;
&lt;p&gt;Knowing a bit of the code base, I went straight to the &lt;code&gt;SPARQL_Upload&lt;/code&gt; class,
from the Fuseki Core module. Set up a couple of breakpoints, uploaded my file,
but nothing. Then tried on its package-neighbour class, &lt;code&gt;Upload&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Actually, it is easier to understand seeing the class hierarchy, and knowing
that when I run the application in Eclipse, it is running with Jetty, serving
servlets (there is no framework like Wicket, Struts, etc, involved).&lt;/p&gt;
&lt;p style=&#39;text-align: center;&#39;&gt;
&lt;img style=&#34;display: inline; width: 600px;&#34; class=&#34;ui image&#34; src=&#34;/2018/05/27/what-happens-when-you-upload-a-turtle-file-in-apache-jena-fuseki/class-hierarchy.png&#34;  /&gt;
&lt;/p&gt;

&lt;p&gt;Several filters are applied to the HTTP request too, like Cross Origin, Shiro, and
the &lt;code&gt;FusekiFilter&lt;/code&gt;. The latter looks at the requests to see if it includes a dataset.
If a dataset is found - it is in our case - then it hands the request over to
the right class to handle it.&lt;/p&gt;
&lt;p&gt;REST_Quads_RW will take care of the upload action, using the &lt;code&gt;Upload&lt;/code&gt; class where my
breakpoint stopped.&lt;/p&gt;
&lt;h3&gt;Upload#incomingData() (Fuseki Core)&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;Upload#incomingData()&lt;/code&gt; starts by checking the Content Type from the request. In my case
it is a &lt;code&gt;multipart/form-data&lt;/code&gt;. Then it calls its other method &lt;code&gt;#fileUploadWorker()&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;#fileUploadWorker()&lt;/code&gt; creates a &lt;code&gt;ServletFilterUpload&lt;/code&gt;, from Apache Commons FileUpload.
With that, it opens a stream for the file, retrieves its name and other information,
such as the content type.&lt;/p&gt;
&lt;p&gt;Ah, the content type is interesting too. It defaults to &lt;code&gt;RDFXML&lt;/code&gt;, but what&amp;#8217;s interesting
is the comment.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lang&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// Desperate.&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;lang&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RDFLanguages&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;RDFXML&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Well, in this case we are getting a &lt;code&gt;Lang:Turtle&lt;/code&gt;. So it now knows that it has a Turtle
file, but it still needs to parse it.&lt;/p&gt;
&lt;h3&gt;ActionLib#parse() (Fuseki Core)&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;Upload&lt;/code&gt; calls &lt;code&gt;ActionLib#parse()&lt;/code&gt;, which uses &lt;code&gt;RDFParserBuilder&lt;/code&gt; to build a parser.
It applies a nice fluent API design when doing that.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RDFParser&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;create&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;errorHandler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;errorHandler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;lang&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lang&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;base&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;base&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;parse&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dest&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;blockquote&gt;Side note to self: the `RDFParser` has a `canUse` flag. It seems to indicate
the parser can be used just once. Though it looks actually it works until the stream
is closed&amp;#8230;&lt;/blockquote&gt;

&lt;p&gt;So &lt;code&gt;RDFParserBuilder&lt;/code&gt; will call &lt;code&gt;RDFParser&lt;/code&gt;, which in turn will use the
classes &lt;code&gt;LangTurtle&lt;/code&gt; and &lt;code&gt;LangTurtleBase&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;LangTurtle (ARQ)&lt;/h3&gt;
&lt;p&gt;ARQ is a low level module in Jena, responsible for parsing queries, and also
some of the interaction with graphs and datasets.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;LangTurtle&lt;/code&gt; extends &lt;code&gt;LangTurtleBase&lt;/code&gt;. Their task starts by populating
the &lt;code&gt;prefixMap&lt;/code&gt;, which contains all those prefixes used in queries like
&lt;code&gt;rdfs&lt;/code&gt;, &lt;code&gt;void&lt;/code&gt;, &lt;code&gt;skos&lt;/code&gt;, &lt;code&gt;etc&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Then it will keep parsing &lt;strong&gt;triples&lt;/strong&gt; until it finds an &lt;code&gt;EOF&lt;/code&gt;. For every
triple, after the &lt;em&gt;Predicate-Object-List&lt;/em&gt; is found, it calls
&lt;code&gt;LangTurtle#emit()&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;#emit()&lt;/code&gt;method creates a &lt;code&gt;Triple&lt;/code&gt; object (Jena Core, graph package).
And also a &lt;code&gt;StreamRDFCountingBase&lt;/code&gt; to keep track of statistics to display
back to the user.&lt;/p&gt;
&lt;p style=&#39;text-align: center;&#39;&gt;
&lt;img style=&#34;display: inline; width: 600px;&#34; class=&#34;ui image&#34; src=&#34;/2018/05/27/what-happens-when-you-upload-a-turtle-file-in-apache-jena-fuseki/eclipse.png&#34;  /&gt;
&lt;/p&gt;

&lt;p&gt;&lt;code&gt;StreamRDFCountingBase&lt;/code&gt; extends &lt;code&gt;StreamRDFWrapper&lt;/code&gt;, and wraps - as per name -
other &lt;code&gt;StreamRDF&lt;/code&gt;&amp;#8216;s, such as &lt;code&gt;ParserOutputDataset&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ParserOutputDataset&lt;/code&gt; holds a reference to the &lt;code&gt;DatasetGraph&lt;/code&gt; and also to the
&lt;code&gt;prefixMap&lt;/code&gt; populated earlier in &lt;code&gt;LangTurtle&lt;/code&gt;. For each &lt;code&gt;Triple&lt;/code&gt; that we have
it will call the &lt;code&gt;DatasetGraph#add&lt;/code&gt; method, creating a new &lt;em&gt;Quad&lt;/em&gt; with the
default graph name.&lt;/p&gt;
&lt;h3&gt;Conclusion&lt;/h3&gt;
&lt;p&gt;Finally, readers and streams are closed. An &lt;code&gt;UploadDetails&lt;/code&gt; object is created
holding stats ollected in &lt;code&gt;StreamRDFCountingBase&lt;/code&gt;, which are also used for
logging.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Upload#incomingPath()&lt;/code&gt; will return the &lt;code&gt;UploadDetails&lt;/code&gt;. If there are no errors
then the transaction will be commited. It involves again classes from ARQ and
TDB (for journaling), but that will be for another post.&lt;/p&gt;
&lt;p&gt;The final method called in the &lt;code&gt;Upload&lt;/code&gt; class will be &lt;code&gt;detailsJson()&lt;/code&gt;, which
returns the object as JSON. This JSON string is then finally returned to the
user.&lt;/p&gt;
&lt;p&gt;So that&amp;#8217;s it. Probably the next step will be to learn how &lt;code&gt;DatasetGraph&lt;/code&gt; works,
or maybe more about transactions in Jena.&lt;/p&gt;
&lt;p&gt;Happy hacking !&lt;/p&gt;
            
            </description>
        </item>
        
        
        
        <item>
            <title>Drawing Santos Dumont's "Encantada" in Krita</title>
            <link>/2018/05/13/drawing-santos-dumonts-encantada-in-krita</link>
            
            <author>kinow</author>
            <dc:creator>kinow</dc:creator>
            
            
            
            <category>opensource</category>
            
            <category>illustrations</category>
            
            <category>krita</category>
            
            <pubDate>2018-05-13T02:38:12+12:00</pubDate>
            <guid>/2018/05/13/drawing-santos-dumonts-encantada-in-krita</guid>
            <description>
            
            &lt;div class=&#39;row&#39;&gt;
&lt;div class=&#34;ui fluid container&#34;&gt;
&lt;figure&gt;
&lt;a  href=&#34;/2018/05/13/drawing-santos-dumonts-encantada-in-krita/encantada.png&#34; rel=&#34;prettyPhoto&#34; class=&#34;thumbnail&#34; title=&#34;A Encantada&#34;&gt;
&lt;img style=&#34;height: 400px;&#34; class=&#34;ui image&#34; src=&#34;/2018/05/13/drawing-santos-dumonts-encantada-in-krita/encantada.png&#34; alt=&#34;A Encantada&#34; /&gt;
&lt;/a&gt;
&lt;figcaption&gt;A Encantada&lt;/i&gt;&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;With Krita 4.x released, and the &lt;a href=&#34;https://forum.kde.org/viewtopic.php?f=277&amp;amp;t=152338&amp;amp;p=398403#p398403&#34;&gt;Krita monthly challange&lt;/a&gt;
of May still open for submission, I decided to give it a go and try this new version to create
an artwork to for the challenge. The topic of this month&amp;#8217;s challenge is &lt;strong&gt;Home&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;My submission was &lt;a href=&#34;https://www.google.co.nz/maps/place/Casa+de+Santos+Dumont/@-22.5103512,-43.1864205,17z/data=!3m1!4b1!4m5!3m4!1s0x70145eaee05ea9b:0x33f52a8860f58db9!8m2!3d-22.5103562!4d-43.1842318&#34;&gt;Santos Dumont&amp;#8217;s house in Petropolis, Rio de Janeiro&lt;/a&gt;, called
&lt;a href=&#34;(https://en.wikipedia.org/wiki/Alberto_Santos-Dumont#A_Encantada)&#34;&gt;&lt;em&gt;Encantada&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;And I am happy to report that &lt;strong&gt;Krita 4.x looks much faster&lt;/strong&gt;! And I had no crashes, bugs,
nor any lags while painting.&lt;/p&gt;
&lt;p&gt;Santos Dumont built this house to be his home away from the big city, while also being able to
keep some of his inventions nearby, and work on other projects. It was a space to be
creative!&lt;/p&gt;
&lt;p&gt;I started by preparing the canvas with the original image and an onion layer, and then traced
the lineart. I used &lt;a href=&#34;https://www.davidrevoy.com/article340/krita-4-0-brushes&#34;&gt;David Revoy&amp;#8217;s brushes&lt;/a&gt;.
They are great! And used the built-in chalk brush for most of the colours.&lt;/p&gt;
&lt;div class=&#39;row&#39;&gt;
&lt;div class=&#34;ui fluid container&#34;&gt;
&lt;figure&gt;
&lt;a  href=&#34;/2018/05/13/drawing-santos-dumonts-encantada-in-krita/side-by-side.jpg&#34; rel=&#34;prettyPhoto&#34; class=&#34;thumbnail&#34; title=&#34;Line art&#34;&gt;
&lt;img style=&#34;height: 400px;&#34; class=&#34;ui image&#34; src=&#34;/2018/05/13/drawing-santos-dumonts-encantada-in-krita/side-by-side.jpg&#34; alt=&#34;Line art&#34; /&gt;
&lt;/a&gt;
&lt;figcaption&gt;Line art&lt;/i&gt;&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;I enjoy line art much more than colours, but for the monthly challenge, I tried to use
some colours. I used the original photo to create the palette for the painting.&lt;/p&gt;
&lt;div class=&#39;row&#39;&gt;
&lt;div class=&#34;ui fluid container&#34;&gt;
&lt;figure&gt;
&lt;a  href=&#34;/2018/05/13/drawing-santos-dumonts-encantada-in-krita/lineart.jpg&#34; rel=&#34;prettyPhoto&#34; class=&#34;thumbnail&#34; title=&#34;Line art&#34;&gt;
&lt;img style=&#34;height: 400px;&#34; class=&#34;ui image&#34; src=&#34;/2018/05/13/drawing-santos-dumonts-encantada-in-krita/lineart.jpg&#34; alt=&#34;Line art&#34; /&gt;
&lt;/a&gt;
&lt;figcaption&gt;Line art&lt;/i&gt;&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;It had been a few months since I used either my Wacom tablet or Krita for painting. But I
was glad to remember some shortcuts. Krita interface is also quite intuitive. In a few
minutes I found how to rotate the canvas and the zoom controls.&lt;/p&gt;
&lt;p&gt;Below a few more screenshots. If you are interested, submit your artwork to the Krita monthly
challenge too! Or if you are not using Krita yet, spend some time using it to compare
with other editors.&lt;/p&gt;
&lt;p&gt;I am sure you will be glad with the results.&lt;/p&gt;
&lt;div class=&#39;row&#39;&gt;
&lt;div class=&#34;ui fluid container&#34;&gt;
&lt;img style=&#34;height: 400px;&#34; class=&#34;ui image&#34; src=&#34;/2018/05/13/drawing-santos-dumonts-encantada-in-krita/Screenshot_2018-05-12_23-16-21.png&#34; alt=&#34;Screen shot&#34; /&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class=&#39;row&#39;&gt;
&lt;div class=&#34;ui fluid container&#34;&gt;
&lt;img style=&#34;height: 400px;&#34; class=&#34;ui image&#34; src=&#34;/2018/05/13/drawing-santos-dumonts-encantada-in-krita/Screenshot from 2018-05-12 22-42-51.png&#34; alt=&#34;Screen shot&#34; /&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class=&#39;row&#39;&gt;
&lt;div class=&#34;ui fluid container&#34;&gt;
&lt;img style=&#34;height: 400px;&#34; class=&#34;ui image&#34; src=&#34;/2018/05/13/drawing-santos-dumonts-encantada-in-krita/Screenshot from 2018-05-13 00-11-38.png&#34; alt=&#34;Screen shot&#34; /&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class=&#39;row&#39;&gt;
&lt;div class=&#34;ui fluid container&#34;&gt;
&lt;img style=&#34;height: 400px;&#34; class=&#34;ui image&#34; src=&#34;/2018/05/13/drawing-santos-dumonts-encantada-in-krita/Screenshot from 2018-05-13 00-38-24.png&#34; alt=&#34;Screen shot&#34; /&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class=&#39;row&#39;&gt;
&lt;div class=&#34;ui fluid container&#34;&gt;
&lt;img style=&#34;height: 400px;&#34; class=&#34;ui image&#34; src=&#34;/2018/05/13/drawing-santos-dumonts-encantada-in-krita/Screenshot from 2018-05-13 01-24-27.png&#34; alt=&#34;Screen shot&#34; /&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;Oh! I also need to find some more time another day to try the newly released
&lt;a href=&#34;https://docs.krita.org/Introduction_to_Python_Scripting&#34;&gt;Krita&amp;#8217;s Python scripting&lt;/a&gt;!&lt;/p&gt;
&lt;p&gt;&amp;hearts; Open Source&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Trivia #1: I grew up on the North of Sao Paulo city, near an important avenue called Dumont Vilares.
It gets this name after Lu&amp;iacute;s Dumont Vilares, main name of Atlas Elevators, and brother of
Santos Dumont. Very few people are aware that this avenue is related to the inventor.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Trivia #2: the house is called &amp;ldquo;A Encantada&amp;rdquo;, which means Enchanted (feminine). It gets this name
because of the name of the street where it was located: Enchant Street, or Rua do Encanto in
Portuguese.&lt;/em&gt;&lt;/p&gt;
            
            </description>
        </item>
        
        
        
        <item>
            <title>Learning more about SPARQL and Jena internals</title>
            <link>/2018/04/28/learning-more-about-sparql-and-jena-internals</link>
            
            <author>kinow</author>
            <dc:creator>kinow</dc:creator>
            
            
            
            <category>jena</category>
            
            <category>apache software foundation</category>
            
            <category>java</category>
            
            <category>sparql</category>
            
            <category>opensource</category>
            
            <pubDate>2018-04-28T18:20:28+12:00</pubDate>
            <guid>/2018/04/28/learning-more-about-sparql-and-jena-internals</guid>
            <description>
            
            &lt;p style=&#39;text-align: center;&#39;&gt;
&lt;a href=&#34;https://kinow.deviantart.com/art/O-Corvo-742473382&#34;&gt;&lt;img style=&#34;display: inline; width: 600px;&#34; class=&#34;ui image&#34; src=&#34;/2018/04/28/learning-more-about-sparql-and-jena-internals/ocorvo.jpg&#34; alt=&#34;O Corvo&#34; /&gt;&lt;/a&gt;
&lt;br/&gt;
&lt;small&gt;&lt;a href=&#34;https://kinow.deviantart.com/art/O-Corvo-742473382&#34;&gt;O Corvo&lt;/a&gt;&lt;/small&gt;
&lt;/p&gt;

&lt;p&gt;Recently a &lt;a href=&#34;https://github.com/apache/jena/pull/114/&#34;&gt;pull request&lt;/a&gt; for Apache Jena
that I started three years ago got merged. Even though it has been three years since
that pull request, there are still many parts of the project code base that I am
not familiar with.&lt;/p&gt;
&lt;p&gt;And not only the code, but there are also many concepts about SPARQL, other standards
used in Jena, and internals about triple stores.&lt;/p&gt;
&lt;p&gt;The following list contains some presentations and posts that I am reading right now,
while I try to improve my knowledge of SPARQL and Jena internals.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.slideshare.net/olafhartig/the-semantics-of-sparql&#34;&gt;The Semantics of SPARQL&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;Slides with information from Query parsing to Algebra and evaluating the Query&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://wiki.blazegraph.com/wiki/index.php/SPARQL_Order_Matters&#34;&gt;SPARQL Order Matters&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;Short but great post from Blazegraph about order in SPARQL queries with JOIN&amp;#8217;s
and LEFT JOIN&amp;#8217;s&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://gregheartsfield.com/2012/08/26/jena-arq-query-performance.html&#34;&gt;Jena ARQ Query Performance&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;Old post, but still very useful. Related to the post above, as it also talks about
query performances due to the order of statements&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://oracle.readthedocs.io/en/latest/sql/indexes/predicates-lhs-vs-rhs.html&#34;&gt;Predicates: LHS vs RHS&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;Oracle post for SQL, but this part applies to SPARQL, at least terminology-wise. LHS
and RHS appear in &lt;a href=&#34;https://issues.apache.org/jira/browse/JENA-1534&#34;&gt;some SPARQL related tickets&lt;/a&gt;
/documentation too&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
            
            </description>
        </item>
        
        
        
        <item>
            <title>R Shiny + Ansible = shiny.nzoss.org.nz</title>
            <link>/2018/02/03/r-shiny-plus-ansible-equals-shinynzossorgnz</link>
            
            <author>kinow</author>
            <dc:creator>kinow</dc:creator>
            
            <category>presentations</category>
            
            <category>r shiny</category>
            
            <category>r</category>
            
            <category>opensource</category>
            
            <pubDate>2018-02-03T17:23:03+13:00</pubDate>
            <guid>/2018/02/03/r-shiny-plus-ansible-equals-shinynzossorgnz</guid>
            <description>
            
            &lt;p&gt;&lt;strong&gt;R Shiny + Ansible = shiny.nzoss.org.nz&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#39;row&#39;&gt;
&lt;div class=&#34;ui embed&#34;&gt;
&lt;iframe src=&#34;https://kinow.github.io/auckland-r-meetup-shiny-talk/&#34; frameborder=&#34;0&#34; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;dl&gt;
&lt;dt&gt;Event&lt;/dt&gt;
&lt;dd&gt;&lt;a href=&#34;https://www.meetup.com/Auckland-R-Users-Group-AKLRUG/events/247400612/&#34;&gt;R Shiny + Ansible = shiny.nzoss.org.nz&lt;/a&gt;&lt;/dd&gt;
&lt;dt&gt;Where ?&lt;/dt&gt;
&lt;dd&gt;&lt;a href=&#34;https://www.google.com/maps/search/?api=1&amp;query=38+Princes+Street%2C+The+University+of+Auckland%2C+Auckland%2C+nz&#34;&gt;Auckland, New Zealand&lt;/a&gt;&lt;/dd&gt;
&lt;dt&gt;When ?&lt;/dt&gt;
&lt;dd&gt;2018-02-08&lt;/dd&gt;
&lt;/dl&gt;
            
            </description>
        </item>
        
        
        
        <item>
            <title>Exif Odd Offsets</title>
            <link>/2017/12/25/exif-odd-offsets</link>
            
            <author>kinow</author>
            <dc:creator>kinow</dc:creator>
            
            
            
            <category>programming</category>
            
            <category>java</category>
            
            <category>apache software foundation</category>
            
            <category>opensource</category>
            
            <pubDate>2017-12-25T21:43:33+13:00</pubDate>
            <guid>/2017/12/25/exif-odd-offsets</guid>
            <description>
            
            &lt;p&gt;A file format like JPEG may contain metadata in JFIF, &lt;a href=&#34;https://en.wikipedia.org/wiki/Exif&#34;&gt;Exif&lt;/a&gt;,
or a vendor proprietary format. The Exif format is based - or uses parts of - on the TIFF format.&lt;/p&gt;
&lt;p&gt;Within an Exif metadata block, you should see directories, with several entries. The entries have fields
like description, value, and also an offset. The offset indicates the offset to the next entry.&lt;/p&gt;
&lt;p&gt;The Exif specification defines that &lt;strong&gt;implementers must make sure to keep the offset an even number,
within 4 bytes&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;I recently worked on &lt;a href=&#34;https://issues.apache.org/jira/browse/IMAGING-205&#34;&gt;IMAGING-205&lt;/a&gt;, a ticket
about odd offsets in files with Exif metadata. This issue was exactly to address that when files
were rewritten with Apache Commons Imaging, even though the image initially had no odd offsets,
after the entries were rearranged, we could have odd offsets.&lt;/p&gt;
&lt;p&gt;The fix was simply checking for odd offsets, adding +1, and later it would be put within the
4 bytes limit.&lt;/p&gt;
&lt;p style=&#39;text-align: center;&#39;&gt;
&lt;img style=&#34;display: inline&#34; class=&#34;ui image&#34; src=&#34;/2017/12/25/exif-odd-offsets/screenshot.png&#34; alt=&#34;A screen shot of Eclipse with source code&#34; title=&#34;Locating the bug&#34; /&gt;
&lt;br/&gt;
&lt;small&gt;Locating the bug&lt;/small&gt;
&lt;/p&gt;

&lt;p&gt;One interesting point, however, is that this is in the standard, but not all software that read
and write Exif follow the specification. So it is quite common to find images with odd offsets.&lt;/p&gt;
&lt;p&gt;Which means you could take a picture with your phone, that contains some Exif metadata, and
be surprised to analyze it with &lt;code&gt;exiftool&lt;/code&gt; and get warnings about odd offsets. Most viewers
handle odd and even offsets, so it should work for most cases, unless you have a strict reader/viewer.&lt;/p&gt;
&lt;p&gt;Happy hacking!&lt;/p&gt;
&lt;p&gt;&amp;heart; Open Source&lt;/p&gt;
            
            </description>
        </item>
        

    </channel>
</rss>