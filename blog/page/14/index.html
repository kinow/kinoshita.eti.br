<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Page 14 of 28 for Blog - page 14 | kinow</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Blog - page 14" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Bruno “kinow” Kinoshita personal home page" />
<meta property="og:description" content="Bruno “kinow” Kinoshita personal home page" />
<link rel="canonical" href="https://kinoshita.eti.br/blog/page/14/" />
<meta property="og:url" content="https://kinoshita.eti.br/blog/page/14/" />
<meta property="og:site_name" content="kinow" />
<link rel="prev" href="https://kinoshita.eti.br/blog/page/13/" />
<link rel="next" href="https://kinoshita.eti.br/blog/page/15/" />
<script type="application/ld+json">
{"description":"Bruno “kinow” Kinoshita personal home page","@type":"WebPage","url":"https://kinoshita.eti.br/blog/page/14/","headline":"Blog - page 14","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/main.css"><link type="application/atom+xml" rel="alternate" href="https://kinoshita.eti.br/feed.xml" title="kinow" /><link href="https://unpkg.com/pattern.css" rel="stylesheet">

</head>
<body>
<div id="mobile-menu"><div class="menu">
  <ul class="menu">
    <li class="item">
      <h1 id="kinow">KINOW</h1>
    </li>
    <li class="item">
      <a href="/" class="">About</a>
    </li>
    <li class="item">
      <a href="/blog/" class="">Blog</a>
    </li>
    <li class="item">
      <a href="/portfolio/" class="">Portfolio</a>
    </li>
    <li class="item social-media-item">
      <a href="https://www.instagram.com/brunokinoshita/" class="inline-link">
        <img src="/assets/icons/instagram.png" class="inverted-image" />
      </a>
      <a href="https://twitter.com/kinow/" class="inline-link">
        <img src="/assets/icons/twitter.png" class="inverted-image" />
      </a>
      <a href="https://github.com/kinow/" class="inline-link">
        <img src="/assets/icons/github.png" class="inverted-image" />
      </a>
    </li>
  </ul>
</div>
</div>
<div id="wrapper">
  <div id="sidebar"><div class="menu">
  <ul class="menu">
    <li class="item">
      <h1 id="kinow">KINOW</h1>
    </li>
    <li class="item">
      <a href="/" class="">About</a>
    </li>
    <li class="item">
      <a href="/blog/" class="">Blog</a>
    </li>
    <li class="item">
      <a href="/portfolio/" class="">Portfolio</a>
    </li>
    <li class="item social-media-item">
      <a href="https://www.instagram.com/brunokinoshita/" class="inline-link">
        <img src="/assets/icons/instagram.png" class="inverted-image" />
      </a>
      <a href="https://twitter.com/kinow/" class="inline-link">
        <img src="/assets/icons/twitter.png" class="inverted-image" />
      </a>
      <a href="https://github.com/kinow/" class="inline-link">
        <img src="/assets/icons/github.png" class="inverted-image" />
      </a>
    </li>
  </ul>
</div>
</div>
  <div id="content">
    <h1 class="page-heading">Blog - page 14</h1>

<div class="blog"><div class="post">
  <h3 class="post-header">
    <a class="post-link" href="/2016/11/07/content-negotiation-with-spring-boot-and-react.html">
      Content negotiation with Spring Boot and React
    </a>
  </h3><span class="post-meta">Nov 7, 2016<span>&mdash; star date: -306068.31.</span></span>
  <span class="post-meta">Number of words: 0.</span><p>A few days ago I had a bug in a system built with Spring Boot and React. The frontend application
was using a REST client in React, built in a similar way to what is found in the documentation, and
also in blogs.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">rest</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">rest</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">Rest</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">rest</span><span class="p">.</span><span class="nx">wrap</span><span class="p">(</span><span class="nx">mime</span><span class="p">);</span>
</code></pre></div></div>

<p>However, for one of the Spring Boot application endpoints, the React component was not working. The
response seemed to be OK in the Network tab, of the browser developer tools. But the component was
failing and complaining when parsing the response.</p>

<p>Turns out that the frontend was sending the request with the header <code class="language-plaintext highlighter-rouge">Accept: text/plain, application/json</code>.
And Spring Boot was just using its <a href="https://spring.io/blog/2013/05/11/content-negotiation-using-spring-mvc">default content negotiation</a>
and returning what the frontend requested: a text plain version of, what looked like, JSON.</p>

<p>The quick fix was to request the content as JSON in React.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">rest</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">rest</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">mime</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">rest/interceptor/mime</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">Rest</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">rest</span><span class="p">.</span><span class="nx">wrap</span><span class="p">(</span><span class="nx">mime</span> <span class="p">,</span> <span class="p">{</span> <span class="na">mime</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span> <span class="p">}</span> <span class="p">);</span>
</code></pre></div></div>

<p>Now we will revisit the backend to return the JSON content, as content, regardless of what
the user asks :-)</p>

<p>Happy hacking!</p>
</div>
<div class="post">
  <h3 class="post-header">
    <a class="post-link" href="/2016/11/05/checking-the-operating-system-type-in-shell-script.html">
      Checking the operating system type in shell script
    </a>
  </h3><span class="post-meta">Nov 5, 2016<span>&mdash; star date: -306073.77.</span></span>
  <span class="post-meta">Number of words: 0.</span><p>Last week I learned about a tool called <a href="https://github.com/koalaman/shellcheck">ShellCheck</a>, a tool
for static analysis of shell scripts. It reports errors like missing double quotes, use of deprecated
syntax, etc.</p>

<p>I decided to check some projects I contribute to, and the first issue I found was in
<a href="https://jena.apache.org">Apache Jena</a>:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kinow@localhost:~/Development/java/jena/jena/apache-jena/bin<span class="nv">$ </span>shellcheck arq

In arq line 8:
    <span class="k">case</span> <span class="s2">"</span><span class="nv">$OSTYPE</span><span class="s2">"</span> <span class="k">in</span>
          ^-- SC2039: In POSIX sh, OSTYPE is not supported.
</code></pre></div></div>

<p>So, in summary, the <code class="language-plaintext highlighter-rouge">OSTYPE</code> variable should not be available in POSIX shell. The case in question, where
<code class="language-plaintext highlighter-rouge">OSTYPE</code> is being used, checks for the Darwin OS type (i.e. Mac OS). Knowing how things get weird when you
use different operating systems, I decided to check and learn how <code class="language-plaintext highlighter-rouge">OSTYPE</code> works. Here’s what I found.</p>

<ul>
  <li>In Ubuntu, with /bin/bash, OSTYPE works fine (linux-gnu)</li>
  <li>In Ubuntu, with /bin/sh, OSTYPE is not set</li>
  <li>In Mac OS, with /bin/sh, OSTYPE is set (darwin15)</li>
</ul>

<p>I checked the shells to make sure they were not pointing to symbolic links - some distributions
use a different default shell, and replace /bin/bash and/or /bin/sh by a link to another
shell. Looks like Mac OS has a POSIX shell that behaves different than Ubuntu’s.</p>

<p>Instead of trying to find a way to use <code class="language-plaintext highlighter-rouge">OSTYPE</code>, I decided to spend some time looking at
how other projects do the same thing. And the best example I could find was
<a href="https://git.kernel.org/cgit/git/git.git/tree/config.mak.uname">git</a>.</p>

<p>Instead of relying on <code class="language-plaintext highlighter-rouge">OSTYPE</code>, git uses <code class="language-plaintext highlighter-rouge">uname</code>.</p>

<p>I will spend some time during the next days working on a proposal to replace the <code class="language-plaintext highlighter-rouge">OSTYPE</code>
from Apache Jena scripts, but then may have to submit more changes for the other issues
found by ShellCheck.</p>

<p>Happy hacking!</p>
</div>
<div class="post">
  <h3 class="post-header">
    <a class="post-link" href="/2016/10/04/using-the-aws-api-with-python.html">
      Using the AWS API with Python
    </a>
  </h3><span class="post-meta">Oct 4, 2016<span>&mdash; star date: -306158.47.</span></span>
  <span class="post-meta">Number of words: 0.</span><p>Amazon Web Services provides a series of cloud services. When you access the web interface, most - if not all - of the actions you do there are actually translated into API calls.</p>

<p>They also provide SDK’s in several programming languages. With these SDK’s you are able to call the same API used by the web interface. Python has <a href="https://github.com/boto/boto3">boto</a> (or boto3) which lets you to automate several tasks in AWS.</p>

<p>But before you start using the API, you will need to <a href="https://web.archive.org/web/20160818112016/http://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSGettingStartedGuide/AWSCredentials.html">set up your access key</a>.</p>

<p>It is likely that with time you will have different roles, and may have different permissions with each role. You have to configure your local environment so that you can either use the command line Python utility (installed via <code class="language-plaintext highlighter-rouge">pip install awscli</code>) or with boto.</p>

<p>The awscli is a dependency for using boto3. After you install it, you need to run <code class="language-plaintext highlighter-rouge">aws configure</code>. It will create the <em>~/.aws/config</em> and <em>~/.aws/credentials</em> files. You can tweak these files to support multiple roles.</p>

<p>I followed the tutorials, but got all sorts of different issues. Then after debugging some locally installed dependencies, in special awscli files, I found that the following settings work for my environment.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># File: config</span>
<span class="o">[</span>profile default]
region <span class="o">=</span> ap-southeast-2

<span class="o">[</span>profile profile1]
region <span class="o">=</span> ap-southeast-2
source_profile <span class="o">=</span> default
role_arn <span class="o">=</span> arn:aws:iam::123:role/Developer

<span class="o">[</span>profile profile2]
region <span class="o">=</span> ap-southeast-2
source_profile <span class="o">=</span> default
role_arn <span class="o">=</span> arn:aws:iam::456:role/Sysops
mfa_serial <span class="o">=</span> arn:aws:iam::789:mfa/user@domain.blabla
</code></pre></div></div>

<p>and</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># File: credentials</span>
<span class="o">[</span>default]
aws_access_key_id <span class="o">=</span> YOU_KEY_ID
aws_secret_access_key <span class="o">=</span> YOUR_SECRET
</code></pre></div></div>

<p>And once it is done you can, for example, confirm it is working with some S3 commands in Python.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">boto3</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">profile_name</span><span class="o">=</span><span class="s">'profile2'</span><span class="p">)</span>
<span class="n">s3</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s">'s3'</span><span class="p">)</span>

<span class="n">found</span> <span class="o">=</span> <span class="bp">False</span>

<span class="n">name</span> <span class="o">=</span> <span class="s">'mysuperduperbucket'</span>

<span class="k">for</span> <span class="n">bucket</span> <span class="ow">in</span> <span class="n">s3</span><span class="o">.</span><span class="n">buckets</span><span class="o">.</span><span class="nb">all</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">bucket</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">found</span> <span class="o">=</span> <span class="bp">True</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Creating bucket..."</span><span class="p">)</span>
    <span class="n">s3</span><span class="o">.</span><span class="n">create_bucket</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

<span class="n">file_location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s">'samplefile.txt'</span>
<span class="n">s3</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="n">file_location</span><span class="p">,</span> <span class="n">Bucket</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="s">'book.txt'</span><span class="p">)</span>
</code></pre></div></div>

<p>The AWS files in this example are using MFA too, the multi-factor authentication. So the first time you run this code you may be asked to generate a token, which will be cached for a short time.</p>

<p>That’s it for today.</p>

<p>Happy hacking!</p>
</div>
<div class="post">
  <h3 class="post-header">
    <a class="post-link" href="/2016/09/03/performance-problems-in-jenkins-tap-plugin-part-1.html">
      Performance problems in Jenkins TAP Plug-in &amp;mdash; part 1
    </a>
  </h3><span class="post-meta">Sep 3, 2016<span>&mdash; star date: -306245.9.</span></span>
  <span class="post-meta">Number of words: 0.</span><p><a href="https://issues.jenkins-ci.org/browse/JENKINS-17887">JENKINS-17887</a> reports performance problems in the <a href="https://wiki.jenkins-ci.org/display/JENKINS/TAP+Plugin">Jenkins TAP Plug-in</a>. It also lists a series of suggestions on how to improve the Jenkins TAP Plug-in performance. On this initial post, we will get a general idea of how the plug-in performs for large projects.</p>

<p><a href="http://bioperl.org/">BioPerl</a> has over 21K tests. That should be enough for giving an initial idea of CPU, memory and disk usage for the plug-in.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/bioperl/bioperl-live.git
<span class="nb">cd </span>bioperl-live
<span class="nb">sudo </span>cpanm  <span class="nt">-vv</span> <span class="nt">--installdeps</span> <span class="nt">--notest</span> <span class="nb">.</span>
<span class="nb">sudo </span>cpanm Set::Scalar Graph::Directed XML::LibXML XML::SAX <span class="se">\</span>
    SVG XML::Parser::PerlSAX Convert::Binary::C XML::SAX::Writer <span class="se">\</span>
    XML::DOM::XPath Spreadsheet::ParseExcel XML::SAX::Writer <span class="se">\</span>
    XML::DOM HTML::TableExtract XML::Simple Test::Pod DBI
prove <span class="nt">-r</span> t/ <span class="nt">-a</span> tests.tar.gz

All tests successful.
<span class="nv">Files</span><span class="o">=</span>325, <span class="nv">Tests</span><span class="o">=</span>21095, 94 wallclock secs <span class="o">(</span> 2.47 usr  0.55 sys + 88.29 cusr  3.85 csys <span class="o">=</span> 95.16 CPU<span class="o">)</span>
Result: PASS
</code></pre></div></div>

<p>When the test results are parsed, the plug-in also copies TAP files over to the master, in a folder called <em>tap-master-files</em>.</p>

<p>The BioPerl tests are not really big, just <strong>1.7M</strong>. It gets doubled as there will be the workspace copy, and the tap-master-files directory copy, so <strong>3.4M</strong>.</p>

<p>But several objects get created in memory, and persisted into the build.xml job file. BioPerl generates a build.xml file with <strong>11M</strong>. So <strong>less than 15M</strong>. But the build.xml contains objects that are read via XStream by Jenkins and into the memory.</p>

<p>The build page with the graph, and the other two test result pages are rendering in more than 10 seconds in my computer. But the CPU load is OK, so a closer look at the memory use would probably be more interesting.</p>

<p><img class="ui centered image" src="/assets/posts/2016-09-03-performance-problems-in-jenkins-tap-plug-in-mdash-part-1/JENKINS-17887-yourkit1.png" alt="JENKINS-17887 YourKit profiler" /></p>

<p>The image shows one of the screens in YourKit profiler, where it is possible to see that <strong>org.tap4j.plugin.model.TapTestResultResult</strong> has over 6 million objects.</p>

<p>One build.xml for the BioPerl project gets over 80K entries for the TestResult object.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">grep</span> <span class="s2">"org.tap4j.model.TestResult"</span> builds/1/build.xml <span class="nt">-o</span> | <span class="nb">wc</span> <span class="nt">-l</span>
84522
</code></pre></div></div>

<p>This happens because each TAP file may contain multiple test results (lines with test results). Each of these test results gets turned into a Java object and loaded by the plug-in. So when loading the test result pages, Jenkins needs to wait until all these objects have been parsed, deserialized and read into the memory.</p>

<p>The next post will continue on code improvements, and another benchmark.</p>

<p>Happy profiling!</p>
</div>
<div class="post">
  <h3 class="post-header">
    <a class="post-link" href="/2016/07/20/reading-notes-about-drmaa-v2.html">
      Reading notes about DRMAA v2
    </a>
  </h3><span class="post-meta">Jul 20, 2016<span>&mdash; star date: -306366.12.</span></span>
  <span class="post-meta">Number of words: 0.</span><p>The DRMAA v2 specification draft is ready to be published, and is in <a href="https://redmine.ogf.org/boards/36/topics/494">public
comment</a> until 31st July this year.
I used DRMAA v1 to integrate Jenkins and PBS some time ago, but it was not a
very elegant solution.</p>

<p>And in the end integrating other grid computing implementations like SGE would
not be very simple.</p>

<p>This post contains my reading notes for DRMAA v2, and a short analysis of how
this new specification could be used in a new tentative to integrate
Jenkins and several grid computing implementations in a single plug-in.</p>

<p class="more-link">
    <a class="post-link" href="/2016/07/20/reading-notes-about-drmaa-v2.html">Continue reading&hellip;</a>
  </p></div>
<!-- Pagination links -->
  <div class="pagination">
    <p>
      
      <a href="/blog/page/13/" class="icon item">
        <i class="left chevron icon"></i>Previous
      </a>
      
      <span class="page_number ">Page: 14 of 28</span>
      
      <a href="/blog/page/15/" class="next">
        Next<i class="right chevron icon"></i>
      </a>
      
    </p>
  </div></div>

  </div>
</div>
</body>
</html>
