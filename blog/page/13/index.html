<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Page 13 of 28 for Blog - page 13 | Bruno P. Kinoshita</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Blog - page 13" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Bruno P. Kinoshita personal home page" />
<meta property="og:description" content="Bruno P. Kinoshita personal home page" />
<link rel="canonical" href="https://kinoshita.eti.br/blog/page/13/" />
<meta property="og:url" content="https://kinoshita.eti.br/blog/page/13/" />
<meta property="og:site_name" content="Bruno P. Kinoshita" />
<link rel="prev" href="https://kinoshita.eti.br/blog/page/12/" />
<link rel="next" href="https://kinoshita.eti.br/blog/page/14/" />
<script type="application/ld+json">
{"description":"Bruno P. Kinoshita personal home page","@type":"WebPage","url":"https://kinoshita.eti.br/blog/page/13/","headline":"Blog - page 13","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/main.css"><link type="application/atom+xml" rel="alternate" href="https://kinoshita.eti.br/feed.xml" title="Bruno P. Kinoshita" /><link href="https://unpkg.com/pattern.css" rel="stylesheet">

</head>
<body>
<div id="mobile-menu"><div class="menu">
  <ul class="menu">
    <li class="item">
      <h1 id="kinow">KINOW</h1>
    </li>
    <li class="item">
      <a href="/" class="">About</a>
    </li>
    <li class="item">
      <a href="/blog/" class="">Blog</a>
    </li>
    <li class="item">
      <a href="/portfolio/" class="">Portfolio</a>
    </li>
    <li class="item social-media-item">
      <a href="https://www.instagram.com/brunokinoshita/" class="inline-link">
        <img src="/assets/icons/instagram.png" class="inverted-image" />
      </a>
      <a href="https://twitter.com/kinow/" class="inline-link">
        <img src="/assets/icons/twitter.png" class="inverted-image" />
      </a>
      <a href="https://github.com/kinow/" class="inline-link">
        <img src="/assets/icons/github.png" class="inverted-image" />
      </a>
    </li>
  </ul>
</div>
</div>
<div id="wrapper">
  <div id="sidebar"><div class="menu">
  <ul class="menu">
    <li class="item">
      <h1 id="kinow">KINOW</h1>
    </li>
    <li class="item">
      <a href="/" class="">About</a>
    </li>
    <li class="item">
      <a href="/blog/" class="">Blog</a>
    </li>
    <li class="item">
      <a href="/portfolio/" class="">Portfolio</a>
    </li>
    <li class="item social-media-item">
      <a href="https://www.instagram.com/brunokinoshita/" class="inline-link">
        <img src="/assets/icons/instagram.png" class="inverted-image" />
      </a>
      <a href="https://twitter.com/kinow/" class="inline-link">
        <img src="/assets/icons/twitter.png" class="inverted-image" />
      </a>
      <a href="https://github.com/kinow/" class="inline-link">
        <img src="/assets/icons/github.png" class="inverted-image" />
      </a>
    </li>
  </ul>
</div>
</div>
  <div id="content">
    <h1 class="page-heading">Blog - page 13</h1>

<div class="blog"><div class="post">
  <h3 class="post-header">
    <a class="post-link" href="/2017/01/02/debugging-an-application-that-freezes-the-x-server.html">
      Debugging an application that freezes the X server
    </a>
  </h3><span class="post-meta">Jan 2, 2017<span>&mdash; star date: -305912.33.</span></span>
  <span class="post-meta">Number of words: 0.</span><p>Some time ago, I decided to start writing C++ again, and picked Krita for that.
Krita is written in C++ and Qt. The <a href="https://bugs.kde.org/show_bug.cgi?id=366741">bug I was working on</a>
involved a memory issue when changing the UI.</p>

<p>The problem was that this UI change would result in, not only Krita, but the whole
X server freezing. My set up was basically Ubuntu 16.04.1 LTS, with Eclipse, Qt5,
and the latest version of Krita checked out via git.</p>

<p>Initially I spent some time looking at the logs, tracing the binary, even downloaded
some Qt utility tools to look at the events and what was happening with the application
when it froze.</p>

<p>However, eventually I realized I was going to spend more time on this part of the
issue, rather than on the memory bug. So decided to look for a work-around.</p>

<p>Thankfully someone else blogged about a similar issue and saved me a lot of time :-)
Here’s how I did it, following the instructions in
<a href="http://www.geany.org/manual/gtk/gtk-faq/x462.html">this blog post</a>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>apt-get <span class="nb">install </span>xnest <span class="nt">-y</span>
<span class="nv">$ </span><span class="nb">cd </span>krita_install/
<span class="nv">$ </span>Xnest :10
<span class="nv">$ </span>twm <span class="nt">-display</span> :10
<span class="nv">$ </span><span class="nb">export </span><span class="nv">DISPLAY</span><span class="o">=</span>:10
<span class="nv">$ </span>./krita
</code></pre></div></div>

<p>That’s it. You should have Krita running in a separate window, with Xnest, and within
this window the twm window manager running. So when it freezes, at least you can still
debug your application in Eclipse or whatever IDE you prefer.</p>

<p>Happy hacking!</p>
</div>
<div class="post">
  <h3 class="post-header">
    <a class="post-link" href="/2016/12/19/permgen-errors-and-java-lang-classcastexception-com-sun-crypto-provider-aescipher-cannot-be-cast-to-javax-crypto-cipherspi-running-jenkins-plug-in-tests-with-powermock.html">
      PermGen errors and java.lang.ClassCastException: com.sun.crypto.provider.AESCipher cannot be cast to javax.crypto.CipherSpi running Jenkins plug-in tests with PowerMock
    </a>
  </h3><span class="post-meta">Dec 19, 2016<span>&mdash; star date: -306948.09.</span></span>
  <span class="post-meta">Number of words: 0.</span><p>Recently while working on a Jenkins plugin some tests were failing with PermGen errors.
Even though it worked in my notebook at home (with Java 8, thus no Permgen), it failed
in a CloudBees hosted Jenkins job, and also on my Mac (with Java 7) at work.</p>

<p>As I could not change the settings in the CloudBees hosted Jenkins, I decided to spent some
time investigating why these tests would require so much memory. Then I found
<a href="https://angus.nyc/2015/fixing-common-powermock-problems/">this blog post about PowerMock</a>.</p>

<p>I was not using the <em>@PrepareForTest</em> annotation, but after adding it the issue was gone. So I
assume it either prevents PowerMock from trying to dynamically load several classes, or instructs
it to unload classes after the tests. But in anyway after adding it the issue was gone.</p>

<p>Then I got the following exception.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>WARNING: Failed to instantiate Key[type<span class="o">=</span>hudson.security.csrf.DefaultCrumbIssuer<span class="nv">$DescriptorImpl</span>, <span class="nv">annotation</span><span class="o">=[</span>none]]<span class="p">;</span> skipping this component
com.google.inject.ProvisionException: Guice provision errors:

1<span class="o">)</span> Error injecting constructor, java.lang.ClassCastException: com.sun.crypto.provider.AESCipher cannot be cast to javax.crypto.CipherSpi
  at hudson.security.csrf.DefaultCrumbIssuer<span class="nv">$DescriptorImpl</span>.&lt;init&gt;<span class="o">(</span>DefaultCrumbIssuer.java:127<span class="o">)</span>

1 error
    at com.google.inject.internal.ProviderToInternalFactoryAdapter.get<span class="o">(</span>ProviderToInternalFactoryAdapter.java:52<span class="o">)</span>
</code></pre></div></div>

<p>And then thanks to <a href="https://github.com/powermock/powermock/issues/294">this issue</a> I understood
that PowerMock was mocking <em>javax.crypto</em> classes. Turns out it is quite easy to tell
PowerMock to ignore certain classes from being mocked, with the <em>@PowerMockIgnore</em> annotation.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// snip</span>
<span class="nd">@RunWith</span><span class="o">(</span><span class="nc">PowerMockRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@PowerMockIgnore</span><span class="o">({</span><span class="s">"javax.crypto.*"</span> <span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestAbstractUnoChoiceParameter</span> <span class="o">{</span>
<span class="c1">//</span>
<span class="o">}</span>
<span class="c1">// snip</span>
</code></pre></div></div>

<p>Added a couple of notes to this <a href="https://wiki.jenkins-ci.org/display/JENKINS/Mocking+in+Unit+Tests">Jenkins Wiki page</a>
so that users facing similar issues can try these possible workarounds.</p>

<p>Hope that helps someone!</p>
</div>
<div class="post">
  <h3 class="post-header">
    <a class="post-link" href="/2016/11/25/using-requests-session-objects-for-web-scraping.html">
      Using Requests Session Objects for web scraping
    </a>
  </h3><span class="post-meta">Nov 25, 2016<span>&mdash; star date: -306019.13.</span></span>
  <span class="post-meta">Number of words: 0.</span><p>I had to write a Python script some months ago, that would retrieve Solar energy
data from a web site. It was basically a handful of HTTP calls, parse the response
that was mainly in JSON, and store the results as JSON and CSV for processing later.</p>

<p>Since it was such a small task, I used the <a href="http://docs.python-requests.org">Requests</a>
module instead of a complete web scraper. The HTTP requests had to be made with a
time out, and also pass certain headers. I started customizing each call, until
I learned about the Requests <a href="http://docs.python-requests.org/en/master/user/advanced/">Session Objects</a>.</p>

<p>You create a session, as in ORM/JPA, where you can define a context, with certain properties
and control an orthogonal behavior.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
    <span class="s">"""Utility method to HTTP GET a URL"""</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span>

<span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="s">"""Utility method to HTTP POST a URL with data parameters"""</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="n">requests</span><span class="o">.</span><span class="n">codes</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">response</span>

<span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
    <span class="c1"># x-test header will be sent with every request
</span>    <span class="n">s</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">'x-test'</span><span class="p">:</span> <span class="s">'true'</span><span class="p">})</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">'user'</span><span class="p">:</span> <span class="n">user</span><span class="p">,</span> <span class="s">'password'</span><span class="p">:</span> <span class="n">password</span><span class="p">,</span> <span class="s">'rememberne'</span><span class="p">:</span> <span class="s">'false'</span><span class="p">}</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">'https://portal.login.url'</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">'https://portal.home.url'</span><span class="p">)</span>
</code></pre></div></div>

<p>Besides the session object, that gives you ability to add headers to all requests,
you won’t have to worry about redirects. The library by default takes care
<a href="https://github.com/kennethreitz/requests/blob/dfad00a6e84bc75b12468ca29ccf4f971c813fc8/requests/sessions.py#L110">of that</a>
with a <a href="https://github.com/kennethreitz/requests/blob/dfad00a6e84bc75b12468ca29ccf4f971c813fc8/requests/models.py#L54">default limit of up to 30</a>.</p>

<p>Happy hacking!</p>
</div>
<div class="post">
  <h3 class="post-header">
    <a class="post-link" href="/2016/11/21/changing-spring-boot-environment-variables-in-the-command-line.html">
      Changing Spring Boot environment variables in the command line
    </a>
  </h3><span class="post-meta">Nov 21, 2016<span>&mdash; star date: -306030.05.</span></span>
  <span class="post-meta">Number of words: 0.</span><p>This week while helping developers and testers to experiment with a backend application,
some of them found useful to learn a simple trick to change Spring Boot properties
when you can run the application locally (our testers build, compile, change the code, how cool
is that?).</p>

<p>Here’s how it works. Say you have the following settings in your application’s
<strong>application.properties</strong>:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>my.application.database.username<span class="o">=</span>sa
my.application.database.password<span class="o">=</span>notasimplepassword
</code></pre></div></div>

<p>And that you want to change these parameters in order to, for instance, create an application
error, so that you can code and test what happens to the frontend application in that situation.</p>

<p>You replace <em>dots</em> by <em>underscores</em>, and put all your words in upper case. So the variables
above would be: MY_APPLICATION_DATABASE_USERNAME and MY_APPLICATION_DATABASE_PASSWORD.</p>

<p>Furthermore, you do not need to edit your application.properties file, if you are on Linux or
Mac OS. You can start the application and override environment variables at the same time
with the following syntax.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ MY_APPLICATION_DATABASE_USERNAME</span><span class="o">=</span>olivei <span class="nv">MY_APPLICATION_DATABASE_PASSWORD</span><span class="o">=</span>7655432222a mvn clean spring-boot:run
</code></pre></div></div>

<p>This way your application will start with the new values.</p>

<p>Happy hacking!</p>

<p><strong>–EDIT–</strong></p>

<p>As pointed by Stéphane Nicoll (thanks!), you could change the property values
without having to use the upper case syntax.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn <span class="nt">-Dmy</span>.application.database.username<span class="o">=</span>anotheruser clean spring-boot:run
</code></pre></div></div>

<p>And he even included a link to <a href="http://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-external-config">docs</a>! ♥ the Internet and Open Source!</p>

<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/kinow">@kinow</a> you can also specify them as command-line arguments (no need for the upper case thing)<a href="https://t.co/zBKpgcXN1C">https://t.co/zBKpgcXN1C</a><br /><br />or `-Drun.arguments`</p>&mdash; Stéphane Nicoll (@snicoll) <a href="https://twitter.com/snicoll/status/800965565120708608">November 22, 2016</a></blockquote>
<script async="" src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

</div>
<div class="post">
  <h3 class="post-header">
    <a class="post-link" href="/2016/11/12/add-a-header-to-a-file-with-shell-script-sed.html">
      Add a header to a file with Shell script (sed)
    </a>
  </h3><span class="post-meta">Nov 12, 2016<span>&mdash; star date: -306054.64.</span></span>
  <span class="post-meta">Number of words: 0.</span><p>Today I was re-generating the documentation for a REST API written in PHP, with
Laravel. To generate the documentation, one would have to call a Laravel command first.
That command would create a Markdown page. And since in this project I am using Jekyll
for the project site, the final step was adding a header to the file, so that Jekyll
can recognize that content as a blog post.</p>

<p>Laravel allows you to add custom commands to your project, so I decided to write a command
that would call the other command that generates the documentation, and add an extra step
of adding the header to the Markdown file.</p>

<p>Here’s the shell script part, that allows you to add a header to a file, in place (i.e.
it will alter and save the change your file).</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sed</span> <span class="nt">-i</span> 1i<span class="s2">"----</span><span class="se">\n</span><span class="s2">layout: page</span><span class="se">\n</span><span class="s2">title: API Installation</span><span class="se">\n</span><span class="s2">----</span><span class="se">\n\n</span><span class="s2">"</span> ./docs/documentation/api/api.md
</code></pre></div></div>

<p>Here the first argument to sed, <em>-i</em> is for in place. Then that strange <em>1i</em>
means that it will insert something before the first line, once. Then we have our header,
and finally the file.</p>

<p>Happy hacking!</p>
</div>
<!-- Pagination links -->
  <div class="pagination">
    <p>
      
      <a href="/blog/page/12/" class="icon item">
        <i class="left chevron icon"></i>Previous
      </a>
      
      <span class="page_number ">Page: 13 of 28</span>
      
      <a href="/blog/page/14/" class="next">
        Next<i class="right chevron icon"></i>
      </a>
      
    </p>
  </div></div>

  </div>
</div>
</body>
</html>
