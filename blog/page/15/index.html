<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Page 15 of 31 for Blog - page 15 | Bruno P. Kinoshita</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Blog - page 15" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Bruno P. Kinoshita personal home page" />
<meta property="og:description" content="Bruno P. Kinoshita personal home page" />
<link rel="canonical" href="https://kinoshita.eti.br/blog/page/15/" />
<meta property="og:url" content="https://kinoshita.eti.br/blog/page/15/" />
<meta property="og:site_name" content="Bruno P. Kinoshita" />
<link rel="prev" href="https://kinoshita.eti.br/blog/page/14/" />
<link rel="next" href="https://kinoshita.eti.br/blog/page/16/" />
<script type="application/ld+json">
{"headline":"Blog - page 15","description":"Bruno P. Kinoshita personal home page","@type":"WebPage","url":"https://kinoshita.eti.br/blog/page/15/","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/main.css"><link type="application/atom+xml" rel="alternate" href="https://kinoshita.eti.br/feed.xml" title="Bruno P. Kinoshita" /></head>
<body>
<div id="wrapper">
  <div id="sidebar"><div id="menu">
  <ul class="menu">
    <li class="item">
      <a href="/" aria-label="Home page link">
        <svg id="svg8" version="1.1" viewBox="0 0 58.208 9.2604" xmlns="http://www.w3.org/2000/svg" role="img"
             aria-labelledby="svg-logo-title svg-logo-desc">
          <title id="svg-logo-title">KINOSHITA image</title>
          <desc id="svg-logo-desc">A logo with the word KINOSHITA</desc>
          <g id="layer1" transform="translate(0 -287.74)">
            <g id="text817" transform="translate(-2.4568 -.23624)">
              <g id="logo" transform="matrix(2.6585 0 0 2.5911 -63.587 100.56)" fill="#000000" stroke-width=".26458px">
                <path role="presentation" id="path819"
                      d="m25.178 72.637h0.54187v2.9633h-0.54187zm0.5842 1.397 1.0964-1.397h0.635l-1.1049 1.397 1.1049 1.5663h-0.635z"/>
                <path role="presentation" id="path821" d="m27.832 72.637h0.54187v2.9633h-0.54187z"/>
                <path role="presentation" id="path823"
                      d="m29.023 72.637h0.5334l1.2658 1.9135v-1.9135h0.54187v2.9633h-0.4445l-1.3547-2.032v2.032h-0.54187z"/>
                <path role="presentation" id="path825"
                      d="m33.298 75.66q-0.4191 0-0.75353-0.1905-0.3302-0.19473-0.5207-0.54187-0.18627-0.35137-0.18627-0.80857t0.18627-0.80433q0.1905-0.35137 0.5207-0.54187 0.33443-0.19473 0.75353-0.19473t0.7493 0.19473q0.33443 0.1905 0.5207 0.54187 0.1905 0.34713 0.1905 0.80433t-0.1905 0.80857q-0.18627 0.34713-0.5207 0.54187-0.3302 0.1905-0.7493 0.1905zm0-0.52493q0.4318 0 0.6604-0.2794 0.23283-0.2794 0.23283-0.7366t-0.23283-0.7366q-0.2286-0.2794-0.6604-0.2794t-0.66463 0.2794q-0.2286 0.2794-0.2286 0.7366t0.2286 0.7366q0.23283 0.2794 0.66463 0.2794z"/>
                <path role="presentation" id="path827"
                      d="m36.091 75.66q-0.24977 0-0.53763-0.06773-0.28363-0.06773-0.4445-0.14817l0.0635-0.57573q0.5588 0.27093 0.98213 0.27093 0.22437 0 0.35137-0.08467 0.127-0.0889 0.127-0.25823 0-0.127-0.07197-0.20743-0.06773-0.08467-0.19897-0.1397-0.13123-0.05927-0.4191-0.16087-0.27093-0.09313-0.44873-0.19473-0.1778-0.10583-0.28363-0.2667-0.1016-0.1651-0.1016-0.40217 0-0.381 0.2794-0.61383t0.8001-0.23283q0.24553 0 0.48683 0.05503 0.24553 0.05503 0.44873 0.13547l-0.05503 0.55457q-0.26247-0.1143-0.4826-0.16933-0.2159-0.05927-0.4318-0.05927-0.2413 0-0.3683 0.08043t-0.127 0.23283q0 0.11853 0.06773 0.19473t0.18203 0.127q0.11853 0.0508 0.34713 0.12277 0.51223 0.16087 0.74507 0.37253 0.23707 0.20743 0.23707 0.5715 0 0.34713-0.2413 0.60537t-0.90593 0.25823z"/>
                <path role="presentation" id="path829"
                      d="m37.688 72.637h0.54187v1.1726h1.3547v-1.1726h0.54187v2.9633h-0.54187v-1.2827h-1.3547v1.2827h-0.54187z"/>
                <path role="presentation" id="path831" d="m40.78 72.637h0.54187v2.9633h-0.54187z"/>
                <path role="presentation" id="path833"
                      d="m42.546 73.162h-0.8382v-0.52493h2.2183v0.52493h-0.8382v2.4384h-0.54187z"/>
                <path role="presentation" id="path835"
                      d="m45.632 74.898h-1.0795l-0.24553 0.70273h-0.52493l1.0541-2.9633h0.51223l1.0541 2.9633h-0.52493zm-0.16933-0.47413-0.3683-1.0583-0.37253 1.0583z"/>
              </g>
            </g>
          </g>
        </svg>
      </a>
    </li>
    <li class="item">
      <a href="/blog/" class="">Blog</a>
      <ul>
        <li class="item">
          <a href="/blog/drawing/">Drawing</a>
        </li>
        <li class="item">
          <a href="/blog/languages/">Languages</a>
        </li>
        <li class="item">
          <a href="/blog/music/">Music</a>
        </li>
        <li class="item">
          <a href="/blog/writing/">Writing</a>
        </li>
      </ul>
    </li>
    <li class="item">
      <a href="/art/" class="">Illustrations</a>
    </li>
    <li class="item">
      <a href="/maps/" class="">Maps</a>
    </li>
  </ul>
  <div id="menu-bottom">
    <p id="feed-subscribe">
      <a href="/feed.xml">
        <svg id="feed-icon" xmlns="http://www.w3.org/2000/svg" version="1.1" width="128px" height="128px"
             viewBox="0 0 256 256">
          <circle cx="68" cy="189" r="24" fill="rgba(255, 255, 255, .2)"/>
          <path d="M160 213h-34a82 82 0 0 0 -82 -82v-34a116 116 0 0 1 116 116z" fill="rgba(255, 255, 255, .2)"/>
          <path d="M184 213A140 140 0 0 0 44 73 V 38a175 175 0 0 1 175 175z" fill="rgba(255, 255, 255, .2)"/>
        </svg>
      </a>
    </p>
  </div>
</div>
</div>
  <div id="content">
    <h1 class="page-heading">Blog - page 15</h1><div class="note"><p>Posts about technology.</p>
</div>

<div class="blog"><div class="post">
  <h3 class="post-header">
    <a class="post-link" href="/2016/11/11/add-a-header-to-a-file-with-shell-script-sed.html">
      Add a header to a file with Shell script (sed)
    </a>
  </h3><span class="post-meta">Nov 11, 201651<span>&mdash; star date: -306060.11</span></span><p>Today I was re-generating the documentation for a REST API written in PHP, with
Laravel. To generate the documentation, one would have to call a Laravel command first.
That command would create a Markdown page. And since in this project I am using Jekyll
for the project site, the final step was adding a header to the file, so that Jekyll
can recognize that content as a blog post.</p>

<p>Laravel allows you to add custom commands to your project, so I decided to write a command
that would call the other command that generates the documentation, and add an extra step
of adding the header to the Markdown file.</p>

<p>Hereâ€™s the shell script part, that allows you to add a header to a file, in place (i.e.
it will alter and save the change your file).</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sed</span> <span class="nt">-i</span> 1i<span class="s2">"----</span><span class="se">\n</span><span class="s2">layout: page</span><span class="se">\n</span><span class="s2">title: API Installation</span><span class="se">\n</span><span class="s2">----</span><span class="se">\n\n</span><span class="s2">"</span> ./docs/documentation/api/api.md
</code></pre></div></div>

<p>Here the first argument to sed, <em>-i</em> is for in place. Then that strange <em>1i</em>
means that it will insert something before the first line, once. Then we have our header,
and finally the file.</p>

<p>Happy hacking!</p>
</div>
<div class="post">
  <h3 class="post-header">
    <a class="post-link" href="/2016/11/07/content-negotiation-with-spring-boot-and-react.html">
      Content negotiation with Spring Boot and React
    </a>
  </h3><span class="post-meta">Nov 7, 201652<span>&mdash; star date: -306071.04</span></span><p>A few days ago I had a bug in a system built with Spring Boot and React. The frontend application
was using a REST client in React, built in a similar way to what is found in the documentation, and
also in blogs.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">rest</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">rest</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">Rest</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">rest</span><span class="p">.</span><span class="nx">wrap</span><span class="p">(</span><span class="nx">mime</span><span class="p">);</span>
</code></pre></div></div>

<p>However, for one of the Spring Boot application endpoints, the React component was not working. The
response seemed to be OK in the Network tab, of the browser developer tools. But the component was
failing and complaining when parsing the response.</p>

<p>Turns out that the frontend was sending the request with the header <code class="language-plaintext highlighter-rouge">Accept: text/plain, application/json</code>.
And Spring Boot was just using its <a href="https://spring.io/blog/2013/05/11/content-negotiation-using-spring-mvc">default content negotiation</a>
and returning what the frontend requested: a text plain version of, what looked like, JSON.</p>

<p>The quick fix was to request the content as JSON in React.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">rest</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">rest</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">mime</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">rest/interceptor/mime</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">Rest</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">rest</span><span class="p">.</span><span class="nx">wrap</span><span class="p">(</span><span class="nx">mime</span> <span class="p">,</span> <span class="p">{</span> <span class="na">mime</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span> <span class="p">}</span> <span class="p">);</span>
</code></pre></div></div>

<p>Now we will revisit the backend to return the JSON content, as content, regardless of what
the user asks :-)</p>

<p>Happy hacking!</p>
</div>
<div class="post">
  <h3 class="post-header">
    <a class="post-link" href="/2016/11/05/checking-the-operating-system-type-in-shell-script.html">
      Checking the operating system type in shell script
    </a>
  </h3><span class="post-meta">Nov 5, 201653<span>&mdash; star date: -306076.5</span></span><p>Last week I learned about a tool called <a href="https://github.com/koalaman/shellcheck">ShellCheck</a>, a tool
for static analysis of shell scripts. It reports errors like missing double quotes, use of deprecated
syntax, etc.</p>

<p>I decided to check some projects I contribute to, and the first issue I found was in
<a href="https://jena.apache.org">Apache Jena</a>:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kinow@localhost:~/Development/java/jena/jena/apache-jena/bin<span class="nv">$ </span>shellcheck arq

In arq line 8:
    <span class="k">case</span> <span class="s2">"</span><span class="nv">$OSTYPE</span><span class="s2">"</span> <span class="k">in</span>
          ^-- SC2039: In POSIX sh, OSTYPE is not supported.
</code></pre></div></div>

<p>So, in summary, the <code class="language-plaintext highlighter-rouge">OSTYPE</code> variable should not be available in POSIX shell. The case in question, where
<code class="language-plaintext highlighter-rouge">OSTYPE</code> is being used, checks for the Darwin OS type (i.e. Mac OS). Knowing how things get weird when you
use different operating systems, I decided to check and learn how <code class="language-plaintext highlighter-rouge">OSTYPE</code> works. Hereâ€™s what I found.</p>

<ul>
  <li>In Ubuntu, with /bin/bash, OSTYPE works fine (linux-gnu)</li>
  <li>In Ubuntu, with /bin/sh, OSTYPE is not set</li>
  <li>In Mac OS, with /bin/sh, OSTYPE is set (darwin15)</li>
</ul>

<p>I checked the shells to make sure they were not pointing to symbolic links - some distributions
use a different default shell, and replace /bin/bash and/or /bin/sh by a link to another
shell. Looks like Mac OS has a POSIX shell that behaves different than Ubuntuâ€™s.</p>

<p>Instead of trying to find a way to use <code class="language-plaintext highlighter-rouge">OSTYPE</code>, I decided to spend some time looking at
how other projects do the same thing. And the best example I could find was
<a href="https://git.kernel.org/cgit/git/git.git/tree/config.mak.uname">git</a>.</p>

<p>Instead of relying on <code class="language-plaintext highlighter-rouge">OSTYPE</code>, git uses <code class="language-plaintext highlighter-rouge">uname</code>.</p>

<p>I will spend some time during the next days working on a proposal to replace the <code class="language-plaintext highlighter-rouge">OSTYPE</code>
from Apache Jena scripts, but then may have to submit more changes for the other issues
found by ShellCheck.</p>

<p>Happy hacking!</p>
</div>
<div class="post">
  <h3 class="post-header">
    <a class="post-link" href="/2016/10/04/using-the-aws-api-with-python.html">
      Using the AWS API with Python
    </a>
  </h3><span class="post-meta">Oct 4, 201654<span>&mdash; star date: -306161.2</span></span><p>Amazon Web Services provides a series of cloud services. When you access the web interface, most - if not all - of the actions you do there are actually translated into API calls.</p>

<p>They also provide SDKâ€™s in several programming languages. With these SDKâ€™s you are able to call the same API used by the web interface. Python has <a href="https://github.com/boto/boto3">boto</a> (or boto3) which lets you to automate several tasks in AWS.</p>

<p>But before you start using the API, you will need to <a href="https://web.archive.org/web/20160818112016/http://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSGettingStartedGuide/AWSCredentials.html">set up your access key</a>.</p>

<p>It is likely that with time you will have different roles, and may have different permissions with each role. You have to configure your local environment so that you can either use the command line Python utility (installed via <code class="language-plaintext highlighter-rouge">pip install awscli</code>) or with boto.</p>

<p>The awscli is a dependency for using boto3. After you install it, you need to run <code class="language-plaintext highlighter-rouge">aws configure</code>. It will create the <em>~/.aws/config</em> and <em>~/.aws/credentials</em> files. You can tweak these files to support multiple roles.</p>

<p>I followed the tutorials, but got all sorts of different issues. Then after debugging some locally installed dependencies, in special awscli files, I found that the following settings work for my environment.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># File: config</span>
<span class="o">[</span>profile default]
region <span class="o">=</span> ap-southeast-2

<span class="o">[</span>profile profile1]
region <span class="o">=</span> ap-southeast-2
source_profile <span class="o">=</span> default
role_arn <span class="o">=</span> arn:aws:iam::123:role/Developer

<span class="o">[</span>profile profile2]
region <span class="o">=</span> ap-southeast-2
source_profile <span class="o">=</span> default
role_arn <span class="o">=</span> arn:aws:iam::456:role/Sysops
mfa_serial <span class="o">=</span> arn:aws:iam::789:mfa/user@domain.blabla
</code></pre></div></div>

<p>and</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># File: credentials</span>
<span class="o">[</span>default]
aws_access_key_id <span class="o">=</span> YOU_KEY_ID
aws_secret_access_key <span class="o">=</span> YOUR_SECRET
</code></pre></div></div>

<p>And once it is done you can, for example, confirm it is working with some S3 commands in Python.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">boto3</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">profile_name</span><span class="o">=</span><span class="s">'profile2'</span><span class="p">)</span>
<span class="n">s3</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s">'s3'</span><span class="p">)</span>

<span class="n">found</span> <span class="o">=</span> <span class="bp">False</span>

<span class="n">name</span> <span class="o">=</span> <span class="s">'mysuperduperbucket'</span>

<span class="k">for</span> <span class="n">bucket</span> <span class="ow">in</span> <span class="n">s3</span><span class="o">.</span><span class="n">buckets</span><span class="o">.</span><span class="nb">all</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">bucket</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">found</span> <span class="o">=</span> <span class="bp">True</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Creating bucket..."</span><span class="p">)</span>
    <span class="n">s3</span><span class="o">.</span><span class="n">create_bucket</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

<span class="n">file_location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s">'samplefile.txt'</span>
<span class="n">s3</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="n">file_location</span><span class="p">,</span> <span class="n">Bucket</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="s">'book.txt'</span><span class="p">)</span>
</code></pre></div></div>

<p>The AWS files in this example are using MFA too, the multi-factor authentication. So the first time you run this code you may be asked to generate a token, which will be cached for a short time.</p>

<p>Thatâ€™s it for today.</p>

<p>Happy hacking!</p>
</div>
<div class="post">
  <h3 class="post-header">
    <a class="post-link" href="/2016/10/02/best-place-to-find-science-fiction-books-in-new-zealand.html">
      Best place to find science fiction books in New Zealand
    </a>
  </h3><span class="post-meta">Oct 2, 201655<span>&mdash; star date: -306166.67</span></span><p>Since I moved to New Zealand it has been hard to find good science fiction sections in the local book stores. I really miss the Livraria Cultura at Avenida Paulista, or the Saraiva Megastores. Whitcoulls and Paper Plus do a good job, but they have very few series, only recent releases, and you do not feel that cool environment while you browse the books.</p>

<p>I found that small secondhand bookstores are the best places to find good books - not only science fiction - in New Zealand. Devonport has one, near the waterfront. Auckland has Jason books too, right in the CBD. Wellington, Dunedin and Queenstown too (the Queenstown one is on the second level in a small mall, you have to check it out!).</p>

<p>But last week I remembered my wife telling me about this web site, <a href="https://www.hardtofind.co.nz/">https://www.hardtofind.co.nz/</a>. I found several books from <a href="http://kinoshita.eti.br/books/#my-wish-list">my Wish List</a> there, and also other Stephen King books recommended by the bookstore clerk from Queenstown.</p>

<p><img class="ui centered image" src="/assets/posts/2016-10-02-best-place-to-find-science-fiction-books-in-new-zealand/books-hard-to-find-store.jpg" alt="Books from Hard To Find bookstore" /></p>

<p>If you are into science fiction, Asimov, Neal Stephenson, Peter H. Hamilton, Piers Anthony, Arthur C. Clarke, Stephen King, etc, I am sure you will enjoy going to the Hard To Find store in Onehunga. It is near the Dress Smart. So during week if you stop by Dress Smart, you can hop on their free bus from the city centre and later enjoy checking out the store too.</p>

<p>It is a two story house, with lots of rooms, with science fiction, New Zealand, maritime sports, arts, poetry, health, etc.</p>

<p>Happy reading!</p>
</div>
<!-- Pagination links -->
  <div class="pagination">
    <p>
      
      <a href="/blog/page/14/" class="icon item">
        <i class="left chevron icon"></i>Previous
      </a>
      
      <span class="page_number ">Page: 15 of 31</span>
      
      <a href="/blog/page/16/" class="next">
        Next<i class="right chevron icon"></i>
      </a>
      
    </p>
  </div></div>

  </div>
</div>
</body>
</html>
