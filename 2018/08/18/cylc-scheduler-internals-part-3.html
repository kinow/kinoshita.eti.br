<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Cylc Scheduler Internals - Part 3 | Bruno P. Kinoshita</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Cylc Scheduler Internals - Part 3" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This is the part 3, in a series of posts about Cylc internals. The part 1 had the beginning of the workflow. part 2 documented from the moment the method configure() is called. This post will continue right after the continue() method returns, going on with the next method: run()." />
<meta property="og:description" content="This is the part 3, in a series of posts about Cylc internals. The part 1 had the beginning of the workflow. part 2 documented from the moment the method configure() is called. This post will continue right after the continue() method returns, going on with the next method: run()." />
<link rel="canonical" href="https://kinoshita.eti.br/2018/08/18/cylc-scheduler-internals-part-3.html" />
<meta property="og:url" content="https://kinoshita.eti.br/2018/08/18/cylc-scheduler-internals-part-3.html" />
<meta property="og:site_name" content="Bruno P. Kinoshita" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-08-18T00:00:00+12:00" />
<script type="application/ld+json">
{"description":"This is the part 3, in a series of posts about Cylc internals. The part 1 had the beginning of the workflow. part 2 documented from the moment the method configure() is called. This post will continue right after the continue() method returns, going on with the next method: run().","@type":"BlogPosting","url":"https://kinoshita.eti.br/2018/08/18/cylc-scheduler-internals-part-3.html","headline":"Cylc Scheduler Internals - Part 3","dateModified":"2018-08-18T00:00:00+12:00","datePublished":"2018-08-18T00:00:00+12:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://kinoshita.eti.br/2018/08/18/cylc-scheduler-internals-part-3.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/main.css"><link type="application/atom+xml" rel="alternate" href="https://kinoshita.eti.br/feed.xml" title="Bruno P. Kinoshita" /><link href="https://unpkg.com/pattern.css" rel="stylesheet">

</head>
<body>
<div id="mobile-menu"><div class="menu">
  <ul class="menu">
    <li class="item">
      <h1 id="kinow">KINOW</h1>
    </li>
    <li class="item">
      <a href="/" class="">About</a>
    </li>
    <li class="item">
      <a href="/blog/" class="current">Blog</a>
    </li>
    <li class="item">
      <a href="/portfolio/" class="">Portfolio</a>
    </li>
    <li class="item social-media-item">
      <a href="https://www.instagram.com/brunokinoshita/" class="inline-link">
        <img src="/assets/icons/instagram.png" class="inverted-image" />
      </a>
      <a href="https://twitter.com/kinow/" class="inline-link">
        <img src="/assets/icons/twitter.png" class="inverted-image" />
      </a>
      <a href="https://github.com/kinow/" class="inline-link">
        <img src="/assets/icons/github.png" class="inverted-image" />
      </a>
    </li>
  </ul>
</div>
</div>
<div id="wrapper">
  <div id="sidebar"><div class="menu">
  <ul class="menu">
    <li class="item">
      <h1 id="kinow">KINOW</h1>
    </li>
    <li class="item">
      <a href="/" class="">About</a>
    </li>
    <li class="item">
      <a href="/blog/" class="current">Blog</a>
    </li>
    <li class="item">
      <a href="/portfolio/" class="">Portfolio</a>
    </li>
    <li class="item social-media-item">
      <a href="https://www.instagram.com/brunokinoshita/" class="inline-link">
        <img src="/assets/icons/instagram.png" class="inverted-image" />
      </a>
      <a href="https://twitter.com/kinow/" class="inline-link">
        <img src="/assets/icons/twitter.png" class="inverted-image" />
      </a>
      <a href="https://github.com/kinow/" class="inline-link">
        <img src="/assets/icons/github.png" class="inverted-image" />
      </a>
    </li>
  </ul>
</div>
</div>
  <div id="content">
    <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Cylc Scheduler Internals - Part 3</h1><div class="note"><p>NB: this is a post to remember things, not really expecting to give someone enough information to be able to hack the Cylc Scheduler (though you can and would have fun!).</p>
</div>
    <span class="post-meta">
      <time class="dt-published" datetime="2018-08-18T00:00:00+12:00" itemprop="datePublished">Aug 18, 2018
      </time>
      <span>&mdash; star date: -304287.67.</span>
      <span>
        Number of words: 244.
      </span></span>
  </header>

  


  <div class="post-content e-content" itemprop="articleBody">
    <p>This is the part 3, in a series of posts about <a href="https://cylc.github.io/cylc">Cylc</a>
internals. The <a href="/2018/07/14/cylc-scheduler-internals-part-1.html">part 1</a>
had the beginning of the workflow. <a href="/2018/07/27/cylc-scheduler-internals-part-2.html">part 2</a>
documented from the moment the method <code class="language-plaintext highlighter-rouge">configure()</code> is called. This post will
continue right after the <code class="language-plaintext highlighter-rouge">continue()</code> method returns, going on with the next method: <code class="language-plaintext highlighter-rouge">run()</code>.</p>

<p style="text-align: center;">
<a href="/assets/posts/2018-08-18-cylc-scheduler-internals-part-3/cylc-scheduler_run.png">
<img style="display: inline; width: 100%;" class="ui image" src="/assets/posts/2018-08-18-cylc-scheduler-internals-part-3/cylc-scheduler_run.png" />
</a>
</p>

<!--more-->

<p>At this point, the Suite Server program must have been initialized, with the
objects that it requires, and with everything configured. So this method is the one
that starts the whole work on the tasks &amp; proxies.</p>

<p>The runahead points, i.e. what are the next available cycle points, are calculated
and scheduled. In the scheduling, tasks are queued for execution.</p>

<p>Most of the interesting action takes place when <code class="language-plaintext highlighter-rouge">process_task_pool()</code> is called,
and in the <code class="language-plaintext highlighter-rouge">submit_task_jobs()</code>. The latter is a method from <code class="language-plaintext highlighter-rouge">TaskJobManager</code>, and
it is here where - in this case - my shell command is executed through a temporary
shell script file.</p>

<p>The graph was created from the initial execution of a suite that was starting from
scratch (they can also be reinitialized). If there are multiple tasks waiting,
or if a suite was restarted, the diagram would look considerably different.</p>

<p>You can download the
<a href="/assets/posts/2018-08-18-cylc-scheduler-internals-part-3/cylc-scheduler_run-src.xml">source file</a>
for the diagram used in this post, and edit it with <a href="https://draw.io">draw.io</a>.</p>

  </div>

  <div class="tags">
    <p>
      Published Aug 18, 2018 in &ldquo;blog&rdquo; and tagged&nbsp;<a class="label" href="/tags#cylc">cylc</a>,&nbsp;<a class="label" href="/tags#python">python</a>,&nbsp;<a class="label" href="/tags#opensource">opensource</a>. Number of words: 244.
    </p>
  </div>

  <a class="u-url" href="/2018/08/18/cylc-scheduler-internals-part-3.html" hidden></a>
</article>

  </div>
</div>
</body>
</html>
