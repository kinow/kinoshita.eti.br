<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:url" content="https://kinoshita.eti.br/2018/08/04/creating-a-docker-container-to-run-as-a-command.html"><meta property="og:site_name" content="kinow"><meta property="og:title" content="Creating a Docker container to run as a command"><meta property="og:description" content="For the past two weeks at work I have been assigned to work on PHP projects. Though I used PHP some time ago - especially with Code Igniter and Laravel - I have not used it in a few years. And have been doing mostly Java nowadays.
The complete project setup was done by co-workers. I had a PHP project, using Symfony, several bundles and libraries, and Postgres. But it required just running a few commands to set up AWS settings, and then fire up Docker Compose.
"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-08-04T00:00:00+00:00"><meta property="article:modified_time" content="2024-05-11T09:47:07+02:00"><meta property="article:tag" content="Cylc"><meta property="article:tag" content="Docker"><meta property="article:tag" content="Opensource"><meta property="article:tag" content="Workflows"><meta property="article:tag" content="Python"><meta property="og:image" content="https://kinoshita.eti.br/assets/photos/about/2023-me-closeup.png"><meta property="fb:admins" content="bruno.kinoshita"><meta name=twitter:title content="Creating a Docker container to run as a command"><meta name=twitter:description content="For the past two weeks at work I have been assigned to work on PHP projects. Though I used
PHP some time ago - especially with Code Igniter and Laravel - I have not used it in a few
years. And have been doing mostly Java nowadays.
The complete project setup was done by co-workers. I had a PHP project, using Symfony, several
bundles and libraries, and Postgres. But it required just running a few commands to set up
AWS settings, and then fire up Docker Compose."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kinoshita.eti.br/assets/photos/about/2023-me-closeup.png"><meta name=twitter:site content="@kinow"><link rel=alternate type=application/rss+xml href=https://kinoshita.eti.br/2018/08/04/creating-a-docker-container-to-run-as-a-command/feed.xml title=kinow><link rel=stylesheet type=text/css href=https://kinoshita.eti.br/sass/main.c3626db3678f53e4a53e3e75c7b2fe34bb46566f00eb84692501404d0064c32a.css integrity="sha256-w2Jts2ePU+SlPj51x7L+NLtGVm8A64RpJQFATQBkwyo="><title>kinow | Creating a Docker container to run as a command</title><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"posts","name":"Creating a Docker container to run as a command","headline":"Creating a Docker container to run as a command","alternativeHeadline":"","description":"\u003cp\u003eFor the past two weeks at work I have been assigned to work on PHP projects. Though I used\nPHP some time ago - especially with Code Igniter and Laravel - I have not used it in a few\nyears. And have been doing mostly Java nowadays.\u003c\/p\u003e\n\u003cp\u003eThe complete project setup was done by co-workers. I had a PHP project, using Symfony, several\nbundles and libraries, and Postgres. But it required just running a few commands to set up\nAWS settings, and then fire up Docker Compose.\u003c\/p\u003e","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/kinoshita.eti.br\/2018\/08\/04\/creating-a-docker-container-to-run-as-a-command.html"},"author":{"@type":"Person","name":"Bruno P. Kinoshita"},"creator":{"@type":"Person","name":"Bruno P. Kinoshita"},"accountablePerson":{"@type":"Person","name":"Bruno P. Kinoshita"},"copyrightHolder":"kinow","copyrightYear":"2018","dateCreated":"2018-08-04T00:00:00.00Z","datePublished":"2018-08-04T00:00:00.00Z","dateModified":"2024-05-11T09:47:07.00Z","publisher":{"@type":"Organization","name":"kinow","url":"https://kinoshita.eti.br/","logo":{"@type":"ImageObject","url":"https:\/\/kinoshita.eti.br\/","width":"32","height":"32"}},"image":"https://kinoshita.eti.br/","url":"https:\/\/kinoshita.eti.br\/2018\/08\/04\/creating-a-docker-container-to-run-as-a-command.html","wordCount":"721","genre":["cylc","docker","opensource","workflows","python"],"keywords":[]}</script></head><body><header role=banner class=content><nav id=nav aria-label=Main role=navigation class=content><ul><li><a href=/><i data-feather=about></i> About</a></li><li><a href=/blog/><i data-feather=blog></i> Blog</a></li><li><a href=/portfolio/><i data-feather=portfolio></i> Portfolio</a></li></ul></nav></header><main><article class=content><h1>Creating a Docker container to run as a command</h1><div class=metadata><i data-feather=calendar></i>
<time datetime=2018-08-04>Aug 4, 2018</time></div><aside><nav id=TableOfContents></nav></aside><p>For the past two weeks at work I have been assigned to work on PHP projects. Though I used
PHP some time ago - especially with Code Igniter and Laravel - I have not used it in a few
years. And have been doing mostly Java nowadays.</p><p>The complete project setup was done by co-workers. I had a PHP project, using Symfony, several
bundles and libraries, and Postgres. But it required just running a few commands to set up
AWS settings, and then fire up Docker Compose.</p><p>Besides Docker Compose starting a web container, and another Postgres container, we used the
web container to run <a href=https://getcomposer.org/>Composer</a>. In the past, I would see the PHP
project mapped as a folder in the running container, and then composer would be executed
in the host.</p><p>I noticed then that I could do the same to an image I created in 2016 to run
<a href=https://cylc.github.io/cylc/>Cylc</a>. The <a href=https://github.com/kinow/docker/blob/d1cc1771ac53b8efd37b5e4c4401b74ebd294a2b/cylc/Dockerfile>previous version</a>
would be used to start a container in a terminal, then run some commands
while maintaining the state within the container.</p><p>The <a href=https://github.com/kinow/cylc-docker>new version</a>
now maps a volume to the version of cylc, installs the dependencies, and
then allows the state to be maintained solely in the mapped volume.</p><p>Furthermore, the entrypoint of the image is the <code>cylc</code> command. Which means that
you do not have to execute a terminal in order to run commands to the container
(or change the command/entrypoint).</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>...
</span></span><span style=display:flex><span>VOLUME <span style=color:#c41a16>&#34;/opt/cylc&#34;</span> <span style=color:#c41a16>&#34;/tmp&#34;</span> <span style=color:#c41a16>&#34;/run&#34;</span> <span style=color:#c41a16>&#34;/var/run&#34;</span> <span style=color:#177500># we have the state stored only in /opt/cylc</span>
</span></span><span style=display:flex><span>WORKDIR <span style=color:#c41a16>&#34;/opt/cylc&#34;</span>
</span></span><span style=display:flex><span>ENV PATH /opt/cylc/bin:<span style=color:#000>$PATH</span>
</span></span><span style=display:flex><span>WORKDIR /opt/cylc
</span></span><span style=display:flex><span>ENTRYPOINT <span style=color:#000>[</span><span style=color:#c41a16>&#34;cylc&#34;</span><span style=color:#000>]</span> <span style=color:#177500># here&#39;s the trick!</span>
</span></span></code></pre></div><p>It uses the same approach from the PHP image I am using for Composer, with a few
additional improvements from the <a href=https://docs.docker.com/develop/develop-images/dockerfile_best-practices/>Best practices for writing Dockerfiles</a> documentation.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ docker run -ti -v <span style=color:#c41a16>&#34;</span><span style=color:#a90d91>$(</span><span style=color:#a90d91>pwd</span> -P<span style=color:#a90d91>)</span><span style=color:#c41a16>&#34;</span>/cylc:/opt/cylc cylc validate /opt/cylc/etc/examples/tutorial/oneoff/basic/
</span></span><span style=display:flex><span>Valid <span style=color:#a90d91>for</span> cylc-7.7.2
</span></span><span style=display:flex><span>$ docker run -ti -v <span style=color:#c41a16>&#34;</span><span style=color:#a90d91>$(</span><span style=color:#a90d91>pwd</span> -P<span style=color:#a90d91>)</span><span style=color:#c41a16>&#34;</span>/cylc:/opt/cylc cylc register /opt/cylc/etc/examples/tutorial/oneoff/basic/
</span></span><span style=display:flex><span>REGISTER /opt/cylc/etc/examples/tutorial/oneoff/basic/
</span></span><span style=display:flex><span>$ docker run -ti -v <span style=color:#c41a16>&#34;</span><span style=color:#a90d91>$(</span><span style=color:#a90d91>pwd</span> -P<span style=color:#a90d91>)</span><span style=color:#c41a16>&#34;</span>/cylc:/opt/cylc cylc start --non-daemon --debug /opt/cylc/etc/examples/tutorial/oneoff/basic/
</span></span><span style=display:flex><span>            ._.                                                       
</span></span><span style=display:flex><span>            | |                 The Cylc Suite Engine <span style=color:#000>[</span>7.7.2<span style=color:#000>]</span>         
</span></span><span style=display:flex><span>._____._. ._| |_____.           Copyright <span style=color:#000>(</span>C<span style=color:#000>)</span> 2008-2018 NIWA          
</span></span><span style=display:flex><span>| .___| | | | | .___|  _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
</span></span><span style=display:flex><span>| !___| !_! | | !___.  This program comes with ABSOLUTELY NO WARRANTY;
</span></span><span style=display:flex><span>!_____!___. |_!_____!  see <span style=color:#c41a16>`</span>cylc warranty<span style=color:#c41a16>`</span>.  It is free software, you 
</span></span><span style=display:flex><span>      .___! |           are welcome to redistribute it under certain  
</span></span><span style=display:flex><span>      !_____!                conditions; see <span style=color:#c41a16>`</span>cylc conditions<span style=color:#c41a16>`</span>.       
</span></span><span style=display:flex><span>2018-07-30T12:10:32Z INFO - Suite starting: <span style=color:#000>server</span><span style=color:#000>=</span>3714d1a17999:43040 <span style=color:#000>pid</span><span style=color:#000>=</span><span style=color:#1c01ce>1</span>
</span></span><span style=display:flex><span>2018-07-30T12:10:32Z INFO - Cylc version: 7.7.2
</span></span><span style=display:flex><span>2018-07-30T12:10:32Z INFO - Run mode: live
</span></span><span style=display:flex><span>2018-07-30T12:10:32Z INFO - Initial point: <span style=color:#1c01ce>1</span>
</span></span><span style=display:flex><span>2018-07-30T12:10:32Z INFO - Final point: <span style=color:#1c01ce>1</span>
</span></span><span style=display:flex><span>2018-07-30T12:10:32Z INFO - Cold Start <span style=color:#1c01ce>1</span>
</span></span><span style=display:flex><span>2018-07-30T12:10:32Z DEBUG - <span style=color:#000>[</span>hello.1<span style=color:#000>]</span> -released to the task pool
</span></span><span style=display:flex><span>2018-07-30T12:10:32Z DEBUG - BEGIN TASK PROCESSING
</span></span><span style=display:flex><span>2018-07-30T12:10:32Z DEBUG - <span style=color:#000>[</span>hello.1<span style=color:#000>]</span> -waiting <span style=color:#000>=</span>&gt; queued
</span></span><span style=display:flex><span>2018-07-30T12:10:32Z DEBUG - <span style=color:#1c01ce>1</span> task<span style=color:#000>(</span>s<span style=color:#000>)</span> de-queued
</span></span><span style=display:flex><span>2018-07-30T12:10:32Z INFO - <span style=color:#000>[</span>hello.1<span style=color:#000>]</span> -submit-num<span style=color:#000>=</span>1, owner@host<span style=color:#000>=</span>localhost
</span></span><span style=display:flex><span>2018-07-30T12:10:32Z DEBUG - <span style=color:#000>[</span>hello.1<span style=color:#000>]</span> -queued <span style=color:#000>=</span>&gt; ready
</span></span><span style=display:flex><span>2018-07-30T12:10:32Z DEBUG - END TASK PROCESSING <span style=color:#000>(</span>took 0.00642895698547 seconds<span style=color:#000>)</span>
</span></span><span style=display:flex><span>2018-07-30T12:10:32Z DEBUG - <span style=color:#000>[</span><span style=color:#c41a16>&#39;cylc&#39;</span>, <span style=color:#c41a16>&#39;jobs-submit&#39;</span>, <span style=color:#c41a16>&#39;--debug&#39;</span>, <span style=color:#c41a16>&#39;--&#39;</span>, <span style=color:#c41a16>&#39;/opt/cylc/etc/examples/tutorial/oneoff/basic/log/job&#39;</span>, <span style=color:#c41a16>&#39;1/hello/01&#39;</span><span style=color:#000>]</span>
</span></span><span style=display:flex><span>2018-07-30T12:10:33Z DEBUG - <span style=color:#000>[</span>client-connect<span style=color:#000>]</span> root@3714d1a17999:cylc-message <span style=color:#000>privilege</span><span style=color:#000>=</span><span style=color:#c41a16>&#39;full-control&#39;</span> 7b05596a-5971-4733-82de-28528f702ff0
</span></span><span style=display:flex><span>2018-07-30T12:10:33Z INFO - <span style=color:#000>[</span>client-command<span style=color:#000>]</span> put_messages root@3714d1a17999:cylc-message 7b05596a-5971-4733-82de-28528f702ff0
</span></span><span style=display:flex><span>2018-07-30T12:10:33Z DEBUG - <span style=color:#000>[</span>jobs-submit cmd<span style=color:#000>]</span> cylc jobs-submit --debug -- /opt/cylc/etc/examples/tutorial/oneoff/basic/log/job 1/hello/01
</span></span><span style=display:flex><span>	<span style=color:#000>[</span>jobs-submit ret_code<span style=color:#000>]</span> <span style=color:#1c01ce>0</span>
</span></span><span style=display:flex><span>	<span style=color:#000>[</span>jobs-submit out<span style=color:#000>]</span>
</span></span><span style=display:flex><span>	<span style=color:#000>[</span>TASK JOB SUMMARY<span style=color:#000>]</span>2018-07-30T12:10:32Z|1/hello/01|0|<span style=color:#1c01ce>61</span>
</span></span><span style=display:flex><span>	<span style=color:#000>[</span>TASK JOB COMMAND<span style=color:#000>]</span>2018-07-30T12:10:32Z|1/hello/01|<span style=color:#000>[</span>STDOUT<span style=color:#000>]</span> <span style=color:#1c01ce>61</span>
</span></span><span style=display:flex><span>2018-07-30T12:10:33Z INFO - <span style=color:#000>[</span>hello.1<span style=color:#000>]</span> -<span style=color:#000>(</span>current:ready<span style=color:#000>)</span> submitted at 2018-07-30T12:10:32Z
</span></span><span style=display:flex><span>2018-07-30T12:10:33Z INFO - <span style=color:#000>[</span>hello.1<span style=color:#000>]</span> -job<span style=color:#000>[</span>01<span style=color:#000>]</span> submitted to localhost:background<span style=color:#000>[</span>61<span style=color:#000>]</span>
</span></span><span style=display:flex><span>2018-07-30T12:10:33Z DEBUG - <span style=color:#000>[</span>hello.1<span style=color:#000>]</span> -ready <span style=color:#000>=</span>&gt; submitted
</span></span><span style=display:flex><span>2018-07-30T12:10:33Z INFO - <span style=color:#000>[</span>hello.1<span style=color:#000>]</span> -health check settings: submission <span style=color:#000>timeout</span><span style=color:#000>=</span>None
</span></span><span style=display:flex><span>2018-07-30T12:10:33Z DEBUG - BEGIN TASK PROCESSING
</span></span><span style=display:flex><span>2018-07-30T12:10:33Z DEBUG - <span style=color:#1c01ce>0</span> task<span style=color:#000>(</span>s<span style=color:#000>)</span> de-queued
</span></span><span style=display:flex><span>2018-07-30T12:10:33Z DEBUG - <span style=color:#000>[</span>hello.1<span style=color:#000>]</span> -forced spawning
</span></span><span style=display:flex><span>2018-07-30T12:10:33Z DEBUG - END TASK PROCESSING <span style=color:#000>(</span>took 0.000992059707642 seconds<span style=color:#000>)</span>
</span></span><span style=display:flex><span>2018-07-30T12:10:33Z INFO - <span style=color:#000>[</span>hello.1<span style=color:#000>]</span> -<span style=color:#000>(</span>current:submitted<span style=color:#000>)</span>&gt; started at 2018-07-30T12:10:33Z
</span></span><span style=display:flex><span>2018-07-30T12:10:33Z DEBUG - <span style=color:#000>[</span>hello.1<span style=color:#000>]</span> -submitted <span style=color:#000>=</span>&gt; running
</span></span><span style=display:flex><span>2018-07-30T12:10:33Z INFO - <span style=color:#000>[</span>hello.1<span style=color:#000>]</span> -health check settings: execution <span style=color:#000>timeout</span><span style=color:#000>=</span>None
</span></span><span style=display:flex><span>2018-07-30T12:10:34Z DEBUG - BEGIN TASK PROCESSING
</span></span><span style=display:flex><span>2018-07-30T12:10:34Z DEBUG - <span style=color:#1c01ce>0</span> task<span style=color:#000>(</span>s<span style=color:#000>)</span> de-queued
</span></span><span style=display:flex><span>2018-07-30T12:10:34Z DEBUG - END TASK PROCESSING <span style=color:#000>(</span>took 0.000984191894531 seconds<span style=color:#000>)</span>
</span></span><span style=display:flex><span>2018-07-30T12:10:43Z DEBUG - <span style=color:#000>[</span>client-connect<span style=color:#000>]</span> root@3714d1a17999:cylc-message <span style=color:#000>privilege</span><span style=color:#000>=</span><span style=color:#c41a16>&#39;full-control&#39;</span> 524d658e-9932-4135-9523-3c2ace3990cf
</span></span><span style=display:flex><span>2018-07-30T12:10:43Z INFO - <span style=color:#000>[</span>client-command<span style=color:#000>]</span> put_messages root@3714d1a17999:cylc-message 524d658e-9932-4135-9523-3c2ace3990cf
</span></span><span style=display:flex><span>2018-07-30T12:10:43Z INFO - <span style=color:#000>[</span>hello.1<span style=color:#000>]</span> -<span style=color:#000>(</span>current:running<span style=color:#000>)</span>&gt; succeeded at 2018-07-30T12:10:43Z
</span></span><span style=display:flex><span>2018-07-30T12:10:43Z DEBUG - <span style=color:#000>[</span>hello.1<span style=color:#000>]</span> -running <span style=color:#000>=</span>&gt; succeeded
</span></span><span style=display:flex><span>2018-07-30T12:10:43Z INFO - Suite shutting down - AUTOMATIC
</span></span><span style=display:flex><span>2018-07-30T12:10:44Z INFO - DONE
</span></span><span style=display:flex><span>$
</span></span></code></pre></div><p>If you have a utility in your computer that requires a few dependencies, but that
can store the state/data in a mapped volume, the same kind of container may be
useful.</p><p>Categories:
<a href=/categories/blog.html>Blog</a></p><p>Tags:
<a href=/tags/cylc.html>Cylc</a>,
<a href=/tags/docker.html>Docker</a>,
<a href=/tags/opensource.html>Opensource</a>,
<a href=/tags/workflows.html>Workflows</a>,
<a href=/tags/python.html>Python</a></p><aside class=links><a class=previous href=https://kinoshita.eti.br/2018/07/27/cylc-scheduler-internals-part-2.html>&#171; Previous</a><a class=next href=https://kinoshita.eti.br/2018/08/11/uuids-in-apache-jena.html>Next &#187;</a></aside></article></main><footer role=contentinfo><ul id=social-media-icons><li><a href=https://www.instagram.com/brunokinoshita/><img src=/assets/icons/instagram.png alt="Instagram link"></a></li><li><a href=https://twitter.com/kinow/><img src=/assets/icons/twitter.png alt="Twitter link"></a></li><li><a href=https://github.com/kinow/><img src=/assets/icons/github.png alt="GitHub link"></a></li><li><a href=/feed.xml><img src=/assets/icons/news.png alt="RSS feed link"></a></li></ul></footer></body></html>