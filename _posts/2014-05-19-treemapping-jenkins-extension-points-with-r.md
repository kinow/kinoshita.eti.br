---
title: 'Treemapping Jenkins Extension Points with R'
author: kinow
tags:
    - jenkins
    - r
category: 'blog'
time: '00:51:33'
---

I have been playing with R and its packages for some time, and decided to study it a 
bit harder. Last week I started reading the [Advanced R Programming](http://adv-r.had.co.nz/) 
by Hadley Wickham. 

One of the first chapters talks about the basic data structures in R. In order to 
get my feet wet I thought about a simple example: [treemapping](http://en.wikipedia.org/wiki/Treemapping) 
Jenkins extension points. 

<p style="text-align: center;"><a href="{{assets.extension_points}}"><img src="{{assets.extension_points}}" width="600px" alt="Treemap graph" /></a></p>

There is a [Wiki page with the extension points in Jenkins](https://wiki.jenkins-ci.org/display/JENKINS/Extension+points) (what parts of Jenkins can be customized) 
and its implementations. That page is generated by a [Jenkins job](https://ci.jenkins-ci.org/view/Infrastructure/job/infra_extension-indexer/). 

That job outputs a JSON file that contains each available extension points, as well as 
an array with its implementations. The R code below will produce two vectors, one with the 
count of implementations of each extension point, and the other with the class name.

{% geshi 'r' %}
nExtensionPoints <- length(extensionPointsJson$extensionPoints)
numberOfImplementations <- vector(length = nExtensionPoints)
namesOfTheExtensionPoints <- vector(length = nExtensionPoints)
for (i in seq_along(extensionPoints)) {
  extensionName = extensionPoints[[i]]$className
  lastIndexOfDot = regexpr("\\.[^\\.]*$", extensionName)
  namesOfTheExtensionPoints[[i]] = substr(extensionName, lastIndexOfDot[1]+1, nchar(extensionName))
  numberOfImplementations[[i]] = length(extensionPoints[[i]]$implementations)
  print(paste(namesOfTheExtensionPoints[[i]], " -> ", numberOfImplementations[[i]]))
}
{% endgeshi %}

For creating the treemap I used the **[portfolio package](http://flowingdata.com/2010/02/11/an-easy-way-to-make-a-treemap/)**, and the <code>map.market</code> 
function. The structures previously created and the next snippet of code are all that is 
needed to create the treemap of the Jenkins extension points.

{% geshi 'r' %}
map.market(id=seq_along(extensionPoints), area=numberOfImplementations, group=namesOfTheExtensionPoints, color=numberOfImplementations, main="Jenkins Extension Points")
{% endgeshi %}

You can also use the [Jenkins R Plug-in](https://wiki.jenkins-ci.org/display/JENKINS/R+Plugin) to produce this graph, 
as in this [sample job](http://builds.tupilabs.com/job/backend-extension-points-treemap/2/). 
You can get the complete script in this [gist](https://gist.github.com/kinow/d5a2221c32dce3aa1076), or just 
copy it here.

{% geshi 'r' %}
library('rjson')
library('portfolio')
 
download.file(url="https://ci.jenkins-ci.org/view/Infrastructure/job/infra_extension-indexer/ws/extension-points.json", destfile="extension-points.json", method="wget")
extensionPointsJson <- fromJSON(paste(readLines("extension-points.json"), collapse=""))
extensionPoints <- extensionPointsJson$extensionPoints
nExtensionPoints <- length(extensionPointsJson$extensionPoints)
numberOfImplementations <- vector(length = nExtensionPoints)
namesOfTheExtensionPoints <- vector(length = nExtensionPoints)
for (i in seq_along(extensionPoints)) {
  extensionName = extensionPoints[[i]]$className
  lastIndexOfDot = regexpr("\\.[^\\.]*$", extensionName)
  namesOfTheExtensionPoints[[i]] = substr(extensionName, lastIndexOfDot[1]+1, nchar(extensionName))
  numberOfImplementations[[i]] = length(extensionPoints[[i]]$implementations)
  print(paste(namesOfTheExtensionPoints[[i]], " -> ", numberOfImplementations[[i]]))
}
png(filename="extension-points.png", width=2048, height=1536, units="px", bg="white")
map.market(id=seq_along(extensionPoints), area=numberOfImplementations, group=namesOfTheExtensionPoints, color=numberOfImplementations, main="Jenkins Extension Points")
dev.off()
{% endgeshi %}