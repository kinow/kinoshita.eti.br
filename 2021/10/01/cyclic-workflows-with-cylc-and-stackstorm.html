<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" /><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Cyclic Workflows with Cylc and StackStorm | kinow</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Cyclic Workflows with Cylc and StackStorm" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I am aware of only two workflow managers that support cyclic workflows. Cylc and StackStorm. I won’t enter into details about these two tools, but I must note that I worked on Cylc during my employment with NIWA, in New Zealand. In this post I will only show a very simple workflow called five first using Cylc, and then the same workflow with StackStorm. Cylc First let’s take a look at the source code of this workflow with Cylc 8 and plot it. [scheduling] cycling mode = integer initial cycle point = 1 [[queues]] [[[default]]] limit = 1 [[graph]] R1 = &quot;prep =&gt; foo&quot; P1 = &quot;foo[-P1] =&gt; foo =&gt; bar&quot; [runtime] [[root]] script=&quot;sleep 5&quot; [[prep]] [[foo]] [[bar]] The part &quot;foo[-P1] =&gt; foo =&gt; bar&quot; is where the recursion occurs, creating a cycle in the workflow. Installing Cylc requires just pip install cylc-flow. After that, with the workflow installed, we are ready to run it. cylc install -c ~/cylc-src/five --flow-name five cylc play --no-detach five/run1 The workflow will run forever, incrementing the cycle points, and triggering the tasks in the five workflow source. So you will have foo.1 (foo in the first cycle point), that triggers both bar.1 and also foo.2 (foo in the second cycle point) and so it goes. StackStorm StackStorm requires more work to get everything up and running. Luckily they provide a Docker Compose installation. So after the servers have been started with Docker we are ready to create a “pack” (a neat way to organize separate installation files). mkdir -p /opt/stackstorm/packs/kinow/ touch /opt/stackstorm/packs/kinow/pack.yaml --- name : kinow description: kinow version: 1.0.0 author: kinow email: kinow@localhost And install the new pack. st2 pack install file:///opt/stackstorm/packs/kinow Now we create a new workflow and an action to run the workflow — I think this step is optional, and you could have just an action but I was following one section of the docs that had it this way. mkdir -p /opt/stackstorm/packs/kinow/actions/workflows touch /opt/stackstorm/packs/kinow/actions/five.yaml touch /opt/stackstorm/packs/kinow/actions/workflows/five.yaml --- name: five pack: kinow description: five runner_type: orquesta entry_point: workflows/five.yaml enabled: true And now create the action in StackStorm, so we can run it via command line or with the UI. st2 action create /opt/stackstorm/packs/kinow/actions/five.yaml And here’s the five workflow source for StackStorm, producing something very similar (if no identical) to the graph produced by Cylc 8. version: 1.0 description: five tasks: prep: action: core.local cmd=&quot;sleep 5&quot; next: - when: &lt;% succeeded() %&gt; do: - foo foo: action: core.local cmd=&quot;sleep 5&quot; next: - when: &lt;% succeeded() %&gt; do: - foo - bar bar: action: core.local cmd=&quot;sleep 5&quot; Note that foo is calling itself, creating a cycle in the workflow. And to run the workflow: st2 run kinow.five The StackStorm UI does not appear to support showing the graph of the workflow static or dynamically. But there is a community contributed UI called rehearsal that plots an Orquesta workflow given its source. Final notes Both Cylc and StackStorm support Directed Cyclic Graphs in workflows, which is really rare amongst workflow managers (or workflow standards, as I think WDL/CWL also do not support cyclic workflows yet.) There are many pros and cons for each tool but that will have to be for a future post. To finish this post here’s a screenshot of the StackStorm UI, followed by one of the Cylc 8 UI. Both showing the workflow five." />
<meta property="og:description" content="I am aware of only two workflow managers that support cyclic workflows. Cylc and StackStorm. I won’t enter into details about these two tools, but I must note that I worked on Cylc during my employment with NIWA, in New Zealand. In this post I will only show a very simple workflow called five first using Cylc, and then the same workflow with StackStorm. Cylc First let’s take a look at the source code of this workflow with Cylc 8 and plot it. [scheduling] cycling mode = integer initial cycle point = 1 [[queues]] [[[default]]] limit = 1 [[graph]] R1 = &quot;prep =&gt; foo&quot; P1 = &quot;foo[-P1] =&gt; foo =&gt; bar&quot; [runtime] [[root]] script=&quot;sleep 5&quot; [[prep]] [[foo]] [[bar]] The part &quot;foo[-P1] =&gt; foo =&gt; bar&quot; is where the recursion occurs, creating a cycle in the workflow. Installing Cylc requires just pip install cylc-flow. After that, with the workflow installed, we are ready to run it. cylc install -c ~/cylc-src/five --flow-name five cylc play --no-detach five/run1 The workflow will run forever, incrementing the cycle points, and triggering the tasks in the five workflow source. So you will have foo.1 (foo in the first cycle point), that triggers both bar.1 and also foo.2 (foo in the second cycle point) and so it goes. StackStorm StackStorm requires more work to get everything up and running. Luckily they provide a Docker Compose installation. So after the servers have been started with Docker we are ready to create a “pack” (a neat way to organize separate installation files). mkdir -p /opt/stackstorm/packs/kinow/ touch /opt/stackstorm/packs/kinow/pack.yaml --- name : kinow description: kinow version: 1.0.0 author: kinow email: kinow@localhost And install the new pack. st2 pack install file:///opt/stackstorm/packs/kinow Now we create a new workflow and an action to run the workflow — I think this step is optional, and you could have just an action but I was following one section of the docs that had it this way. mkdir -p /opt/stackstorm/packs/kinow/actions/workflows touch /opt/stackstorm/packs/kinow/actions/five.yaml touch /opt/stackstorm/packs/kinow/actions/workflows/five.yaml --- name: five pack: kinow description: five runner_type: orquesta entry_point: workflows/five.yaml enabled: true And now create the action in StackStorm, so we can run it via command line or with the UI. st2 action create /opt/stackstorm/packs/kinow/actions/five.yaml And here’s the five workflow source for StackStorm, producing something very similar (if no identical) to the graph produced by Cylc 8. version: 1.0 description: five tasks: prep: action: core.local cmd=&quot;sleep 5&quot; next: - when: &lt;% succeeded() %&gt; do: - foo foo: action: core.local cmd=&quot;sleep 5&quot; next: - when: &lt;% succeeded() %&gt; do: - foo - bar bar: action: core.local cmd=&quot;sleep 5&quot; Note that foo is calling itself, creating a cycle in the workflow. And to run the workflow: st2 run kinow.five The StackStorm UI does not appear to support showing the graph of the workflow static or dynamically. But there is a community contributed UI called rehearsal that plots an Orquesta workflow given its source. Final notes Both Cylc and StackStorm support Directed Cyclic Graphs in workflows, which is really rare amongst workflow managers (or workflow standards, as I think WDL/CWL also do not support cyclic workflows yet.) There are many pros and cons for each tool but that will have to be for a future post. To finish this post here’s a screenshot of the StackStorm UI, followed by one of the Cylc 8 UI. Both showing the workflow five." />
<link rel="canonical" href="https://kinoshita.eti.br/2021/10/01/cyclic-workflows-with-cylc-and-stackstorm.html" />
<meta property="og:url" content="https://kinoshita.eti.br/2021/10/01/cyclic-workflows-with-cylc-and-stackstorm.html" />
<meta property="og:site_name" content="kinow" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-10-01T00:00:00+13:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Cyclic Workflows with Cylc and StackStorm" />
<script type="application/ld+json">
{"description":"I am aware of only two workflow managers that support cyclic workflows. Cylc and StackStorm. I won’t enter into details about these two tools, but I must note that I worked on Cylc during my employment with NIWA, in New Zealand. In this post I will only show a very simple workflow called five first using Cylc, and then the same workflow with StackStorm. Cylc First let’s take a look at the source code of this workflow with Cylc 8 and plot it. [scheduling] cycling mode = integer initial cycle point = 1 [[queues]] [[[default]]] limit = 1 [[graph]] R1 = &quot;prep =&gt; foo&quot; P1 = &quot;foo[-P1] =&gt; foo =&gt; bar&quot; [runtime] [[root]] script=&quot;sleep 5&quot; [[prep]] [[foo]] [[bar]] The part &quot;foo[-P1] =&gt; foo =&gt; bar&quot; is where the recursion occurs, creating a cycle in the workflow. Installing Cylc requires just pip install cylc-flow. After that, with the workflow installed, we are ready to run it. cylc install -c ~/cylc-src/five --flow-name five cylc play --no-detach five/run1 The workflow will run forever, incrementing the cycle points, and triggering the tasks in the five workflow source. So you will have foo.1 (foo in the first cycle point), that triggers both bar.1 and also foo.2 (foo in the second cycle point) and so it goes. StackStorm StackStorm requires more work to get everything up and running. Luckily they provide a Docker Compose installation. So after the servers have been started with Docker we are ready to create a “pack” (a neat way to organize separate installation files). mkdir -p /opt/stackstorm/packs/kinow/ touch /opt/stackstorm/packs/kinow/pack.yaml --- name : kinow description: kinow version: 1.0.0 author: kinow email: kinow@localhost And install the new pack. st2 pack install file:///opt/stackstorm/packs/kinow Now we create a new workflow and an action to run the workflow — I think this step is optional, and you could have just an action but I was following one section of the docs that had it this way. mkdir -p /opt/stackstorm/packs/kinow/actions/workflows touch /opt/stackstorm/packs/kinow/actions/five.yaml touch /opt/stackstorm/packs/kinow/actions/workflows/five.yaml --- name: five pack: kinow description: five runner_type: orquesta entry_point: workflows/five.yaml enabled: true And now create the action in StackStorm, so we can run it via command line or with the UI. st2 action create /opt/stackstorm/packs/kinow/actions/five.yaml And here’s the five workflow source for StackStorm, producing something very similar (if no identical) to the graph produced by Cylc 8. version: 1.0 description: five tasks: prep: action: core.local cmd=&quot;sleep 5&quot; next: - when: &lt;% succeeded() %&gt; do: - foo foo: action: core.local cmd=&quot;sleep 5&quot; next: - when: &lt;% succeeded() %&gt; do: - foo - bar bar: action: core.local cmd=&quot;sleep 5&quot; Note that foo is calling itself, creating a cycle in the workflow. And to run the workflow: st2 run kinow.five The StackStorm UI does not appear to support showing the graph of the workflow static or dynamically. But there is a community contributed UI called rehearsal that plots an Orquesta workflow given its source. Final notes Both Cylc and StackStorm support Directed Cyclic Graphs in workflows, which is really rare amongst workflow managers (or workflow standards, as I think WDL/CWL also do not support cyclic workflows yet.) There are many pros and cons for each tool but that will have to be for a future post. To finish this post here’s a screenshot of the StackStorm UI, followed by one of the Cylc 8 UI. Both showing the workflow five.","@type":"BlogPosting","url":"https://kinoshita.eti.br/2021/10/01/cyclic-workflows-with-cylc-and-stackstorm.html","headline":"Cyclic Workflows with Cylc and StackStorm","datePublished":"2021-10-01T00:00:00+13:00","dateModified":"2021-10-01T00:00:00+13:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://kinoshita.eti.br/2021/10/01/cyclic-workflows-with-cylc-and-stackstorm.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/main.css" /><link type="application/atom+xml" rel="alternate" href="https://kinoshita.eti.br/feed.xml" title="kinow" /><link href="https://unpkg.com/pattern.css" rel="stylesheet" />

</head>
<body>
<div id="mobile-menu"><div class="menu">
  <ul class="menu">
    <li class="item">
      <h1 id="kinow">KINOW</h1>
    </li>
    <li class="item">
      <a href="/" class="">About</a>
    </li>
    <li class="item">
      <a href="/blog/" class="current">Blog</a>
    </li>
    <li class="item">
      <a href="/portfolio/" class="">Portfolio</a>
    </li>
    <li class="item social-media-item">
      <a href="https://www.instagram.com/brunokinoshita/" class="inline-link">
        <img src="/assets/icons/instagram.png" class="inverted-image" />
      </a>
      <a href="https://twitter.com/kinow/" class="inline-link">
        <img src="/assets/icons/twitter.png" class="inverted-image" />
      </a>
      <a href="https://github.com/kinow/" class="inline-link">
        <img src="/assets/icons/github.png" class="inverted-image" />
      </a>
    </li>
  </ul>
</div>
</div>
<div id="wrapper">
  <div id="sidebar"><div class="menu">
  <ul class="menu">
    <li class="item">
      <h1 id="kinow">KINOW</h1>
    </li>
    <li class="item">
      <a href="/" class="">About</a>
    </li>
    <li class="item">
      <a href="/blog/" class="current">Blog</a>
    </li>
    <li class="item">
      <a href="/portfolio/" class="">Portfolio</a>
    </li>
    <li class="item social-media-item">
      <a href="https://www.instagram.com/brunokinoshita/" class="inline-link">
        <img src="/assets/icons/instagram.png" class="inverted-image" />
      </a>
      <a href="https://twitter.com/kinow/" class="inline-link">
        <img src="/assets/icons/twitter.png" class="inverted-image" />
      </a>
      <a href="https://github.com/kinow/" class="inline-link">
        <img src="/assets/icons/github.png" class="inverted-image" />
      </a>
    </li>
  </ul>
</div>
</div>
  <div id="content">
    <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Cyclic Workflows with Cylc and StackStorm</h1><div class="note"><p>Most workflow managers focus on the DAG. Very few support cyclic workflows.</p>
</div>
    <span class="post-meta">
      <time class="dt-published" datetime="2021-10-01T00:00:00+13:00" itemprop="datePublished">Oct 1, 2021
      </time>
      <span>&mdash; star date: -301167.12.</span>
      <span>
        Number of words: 790.
      </span></span>
  </header>

  <ul>
  <li><a href="#cylc">Cylc</a></li>
  <li><a href="#stackstorm">StackStorm</a></li>
  <li><a href="#final-notes">Final notes</a></li>
</ul>


  <div class="post-content e-content" itemprop="articleBody">
    <p>I am aware of only two workflow managers that support cyclic workflows.
<a href="https://cylc.github.io/">Cylc</a> and <a href="https://stackstorm.com/">StackStorm</a>. I won’t
enter into details about these two tools, but I must note that I worked on Cylc
during my employment with NIWA, in New Zealand.</p>

<p>In this post I will only show a very simple workflow called <code class="language-plaintext highlighter-rouge">five</code> first using
Cylc, and then the same workflow with StackStorm.</p>

<h2 id="cylc">Cylc</h2>

<p>First let’s take a look at the source code of this workflow with Cylc 8 and plot it.</p>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[scheduling]</span>
  <span class="err">cycling</span> <span class="py">mode</span> <span class="p">=</span> <span class="s">integer</span>
  <span class="err">initial</span> <span class="err">cycle</span> <span class="py">point</span> <span class="p">=</span> <span class="s">1</span>
  <span class="nn">[[queues]</span><span class="err">]</span>
     <span class="nn">[[[default]</span><span class="err">]]</span>
       <span class="py">limit</span> <span class="p">=</span> <span class="s">1</span>
  <span class="nn">[[graph]</span><span class="err">]</span>
    <span class="py">R1</span> <span class="p">=</span> <span class="s">"prep =&gt; foo"</span>
    <span class="py">P1</span> <span class="p">=</span> <span class="s">"foo[-P1] =&gt; foo =&gt; bar"</span>

<span class="nn">[runtime]</span>
  <span class="nn">[[root]</span><span class="err">]</span>
      <span class="py">script</span><span class="p">=</span><span class="s">"sleep 5"</span>
  <span class="nn">[[prep]</span><span class="err">]</span>
  <span class="nn">[[foo]</span><span class="err">]</span>
  <span class="nn">[[bar]</span><span class="err">]</span>
</code></pre></div></div>

<p>The part <code class="language-plaintext highlighter-rouge">"foo[-P1] =&gt; foo =&gt; bar"</code> is where the recursion occurs, creating
a cycle in the workflow.</p>

<p><img src="/assets/posts/2021-10-01-cyclic-workflows-with-cylc-and-stackstorm/five-graph-cylc.png" alt="workflow five plot - cylc" class="center-aligned" /></p>

<p>Installing Cylc requires just <code class="language-plaintext highlighter-rouge">pip install cylc-flow</code>. After that, with the workflow
installed, we are ready to run it.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cylc <span class="nb">install</span> <span class="nt">-c</span> ~/cylc-src/five <span class="nt">--flow-name</span> five
cylc play <span class="nt">--no-detach</span> five/run1
</code></pre></div></div>

<p>The workflow will run forever, incrementing the cycle points, and triggering the tasks
in the <code class="language-plaintext highlighter-rouge">five</code> workflow source. So you will have <code class="language-plaintext highlighter-rouge">foo.1</code> (foo in the first cycle point),
that triggers both <code class="language-plaintext highlighter-rouge">bar.1</code> and also <code class="language-plaintext highlighter-rouge">foo.2</code> (foo in the second cycle point) and so it
goes.</p>

<h2 id="stackstorm">StackStorm</h2>

<p>StackStorm requires more work to get everything up and running. Luckily they provide
a Docker Compose installation. So after the servers have been started with Docker
we are ready to create a “pack” (a neat way to organize separate installation files).</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> /opt/stackstorm/packs/kinow/
<span class="nb">touch</span> /opt/stackstorm/packs/kinow/pack.yaml
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">name </span><span class="pi">:</span> <span class="s">kinow</span>
<span class="na">description</span><span class="pi">:</span> <span class="s">kinow</span>
<span class="na">version</span><span class="pi">:</span> <span class="s">1.0.0</span>
<span class="na">author</span><span class="pi">:</span> <span class="s">kinow</span>
<span class="na">email</span><span class="pi">:</span> <span class="s">kinow@localhost</span>
</code></pre></div></div>

<p>And install the new pack.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>st2 pack <span class="nb">install </span>file:///opt/stackstorm/packs/kinow
</code></pre></div></div>

<p>Now we create a new workflow and an action to run the workflow — I think
this step is optional, and you could have just an action but I was following
one section of the docs that had it this way.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> /opt/stackstorm/packs/kinow/actions/workflows
<span class="nb">touch</span> /opt/stackstorm/packs/kinow/actions/five.yaml
<span class="nb">touch</span> /opt/stackstorm/packs/kinow/actions/workflows/five.yaml
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">five</span>
<span class="na">pack</span><span class="pi">:</span> <span class="s">kinow</span>
<span class="na">description</span><span class="pi">:</span> <span class="s">five</span>
<span class="na">runner_type</span><span class="pi">:</span> <span class="s">orquesta</span>
<span class="na">entry_point</span><span class="pi">:</span> <span class="s">workflows/five.yaml</span>
<span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<p>And now create the action in StackStorm, so we can run it via command line
or with the UI.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>st2 action create /opt/stackstorm/packs/kinow/actions/five.yaml 
</code></pre></div></div>

<p>And here’s the <code class="language-plaintext highlighter-rouge">five</code> workflow source for StackStorm, producing something very
similar (if no identical) to the graph produced by Cylc 8.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="m">1.0</span>
<span class="na">description</span><span class="pi">:</span> <span class="s">five</span>
<span class="na">tasks</span><span class="pi">:</span>
  <span class="na">prep</span><span class="pi">:</span>
    <span class="na">action</span><span class="pi">:</span> <span class="s">core.local cmd="sleep 5"</span>
    <span class="na">next</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">when</span><span class="pi">:</span> <span class="s">&lt;% succeeded() %&gt;</span>
        <span class="na">do</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">foo</span>
  <span class="na">foo</span><span class="pi">:</span>
    <span class="na">action</span><span class="pi">:</span> <span class="s">core.local cmd="sleep 5"</span>
    <span class="na">next</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">when</span><span class="pi">:</span> <span class="s">&lt;% succeeded() %&gt;</span>
        <span class="na">do</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">foo</span>
          <span class="pi">-</span> <span class="s">bar</span>
  <span class="na">bar</span><span class="pi">:</span>
    <span class="na">action</span><span class="pi">:</span> <span class="s">core.local cmd="sleep 5"</span>
</code></pre></div></div>

<p>Note that <code class="language-plaintext highlighter-rouge">foo</code> is calling itself, creating a cycle in the workflow. And to run the
workflow:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>st2 run kinow.five
</code></pre></div></div>

<p>The StackStorm UI does not appear to support showing the graph of the workflow
static or dynamically. But there is a community contributed UI called
<a href="https://github.com/trstruth/rehearsal/">rehearsal</a> that plots an Orquesta
workflow given its source.</p>

<p><img src="/assets/posts/2021-10-01-cyclic-workflows-with-cylc-and-stackstorm/five-graph-stackstorm-rehearsal.png" alt="workflow five plot - stackstorm" class="center-aligned" /></p>

<h2 id="final-notes">Final notes</h2>

<p>Both Cylc and StackStorm support Directed Cyclic Graphs in workflows, which is
really rare amongst workflow managers (or workflow standards, as I think WDL/CWL
also do not support cyclic workflows yet.)</p>

<p>There are many pros and cons for each tool but that will have to be for a future
post. To finish this post here’s a screenshot of the StackStorm UI, followed by
one of the Cylc 8 UI. Both showing the workflow <code class="language-plaintext highlighter-rouge">five</code>.</p>

<p><img src="/assets/posts/2021-10-01-cyclic-workflows-with-cylc-and-stackstorm/stackstorm-ui.png" alt="stackstorm ui" class="center-aligned" /></p>

<p><img src="/assets/posts/2021-10-01-cyclic-workflows-with-cylc-and-stackstorm/cylc-ui.png" alt="stackstorm ui" class="center-aligned" /></p>

  </div>

  <div class="tags"><p>Tags:&nbsp;<a class="label" href="/tag/opensource">opensource</a>,&nbsp;<a class="label" href="/tag/cylc">cylc</a>.<br/></p></div>

  <a class="u-url" href="/2021/10/01/cyclic-workflows-with-cylc-and-stackstorm.html" hidden></a>
</article>

  </div>
</div>
</body>
</html>
