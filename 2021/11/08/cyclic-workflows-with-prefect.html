<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:url" content="https://kinoshita.eti.br/2021/11/08/cyclic-workflows-with-prefect.html"><meta property="og:site_name" content="kinow"><meta property="og:title" content="Cyclic Workflows with Prefect"><meta property="og:description" content=" Last month I wrote about Cyclic Workflows with Cylc and StackStorm and how few workflow managers support cyclic workflows.
I was surprised today while reading Prefect documentation to see this paragraph:
Most workflow frameworks act as if looping is impossible (stressing the Acyclic part of the DAG), but it&amp;rsquo;s actually trivial to implement. We simply dynamically unroll the loop, similar to how RNN gradients are sometimes computed.
"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-11-08T00:00:00+00:00"><meta property="article:modified_time" content="2024-04-22T23:00:18+02:00"><meta property="article:tag" content="Opensource"><meta property="article:tag" content="Workflows"><meta property="og:image" content="https://kinoshita.eti.br/assets/photos/about/2023-me-closeup.png"><meta property="fb:admins" content="bruno.kinoshita"><meta name=twitter:title content="Cyclic Workflows with Prefect"><meta name=twitter:description content="
  
  
  
  
  
    
    
  
  
  


Last month I wrote about
Cyclic Workflows with Cylc and StackStorm
and how few workflow managers support cyclic workflows.
I was surprised today while reading Prefect documentation to see this paragraph:

Most workflow frameworks act as if looping is impossible (stressing the Acyclic part of the DAG),
but it&rsquo;s actually trivial to implement. We simply dynamically unroll the loop, similar to how RNN
gradients are sometimes computed.
"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kinoshita.eti.br/assets/photos/about/2023-me-closeup.png"><meta name=twitter:site content="@kinow"><link rel=alternate type=application/rss+xml href=https://kinoshita.eti.br/2021/11/08/cyclic-workflows-with-prefect/feed.xml title=kinow><link rel=stylesheet type=text/css href=https://kinoshita.eti.br/sass/main.1e768395a672116b3eff41b3123d9aafb8a9302476085be5fb658a4b93613f57.css integrity="sha256-HnaDlaZyEWs+/0GzEj2ar7ipMCR2CFvl+2WKS5NhP1c="><title>kinow | Cyclic Workflows with Prefect</title><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"posts","name":"Cyclic Workflows with Prefect","headline":"Cyclic Workflows with Prefect","alternativeHeadline":"","description":"\u003cdiv style=\u0022width: 50%; margin: 0 auto;\u0022\u003e\n  \n  \n  \n  \u003cfigure class=\u0022feature\u0022\u003e\n  \n    \u003cimg\n      src=\u0027\/assets\/posts\/2021-11-08-cyclic-workflows-with-prefect\/prefect.svg\u0027\n      alt=\u0027Prefect logo\u0027\n      title=\u0027Prefect logo\u0027\n      style=\u0027\u0027\n      width=\u0027\u0027\n      height=\u0027\u0027\n      \/\u003e\n    \u003cfigcaption\u003e\u003c\/figcaption\u003e\n  \n  \u003c\/figure\u003e\n  \n\n\u003c\/div\u003e\n\u003cp\u003eLast month I wrote about\n\u003ca href=\u0022\/2021\/10\/01\/cyclic-workflows-with-cylc-and-stackstorm.html\u0022\u003eCyclic Workflows with Cylc and StackStorm\u003c\/a\u003e\nand how few workflow managers support cyclic workflows.\u003c\/p\u003e\n\u003cp\u003eI was surprised today while reading Prefect documentation to see this paragraph:\u003c\/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eMost workflow frameworks act as if looping is impossible (stressing the Acyclic part of the DAG),\nbut it\u0026rsquo;s actually trivial to implement. We simply dynamically unroll the loop, similar to how RNN\ngradients are sometimes computed.\u003c\/p\u003e\n\u003c\/blockquote\u003e","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/kinoshita.eti.br\/2021\/11\/08\/cyclic-workflows-with-prefect.html"},"author":{"@type":"Person","name":"Bruno P. Kinoshita"},"creator":{"@type":"Person","name":"Bruno P. Kinoshita"},"accountablePerson":{"@type":"Person","name":"Bruno P. Kinoshita"},"copyrightHolder":"kinow","copyrightYear":"2021","dateCreated":"2021-11-08T00:00:00.00Z","datePublished":"2021-11-08T00:00:00.00Z","dateModified":"2024-04-22T23:00:18.00Z","publisher":{"@type":"Organization","name":"kinow","url":"https://kinoshita.eti.br/","logo":{"@type":"ImageObject","url":"https:\/\/kinoshita.eti.br\/","width":"32","height":"32"}},"image":"https://kinoshita.eti.br/","url":"https:\/\/kinoshita.eti.br\/2021\/11\/08\/cyclic-workflows-with-prefect.html","wordCount":"503","genre":["opensource","workflows"],"keywords":[]}</script></head><body><header role=banner class=content><nav id=nav aria-label=Main role=navigation class=content><ul><li><a href=/><i data-feather=about></i> About</a></li><li><a href=/blog/><i data-feather=blog></i> Blog</a></li><li><a href=/portfolio/><i data-feather=portfolio></i> Portfolio</a></li></ul></nav></header><main><article class=content><h1>Cyclic Workflows with Prefect</h1><div class=metadata><i data-feather=calendar></i>
<time datetime=2021-11-08>Nov 8, 2021</time></div><aside><nav id=TableOfContents></nav></aside><div style="width:50%;margin:0 auto"><figure class=feature><img src=/assets/posts/2021-11-08-cyclic-workflows-with-prefect/prefect.svg alt='Prefect logo' title='Prefect logo' width height><figcaption></figcaption></figure></div><p>Last month I wrote about
<a href=/2021/10/01/cyclic-workflows-with-cylc-and-stackstorm.html>Cyclic Workflows with Cylc and StackStorm</a>
and how few workflow managers support cyclic workflows.</p><p>I was surprised today while reading Prefect documentation to see this paragraph:</p><blockquote><p>Most workflow frameworks act as if looping is impossible (stressing the Acyclic part of the DAG),
but it&rsquo;s actually trivial to implement. We simply dynamically unroll the loop, similar to how RNN
gradients are sometimes computed.</p></blockquote><figure class=feature><img src=/assets/posts/2021-11-08-cyclic-workflows-with-prefect/Example-of-Unrolled-RNN-on-the-forward-pass.png alt='Example of Unrolled RNN on the forward-pass (image from https://machinelearningmastery.com/rnn-unrolling/)' title='Example of Unrolled RNN on the forward-pass (image from https://machinelearningmastery.com/rnn-unrolling/)' width height><figcaption>Image source: <a href=https://machinelearningmastery.com/rnn-unrolling/>A Gentle Introduction to RNN Unrolling</a></figcaption></figure><p>The API for cyclic workflows of Prefect appears to be limited when compared with Cylc and
StackStorm, but they have a lot of integrations, and good documentation.</p><p>I had to re-work the example from the previous post a bit, as using <code>prep</code> as entry point
resulted in <code>prep</code> present in every cycle. Their dependency and constraints algorithm is
probably re-executing the whole cycle, or there may be another way to have optional tasks
that I couldn&rsquo;t find.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6><a style=outline:none;text-decoration:none;color:inherit href=#6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7><a style=outline:none;text-decoration:none;color:inherit href=#7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8><a style=outline:none;text-decoration:none;color:inherit href=#8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9><a style=outline:none;text-decoration:none;color:inherit href=#9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10><a style=outline:none;text-decoration:none;color:inherit href=#10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11><a style=outline:none;text-decoration:none;color:inherit href=#11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12><a style=outline:none;text-decoration:none;color:inherit href=#12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13><a style=outline:none;text-decoration:none;color:inherit href=#13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14><a style=outline:none;text-decoration:none;color:inherit href=#14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15><a style=outline:none;text-decoration:none;color:inherit href=#15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=16><a style=outline:none;text-decoration:none;color:inherit href=#16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=17><a style=outline:none;text-decoration:none;color:inherit href=#17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=18><a style=outline:none;text-decoration:none;color:inherit href=#18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=19><a style=outline:none;text-decoration:none;color:inherit href=#19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=20><a style=outline:none;text-decoration:none;color:inherit href=#20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=21><a style=outline:none;text-decoration:none;color:inherit href=#21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=22><a style=outline:none;text-decoration:none;color:inherit href=#22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=23><a style=outline:none;text-decoration:none;color:inherit href=#23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=24><a style=outline:none;text-decoration:none;color:inherit href=#24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=25><a style=outline:none;text-decoration:none;color:inherit href=#25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=26><a style=outline:none;text-decoration:none;color:inherit href=#26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=27><a style=outline:none;text-decoration:none;color:inherit href=#27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=28><a style=outline:none;text-decoration:none;color:inherit href=#28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=29><a style=outline:none;text-decoration:none;color:inherit href=#29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=30><a style=outline:none;text-decoration:none;color:inherit href=#30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=31><a style=outline:none;text-decoration:none;color:inherit href=#31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=32><a style=outline:none;text-decoration:none;color:inherit href=#32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=33><a style=outline:none;text-decoration:none;color:inherit href=#33>33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=34><a style=outline:none;text-decoration:none;color:inherit href=#34>34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=35><a style=outline:none;text-decoration:none;color:inherit href=#35>35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=36><a style=outline:none;text-decoration:none;color:inherit href=#36>36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=37><a style=outline:none;text-decoration:none;color:inherit href=#37>37</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=38><a style=outline:none;text-decoration:none;color:inherit href=#38>38</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=39><a style=outline:none;text-decoration:none;color:inherit href=#39>39</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=40><a style=outline:none;text-decoration:none;color:inherit href=#40>40</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=41><a style=outline:none;text-decoration:none;color:inherit href=#41>41</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#177500>#!/bin/env python3</span>
</span></span><span style=display:flex><span><span style=color:#177500># file: workflow.py</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>import</span> <span style=color:#000>prefect</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>from</span> <span style=color:#000>prefect</span> <span style=color:#a90d91>import</span> <span style=color:#000>task</span>, <span style=color:#000>Flow</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>from</span> <span style=color:#000>prefect.engine.signals</span> <span style=color:#a90d91>import</span> <span style=color:#000>LOOP</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>import</span> <span style=color:#000>time</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>INTERVAL</span><span style=color:#000>=</span><span style=color:#1c01ce>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>@task</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>def</span> <span style=color:#000>prep</span>():
</span></span><span style=display:flex><span>    <span style=color:#000>cycle</span> <span style=color:#000>=</span> <span style=color:#000>prefect</span><span style=color:#000>.</span><span style=color:#000>context</span><span style=color:#000>.</span><span style=color:#000>get</span>(<span style=color:#c41a16>&#34;task_loop_count&#34;</span>, <span style=color:#1c01ce>1</span>)
</span></span><span style=display:flex><span>    <span style=color:#000>logger</span> <span style=color:#000>=</span> <span style=color:#000>prefect</span><span style=color:#000>.</span><span style=color:#000>context</span><span style=color:#000>.</span><span style=color:#000>get</span>(<span style=color:#c41a16>&#34;logger&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#000>time</span><span style=color:#000>.</span><span style=color:#000>sleep</span>(<span style=color:#000>INTERVAL</span>)
</span></span><span style=display:flex><span>    <span style=color:#000>logger</span><span style=color:#000>.</span><span style=color:#000>info</span>(<span style=color:#c41a16>f</span><span style=color:#c41a16>&#34;prep.</span><span style=color:#c41a16>{</span><span style=color:#000>cycle</span><span style=color:#c41a16>}</span><span style=color:#c41a16> says hi!&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>@task</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>def</span> <span style=color:#000>foo</span>():
</span></span><span style=display:flex><span>    <span style=color:#000>cycle</span> <span style=color:#000>=</span> <span style=color:#000>prefect</span><span style=color:#000>.</span><span style=color:#000>context</span><span style=color:#000>.</span><span style=color:#000>get</span>(<span style=color:#c41a16>&#34;task_loop_count&#34;</span>, <span style=color:#1c01ce>1</span>)
</span></span><span style=display:flex><span>    <span style=color:#a90d91>if</span> <span style=color:#000>cycle</span> <span style=color:#000>==</span> <span style=color:#1c01ce>1</span>:
</span></span><span style=display:flex><span>        <span style=color:#000>prep</span><span style=color:#000>.</span><span style=color:#000>run</span>()
</span></span><span style=display:flex><span>    <span style=color:#000>logger</span> <span style=color:#000>=</span> <span style=color:#000>prefect</span><span style=color:#000>.</span><span style=color:#000>context</span><span style=color:#000>.</span><span style=color:#000>get</span>(<span style=color:#c41a16>&#34;logger&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#000>time</span><span style=color:#000>.</span><span style=color:#000>sleep</span>(<span style=color:#000>INTERVAL</span>)
</span></span><span style=display:flex><span>    <span style=color:#000>logger</span><span style=color:#000>.</span><span style=color:#000>info</span>(<span style=color:#c41a16>f</span><span style=color:#c41a16>&#34;foo.</span><span style=color:#c41a16>{</span><span style=color:#000>cycle</span><span style=color:#c41a16>}</span><span style=color:#c41a16> says hi!&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#000>bar</span><span style=color:#000>.</span><span style=color:#000>run</span>()
</span></span><span style=display:flex><span>    <span style=color:#a90d91>raise</span> <span style=color:#000>LOOP</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>@task</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>def</span> <span style=color:#000>bar</span>():
</span></span><span style=display:flex><span>    <span style=color:#000>cycle</span> <span style=color:#000>=</span> <span style=color:#000>prefect</span><span style=color:#000>.</span><span style=color:#000>context</span><span style=color:#000>.</span><span style=color:#000>get</span>(<span style=color:#c41a16>&#34;task_loop_count&#34;</span>, <span style=color:#1c01ce>1</span>)
</span></span><span style=display:flex><span>    <span style=color:#000>logger</span> <span style=color:#000>=</span> <span style=color:#000>prefect</span><span style=color:#000>.</span><span style=color:#000>context</span><span style=color:#000>.</span><span style=color:#000>get</span>(<span style=color:#c41a16>&#34;logger&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#000>time</span><span style=color:#000>.</span><span style=color:#000>sleep</span>(<span style=color:#000>INTERVAL</span>)
</span></span><span style=display:flex><span>    <span style=color:#000>logger</span><span style=color:#000>.</span><span style=color:#000>info</span>(<span style=color:#c41a16>f</span><span style=color:#c41a16>&#34;bar.</span><span style=color:#c41a16>{</span><span style=color:#000>cycle</span><span style=color:#c41a16>}</span><span style=color:#c41a16> says hi!&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>with</span> <span style=color:#000>Flow</span>(<span style=color:#c41a16>&#34;hello-flow&#34;</span>) <span style=color:#a90d91>as</span> <span style=color:#000>flow</span>:
</span></span><span style=display:flex><span>    <span style=color:#000>foo</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>flow</span><span style=color:#000>.</span><span style=color:#000>run</span>()
</span></span><span style=display:flex><span><span style=color:#177500>#flow.visualize() # need to pip install prefect[&#39;viz&#39;]</span></span></span></code></pre></td></tr></table></div></div><p>Running the workflow is really simple (simpler than both
Cylc and StackStorm): <code>python workflow.py</code></p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6><a style=outline:none;text-decoration:none;color:inherit href=#6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7><a style=outline:none;text-decoration:none;color:inherit href=#7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8><a style=outline:none;text-decoration:none;color:inherit href=#8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9><a style=outline:none;text-decoration:none;color:inherit href=#9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10><a style=outline:none;text-decoration:none;color:inherit href=#10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11><a style=outline:none;text-decoration:none;color:inherit href=#11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12><a style=outline:none;text-decoration:none;color:inherit href=#12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13><a style=outline:none;text-decoration:none;color:inherit href=#13>13</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>(venv) kinow@ranma:/tmp$ python workflow.py 
</span></span><span style=display:flex><span>[2021-11-08 21:37:20+1300] INFO - prefect.FlowRunner | Beginning Flow run for &#39;hello-flow&#39;
</span></span><span style=display:flex><span>[2021-11-08 21:37:20+1300] INFO - prefect.TaskRunner | Task &#39;foo&#39;: Starting task run...
</span></span><span style=display:flex><span>[2021-11-08 21:37:21+1300] INFO - prefect.foo | prep.1 says hi!
</span></span><span style=display:flex><span>[2021-11-08 21:37:22+1300] INFO - prefect.foo | foo.1 says hi!
</span></span><span style=display:flex><span>[2021-11-08 21:37:23+1300] INFO - prefect.foo | bar.1 says hi!
</span></span><span style=display:flex><span>[2021-11-08 21:37:24+1300] INFO - prefect.foo | foo.2 says hi!
</span></span><span style=display:flex><span>[2021-11-08 21:37:25+1300] INFO - prefect.foo | bar.2 says hi!
</span></span><span style=display:flex><span>[2021-11-08 21:37:26+1300] INFO - prefect.foo | foo.3 says hi!
</span></span><span style=display:flex><span>[2021-11-08 21:37:27+1300] INFO - prefect.foo | bar.3 says hi!
</span></span><span style=display:flex><span>[2021-11-08 21:37:28+1300] INFO - prefect.foo | foo.4 says hi!
</span></span><span style=display:flex><span>[2021-11-08 21:37:29+1300] INFO - prefect.foo | bar.4 says hi!
</span></span><span style=display:flex><span>...
</span></span></code></pre></td></tr></table></div></div><p>I had seen the RNN graph unrolling algorithm mentioned in their documentation
while working on <a href=https://github.com/kinow/decyclify>decyclify</a>. I believe more
workflow managers will start supporting cyclic workflows soon. It adds some
complexity to the code, but so does add dependency management, good logging,
configuration, distributed execution, and so on.</p><figure class=feature><img src=/assets/posts/2021-11-08-cyclic-workflows-with-prefect/graph-unroll.png alt='Decyclify algorithm (image from https://github.com/kinow/decyclify)' title='Decyclify algorithm (image from https://github.com/kinow/decyclify)' width height><figcaption></figcaption></figure><p>I am not sure if the way I linked tasks is following best practices for Prefect. There
may be better ways so that Prefect can handle restarting workflows, for instance. But
if you want to run cyclic workflows, now you have —at least— three options.</p><p>Tags:
<a href=/tags/opensource.html>Opensource</a>,
<a href=/tags/workflows.html>Workflows</a></p><aside class=links><a class=previous href=https://kinoshita.eti.br/2021/10/22/removing-invisible-unread-github-notifications.html>&#171; Previous</a><a class=next href=https://kinoshita.eti.br/2022/10/26/r/functionalprogramming-turned-10.html>Next &#187;</a></aside></article></main><footer role=contentinfo><ul id=social-media-icons><li><a href=https://www.instagram.com/brunokinoshita/><img src=/assets/icons/instagram.png alt="Instagram link"></a></li><li><a href=https://twitter.com/kinow/><img src=/assets/icons/twitter.png alt="Twitter link"></a></li><li><a href=https://github.com/kinow/><img src=/assets/icons/github.png alt="GitHub link"></a></li><li><a href=/feed.xml><img src=/assets/icons/news.png alt="RSS feed link"></a></li></ul></footer></body></html>