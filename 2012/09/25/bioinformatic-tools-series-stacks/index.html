  
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head profile="http://gmpg.org/xfn/11">
    <title>Bruno P. Kinoshita &mdash; Bioinformatics tools: Stacks</title> 
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="description" content="Bruno de Paula Kinoshita personal web site" />
    <meta name="keywords"
        content="kinoshita, bruno de paula kinoshita, geek, geek stuff, java, python, c, c++, msn now playing, neural network, mackenzie, sao paulo, brasil, brazil, nerd, nerd stuff, cool, jenkins, illustration, quadrinhos, machine learning, linguistic, apache, open source, codigo livre, codigo aberto" />
    <meta name="author" content="" />
    <meta name="generator" content="PieCrust 3.2.1" />
    <meta name="template-engine" content="Twig" />
    <meta name="robots" content="all=index,follow" />
    <meta name="revisit-after" content="15 days" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta name="distribution" content="Global" />
    <meta name="url" content="/" />
    <meta name="copyright" content="Bruno de Paula Kinoshita" />
    <meta name="Googlebot" content="all" />
    <meta name="rating" content="general" />
    <meta http-equiv="expires" content="0" />
    <meta name="city" content="Sao Paulo" />
    <meta name="state" content="Brasil, Sao Paulo" />
    <meta http-equiv="content-language" content="en" />
    <meta http-equiv="imagetoolbar" content="no" />
    <meta id="page_favicon" href="/favicon.ico" rel="icon" type="image/x-icon" />
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link rel="alternate" type="application/rss+xml" title="Bruno P. Kinoshita &raquo; Feed" href="/feed.xml" />
    <link rel="stylesheet" href="/css/semantic/dist/semantic.min.css" type="text/css" media="screen, projection" />
    <link rel="stylesheet" href="/css/style.css" type="text/css" media="screen, projection" />
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="/css/blueprint/ie.css" type="text/css" media="screen, projection" />
    <![endif]-->
    <link rel="stylesheet" href="/css/prettyPhoto.css" type="text/css" media="all" />
</head>
<body id="body">
    <div class="ui vertical sidebar menu" id="toc">
        <nav class="menu" role="navigation">
    <div class="item">
        <a href="/" class="main-link">Kinoshita</a>
    </div>
    <div class="item">
        <a href="/art">Art</a>
    </div>
    <div class="item">
      <a href="/presentations/">Presentations</a>
    </div>
    <div class="item">
        <a href="/contact/">Contact</a>
    </div>
</nav>
<a href="/about/"><img src="/img/bruno.jpg" title="Hmmmm" alt="My picture" width="134px" height="215px" /></a>
    </div>
    <div class="ui black big launch right attached fixed button">
        <i class="content icon"></i>
        <span class="text">Menu</span>
    </div>
    <div class="ui fixed inverted main menu">
        <div class="ui container">
            <a class="launch icon item">
                <i class="content icon"></i>
            </a>
            <div class="item">
                Bioinformatics tools: Stacks
            </div>
        </div>
    </div>
    <div class="pusher">
        <div class="full height">
            <div class="toc">
                <div class="ui vertical sticky fixed top menu">
                    <nav class="menu" role="navigation">
    <div class="item">
        <a href="/" class="main-link">Kinoshita</a>
    </div>
    <div class="item">
        <a href="/art">Art</a>
    </div>
    <div class="item">
      <a href="/presentations/">Presentations</a>
    </div>
    <div class="item">
        <a href="/contact/">Contact</a>
    </div>
</nav>
<a href="/about/"><img src="/img/bruno.jpg" title="Hmmmm" alt="My picture" width="134px" height="215px" /></a>
                </div>
            </div>
            <div class="article">
                <div class="main container" role="main">

                
<div class="ui raised padded container segment">
  <h1 class='post-topic'>Bioinformatics tools: Stacks</h1>
  <small>kinow</small> @
	<small>2012-09-25&nbsp;16:08:03 (<span class='stardate' data-input-date='2012-09-25'></span>)</small>
  <div class="entry">
    





<a href="https://twitter.com/share" class="twitter-share-button" data-url="https://kinoshita.eti.br/2012/09/25/bioinformatic-tools-series-stacks" data-text="Bioinformatics tools: Stacks" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p='https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

	  <p>It is the first post about <strong>bioinformatics tools</strong>, but I will try to post more about other tools such as MrBayes, Structure, maybe some next generation sequencing tools too, and Bioperl, Biojava, and so on.</p>
<p>As I am more a computer geek, rather than a bioinformatics one, I will focus on requirements for running these tools on clusters and the requirements to install them on your machine. The instructions require that you have an intermediary knowledge on *nix OS and sometimes a bit of programming experience.</em></p></p>
<p><em>I will be using tutorials available on the Internet and hosting my code in <a href="http://www.github.com/kinow" alt="GitHub kinow" title="GitHub kinow">GitHub/kinow</a>. Hammer time!

<!-- more -->

<p style="text-align: center"><a href="/2012/09/25/bioinformatic-tools-series-stacks/stacks_logo_300_156.png"><img src="/2012/09/25/bioinformatic-tools-series-stacks/stacks_logo_300_156.png" alt="" title="stacks_logo" width="300" height="156" class="aligncenter size-medium wp-image-1058" /></a></p>

<p><strong>Stacks</strong> is hosted at <a href="http://www.uoregon.edu/" alt="Oregon University" title="Oregon University">Oregon University</a>, so if you are googling about it right now, probably a query including both &#8216;stacks&#8217; and &#8216;oregon&#8217; may give you better results (it&#8217;s good to know when you forget the web address). This is the stacks homepage: <a href="http://creskolab.uoregon.edu/stacks/">http://creskolab.uoregon.edu/stacks/</a>.</p>

<blockquote cite="http://creskolab.uoregon.edu/stacks/">&#8220;Stacks is a software pipeline for building loci out of a set of short-read sequenced samples. Stacks was developed for the purpose of building genetic maps from RAD-Tag Illumina sequence data, but can also be readily applied to population studies, and phylogeography.&#8221;</blockquote>

<p>I will follow the tutorial <a href="http://creskolab.uoregon.edu/stacks/pe_tut.php" alt="Stacks tutorial" title="Stacks tutorial">&#8220;building mini-contigs from paired-end sequences&#8221;</a> to demonstrate how to use Stacks, and for each step executed I&#8217;ll post the directory and database sizes, as well as the processing time. My hardware is an Intel i5 quad core 2.30 GHz with 6GB of memory, running Debian 6.</p>

<!--more-->

<h2>Installing on your local computer</h2>

<p>The installation is quite simple. However, Stacks come with a Web application, and during its pipeline analysis sometimes it uploads data to a database. So in our set up I&#8217;m going to use an Apache HTTP web server and MySQL database. Here&#8217;s a list of things you should have installed in your machine: </p>

<ul>
<li><a href="http://httpd.apache.org" title="Apache httpd">Apache HTTP web server</a> (you could try NGINX, or others too, but you would need a PHP interpreter) - my version: Apache/2.2.22 (Debian)</li>
<li><a href="http://www.php.net" title="PHP">PHP</a> (not sure if 5> is required) - my version: Ver 14.14 Distrib 5.5.24, for debian-linux-gnu (x86_64) using readline 6.2</li>
<li>PHP MDB2 module installed (pear install MDB2 does the trick most of the times)</li>
<li><a href="http://www.mysql.org/" title="MySQL">MySQL</a> database (stacks come with a SQL script for MySQL, not sure how hard it would be to adapt this script and the perl utilities to use Oracle, DB2, etc) - my version: Ver 14.14 Distrib 5.5.24, for debian-linux-gnu (x86_64) using readline 6.2</li>
<li><a href="http://www.perl.org" title="Perl">Perl</a> (5 is fine, didn&#8217;t test with 6) - This is perl 5, version 14, subversion 2 (v5.14.2) built for x86_64-linux-gnu-thread-multi</li>
<li>DBD::mysql and SPREADSHEET::WriteExcel modules (<a href="http://www.cpan.org" title="CPAN">CPAN</a>, yay!)</li>
<li><a href="http://www.ebi.ac.uk/~zerbino/velvet/" title="Velvet">Velvet</a> (for contigs) - my version: 1.2.07</li>
<li>A gcc compiler with OpenMP for multi-threading. My version: 
Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/4.7/lto-wrapper
Target: x86_64-linux-gnu
Configured with: ../src/configure -v &#8212;with-pkgversion=&#8217;Debian 4.7.1-8&#8217; &#8212;with-bugurl=file:///usr/share/doc/gcc-4.7/README.Bugs &#8212;enable-languages=c,c++,go,fortran,objc,obj-c++ &#8212;prefix=/usr &#8212;program-suffix=-4.7 &#8212;enable-shared &#8212;enable-linker-build-id &#8212;with-system-zlib &#8212;libexecdir=/usr/lib &#8212;without-included-gettext &#8212;enable-threads=posix &#8212;with-gxx-include-dir=/usr/include/c++/4.7 &#8212;libdir=/usr/lib &#8212;enable-nls &#8212;with-sysroot=/ &#8212;enable-clocale=gnu &#8212;enable-libstdcxx-debug &#8212;enable-libstdcxx-time=yes &#8212;enable-gnu-unique-object &#8212;enable-plugin &#8212;enable-objc-gc &#8212;with-arch-32=i586 &#8212;with-tune=generic &#8212;enable-checking=release &#8212;build=x86_64-linux-gnu &#8212;host=x86_64-linux-gnu &#8212;target=x86_64-linux-gnu
Thread model: posix
gcc version 4.7.1 (Debian 4.7.1-8)</li>
</ul>

<p>Install Stacks with the classic <em>./configure</em>, <em>make</em>, <em>make install</em>. It will put several utilities and Perl scripts in your PATH. For testing if the installation worked, try running <em>ustacks</em>. You may need to update your Apache HTTP settings to include a virtual directory to the stacks web folder. In my computer this folder is located at <em>/usr/local/share/stacks/php</em>.</p>

<h2>Installing on your cluster</h2>

<p>Stacks uses <strong>OpenMP</strong> for running over multiple CPU&#8217;s. I have a small commodity-hardware cluster that is quite handy for MapReduce and MPI processing, but for this case I will have to use only one machine. So I&#8217;m using my notebook with four cores, and using <a href="http://ganglia.sourceforge.net" title="Ganglia">Ganglia</a> and htop/free for monitoring CPU and memory usage.</p>

<h2>Following the Stacks tutorial</h2>

<p>The tutorial requires that you download samples and create some directories and a database. Here&#8217;s the status of my system before the analysis.</p>

<p><strong>Database size: 880KB</strong></p>

<p><strong>Directory size: 2.6 GB</strong></p>

<p><code>kinow@chuva:~/Desktop/pe_tut$ du -h
4.0K    ./stacks
4.0K    ./assembled
2.6G    ./samples
4.0K    ./raw
4.0K    ./pairs
2.6G    .</code></p>
<p>After these steps, you start your pipeline with the <em>denovo_map.pl</em> script. The denovo_map.pl script took 23 minutes to finish, and here&#8217;s the new status of my system.</p>

<p><strong>Database size: 1.7 GB</strong></p>

<p><strong>Directory size: 3.5 GB</strong></p>

<p><code>kinow@chuva:~/Desktop/pe_tut$ du -h
971M    ./stacks
4.0K    ./assembled
2.6G    ./samples
4.0K    ./raw
4.0K    ./pairs
3.5G    .</code></p>
<p>The next step is the <em>export_sql.pl</em> script. It took 31 minutes to finish.</p>

<p><strong>Database size: 1.7 GB</strong></p>

<p><strong>Directory size: 3.5 GB</strong></p>

<p><code>kinow@chuva:~/Desktop/pe_tut$ du -h
971M    ./stacks
4.0K    ./assembled
2.6G    ./samples
4.0K    ./raw
4.0K    ./pairs
3.5G    .</code></p>
<p>Half way to go. Now execute the <em>sort_read_pairs.pl</em> script. This was the longest and the one that consumed more memory, it took 49 minutes to finish.</p>

<p><strong>Database size: 1.7 GB</strong></p>

<p><strong>Directory size: 3.7 GB</strong></p>

<p><code>kinow@chuva:~/Desktop/pe_tut$ du -h
971M    ./stacks
4.0K    ./assembled
2.6G    ./samples
4.0K    ./raw
170M    ./pairs
3.7G    .</code></p>
<p>It&#8217;s time to get the contigs with Velvet now with <em>exec_velvet.pl</em>. Don&#8217;t worry, this one is faster, only 15 minutes.</p>

<p><strong>Database size: 1.7 GB</strong></p>

<p><strong>Directory size: 3.7 GB</strong></p>

<p><code>kinow@chuva:~/Desktop/pe_tut$ du -h
971M    ./stacks
3.4M    ./assembled
2.6G    ./samples
4.0K    ./raw
170M    ./pairs
3.7G    .</code></p>
<p>Last two scripts to execute. First <em>load_sequences.pl</em>, that apparently loads some data into the database. It took 3 minutes to finish.</p>

<p><strong>Database size: 1.8 GB</strong></p>

<p><strong>Directory size: 3.7 GB</strong></p>

<p><code>kinow@chuva:~/Desktop/pe_tut$ du -h
971M    ./stacks
3.4M    ./assembled
2.6G    ./samples
4.0K    ./raw
170M    ./pairs
3.7G    .</code></p>
<p>And finally <em>index_radtags.pl</em> which took only 1 minute.</p>

<p><strong>Database size: 1.8 GB</strong></p>

<p><strong>Directory size: 3.7 GB</strong></p>

<p><code>kinow@chuva:~/Desktop/pe_tut$ du -h
971M    ./stacks
3.4M    ./assembled
2.6G    ./samples
4.0K    ./raw
170M    ./pairs
3.7G    .</code></p>
<h2>CPU, memory and disk usage</h2>

<p>I was using Ganglia for monitoring Hadoop jobs, so I saved the graphs for the timeframe of the pipeline execution. I started to execute this analysis at 10AM, and finished about 2 and a half hours later (the process is not automated, so sometimes I had to check the output and documentation before executing the next step).</p>

<p>Following you&#8217;ll find the raw graphs and another version with legends to help understand what was being executed.</p>

<h3>CPU usage</h3>

<p style="text-align: center"><a href="/2012/09/25/bioinformatic-tools-series-stacks/cpu.png"><img src="/2012/09/25/bioinformatic-tools-series-stacks/cpu.png" alt="" title="CPU usage" width="747" height="418" class="aligncenter size-full wp-image-1043" /></a></p>

<p style="text-align: center"><a href="/2012/09/25/bioinformatic-tools-series-stacks/cpu_legends.png"><img src="/2012/09/25/bioinformatic-tools-series-stacks/cpu_legends.png" alt="" title="CPU usage with legends" width="747" height="418" class="aligncenter size-full wp-image-1050" /></a></p>

<h3>Memory usage</h3>

<p style="text-align: center"><a href="/2012/09/25/bioinformatic-tools-series-stacks/memory.png"><img src="/2012/09/25/bioinformatic-tools-series-stacks/memory.png" alt="" title="Memory usage" width="747" height="430" class="aligncenter size-full wp-image-1048" /></a></p>

<p style="text-align: center"><a href="/2012/09/25/bioinformatic-tools-series-stacks/memory_legends.png"><img src="/2012/09/25/bioinformatic-tools-series-stacks/memory_legends.png" alt="" title="Memory usage with legends" width="747" height="430" class="aligncenter size-full wp-image-1052" /></a></p>

<h3>Disk usage</h3>

<p>I thought the disk graphs from Ganglia wouldn&#8217;t represent the disk usage very well, specially since my disk has about 500GB, so it&#8217;s harder to see the changes. So I used some R to plot a graph that I hope can demonstrate the usage for this tutorial. <strong>It is important to highlight that we are using samples from a tutorial, and your analysis may produce high or lower disk usage.</strong></p>

<p style="text-align: center"><a href="/2012/09/25/bioinformatic-tools-series-stacks/disk.png"><img src="/2012/09/25/bioinformatic-tools-series-stacks/disk.png" alt="" title="Disk Usage" width="824" height="630" class="aligncenter size-full wp-image-1055" /></a></p>

<p>Hope it helps you using Stacks. Kudos to all developers and contributors of this great tool.</p>

<div class="highlight"><pre><span></span>disk<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">2.6</span><span class="p">,</span><span class="m">3.5</span><span class="p">,</span><span class="m">3.5</span><span class="p">,</span><span class="m">3.7</span><span class="p">,</span><span class="m">3.7</span><span class="p">,</span><span class="m">3.7</span><span class="p">,</span><span class="m">3.7</span><span class="p">)</span>
db<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">0.0008</span><span class="p">,</span><span class="m">1.7</span><span class="p">,</span><span class="m">1.7</span><span class="p">,</span><span class="m">1.7</span><span class="p">,</span><span class="m">1.7</span><span class="p">,</span><span class="m">1.8</span><span class="p">,</span><span class="m">1.8</span><span class="p">)</span>
x<span class="o">=</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">7</span><span class="p">)</span>
plot<span class="p">(</span>x<span class="o">=</span>x<span class="p">,</span> xlab<span class="o">=</span><span class="s">&quot;Tutorial Step (1 to 7)&quot;</span><span class="p">,</span> y<span class="o">=</span>disk<span class="p">,</span> ylab<span class="o">=</span><span class="s">&quot;Disk Usage (GB)&quot;</span><span class="p">,</span> col<span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">,</span> type<span class="o">=</span><span class="s">&quot;o&quot;</span><span class="p">,</span>ylim<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">6</span><span class="p">),</span>xlim<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">8</span><span class="p">))</span>
lines<span class="p">(</span>x<span class="o">=</span>x<span class="p">,</span> y<span class="o">=</span>db<span class="p">,</span> type<span class="o">=</span><span class="s">&quot;o&quot;</span><span class="p">,</span> pch<span class="o">=</span><span class="m">22</span><span class="p">,</span> lty<span class="o">=</span><span class="m">2</span><span class="p">,</span> col<span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">)</span>
title<span class="p">(</span>main<span class="o">=</span><span class="s">&quot;Disk Usage&quot;</span><span class="p">,</span> font.main<span class="o">=</span><span class="m">2</span><span class="p">)</span>
abline<span class="p">(</span>v<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="o">:</span><span class="m">8</span><span class="p">),</span> col<span class="o">=</span><span class="s">&quot;grey40&quot;</span><span class="p">,</span> lty<span class="o">=</span><span class="s">&quot;dotted&quot;</span><span class="p">)</span>
abline<span class="p">(</span>h<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="o">:</span><span class="m">5</span><span class="p">),</span> col<span class="o">=</span><span class="s">&quot;grey10&quot;</span><span class="p">,</span> lty<span class="o">=</span><span class="s">&quot;dotted&quot;</span><span class="p">)</span>
df <span class="o">=</span> <span class="kt">data.frame</span><span class="p">(</span>disk<span class="p">,</span>db<span class="p">)</span>
totals<span class="o">=</span><span class="kp">rowSums</span><span class="p">(</span>df<span class="p">,</span>na.rm<span class="o">=</span><span class="bp">T</span><span class="p">)</span>
lines<span class="p">(</span>x<span class="o">=</span>x<span class="p">,</span> y<span class="o">=</span>totals<span class="p">,</span> type<span class="o">=</span><span class="s">&quot;o&quot;</span><span class="p">,</span> pch<span class="o">=</span><span class="m">22</span><span class="p">,</span> lty<span class="o">=</span><span class="m">2</span><span class="p">,</span> col<span class="o">=</span><span class="s">&quot;green&quot;</span><span class="p">)</span> 
legend<span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="kt">c</span><span class="p">(</span><span class="s">&quot;DB&quot;</span><span class="p">,</span> <span class="s">&quot;Disk&quot;</span><span class="p">,</span> <span class="s">&quot;Total&quot;</span><span class="p">),</span> cex<span class="o">=</span><span class="m">0.6</span><span class="p">,</span>col<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="s">&quot;red&quot;</span><span class="p">,</span> <span class="s">&quot;blue&quot;</span><span class="p">,</span> <span class="s">&quot;green&quot;</span><span class="p">),</span>pch<span class="o">=</span><span class="m">21</span><span class="o">:</span><span class="m">23</span><span class="p">,</span>lty<span class="o">=</span><span class="m">1</span><span class="p">,</span>y.intersp<span class="o">=</span><span class="m">0.2</span><span class="p">,</span>x.intersp<span class="o">=</span><span class="m">0.2</span><span class="p">,</span>pt.lwd<span class="o">=</span><span class="m">1</span><span class="p">,</span>adj<span class="o">=</span><span class="m">0</span><span class="p">,</span>inset<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="m">0.5</span><span class="p">))</span>
</pre></div>

<h4>References</h4>

<ul>
<li>Stacks - <a href="http://creskolab.uoregon.edu/stacks/">http://creskolab.uoregon.edu/stacks/</a></li>
<li>Tutorial: building mini-contigs from paired-end sequences - <a href="http://creskolab.uoregon.edu/stacks/pe_tut.php">http://creskolab.uoregon.edu/stacks/pe_tut.php</a></li>
</ul>
  </div>
  <p class="postmetadata">
    
    <small>tags [&nbsp;<a href="/tag/bioinformatics" rel="tag">bioinformatics</a>&nbsp;]&nbsp;</small>
    
    
    <br/>
    <small>posted in [&nbsp;<a href="/bioinformatics" title="View all posts in bioinformatics" rel="category tag">bioinformatics</a>&nbsp;]&nbsp; category </small>
    
  </p>
  
</div>

                </div>
            </div>
        </div>
        <div class="ui vertical footer segment">
            <div class="ui center aligned container">
                           <div id="copy" class="">
                <p>&copy; <a href="/about"><span
                            class="b">Bru</span><span
                            class="r">no de</span> <span
                            class="a">Paula</span> <span
                            class="s"></span><span
                            class="i">Kinos</span><span
                            class="l">hita</span></a>
                </p>
            </div>
            </div>
         </div>
    </div>
</body>
</html>
<script src="/js/jquery-2.2.3.min.js"  type="text/javascript"></script>
<script src="/css/semantic/dist/semantic.min.js"  type="text/javascript"></script>
<script src="/js/jquery.prettyPhoto.js"></script>
<script src="/js/site.js"></script>