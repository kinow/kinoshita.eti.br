<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:url" content="https://kinoshita.eti.br/2012/10/20/replacing-a-hashset-with-a-bitset.html"><meta property="og:site_name" content="kinow"><meta property="og:title" content="Replacing a HashSet with a BitSet"><meta property="og:description" content="I always read the messages in the Apache dev mailing lists, including Apache Commons dev mailing list. And you should too. There are always interesting discussions. Sometimes you participate, other times you only watch what's happening, but in the end you always learn something new.
A few days ago, I found an issue where it was being proposed to replace an unnecessary HashSet in ArrayUtils#removeElements() by a BitSet. Here's how the code looked like: "><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2012-10-20T00:00:00+00:00"><meta property="article:modified_time" content="2024-05-04T19:16:36+02:00"><meta property="article:tag" content="Apache Software Foundation"><meta property="article:tag" content="Java"><meta property="article:tag" content="Opensource"><meta property="article:tag" content="Programming"><meta property="og:image" content="https://kinoshita.eti.br/assets/photos/about/2023-me-closeup.png"><meta property="fb:admins" content="bruno.kinoshita"><meta name=twitter:title content="Replacing a HashSet with a BitSet"><meta name=twitter:description content="I always read the messages in the Apache dev mailing lists, including Apache Commons dev mailing list. And you should too. There are always interesting discussions. Sometimes you participate, other times you only watch what's happening, but in the end you always learn something new.





  
  




A few days ago, I found an issue where it was being proposed to replace an unnecessary HashSet in ArrayUtils#removeElements() by a BitSet. Here's how the code looked like: "><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kinoshita.eti.br/assets/photos/about/2023-me-closeup.png"><meta name=twitter:site content="@kinow"><link rel=alternate type=application/rss+xml href=https://kinoshita.eti.br/2012/10/20/replacing-a-hashset-with-a-bitset/feed.xml title=kinow><link rel=stylesheet type=text/css href=https://kinoshita.eti.br/sass/main.c3626db3678f53e4a53e3e75c7b2fe34bb46566f00eb84692501404d0064c32a.css integrity="sha256-w2Jts2ePU+SlPj51x7L+NLtGVm8A64RpJQFATQBkwyo="><title>kinow | Replacing a HashSet with a BitSet</title><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"posts","name":"Replacing a HashSet with a BitSet","headline":"Replacing a HashSet with a BitSet","alternativeHeadline":"","description":"\u003cp\u003eI always read the messages in the \u003ca href=\u0022http:\/\/www.apache.org\/foundation\/mailinglists.html\u0022 title=\u0022Apache mailing lists\u0022\u003eApache dev mailing lists\u003c\/a\u003e, including Apache Commons \u003ca href=\u0022http:\/\/commons.apache.org\/mail-lists.html\u0022 title=\u0022Apache Commons mailing lists\u0022\u003edev mailing list\u003c\/a\u003e. And you should too. There are always interesting discussions. Sometimes you participate, other times you only watch what\u0027s happening, but in the end \u003cstrong\u003eyou always learn something new\u003c\/strong\u003e.\u003c\/p\u003e\n\n\n\n\u003cfigure class=\u0022feature\u0022\u003e\n\n  \u003cimg\n    src=\u0027\/assets\/posts\/2012-10-20-replacing-a-hashset-with-a-bitset\/feather_small.gif\u0027\n    alt=\u0027\u0027\n    title=\u0027\u0027\n    style=\u0027\u0027\n    width=\u0027\u0027\n    height=\u0027\u0027\n    \/\u003e\n  \u003cfigcaption\u003e\u003c\/figcaption\u003e\n\n\u003c\/figure\u003e\n\n\n\u003cp\u003eA few days ago, I found \u003ca href=\u0022https:\/\/issues.apache.org\/jira\/browse\/LANG-839\u0022 title=\u0022LANG-839\u0022\u003ean issue\u003c\/a\u003e where it was being proposed to replace an unnecessary \u003ca href=\u0022http:\/\/docs.oracle.com\/javase\/6\/docs\/api\/java\/util\/HashSet.html\u0022 title=\u0022HashSet\u0022\u003eHashSet\u003c\/a\u003e in \u003ca href=\u0022http:\/\/commons.apache.org\/lang\/api-release\/org\/apache\/commons\/lang3\/ArrayUtils.html\u0022 title=\u0022ArrayUtils\u0022\u003eArrayUtils\u003c\/a\u003e#removeElements() by a \u003ca href=\u0022http:\/\/docs.oracle.com\/javase\/6\/docs\/api\/java\/util\/BitSet.html\u0022 title=\u0022BitSet\u0022\u003eBitSet\u003c\/a\u003e. Here\u0027s how the code looked like: \u003c\/p\u003e","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/kinoshita.eti.br\/2012\/10\/20\/replacing-a-hashset-with-a-bitset.html"},"author":{"@type":"Person","name":"Bruno P. Kinoshita"},"creator":{"@type":"Person","name":"Bruno P. Kinoshita"},"accountablePerson":{"@type":"Person","name":"Bruno P. Kinoshita"},"copyrightHolder":"kinow","copyrightYear":"2012","dateCreated":"2012-10-20T00:00:00.00Z","datePublished":"2012-10-20T00:00:00.00Z","dateModified":"2024-05-04T19:16:36.00Z","publisher":{"@type":"Organization","name":"kinow","url":"https://kinoshita.eti.br/","logo":{"@type":"ImageObject","url":"https:\/\/kinoshita.eti.br\/","width":"32","height":"32"}},"image":"https://kinoshita.eti.br/","url":"https:\/\/kinoshita.eti.br\/2012\/10\/20\/replacing-a-hashset-with-a-bitset.html","wordCount":"392","genre":["apache software foundation","java","opensource","programming"],"keywords":[]}</script></head><body><header role=banner class=content><nav id=nav aria-label=Main role=navigation class=content><ul><li><a href=/><i data-feather=about></i> About</a></li><li><a href=/blog/><i data-feather=blog></i> Blog</a></li><li><a href=/portfolio/><i data-feather=portfolio></i> Portfolio</a></li></ul></nav></header><main><article class=content><h1>Replacing a HashSet with a BitSet</h1><div class=metadata><i data-feather=calendar></i>
<time datetime=2012-10-20>Oct 20, 2012</time></div><aside><nav id=TableOfContents></nav></aside><p>I always read the messages in the <a href=http://www.apache.org/foundation/mailinglists.html title="Apache mailing lists">Apache dev mailing lists</a>, including Apache Commons <a href=http://commons.apache.org/mail-lists.html title="Apache Commons mailing lists">dev mailing list</a>. And you should too. There are always interesting discussions. Sometimes you participate, other times you only watch what's happening, but in the end <strong>you always learn something new</strong>.</p><figure class=feature><img src=/assets/posts/2012-10-20-replacing-a-hashset-with-a-bitset/feather_small.gif alt title width height><figcaption></figcaption></figure><p>A few days ago, I found <a href=https://issues.apache.org/jira/browse/LANG-839 title=LANG-839>an issue</a> where it was being proposed to replace an unnecessary <a href=http://docs.oracle.com/javase/6/docs/api/java/util/HashSet.html title=HashSet>HashSet</a> in <a href=http://commons.apache.org/lang/api-release/org/apache/commons/lang3/ArrayUtils.html title=ArrayUtils>ArrayUtils</a>#removeElements() by a <a href=http://docs.oracle.com/javase/6/docs/api/java/util/BitSet.html title=BitSet>BitSet</a>. Here's how the code looked like:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>HashSet</span><span style=color:#000>&lt;</span><span style=color:#000>Integer</span><span style=color:#000>&gt;</span> <span style=color:#000>toRemove</span> <span style=color:#000>=</span> <span style=color:#a90d91>new</span> <span style=color:#000>HashSet</span><span style=color:#000>&lt;</span><span style=color:#000>Integer</span><span style=color:#000>&gt;</span>();
</span></span><span style=display:flex><span><span style=color:#a90d91>for</span> (<span style=color:#000>Map</span>.<span style=color:#836c28>Entry</span><span style=color:#000>&lt;</span><span style=color:#000>Character</span>, <span style=color:#000>MutableInt</span><span style=color:#000>&gt;</span> <span style=color:#000>e</span> : <span style=color:#000>occurrences</span>.<span style=color:#836c28>entrySet</span>()) {
</span></span><span style=display:flex><span>    <span style=color:#000>Character</span> <span style=color:#000>v</span> <span style=color:#000>=</span> <span style=color:#000>e</span>.<span style=color:#836c28>getKey</span>();
</span></span><span style=display:flex><span>    <span style=color:#a90d91>int</span> <span style=color:#000>found</span> <span style=color:#000>=</span> <span style=color:#000>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#a90d91>for</span> (<span style=color:#a90d91>int</span> <span style=color:#000>i</span> <span style=color:#000>=</span> <span style=color:#000>0</span>, <span style=color:#000>ct</span> <span style=color:#000>=</span> <span style=color:#000>e</span>.<span style=color:#836c28>getValue</span>().<span style=color:#836c28>intValue</span>(); <span style=color:#000>i</span> <span style=color:#000>&lt;</span> <span style=color:#000>ct</span>; <span style=color:#000>i</span><span style=color:#000>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#000>found</span> <span style=color:#000>=</span> <span style=color:#000>indexOf</span>(<span style=color:#000>array</span>, <span style=color:#000>v</span>.<span style=color:#836c28>charValue</span>(), <span style=color:#000>found</span>);
</span></span><span style=display:flex><span>        <span style=color:#a90d91>if</span> (<span style=color:#000>found</span> <span style=color:#000>&lt;</span> <span style=color:#000>0</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a90d91>break</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#000>toRemove</span>.<span style=color:#836c28>add</span>(<span style=color:#000>found</span><span style=color:#000>++</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>return</span> (<span style=color:#a90d91>char</span><span style=color:#000>[]</span>) <span style=color:#000>removeAll</span>((<span style=color:#000>Object</span>)<span style=color:#000>array</span>, <span style=color:#000>extractIndices</span>(<span style=color:#000>toRemove</span>));
</span></span></code></pre></div><p>The HashSet created at line 1, in the code above, was used to store the array index of the elements that should be removed. And at line 13 there is a call to removeAll method, passing the indexes to be removed. And here's how the new code looks like:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>BitSet</span> <span style=color:#000>toRemove</span> <span style=color:#000>=</span> <span style=color:#a90d91>new</span> <span style=color:#000>BitSet</span>();
</span></span><span style=display:flex><span><span style=color:#a90d91>for</span> (<span style=color:#000>Map</span>.<span style=color:#836c28>Entry</span><span style=color:#000>&lt;</span><span style=color:#000>Character</span>, <span style=color:#000>MutableInt</span><span style=color:#000>&gt;</span> <span style=color:#000>e</span> : <span style=color:#000>occurrences</span>.<span style=color:#836c28>entrySet</span>()) {
</span></span><span style=display:flex><span>    <span style=color:#000>Character</span> <span style=color:#000>v</span> <span style=color:#000>=</span> <span style=color:#000>e</span>.<span style=color:#836c28>getKey</span>();
</span></span><span style=display:flex><span>    <span style=color:#a90d91>int</span> <span style=color:#000>found</span> <span style=color:#000>=</span> <span style=color:#000>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#a90d91>for</span> (<span style=color:#a90d91>int</span> <span style=color:#000>i</span> <span style=color:#000>=</span> <span style=color:#000>0</span>, <span style=color:#000>ct</span> <span style=color:#000>=</span> <span style=color:#000>e</span>.<span style=color:#836c28>getValue</span>().<span style=color:#836c28>intValue</span>(); <span style=color:#000>i</span> <span style=color:#000>&lt;</span> <span style=color:#000>ct</span>; <span style=color:#000>i</span><span style=color:#000>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#000>found</span> <span style=color:#000>=</span> <span style=color:#000>indexOf</span>(<span style=color:#000>array</span>, <span style=color:#000>v</span>.<span style=color:#836c28>charValue</span>(), <span style=color:#000>found</span>);
</span></span><span style=display:flex><span>        <span style=color:#a90d91>if</span> (<span style=color:#000>found</span> <span style=color:#000>&lt;</span> <span style=color:#000>0</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a90d91>break</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#000>toRemove</span>.<span style=color:#836c28>set</span>(<span style=color:#000>found</span><span style=color:#000>++</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>return</span> (<span style=color:#a90d91>char</span><span style=color:#000>[]</span>) <span style=color:#000>removeAll</span>(<span style=color:#000>array</span>, <span style=color:#000>toRemove</span>);
</span></span></code></pre></div><p>The first difference is at line 1. Instead of a HashSet, it is now using a BitSet. And at line 10, instead of adding a new element to the HashSet, now it "sets" a bit in the set (the bit at the specified position is now true). But there are important changes at line 13. The method removeAll was changed, and now the array doesn't require a cast anymore. And the it is not necessary to cast the elements from HashSet anymore, as now the bit in the index position of the set is set to true. So the extractIndices method could be removed.</p><p>The code got simpler. But that's not all. At <a href=http://www.apache.org title="Apache Software Foundation">Apache Software Foundation</a> you can find a lot of talented developers - that's why I got so excited after joining them. Besides simplifying the code, the developer responsible for these changes (<strong>sebb</strong>) also pointed out that the new code <strong>consumes less memory and is faster</strong>. Ah! And he also wrote <strong>unit tests</strong><p>Categories:
<a href=/categories/blog.html>Blog</a></p><p>Tags:
<a href=/tags/apache-software-foundation.html>Apache Software Foundation</a>,
<a href=/tags/java.html>Java</a>,
<a href=/tags/opensource.html>Opensource</a>,
<a href=/tags/programming.html>Programming</a></p><aside class=links><a class=previous href=https://kinoshita.eti.br/2012/10/16/adding-coverage-reports-in-jenkins-with-googletest-and-gcovr.html>&#171; Previous</a><a class=next href=https://kinoshita.eti.br/2012/10/25/a-quick-view-on-wordpress-mantis-and-jenkins-plug-in-api.html>Next &#187;</a></aside></article></main><footer role=contentinfo><ul id=social-media-icons><li><a href=https://www.instagram.com/brunokinoshita/><img src=/assets/icons/instagram.png alt="Instagram link"></a></li><li><a href=https://twitter.com/kinow/><img src=/assets/icons/twitter.png alt="Twitter link"></a></li><li><a href=https://github.com/kinow/><img src=/assets/icons/github.png alt="GitHub link"></a></li><li><a href=/feed.xml><img src=/assets/icons/news.png alt="RSS feed link"></a></li></ul></footer></body></html>