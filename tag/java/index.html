  
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head profile="http://gmpg.org/xfn/11">
    <title>Bruno P. Kinoshita</title> 
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="description" content="Bruno de Paula Kinoshita personal web site" />
    <meta name="keywords"
        content="kinoshita, bruno de paula kinoshita, geek, geek stuff, java, python, c, c++, msn now playing, neural network, mackenzie, sao paulo, brasil, brazil, nerd, nerd stuff, cool, jenkins, illustration, quadrinhos, machine learning, linguistic, apache, open source, codigo livre, codigo aberto" />
    <meta name="author" content="" />
    <meta name="generator" content="PieCrust 3.2.1" />
    <meta name="template-engine" content="Twig" />
    <meta name="robots" content="all=index,follow" />
    <meta name="revisit-after" content="15 days" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta name="distribution" content="Global" />
    <meta name="url" content="/" />
    <meta name="copyright" content="Bruno de Paula Kinoshita" />
    <meta name="Googlebot" content="all" />
    <meta name="rating" content="general" />
    <meta http-equiv="expires" content="0" />
    <meta name="city" content="Sao Paulo" />
    <meta name="state" content="Brasil, Sao Paulo" />
    <meta http-equiv="content-language" content="en" />
    <meta http-equiv="imagetoolbar" content="no" />
    <meta id="page_favicon" href="/favicon.ico" rel="icon" type="image/x-icon" />
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link rel="alternate" type="application/rss+xml" title="Bruno P. Kinoshita &raquo; Feed" href="/feed.xml" />
    <link rel="stylesheet" href="/css/semantic/dist/semantic.min.css" type="text/css" media="screen, projection" />
    <link rel="stylesheet" href="/css/style.css" type="text/css" media="screen, projection" />
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="/css/blueprint/ie.css" type="text/css" media="screen, projection" />
    <![endif]-->
    <link rel="stylesheet" href="/css/prettyPhoto.css" type="text/css" media="all" />
</head>
<body id="body">
    <div class="ui vertical sidebar menu" id="toc">
        <nav class="menu" role="navigation">
    <div class="item">
        <a href="/" class="main-link">Kinoshita</a>
    </div>
    <div class="item">
        <a href="/art">Art</a>
    </div>
    <div class="item">
        <a href="/articles/">Articles</a>
    </div>
    <div class="item">
        <a href="/books/">Books</a>
    </div>
    <div class="item">
      <a href="/presentations/">Presentations</a>
    </div>
    <div class="item">
        <a href="/software/">Software</a>
    </div>
    <div class="item">
        <a href="/contact/">Contact</a>
    </div>
    <div class="item">
        <a href="/about/">About &#038; CV</a>
    </div>
</nav>
<img src="/img/bruno.jpg" title="Hmmmm" alt="My picture" width="134px" height="215px" />
    </div>
    <div class="ui black big launch right attached fixed button">
        <i class="content icon"></i>
        <span class="text">Menu</span>
    </div>
    <div class="ui fixed inverted main menu">
        <div class="ui container">
            <a class="launch icon item">
                <i class="content icon"></i>
            </a>
            <div class="item">
                
            </div>
        </div>
    </div>
    <div class="pusher">
        <div class="full height">
            <div class="toc">
                <div class="ui vertical sticky fixed top menu">
                    <nav class="menu" role="navigation">
    <div class="item">
        <a href="/" class="main-link">Kinoshita</a>
    </div>
    <div class="item">
        <a href="/art">Art</a>
    </div>
    <div class="item">
        <a href="/articles/">Articles</a>
    </div>
    <div class="item">
        <a href="/books/">Books</a>
    </div>
    <div class="item">
      <a href="/presentations/">Presentations</a>
    </div>
    <div class="item">
        <a href="/software/">Software</a>
    </div>
    <div class="item">
        <a href="/contact/">Contact</a>
    </div>
    <div class="item">
        <a href="/about/">About &#038; CV</a>
    </div>
</nav>
<img src="/img/bruno.jpg" title="Hmmmm" alt="My picture" width="134px" height="215px" />
                </div>
            </div>
            <div class="article">
                <div class="main container" role="main">
                    <!-- right fixed menu -->
                    <div class="ui dividing right rail" id="taxonomy">
                        <div class="ui sticky fixed top">
                            <br/>
                            <h4>Blog Taxonomy</h4>
                            <nav id="tag-cloud" class="sidebar-box" role="complementary">
                              
                              <span style="font-size: 22.5pt"><a href="/tag/apache%20software%20foundation">apache software foundation</a></span>&nbsp;(25)
                              
                              <span style="font-size: 12.5pt"><a href="/tag/articles">articles</a></span>&nbsp;(5)
                              
                              <span style="font-size: 11.5pt"><a href="/tag/aws">aws</a></span>&nbsp;(3)
                              
                              <span style="font-size: 13.5pt"><a href="/tag/c%2B%2B">c++</a></span>&nbsp;(7)
                              
                              <span style="font-size: 14.0pt"><a href="/tag/cylc">cylc</a></span>&nbsp;(8)
                              
                              <span style="font-size: 12.5pt"><a href="/tag/docker">docker</a></span>&nbsp;(5)
                              
                              <span style="font-size: 12.5pt"><a href="/tag/events">events</a></span>&nbsp;(5)
                              
                              <span style="font-size: 11.5pt"><a href="/tag/functional%20programming">functional programming</a></span>&nbsp;(3)
                              
                              <span style="font-size: 16.5pt"><a href="/tag/illustrations">illustrations</a></span>&nbsp;(13)
                              
                              <span style="font-size: 27.5pt"><a href="/tag/java">java</a></span>&nbsp;(35)
                              
                              <span style="font-size: 13.0pt"><a href="/tag/jena">jena</a></span>&nbsp;(6)
                              
                              <span style="font-size: 23.0pt"><a href="/tag/jenkins">jenkins</a></span>&nbsp;(26)
                              
                              <span style="font-size: 12.5pt"><a href="/tag/krita">krita</a></span>&nbsp;(5)
                              
                              <span style="font-size: 12.0pt"><a href="/tag/natural%20language%20processing">natural language processing</a></span>&nbsp;(4)
                              
                              <span style="font-size: 29.5pt"><a href="/tag/opensource">opensource</a></span>&nbsp;(39)
                              
                              <span style="font-size: 26.5pt"><a href="/tag/programming">programming</a></span>&nbsp;(33)
                              
                              <span style="font-size: 18.0pt"><a href="/tag/python">python</a></span>&nbsp;(16)
                              
                              <span style="font-size: 11.5pt"><a href="/tag/r">r</a></span>&nbsp;(3)
                              
                              <span style="font-size: 12.5pt"><a href="/tag/security">security</a></span>&nbsp;(5)
                              
                              <span style="font-size: 12.5pt"><a href="/tag/shell%20script">shell script</a></span>&nbsp;(5)
                              
                              <span style="font-size: 24.5pt"><a href="/tag/software%20quality">software quality</a></span>&nbsp;(29)
                              
                              <span style="font-size: 12.0pt"><a href="/tag/sparql">sparql</a></span>&nbsp;(4)
                              
                              <span style="font-size: 13.5pt"><a href="/tag/test%20anything%20protocol">test anything protocol</a></span>&nbsp;(7)
                              
                              <span style="font-size: 16.5pt"><a href="/tag/testlink">testlink</a></span>&nbsp;(13)
                              
                            </nav>
                            
                        </div>
                    </div>
                

Posts tagged with 'java'




<div class="ui raised padded container segment">
    <h2><a href="/2018/08/12/use-of-logging-in-java-image-processing-libraries" title="Permanent link">Use of Logging in Java Image Processing libraries</a></h2>
    <p><small>kinow</small> @ <small>Aug 12, 2018&nbsp;17:55:44</small></p>
    
    





<a href="https://twitter.com/share" class="twitter-share-button" data-url="https://kinoshita.eti.br/2018/08/12/use-of-logging-in-java-image-processing-libraries" data-text="Use of Logging in Java Image Processing libraries" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p='https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


    <p>For <a href="https://issues.apache.org/jira/browse/IMAGING-154">IMAGING-154</a> I was trying to think in a solution
for the <a href="https://github.com/apache/commons-imaging/blob/d2ec76bd10f30c39ae5180ede1254908e76045f0/src/main/java/org/apache/commons/imaging/util/Debug.java">existing <code>Debug</code></a>
class. This class was the issue of discussion during a
<a href="https://markmail.org/thread/ak3hcka7piykxixz#query:+page:1+mid:ppgxbhjx3opqlixj+state:results">previous 1.0 release vote thread</a>.</p>
<p>Initially I tried simply changing the class a bit, and make it configurable, so that we could keep it -
as there is a valid use case for having a class that collects information during the image processing
algorithms were applied.</p>
<p>And for me, the next step would naturally be to remove the use of <code>System.out</code>, as the <code>Debug</code> class
would now have a <code>PrintStream</code> that could be <code>System.out</code> or something else.</p>
<p>That&#8217;s when I realized in the current version of Apache Commons Imaging (n&eacute;e Sanselan) uses
<code>System.out</code> when debugging, but also when it wants to enable a
<a href="https://github.com/apache/commons-imaging/blob/d2ec76bd10f30c39ae5180ede1254908e76045f0/src/main/java/org/apache/commons/imaging/formats/gif/GifImageParser.java#L798">&ldquo;<em>verbose</em>&rdquo; mode</a>
in some classes.</p>
<p>I am using this post to collect a few cases, and check what other image processing images
are doing with regards to logging.</p>
<table>
<thead>
<tr>
<th align="center"><strong>Library</strong></th>
<th align="center"><strong>Logger</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Java ImageIO</td>
<td align="center">No logging (exceptions only)</td>
</tr>
<tr>
<td align="center">im4java</td>
<td align="center">No logging (exceptions only)</td>
</tr>
<tr>
<td align="center">opencv JNI</td>
<td align="center">No logging (exceptions only)</td>
</tr>
<tr>
<td align="center">GeoSolutions ImageIO-Ext</td>
<td align="center">java.util.logging</td>
</tr>
<tr>
<td align="center">Catalano</td>
<td align="center">java.util.logging</td>
</tr>
<tr>
<td align="center">Apache PDFBox JBIG2</td>
<td align="center">Custom Logger</td>
</tr>
<tr>
<td align="center">ImageJ2</td>
<td align="center">SciJava Logger</td>
</tr>
<tr>
<td align="center">Fiji</td>
<td align="center">SLF4J + logback</td>
</tr>
<tr>
<td align="center">OpenJPEG</td>
<td align="center">Custom Logger</td>
</tr>
<tr>
<td align="center">imgscalar</td>
<td align="center">System.out</td>
</tr>
<tr>
<td align="center">Apache Commons Imaging</td>
<td align="center">System.out</td>
</tr>
<tr>
<td align="center">Sanselan</td>
<td align="center">System.out</td>
</tr>
<tr>
<td align="center">Marvin</td>
<td align="center">System.out</td>
</tr>
<tr>
<td align="center">Processing</td>
<td align="center">System.out</td>
</tr>
</tbody>
</table><!-- html -->
    
<p class="postmetadata">
    
    <small>tags 
     [&nbsp;<a
        href="/tag/apache%20software%20foundation"
        rel="tag">apache software foundation</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/java"
        rel="tag">java</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/apache%20commons"
        rel="tag">apache commons</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/image%20processing"
        rel="tag">image processing</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/opensource"
        rel="tag">opensource</a>&nbsp;]&nbsp;
    
    </small>
    
    
</p>
</div>




<div class="ui raised padded container segment">
    <h2><a href="/2018/08/11/uuids-in-apache-jena" title="Permanent link">UUID's in Apache Jena</a></h2>
    <p><small>kinow</small> @ <small>Aug 11, 2018&nbsp;19:02:16</small></p>
    
    





<a href="https://twitter.com/share" class="twitter-share-button" data-url="https://kinoshita.eti.br/2018/08/11/uuids-in-apache-jena" data-text="UUID&#39;s in Apache Jena" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p='https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


    <p>In this post I won&#8217;t talk about what are UUID&#8217;s, or how they work in Java.
<a href="https://www.baeldung.com/java-uuid">Here</a>&#8216;s a great article on that. Or access the always reliable <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier">Wikipedia article</a>
about it. <em>(or if you would rather, read the <a href="http://www.ietf.org/rfc/rfc4122.txt">RFC 4122</a>)</em></p>
<p>I found out that Jena had UUID implementations after writing a 
<a href="/2018/05/29/what-happens-when-you-create-a-new-dataset-in-apache-jena-fuseki">previous post</a>.
And then decided to look into which UUID&#8217;s Jena has, and where these UUID&#8217;s
were used. This way I would either understand why Jena needed UUID&#8217;s, or
just be more educated in case I ever stumbled with a change in Jena that
required related work.</p>
<h2>Jena Core&#8217;s <em>org.apache.jena.shared.uuid</em></h2>
<p>This package is small and simply contains: <em>factories</em>,</p>
<p><a href="https://www.deviantart.com/kinow/art/Zatoichi-Crying-from-A-Tale-of-Zatoichi-758902187"><img style="float: right; height: 300px;" class="ui image" src="/2018/08/11/uuids-in-apache-jena/zatoichi_crying.png" alt="Zatoichi Crying" /></a></p>
<ul>
<li><code>UUIDFactory</code>: interface for a factory of UUID&#8217;s</li>
<li><code>UUID_V1_Gen</code>: a factory for <code>UUID_V1</code></li>
<li><code>UUID_V4_Gen</code>: a factory for <code>UUID_V4</code></li>
</ul>
<p>and <em>UUID implementations</em>,</p>
<ul>
<li><code>JenaUUID</code>: abstract base class for UUID implementations</li>
<li><code>UUID_nil</code>: a special UUID, <em>nil</em>, filled with zeroes</li>
<li><code>UUID_V1</code>: UUID V1</li>
<li><code>UUID_V4</code>: UUID V4</li>
</ul>
<p>and a <em>utility class</em></p>
<ul>
<li><code>LibUUID</code>: with methods to create a <code>Random</code> and to create <code>byte[]</code> seeds.</li>
</ul>
<p><code>JenaUUID</code> contains a method to return a <code>JenaUUID</code> as a Java&#8217;s <code>UUID</code>. And is used
in the command line utility <code>juuid</code>, for transaction ID&#8217;s, and when a new
dataset is created. For the new dataset, Fuseki will create files in a temporary
location. The name of the temporary location is created using an instance of
<code>JenaUUID</code>.</p>
<h3><em>UUID_V1</em> and <em>UUID_V4</em></h3>
<p>Jena&#8217;s <code>UUID_V1</code> is an implementation of Version 1 (<em>time based</em>),
variant 2 (<em>DCE</em>). Which means it uses MAC address and
timestamp to generate the universal unique ID&#8217;s.</p>
<p>It uses <code>NetworkInterface.getNetworkInterfaces()</code> to retrieve the MAC
address of the node running Jena. When using localhost, the MAC
address is not available, so it resorts to using a random number.</p>
<hr />
<p>And Jena&#8217;s <code>UUID_V4</code> is an implementation of Version 4(<em>random</em>),
variant 2 (<em>DCE</em>). Which means it uses random numbers to generate
the universal unique ID&#8217;s.</p>
<p>The factory for V4 will have a random for the most significant bits,
and for the least significant bits of the UUID (also including version
and variant). The random for the factory is created by <code>LibUUID#makeRandom()</code>.
This method returns a <code>SecureRandom</code> with two seeds, one being random, and
the other created with <code>LibUUID#makeSeed()</code>.</p>
<p><code>UUID_V4</code> uses a <code>SecureRandom</code> created locally but with the seed also set by
<code>LibUUID#makeSeed()</code>. The seed returned by this method may use the
MAC address, but will also use the <code>os.version</code>, <code>user.name</code>, <code>java.version</code>,
number of active threads, total memory, free memory, and the hash code
of a newly created <code>Object</code>.</p>
<h2>Transaction ID UUID (<em>TxnIdUuid</em>) &mdash; uses JenaUUID</h2>
<p>Jena contains two implementations of <code>TxnId</code> (transaction identifiers),</p>
<ul>
<li><code>TxnIdSimple</code>: transaction IDs are created with a counter within each JVM</li>
<li><code>TxnIdUuid</code>: transaction IDs are created using <code>JenaUUID</code>.</li>
</ul>
<p>The first thing that called my eye in this class was the inconsistency with the
name - which is quite normal in large projects such as Jena.</p>
<p>As <code>TxnIdUuid</code> calls <code>JenaUUID#generate()</code>, it will use the default factory,
<code>UUID_V1_Gen</code>. Then it will call <code>asUUID</code> to return a Java <code>UUID</code> object but
with the same UUID.</p>
<h2>Create a new dataset in Fuseki (<em>ActionDatasets</em>) &mdash; uses JenaUUID</h2>
<p>When you create a new dataset in Fuseki, as explained in the
<a href="/2018/05/29/what-happens-when-you-create-a-new-dataset-in-apache-jena-fuseki">previous post</a>,
Fuseki will create some temporary files and folders. For at least one folder, it will
use an instance of <code>JenaUUID</code>, in <code>ActionDatasets#execPostContainer()</code>.</p>
<h2>Blank node IDs (<em>BlankNodeId</em>) &mdash; uses Java&#8217;s UUID</h2>
<p>Blank nodes in Jena need an identifier too. It is possible to configure Jena
to either return a JVM bound counter (similarly to how <code>TxnIdSimple</code> works),
or otherwise blank nodes identifiers will be generated with
<code>java.util.UUID.randomUUID()</code>.</p>
<p><em><strong>I wonder why the transaction ID&#8217;s use Jena&#8217;s <code>JenaUUID</code>s, but the blank
node IDs use Java&#8217;s UUID</strong></em>? They are <a href="https://github.com/apache/jena/blob/7b011c30b6bf54db44b5b14408f103009adbdd67/jena-core/src/test/java/org/apache/jena/shared/uuid/TestUUID_JRE.java">compatible</a> anyway.</p>
<p>Other methods related to blank nodes also use Java&#8217;s <code>UUID</code>,</p>
<ul>
<li><code>BlankNodeAllocatorFixedSeedHash</code></li>
<li><code>BlankNodeAllocatorHash#freshSeed()</code>.</li>
</ul>
<h2>SPARQL functions, and <em>NodeFunctions</em> &mdash; uses Java&#8217;s UUID</h2>
<p>SPARQL 1.1 contains functions <a href="https://www.w3.org/TR/sparql11-query/#func-uuid"><code>UUID</code></a> and
<a href="https://www.w3.org/TR/sparql11-query/#func-struuid"><code>STRUUID</code></a>. Apache Jena provides
these two functions, and users can use them in queries such as</p>
<div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="p">(</span><span class="n">UUID</span><span class="p">()</span> <span class="k">AS</span> <span class="o">?</span><span class="n">uuid</span><span class="p">)</span> <span class="p">(</span><span class="n">StrUUID</span><span class="p">()</span> <span class="k">AS</span> <span class="o">?</span><span class="n">strUuid</span><span class="p">)</span> <span class="k">WHERE</span> <span class="err">{</span> <span class="err">}</span>
</pre></div>

<p>(but before users would have to call extra functions in a different namespace).</p>
<p>The function implementations use <code>NodeFunctions</code> methods <code>struuid</code> and <code>uuid</code>. Both methods in
<code>NodeFunctions</code> use Java&#8217;s <code>UUID</code>, and not <code>JenaUUID</code>.</p>
<h2>Files and directories for databases / datasets &mdash; uses Java&#8217;s UUID</h2>
<p>Files and directories created in Jena use Java&#8217;s <code>UUID</code>,</p>
<ul>
<li><code>BufferAllocatorMapped#getNewTemporaryFile()</code></li>
<li><code>TDBBuilder#create</code> methods and <code>ComponentIdMgr</code> constructor</li>
<li><code>AbstractDataBag#getNewTemporaryFile()</code>.</li>
</ul>
<h2>Conclusion</h2>
<p>In Jena there are places where instances of <code>JenaUUID</code> are used to produce a
UUID, and other places where Java&#8217;s <code>UUID</code> is used.</p>
<p>Java&#8217;s <code>UUID</code> provides a variant 2 version 4 (random DCE), which is equivalent to
<code>UUID_V4</code>. But there is no equivalent of <code>UUID_V1</code>, the default used in Jena.</p>
<p>And even though <code>UUID_V4</code> and <code>UUID</code> are compatible, I believe Jena&#8217;s version is using
a seed with so many JVM and operating system related settings (<code>os.version</code>, free memory, etc)
in order to have a unique seed per node running Jena, independent of whether there
are multiple JVM&#8217;s in the same node.</p>
<p>But to be honest, I am still not sure which one I would have to use, nor if there are
cases where I should pick one over the other&#8230;</p>
<p><em>EDIT: Apache Jena&#8217;s lead dev <a href="https://markmail.org/thread/vnys264p4c6lkc6l#query:+page:1+mid:raa7gaxconcnqbzp+state:results">replied</a> with a bit of history about the project too (:</em></p><!-- html -->
    
<p class="postmetadata">
    
    <small>tags 
     [&nbsp;<a
        href="/tag/apache%20software%20foundation"
        rel="tag">apache software foundation</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/java"
        rel="tag">java</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/jena"
        rel="tag">jena</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/opensource"
        rel="tag">opensource</a>&nbsp;]&nbsp;
    
    </small>
    
    
</p>
</div>




<div class="ui raised padded container segment">
    <h2><a href="/2018/05/29/what-happens-when-you-create-a-new-dataset-in-apache-jena-fuseki" title="Permanent link">What happens when you create a new dataset in Apache Jena Fuseki</a></h2>
    <p><small>kinow</small> @ <small>May 29, 2018&nbsp;18:59:04</small></p>
    
    





<a href="https://twitter.com/share" class="twitter-share-button" data-url="https://kinoshita.eti.br/2018/05/29/what-happens-when-you-create-a-new-dataset-in-apache-jena-fuseki" data-text="What happens when you create a new dataset in Apache Jena Fuseki" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p='https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


    <p><a href="/2018/05/27/what-happens-when-you-upload-a-turtle-file-in-apache-jena-fuseki">Last post</a>
was about what happens when you upload a Turtle file to Apache Jena Fuseki. And now today&#8217;s post will be about
what happens when you create a new dataset in Apache Jena Fuseki.</p>
<p>In theory, that happens before you upload a Turtle file, but this post series won&#8217;t follow a logical order.
It will be more based on what I find interesting.</p>
<p>Oh, the dataset created is <strong>an in-memory dataset</strong>. Here&#8217;s a simplified sequence diagram. Again,
these articles are more brain-dumps, used by myself for later reference.</p>
<p style='text-align: center;'>
<img style="display: inline; width: 100%;" class="ui image" src="/2018/05/29/what-happens-when-you-create-a-new-dataset-in-apache-jena-fuseki/sequence-diagram.png"  />
</p>

<h2>ActionDatasets#execPostContainer() (Fuseki Core)</h2>
<p><code>ActionDatasets</code>, as per the name, handles HTTP requests related to datasets. Such as when you
create a new dataset. It is also an HTTP action. The concept in Jena, as far as I could tell,
is similar to Jenkins&#8217; actions, but simpler, without the UI/Jelly/Groovy part.</p>
<p>This class also has a few static fields, which hold system information. One variable is actually
called <code>system</code>. (wonder how well it works if you try to deploy Jena Fuseki with multiple JVM&#8217;s
<a href="https://markmail.org/message/xpfcgccuwgycdopw"><sup>1</sup></a> <a href="https://afs.github.io/rdf-delta/ha-fuseki.html"><sup>2</sup></a>).</p>
<p>Its first task is to create an <em>UUID</em>, using <code>JenaUUID</code> (from Jena Core). This class looks
very interesting, <a href="/2018/08/11/uuids-in-apache-jena">wonder how it works</a>.</p>
<p>Then it creates a <code>DatasetDescriptionRegistry</code>, which is a registry to keep track
of the datasets created. There is also some validation of parameters and state check, and then
the transaction is started (<code>system.begin()</code>).</p>
<h2>Model / (Core)</h2>
<p>I used <code>Model</code> and <code>ModelFactory</code> before when working with ontologies and Prot&eacute;g&eacute;.
<code>ActionDatasets</code> will create a <code>Model</code>.</p>
<blockquote>    An RDF Model.

    An RDF model is a set of Statements.  Methods are provided for creating
    resources, properties and literals and the Statements which link them,
    for adding statements to and removing them from a model, for
    querying a model and set operations for combining models.
</blockquote>

<p>It also gets a <code>StreamRDF</code> from the model (i.e. <code>model.getGraph()</code>), which will be used
later by the <code>RDFParser</code>.</p>
<h2>ActionDatasets#assemblerFromForm() (Fuseki)</h2>
<p>In <code>#assemblerFromForm()</code>, it will create a template, and then use
<code>RDFParser</code> to parse the template and load into <code>SteamRFF</code>. The template looks like this:</p>
<div class="highlight"><pre><span></span><span class="c"># Licensed under the terms of http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="err">@</span><span class="k">prefix</span> <span class="p">:</span>        <span class="nl">&lt;#&gt;</span> <span class="p">.</span>
<span class="err">@</span><span class="k">prefix</span> <span class="nn">fuseki</span><span class="p">:</span>  <span class="nl">&lt;http://jena.apache.org/fuseki#&gt;</span> <span class="p">.</span>
<span class="err">@</span><span class="k">prefix</span> <span class="nn">rdf</span><span class="p">:</span>     <span class="nl">&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span> <span class="p">.</span>

<span class="err">@</span><span class="k">prefix</span> <span class="nn">rdfs</span><span class="p">:</span>    <span class="nl">&lt;http://www.w3.org/2000/01/rdf-schema#&gt;</span> <span class="p">.</span>
<span class="err">@</span><span class="k">prefix</span> <span class="nn">tdb</span><span class="p">:</span>     <span class="nl">&lt;http://jena.hpl.hp.com/2008/tdb#&gt;</span> <span class="p">.</span>
<span class="err">@</span><span class="k">prefix</span> <span class="nn">ja</span><span class="p">:</span>      <span class="nl">&lt;http://jena.hpl.hp.com/2005/11/Assembler#&gt;</span> <span class="p">.</span>

<span class="c">## ---------------------------------------------------------------</span>
<span class="c">## Updatable in-memory dataset.</span>

<span class="nl">&lt;#service1&gt;</span> <span class="nn">rdf</span><span class="p">:</span><span class="nt">type</span> <span class="nn">fuseki</span><span class="p">:</span><span class="nt">Service</span> <span class="p">;</span>
    <span class="c"># URI of the dataset -- http://host:port/aaa</span>
    <span class="nn">fuseki</span><span class="p">:</span><span class="nt">name</span>                        <span class="s">&quot;aaa&quot;</span> <span class="p">;</span>
    <span class="nn">fuseki</span><span class="p">:</span><span class="nt">serviceQuery</span>                <span class="s">&quot;sparql&quot;</span> <span class="p">;</span>
    <span class="nn">fuseki</span><span class="p">:</span><span class="nt">serviceQuery</span>                <span class="s">&quot;query&quot;</span> <span class="p">;</span>
    <span class="nn">fuseki</span><span class="p">:</span><span class="nt">serviceUpdate</span>               <span class="s">&quot;update&quot;</span> <span class="p">;</span>
    <span class="nn">fuseki</span><span class="p">:</span><span class="nt">serviceUpload</span>               <span class="s">&quot;upload&quot;</span> <span class="p">;</span>
    <span class="nn">fuseki</span><span class="p">:</span><span class="nt">serviceReadWriteGraphStore</span>  <span class="s">&quot;data&quot;</span> <span class="p">;</span>     
    <span class="nn">fuseki</span><span class="p">:</span><span class="nt">serviceReadGraphStore</span>       <span class="s">&quot;get&quot;</span> <span class="p">;</span>
    <span class="nn">fuseki</span><span class="p">:</span><span class="nt">dataset</span>                     <span class="nl">&lt;#dataset&gt;</span> <span class="p">;</span>
    <span class="p">.</span>

<span class="c"># Transactional, in-memory dataset. Initially empty.</span>
<span class="nl">&lt;#dataset&gt;</span> <span class="nn">rdf</span><span class="p">:</span><span class="nt">type</span> <span class="nn">ja</span><span class="p">:</span><span class="nt">DatasetTxnMem</span> <span class="p">.</span>
</pre></div>

<h2>Persisting the dataset</h2>
<p>Jena Fuseki will create a local copy of the template, using RIOT&#8217;s <code>RDFDataMgr</code>. For my environment, running from
Eclipse, the file location was <em>/home/kinow/Development/java/jena/jena/jena-fuseki2/jena-fuseki-core/run/system_files/902154aa-2bb6-11b2-8053-024232e7b374</em>.</p>
<p>Fuseki now will look for exactly one Service Name statement (http://jena.apache.org/fuseki#name). The
name will be validated for things like blank space, empty, &#8216;/&#8217;, etc.</p>
<p>Once the validation passes, then it will persist the file in somewhere like
/home/kinow/Development/java/jena/jena/jena-fuseki2/jena-fuseki-core/run/configuration/aaa.ttl. But
not without checking first it the file existed.</p>
<p>As this is a brand new file, the <code>Model</code> instance will be written on the file now.</p>
<h2>DatasetAccessPoint (ARQ)</h2>
<p>Funny, when I wrote it I immediately put this class under Fuseki Core, but it is actually
in ARQ. <strong>Why not in Fuseki?</strong>. Looks like ARQ has a Web layer too.</p>
<p>Fuseki&#8217;s <code>FusekiBuilder#buildDataAccessPoint()</code> creates the <code>DataAccessPoint</code>. The <code>DataAccessPoint</code>&#8216;s
Javadocs say: &ldquo;A name in the URL space of the server&rdquo;.</p>
<ul>
<li><code>DataService</code> contains operations, and endpoints</li>
<li>Services are added to endpoints, such as an endpoint for the <code>Quads_RW</code>, the <code>REST_Quads_RW</code> from previous post</li>
<li>The name and the data service are used to create the <code>DataAccessPoint</code></li>
</ul>
<p>The current <code>HttpAction</code> in the request contains a reference to Fuseki&#8217;s
<code>DataAccessPointRegistry</code>. Fuseki&#8217;s <code>DataAccessPointRegistry</code> extends Atlas&#8217;
<code>Registry</code>, which uses a <code>ConcurrentHashMap</code> (again, how does it work with multiple JVM&#8217;s?).</p>
<p>The new <code>DataAccessPoint</code> is registered with Fuseki&#8217;s registry (not the other registry).</p>
<p>And then, finally, the transaction is committed, the response is prepared (a 200 OK in <code>text/plain</code>).
And a <code>null</code> is returned, which means empty response.</p>
<p>And here&#8217;s some of the logs produced during this experiment.</p>
<div class="highlight"><pre><span></span><span class="o">[</span><span class="m">2018</span>-05-28 <span class="m">21</span>:11:43<span class="o">]</span> Config     INFO  Load configuration: file:///home/kinow/Development/java/jena/jena/jena-fuseki2/jena-fuseki-core/run/configuration/ds2.ttl
<span class="o">[</span><span class="m">2018</span>-05-28 <span class="m">21</span>:11:43<span class="o">]</span> Config     INFO  Load configuration: file:///home/kinow/Development/java/jena/jena/jena-fuseki2/jena-fuseki-core/run/configuration/p1.ttl
<span class="o">[</span><span class="m">2018</span>-05-28 <span class="m">21</span>:11:43<span class="o">]</span> Config     INFO  Register: /ds2
<span class="o">[</span><span class="m">2018</span>-05-28 <span class="m">21</span>:11:43<span class="o">]</span> Config     INFO  Register: /p1
<span class="o">[</span><span class="m">2018</span>-05-28 <span class="m">21</span>:11:43<span class="o">]</span> Server     INFO  Started <span class="m">2018</span>/05/28 <span class="m">21</span>:11:43 NZST on port <span class="m">3030</span>
<span class="o">[</span><span class="m">2018</span>-05-28 <span class="m">21</span>:11:52<span class="o">]</span> Admin      INFO  <span class="o">[</span><span class="m">1</span><span class="o">]</span> GET http://localhost:3030/$/server
<span class="o">[</span><span class="m">2018</span>-05-28 <span class="m">21</span>:11:52<span class="o">]</span> Admin      INFO  <span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="m">200</span> OK <span class="o">(</span><span class="m">11</span> ms<span class="o">)</span>
<span class="o">[</span><span class="m">2018</span>-05-28 <span class="m">21</span>:12:41<span class="o">]</span> Admin      INFO  <span class="o">[</span><span class="m">2</span><span class="o">]</span> GET http://localhost:3030/$/server
<span class="o">[</span><span class="m">2018</span>-05-28 <span class="m">21</span>:12:41<span class="o">]</span> Admin      INFO  <span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="m">200</span> OK <span class="o">(</span><span class="m">3</span> ms<span class="o">)</span>
<span class="o">[</span><span class="m">2018</span>-05-28 <span class="m">21</span>:22:33<span class="o">]</span> Admin      INFO  <span class="o">[</span><span class="m">3</span><span class="o">]</span> POST http://localhost:3030/$/datasets
<span class="o">[</span><span class="m">2018</span>-05-28 <span class="m">21</span>:46:25<span class="o">]</span> Admin      INFO  <span class="o">[</span><span class="m">3</span><span class="o">]</span> Create database : <span class="nv">name</span> <span class="o">=</span> /aaa
<span class="o">[</span><span class="m">2018</span>-05-28 <span class="m">22</span>:16:17<span class="o">]</span> Admin      INFO  <span class="o">[</span><span class="m">3</span><span class="o">]</span> <span class="m">200</span> OK <span class="o">(</span><span class="m">3</span>,224.390 s<span class="o">)</span>
<span class="o">[</span><span class="m">2018</span>-05-28 <span class="m">22</span>:16:18<span class="o">]</span> Admin      INFO  <span class="o">[</span><span class="m">4</span><span class="o">]</span> GET http://localhost:3030/$/server
<span class="o">[</span><span class="m">2018</span>-05-28 <span class="m">22</span>:16:18<span class="o">]</span> Admin      INFO  <span class="o">[</span><span class="m">4</span><span class="o">]</span> <span class="m">200</span> OK <span class="o">(</span><span class="m">8</span> ms<span class="o">)</span>
</pre></div>

<p>So that&#8217;s that.</p>
<p>Happy hacking !</p><!-- html -->
    
<p class="postmetadata">
    
    <small>tags 
     [&nbsp;<a
        href="/tag/jena"
        rel="tag">jena</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/apache%20software%20foundation"
        rel="tag">apache software foundation</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/java"
        rel="tag">java</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/sparql"
        rel="tag">sparql</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/opensource"
        rel="tag">opensource</a>&nbsp;]&nbsp;
    
    </small>
    
    
</p>
</div>




<div class="ui raised padded container segment">
    <h2><a href="/2018/04/28/learning-more-about-sparql-and-jena-internals" title="Permanent link">Learning more about SPARQL and Jena internals</a></h2>
    <p><small>kinow</small> @ <small>Apr 28, 2018&nbsp;18:20:28</small></p>
    
    





<a href="https://twitter.com/share" class="twitter-share-button" data-url="https://kinoshita.eti.br/2018/04/28/learning-more-about-sparql-and-jena-internals" data-text="Learning more about SPARQL and Jena internals" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p='https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


    <p style='text-align: center;'>
<a href="https://kinow.deviantart.com/art/O-Corvo-742473382"><img style="display: inline; width: 600px;" class="ui image" src="/2018/04/28/learning-more-about-sparql-and-jena-internals/ocorvo.jpg" alt="O Corvo" /></a>
<br/>
<small><a href="https://kinow.deviantart.com/art/O-Corvo-742473382">O Corvo</a></small>
</p>

<p>Recently a <a href="https://github.com/apache/jena/pull/114/">pull request</a> for Apache Jena
that I started three years ago got merged. Even though it has been three years since
that pull request, there are still many parts of the project code base that I am
not familiar with.</p>
<p>And not only the code, but there are also many concepts about SPARQL, other standards
used in Jena, and internals about triple stores.</p>
<p>The following list contains some presentations and posts that I am reading right now,
while I try to improve my knowledge of SPARQL and Jena internals.</p>
<ul>
<li><a href="https://www.slideshare.net/olafhartig/the-semantics-of-sparql">The Semantics of SPARQL</a><ul>
<li>Slides with information from Query parsing to Algebra and evaluating the Query</li>
</ul>
</li>
<li><a href="https://wiki.blazegraph.com/wiki/index.php/SPARQL_Order_Matters">SPARQL Order Matters</a><ul>
<li>Short but great post from Blazegraph about order in SPARQL queries with JOIN&#8217;s
and LEFT JOIN&#8217;s</li>
</ul>
</li>
<li><a href="https://gregheartsfield.com/2012/08/26/jena-arq-query-performance.html">Jena ARQ Query Performance</a><ul>
<li>Old post, but still very useful. Related to the post above, as it also talks about
query performances due to the order of statements</li>
</ul>
</li>
<li><a href="http://oracle.readthedocs.io/en/latest/sql/indexes/predicates-lhs-vs-rhs.html">Predicates: LHS vs RHS</a><ul>
<li>Oracle post for SQL, but this part applies to SPARQL, at least terminology-wise. LHS
and RHS appear in <a href="https://issues.apache.org/jira/browse/JENA-1534">some SPARQL related tickets</a>
/documentation too</li>
</ul>
</li>
</ul><!-- html -->
    
<p class="postmetadata">
    
    <small>tags 
     [&nbsp;<a
        href="/tag/jena"
        rel="tag">jena</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/apache%20software%20foundation"
        rel="tag">apache software foundation</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/java"
        rel="tag">java</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/sparql"
        rel="tag">sparql</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/opensource"
        rel="tag">opensource</a>&nbsp;]&nbsp;
    
    </small>
    
    
</p>
</div>




<div class="ui raised padded container segment">
    <h2><a href="/2017/12/25/exif-odd-offsets" title="Permanent link">Exif Odd Offsets</a></h2>
    <p><small>kinow</small> @ <small>Dec 25, 2017&nbsp;21:43:33</small></p>
    
    





<a href="https://twitter.com/share" class="twitter-share-button" data-url="https://kinoshita.eti.br/2017/12/25/exif-odd-offsets" data-text="Exif Odd Offsets" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p='https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


    <p>A file format like JPEG may contain metadata in JFIF, <a href="https://en.wikipedia.org/wiki/Exif">Exif</a>,
or a vendor proprietary format. The Exif format is based - or uses parts of - on the TIFF format.</p>
<p>Within an Exif metadata block, you should see directories, with several entries. The entries have fields
like description, value, and also an offset. The offset indicates the offset to the next entry.</p>
<p>The Exif specification defines that <strong>implementers must make sure to keep the offset an even number,
within 4 bytes</strong>.</p>
<p>I recently worked on <a href="https://issues.apache.org/jira/browse/IMAGING-205">IMAGING-205</a>, a ticket
about odd offsets in files with Exif metadata. This issue was exactly to address that when files
were rewritten with Apache Commons Imaging, even though the image initially had no odd offsets,
after the entries were rearranged, we could have odd offsets.</p>
<p>The fix was simply checking for odd offsets, adding +1, and later it would be put within the
4 bytes limit.</p>
<p style='text-align: center;'>
<img style="display: inline" class="ui image" src="/2017/12/25/exif-odd-offsets/screenshot.png" alt="A screen shot of Eclipse with source code" title="Locating the bug" />
<br/>
<small>Locating the bug</small>
</p>

<p>One interesting point, however, is that this is in the standard, but not all software that read
and write Exif follow the specification. So it is quite common to find images with odd offsets.</p>
<p>Which means you could take a picture with your phone, that contains some Exif metadata, and
be surprised to analyze it with <code>exiftool</code> and get warnings about odd offsets. Most viewers
handle odd and even offsets, so it should work for most cases, unless you have a strict reader/viewer.</p>
<p>Happy hacking!</p>
<p>&heart; Open Source</p><!-- html -->
    
<p class="postmetadata">
    
    <small>tags 
     [&nbsp;<a
        href="/tag/programming"
        rel="tag">programming</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/java"
        rel="tag">java</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/apache%20software%20foundation"
        rel="tag">apache software foundation</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/opensource"
        rel="tag">opensource</a>&nbsp;]&nbsp;
    
    </small>
    
    
</p>
</div>




<div id="navigation">
    
        &larr;&nbsp;<a href="/tag/java/2" id="navigation-next">Older Entries</a>
    
    
</div>



               </div>
            </div>
        </div>
        <div class="ui vertical footer segment">
            <div class="ui center aligned container">
                           <div id="copy" class="">
                <p>&copy; <a href="/about"><span
                            class="b">Bru</span><span
                            class="r">no de</span> <span
                            class="a">Paula</span> <span
                            class="s"></span><span
                            class="i">Kinos</span><span
                            class="l">hita</span></a>
                </p>
            </div>
            </div>
         </div>
    </div>
</body>
</html>
<script src="/js/jquery-2.2.3.min.js"  type="text/javascript"></script>
<script src="/css/semantic/dist/semantic.min.js"  type="text/javascript"></script>
<script src="/js/jquery.prettyPhoto.js"></script>
<script src="/js/site.js"></script>