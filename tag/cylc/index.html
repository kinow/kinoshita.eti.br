  
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head profile="http://gmpg.org/xfn/11">
    <title>Bruno P. Kinoshita</title> 
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="description" content="Bruno de Paula Kinoshita personal web site" />
    <meta name="keywords"
        content="kinoshita, bruno de paula kinoshita, geek, geek stuff, java, python, c, c++, msn now playing, neural network, mackenzie, sao paulo, brasil, brazil, nerd, nerd stuff, cool, jenkins, illustration, quadrinhos, machine learning, linguistic, apache, open source, codigo livre, codigo aberto" />
    <meta name="author" content="" />
    <meta name="generator" content="PieCrust 3.2.1" />
    <meta name="template-engine" content="Twig" />
    <meta name="robots" content="all=index,follow" />
    <meta name="revisit-after" content="15 days" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta name="distribution" content="Global" />
    <meta name="url" content="/" />
    <meta name="copyright" content="Bruno de Paula Kinoshita" />
    <meta name="Googlebot" content="all" />
    <meta name="rating" content="general" />
    <meta http-equiv="expires" content="0" />
    <meta name="city" content="Sao Paulo" />
    <meta name="state" content="Brasil, Sao Paulo" />
    <meta http-equiv="content-language" content="en" />
    <meta http-equiv="imagetoolbar" content="no" />
    <meta id="page_favicon" href="/favicon.ico" rel="icon" type="image/x-icon" />
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link rel="alternate" type="application/rss+xml" title="Bruno P. Kinoshita &raquo; Feed" href="/feed.xml" />
    <link rel="stylesheet" href="/css/semantic/dist/semantic.min.css" type="text/css" media="screen, projection" />
    <link rel="stylesheet" href="/css/style.css" type="text/css" media="screen, projection" />
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="/css/blueprint/ie.css" type="text/css" media="screen, projection" />
    <![endif]-->
    <link rel="stylesheet" href="/css/prettyPhoto.css" type="text/css" media="all" />
</head>
<body id="body">
    <div class="ui vertical sidebar menu" id="toc">
        <nav class="menu" role="navigation">
    <div class="item">
        <a href="/" class="main-link">Kinoshita</a>
    </div>
    <div class="item">
        <a href="/art">Art</a>
    </div>
    <div class="item">
        <a href="/articles/">Articles</a>
    </div>
    <div class="item">
        <a href="/books/">Books</a>
    </div>
    <div class="item">
      <a href="/presentations/">Presentations</a>
    </div>
    <div class="item">
        <a href="/software/">Software</a>
    </div>
    <div class="item">
        <a href="/contact/">Contact</a>
    </div>
    <div class="item">
        <a href="/about/">About &#038; CV</a>
    </div>
</nav>
<img src="/img/bruno.jpg" title="Hmmmm" alt="My picture" width="134px" height="215px" />
    </div>
    <div class="ui black big launch right attached fixed button">
        <i class="content icon"></i>
        <span class="text">Menu</span>
    </div>
    <div class="ui fixed inverted main menu">
        <div class="ui container">
            <a class="launch icon item">
                <i class="content icon"></i>
            </a>
            <div class="item">
                
            </div>
        </div>
    </div>
    <div class="pusher">
        <div class="full height">
            <div class="toc">
                <div class="ui vertical sticky fixed top menu">
                    <nav class="menu" role="navigation">
    <div class="item">
        <a href="/" class="main-link">Kinoshita</a>
    </div>
    <div class="item">
        <a href="/art">Art</a>
    </div>
    <div class="item">
        <a href="/articles/">Articles</a>
    </div>
    <div class="item">
        <a href="/books/">Books</a>
    </div>
    <div class="item">
      <a href="/presentations/">Presentations</a>
    </div>
    <div class="item">
        <a href="/software/">Software</a>
    </div>
    <div class="item">
        <a href="/contact/">Contact</a>
    </div>
    <div class="item">
        <a href="/about/">About &#038; CV</a>
    </div>
</nav>
<img src="/img/bruno.jpg" title="Hmmmm" alt="My picture" width="134px" height="215px" />
                </div>
            </div>
            <div class="article">
                <div class="main container" role="main">
                    <!-- right fixed menu -->
                    <div class="ui dividing right rail" id="taxonomy">
                        <div class="ui sticky fixed top">
                            <br/>
                            <h4>Blog Taxonomy</h4>
                            <nav id="tag-cloud" class="sidebar-box" role="complementary">
                              
                              <span style="font-size: 22.5pt"><a href="/tag/apache%20software%20foundation">apache software foundation</a></span>&nbsp;(25)
                              
                              <span style="font-size: 12.5pt"><a href="/tag/articles">articles</a></span>&nbsp;(5)
                              
                              <span style="font-size: 11.5pt"><a href="/tag/aws">aws</a></span>&nbsp;(3)
                              
                              <span style="font-size: 13.5pt"><a href="/tag/c%2B%2B">c++</a></span>&nbsp;(7)
                              
                              <span style="font-size: 14.0pt"><a href="/tag/cylc">cylc</a></span>&nbsp;(8)
                              
                              <span style="font-size: 12.5pt"><a href="/tag/docker">docker</a></span>&nbsp;(5)
                              
                              <span style="font-size: 12.5pt"><a href="/tag/events">events</a></span>&nbsp;(5)
                              
                              <span style="font-size: 11.5pt"><a href="/tag/functional%20programming">functional programming</a></span>&nbsp;(3)
                              
                              <span style="font-size: 16.5pt"><a href="/tag/illustrations">illustrations</a></span>&nbsp;(13)
                              
                              <span style="font-size: 27.5pt"><a href="/tag/java">java</a></span>&nbsp;(35)
                              
                              <span style="font-size: 13.0pt"><a href="/tag/jena">jena</a></span>&nbsp;(6)
                              
                              <span style="font-size: 23.0pt"><a href="/tag/jenkins">jenkins</a></span>&nbsp;(26)
                              
                              <span style="font-size: 12.5pt"><a href="/tag/krita">krita</a></span>&nbsp;(5)
                              
                              <span style="font-size: 12.0pt"><a href="/tag/natural%20language%20processing">natural language processing</a></span>&nbsp;(4)
                              
                              <span style="font-size: 29.5pt"><a href="/tag/opensource">opensource</a></span>&nbsp;(39)
                              
                              <span style="font-size: 26.5pt"><a href="/tag/programming">programming</a></span>&nbsp;(33)
                              
                              <span style="font-size: 18.0pt"><a href="/tag/python">python</a></span>&nbsp;(16)
                              
                              <span style="font-size: 11.5pt"><a href="/tag/r">r</a></span>&nbsp;(3)
                              
                              <span style="font-size: 12.5pt"><a href="/tag/security">security</a></span>&nbsp;(5)
                              
                              <span style="font-size: 12.5pt"><a href="/tag/shell%20script">shell script</a></span>&nbsp;(5)
                              
                              <span style="font-size: 24.5pt"><a href="/tag/software%20quality">software quality</a></span>&nbsp;(29)
                              
                              <span style="font-size: 12.0pt"><a href="/tag/sparql">sparql</a></span>&nbsp;(4)
                              
                              <span style="font-size: 13.5pt"><a href="/tag/test%20anything%20protocol">test anything protocol</a></span>&nbsp;(7)
                              
                              <span style="font-size: 16.5pt"><a href="/tag/testlink">testlink</a></span>&nbsp;(13)
                              
                            </nav>
                            
                        </div>
                    </div>
                

Posts tagged with 'cylc'




<div class="ui raised padded container segment">
    <h2><a href="/2018/12/22/running-cylc-tasks-on-pbs-torque-with-docker" title="Permanent link">Running Cylc tasks on PBS Torque with Docker</a></h2>
    <p><small>kinow</small> @ <small>Dec 22, 2018&nbsp;11:32:28</small></p>
    
    





<a href="https://twitter.com/share" class="twitter-share-button" data-url="https://kinoshita.eti.br/2018/12/22/running-cylc-tasks-on-pbs-torque-with-docker" data-text="Running Cylc tasks on PBS Torque with Docker" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p='https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


    <p>A few days ago I saw <a href="https://groups.google.com/forum/#!topic/cylc/dP2I1Gxqi20">a post</a> at the
Cylc Google Group, about file permissions for files generated by Cylc. The post was related to
content created by Cylc, but in an environment with PBS.</p>
<p>For context, Cylc is an Open Source meta-scheduler, written in Python, that allows you to
define cycle points with dependencies. These cycle points can be simple incremental integer
numbers, or ISO8601 periods or points (e.g. run every 5 minutes, from 10 days ago until the
next year). Cylc takes care to create an execution schedule for you, and delegate that to a
system that runs your workflow. I work full time on this amazing Open Source tool!</p>
<p>Such system could be the local computer in background, batch systems such as <code>at</code>, or PBS.
PBS was created for NASA, to manage executing jobs taking into consideration cluster resources,
and also using queues, priorities, and other features useful for HPC programming. Later PBS
was acquired by Altair, an Open Source version OpenPBS was created, and later abandoned. And
there is another fork called PBS Torque. I first encountered PBS at the S&atilde;o Paulo
University, in Brazil, where they had a <a href="http://www.usp.br/hpc/puma.php">PBS Torque cluster</a>.</p>
<h2>Running PBS Torque with Docker</h2>
<p>Even though I have access to an environment with Cylc and with PBS, I decided to give it a try
and see how hard it would be to reproduce it with Docker. One thing that I like about this
approach is the possibility to share the work with others online. I believe it improves
communication, agility, and can be useful for posterity.</p>
<!-- html -->
    
    <p>( <a href="/2018/12/22/running-cylc-tasks-on-pbs-torque-with-docker" >Read more ...</a> )</p>
    
<p class="postmetadata">
    
    <small>tags 
     [&nbsp;<a
        href="/tag/cylc"
        rel="tag">cylc</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/python"
        rel="tag">python</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/pbs"
        rel="tag">pbs</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/hpc"
        rel="tag">hpc</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/docker"
        rel="tag">docker</a>&nbsp;]&nbsp;
    
    </small>
    
    
</p>
</div>




<div class="ui raised padded container segment">
    <h2><a href="/2018/08/18/cylc-scheduler-internals-part-3" title="Permanent link">Cylc Scheduler Internals - Part 3</a></h2>
    <p><small>kinow</small> @ <small>Aug 18, 2018&nbsp;18:27:37</small></p>
    
    





<a href="https://twitter.com/share" class="twitter-share-button" data-url="https://kinoshita.eti.br/2018/08/18/cylc-scheduler-internals-part-3" data-text="Cylc Scheduler Internals - Part 3" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p='https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


    <p>This is part 2, in a series of posts about <a href="https://cylc.github.io/cylc">Cylc</a>
internals. The <a href="/2018/07/14/cylc-scheduler-internals-part-1">part 1</a>
had the beginning of the workflow. <a href="/2018/07/27/cylc-scheduler-internals-part-2">part 2</a>
documented from the moment the method <code>configure()</code> is called. This post will
continue right after the <code>continue()</code> method returns, going on with the next method: <code>run()</code>.</p>
<p><em>NB: this is a post to remember things, not really expecting to give someone enough
information to be able to hack the Cylc Scheduler (though you can and would have fun!).</em></p>
<p style='text-align: center;'>
<a href="/2018/08/18/cylc-scheduler-internals-part-3/cylc-scheduler_run.png">
<img style="display: inline; width: 100%;" class="ui image" src="/2018/08/18/cylc-scheduler-internals-part-3/cylc-scheduler_run.png"  />
</a>
</p>

<p>At this point, the Suite Server program must have been initialized, with the
objects that it requires, and with everything configured. So this method is the one
that starts the whole work on the tasks &amp; proxies.</p>
<p>The runahead points, i.e. what are the next available cycle points, are calculated
and scheduled. In the scheduling, tasks are queued for execution.</p>
<p>Most of the interesting action takes place when <code>process_task_pool()</code> is called,
and in the <code>submit_task_jobs()</code>. The latter is a method from <code>TaskJobManager</code>, and
it is here where - in this case - my shell command is executed through a temporary
shell script file.</p>
<p>The graph was created from the initial execution of a suite that was starting from
scratch (they can also be reinitialized). If there are multiple tasks waiting,
or if a suite was restarted, the diagram would look considerably different.</p>
<p>You can download the <a href="/2018/08/18/cylc-scheduler-internals-part-3/cylc-scheduler_run-src.xml">source file</a> for the diagram used in this post, and edit it
with <a href="https://draw.io">draw.io</a>.</p><!-- html -->
    
<p class="postmetadata">
    
    <small>tags 
     [&nbsp;<a
        href="/tag/cylc"
        rel="tag">cylc</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/python"
        rel="tag">python</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/opensource"
        rel="tag">opensource</a>&nbsp;]&nbsp;
    
    </small>
    
    
</p>
</div>




<div class="ui raised padded container segment">
    <h2><a href="/2018/08/04/creating-a-docker-container-to-run-as-a-command" title="Permanent link">Creating a Docker container to run as a command</a></h2>
    <p><small>kinow</small> @ <small>Aug 04, 2018&nbsp;22:00:36</small></p>
    
    





<a href="https://twitter.com/share" class="twitter-share-button" data-url="https://kinoshita.eti.br/2018/08/04/creating-a-docker-container-to-run-as-a-command" data-text="Creating a Docker container to run as a command" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p='https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


    <p>For the past two weeks at work I have been assigned to work on PHP projects. Though I used
PHP some time ago - especially with Code Igniter and Laravel - I have not used it in a few
years. And have been doing mostly Java nowadays.</p>
<p>The complete project setup was done by co-workers. I had a PHP project, using Symfony, several
bundles and libraries, and Postgres. But it required just running a few commands to set up
AWS settings, and then fire up Docker Compose.</p>
<p>Besides Docker Compose starting a web container, and another Postgres container, we used the
web container to run <a href="https://getcomposer.org/">Composer</a>. In the past, I would see the PHP
project mapped as a folder in the running container, and then composer would be executed
in the host.</p>
<p>I noticed then that I could do the same to an image I created in 2016 to run
<a href="https://cylc.github.io/cylc/">Cylc</a>. The <a href="https://github.com/kinow/docker/blob/d1cc1771ac53b8efd37b5e4c4401b74ebd294a2b/cylc/Dockerfile">previous version</a>
would be used to start a container in a terminal, then run some commands
while maintaining the state within the container.</p>
<p>The <a href="https://github.com/kinow/cylc-docker">new version</a>
now maps a volume to the version of cylc, installs the dependencies, and
then allows the state to be maintained solely in the mapped volume.</p>
<p>Furthermore, the entrypoint of the image is the <code>cylc</code> command. Which means that
you do not have to execute a terminal in order to run commands to the container
(or change the command/entrypoint).</p>
<div class="highlight"><pre><span></span>...
VOLUME <span class="s2">&quot;/opt/cylc&quot;</span> <span class="s2">&quot;/tmp&quot;</span> <span class="s2">&quot;/run&quot;</span> <span class="s2">&quot;/var/run&quot;</span> <span class="c1"># we have the state stored only in /opt/cylc</span>
WORKDIR <span class="s2">&quot;/opt/cylc&quot;</span>
ENV PATH /opt/cylc/bin:<span class="nv">$PATH</span>
WORKDIR /opt/cylc
ENTRYPOINT <span class="o">[</span><span class="s2">&quot;cylc&quot;</span><span class="o">]</span> <span class="c1"># here&#39;s the trick!</span>
</pre></div>

<p>It uses the same approach from the PHP image I am using for Composer, with a few
additional improvements from the <a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/">Best practices for writing Dockerfiles</a> documentation.</p>
<div class="highlight"><pre><span></span>$ docker run -ti -v <span class="s2">&quot;</span><span class="k">$(</span><span class="nb">pwd</span> -P<span class="k">)</span><span class="s2">&quot;</span>/cylc:/opt/cylc cylc validate /opt/cylc/etc/examples/tutorial/oneoff/basic/
Valid <span class="k">for</span> cylc-7.7.2
$ docker run -ti -v <span class="s2">&quot;</span><span class="k">$(</span><span class="nb">pwd</span> -P<span class="k">)</span><span class="s2">&quot;</span>/cylc:/opt/cylc cylc register /opt/cylc/etc/examples/tutorial/oneoff/basic/
REGISTER /opt/cylc/etc/examples/tutorial/oneoff/basic/
$ docker run -ti -v <span class="s2">&quot;</span><span class="k">$(</span><span class="nb">pwd</span> -P<span class="k">)</span><span class="s2">&quot;</span>/cylc:/opt/cylc cylc start --non-daemon --debug /opt/cylc/etc/examples/tutorial/oneoff/basic/
            ._.                                                       
            <span class="p">|</span> <span class="p">|</span>                 The Cylc Suite Engine <span class="o">[</span><span class="m">7</span>.7.2<span class="o">]</span>         
._____._. ._<span class="p">|</span> <span class="p">|</span>_____.           Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2008</span>-2018 NIWA          
<span class="p">|</span> .___<span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> .___<span class="p">|</span>  _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
<span class="p">|</span> !___<span class="p">|</span> !_! <span class="p">|</span> <span class="p">|</span> !___.  This program comes with ABSOLUTELY NO WARRANTY<span class="p">;</span>
!_____!___. <span class="p">|</span>_!_____!  see <span class="sb">`</span>cylc warranty<span class="sb">`</span>.  It is free software, you 
      .___! <span class="p">|</span>           are welcome to redistribute it under certain  
      !_____!                conditions<span class="p">;</span> see <span class="sb">`</span>cylc conditions<span class="sb">`</span>.       
<span class="m">2018</span>-07-30T12:10:32Z INFO - Suite starting: <span class="nv">server</span><span class="o">=</span>3714d1a17999:43040 <span class="nv">pid</span><span class="o">=</span><span class="m">1</span>
<span class="m">2018</span>-07-30T12:10:32Z INFO - Cylc version: <span class="m">7</span>.7.2
<span class="m">2018</span>-07-30T12:10:32Z INFO - Run mode: live
<span class="m">2018</span>-07-30T12:10:32Z INFO - Initial point: <span class="m">1</span>
<span class="m">2018</span>-07-30T12:10:32Z INFO - Final point: <span class="m">1</span>
<span class="m">2018</span>-07-30T12:10:32Z INFO - Cold Start <span class="m">1</span>
<span class="m">2018</span>-07-30T12:10:32Z DEBUG - <span class="o">[</span>hello.1<span class="o">]</span> -released to the task pool
<span class="m">2018</span>-07-30T12:10:32Z DEBUG - BEGIN TASK PROCESSING
<span class="m">2018</span>-07-30T12:10:32Z DEBUG - <span class="o">[</span>hello.1<span class="o">]</span> -waiting <span class="o">=</span>&gt; queued
<span class="m">2018</span>-07-30T12:10:32Z DEBUG - <span class="m">1</span> task<span class="o">(</span>s<span class="o">)</span> de-queued
<span class="m">2018</span>-07-30T12:10:32Z INFO - <span class="o">[</span>hello.1<span class="o">]</span> -submit-num<span class="o">=</span><span class="m">1</span>, owner@host<span class="o">=</span>localhost
<span class="m">2018</span>-07-30T12:10:32Z DEBUG - <span class="o">[</span>hello.1<span class="o">]</span> -queued <span class="o">=</span>&gt; ready
<span class="m">2018</span>-07-30T12:10:32Z DEBUG - END TASK PROCESSING <span class="o">(</span>took <span class="m">0</span>.00642895698547 seconds<span class="o">)</span>
<span class="m">2018</span>-07-30T12:10:32Z DEBUG - <span class="o">[</span><span class="s1">&#39;cylc&#39;</span>, <span class="s1">&#39;jobs-submit&#39;</span>, <span class="s1">&#39;--debug&#39;</span>, <span class="s1">&#39;--&#39;</span>, <span class="s1">&#39;/opt/cylc/etc/examples/tutorial/oneoff/basic/log/job&#39;</span>, <span class="s1">&#39;1/hello/01&#39;</span><span class="o">]</span>
<span class="m">2018</span>-07-30T12:10:33Z DEBUG - <span class="o">[</span>client-connect<span class="o">]</span> root@3714d1a17999:cylc-message <span class="nv">privilege</span><span class="o">=</span><span class="s1">&#39;full-control&#39;</span> 7b05596a-5971-4733-82de-28528f702ff0
<span class="m">2018</span>-07-30T12:10:33Z INFO - <span class="o">[</span>client-command<span class="o">]</span> put_messages root@3714d1a17999:cylc-message 7b05596a-5971-4733-82de-28528f702ff0
<span class="m">2018</span>-07-30T12:10:33Z DEBUG - <span class="o">[</span>jobs-submit cmd<span class="o">]</span> cylc jobs-submit --debug -- /opt/cylc/etc/examples/tutorial/oneoff/basic/log/job <span class="m">1</span>/hello/01
    <span class="o">[</span>jobs-submit ret_code<span class="o">]</span> <span class="m">0</span>
    <span class="o">[</span>jobs-submit out<span class="o">]</span>
    <span class="o">[</span>TASK JOB SUMMARY<span class="o">]</span><span class="m">2018</span>-07-30T12:10:32Z<span class="p">|</span><span class="m">1</span>/hello/01<span class="p">|</span><span class="m">0</span><span class="p">|</span><span class="m">61</span>
    <span class="o">[</span>TASK JOB COMMAND<span class="o">]</span><span class="m">2018</span>-07-30T12:10:32Z<span class="p">|</span><span class="m">1</span>/hello/01<span class="p">|</span><span class="o">[</span>STDOUT<span class="o">]</span> <span class="m">61</span>
<span class="m">2018</span>-07-30T12:10:33Z INFO - <span class="o">[</span>hello.1<span class="o">]</span> -<span class="o">(</span>current:ready<span class="o">)</span> submitted at <span class="m">2018</span>-07-30T12:10:32Z
<span class="m">2018</span>-07-30T12:10:33Z INFO - <span class="o">[</span>hello.1<span class="o">]</span> -job<span class="o">[</span><span class="m">01</span><span class="o">]</span> submitted to localhost:background<span class="o">[</span><span class="m">61</span><span class="o">]</span>
<span class="m">2018</span>-07-30T12:10:33Z DEBUG - <span class="o">[</span>hello.1<span class="o">]</span> -ready <span class="o">=</span>&gt; submitted
<span class="m">2018</span>-07-30T12:10:33Z INFO - <span class="o">[</span>hello.1<span class="o">]</span> -health check settings: submission <span class="nv">timeout</span><span class="o">=</span>None
<span class="m">2018</span>-07-30T12:10:33Z DEBUG - BEGIN TASK PROCESSING
<span class="m">2018</span>-07-30T12:10:33Z DEBUG - <span class="m">0</span> task<span class="o">(</span>s<span class="o">)</span> de-queued
<span class="m">2018</span>-07-30T12:10:33Z DEBUG - <span class="o">[</span>hello.1<span class="o">]</span> -forced spawning
<span class="m">2018</span>-07-30T12:10:33Z DEBUG - END TASK PROCESSING <span class="o">(</span>took <span class="m">0</span>.000992059707642 seconds<span class="o">)</span>
<span class="m">2018</span>-07-30T12:10:33Z INFO - <span class="o">[</span>hello.1<span class="o">]</span> -<span class="o">(</span>current:submitted<span class="o">)</span>&gt; started at <span class="m">2018</span>-07-30T12:10:33Z
<span class="m">2018</span>-07-30T12:10:33Z DEBUG - <span class="o">[</span>hello.1<span class="o">]</span> -submitted <span class="o">=</span>&gt; running
<span class="m">2018</span>-07-30T12:10:33Z INFO - <span class="o">[</span>hello.1<span class="o">]</span> -health check settings: execution <span class="nv">timeout</span><span class="o">=</span>None
<span class="m">2018</span>-07-30T12:10:34Z DEBUG - BEGIN TASK PROCESSING
<span class="m">2018</span>-07-30T12:10:34Z DEBUG - <span class="m">0</span> task<span class="o">(</span>s<span class="o">)</span> de-queued
<span class="m">2018</span>-07-30T12:10:34Z DEBUG - END TASK PROCESSING <span class="o">(</span>took <span class="m">0</span>.000984191894531 seconds<span class="o">)</span>
<span class="m">2018</span>-07-30T12:10:43Z DEBUG - <span class="o">[</span>client-connect<span class="o">]</span> root@3714d1a17999:cylc-message <span class="nv">privilege</span><span class="o">=</span><span class="s1">&#39;full-control&#39;</span> 524d658e-9932-4135-9523-3c2ace3990cf
<span class="m">2018</span>-07-30T12:10:43Z INFO - <span class="o">[</span>client-command<span class="o">]</span> put_messages root@3714d1a17999:cylc-message 524d658e-9932-4135-9523-3c2ace3990cf
<span class="m">2018</span>-07-30T12:10:43Z INFO - <span class="o">[</span>hello.1<span class="o">]</span> -<span class="o">(</span>current:running<span class="o">)</span>&gt; succeeded at <span class="m">2018</span>-07-30T12:10:43Z
<span class="m">2018</span>-07-30T12:10:43Z DEBUG - <span class="o">[</span>hello.1<span class="o">]</span> -running <span class="o">=</span>&gt; succeeded
<span class="m">2018</span>-07-30T12:10:43Z INFO - Suite shutting down - AUTOMATIC
<span class="m">2018</span>-07-30T12:10:44Z INFO - DONE
$
</pre></div>

<p>If you have a utility in your computer that requires a few dependencies, but that
can store the state/data in a mapped volume, the same kind of container may be
useful.</p><!-- html -->
    
<p class="postmetadata">
    
    <small>tags 
     [&nbsp;<a
        href="/tag/cylc"
        rel="tag">cylc</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/docker"
        rel="tag">docker</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/opensource"
        rel="tag">opensource</a>&nbsp;]&nbsp;
    
    </small>
    
    
</p>
</div>




<div class="ui raised padded container segment">
    <h2><a href="/2018/07/27/cylc-scheduler-internals-part-2" title="Permanent link">Cylc Scheduler Internals - Part 2</a></h2>
    <p><small>kinow</small> @ <small>Jul 27, 2018&nbsp;00:25:37</small></p>
    
    





<a href="https://twitter.com/share" class="twitter-share-button" data-url="https://kinoshita.eti.br/2018/07/27/cylc-scheduler-internals-part-2" data-text="Cylc Scheduler Internals - Part 2" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p='https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


    <p>This is part 2, in a series of posts about <a href="https://cylc.github.io/cylc">Cylc</a>
internals. The <a href="/2018/07/14/cylc-scheduler-internals-part-1">part 1</a>
had the beginning of the workflow. And here we will have the continuation, from
the moment the method <code>configure()</code> is called.</p>
<p><em>NB: this is a post to remember things, not really expecting to give someone enough
information to be able to hack the Cylc Scheduler (though you can and would have fun!).</em></p>
<p style='text-align: center;'>
<a href="/2018/07/27/cylc-scheduler-internals-part-2/cylc-scheduler_configure.png">
<img style="display: inline; width: 100%;" class="ui image" src="/2018/07/27/cylc-scheduler-internals-part-2/cylc-scheduler_configure.png"  />
</a>
</p>

<p>The <code>configure</code> method is responsible for configuring the Suite Server Program. Which
means it will interact with the configuration singletons to retrieve the necessary
configuration for the program.</p>
<p>It also interacts with other objects that store state, and also creates basic data structures
and objects required for a suite program (e.g. Queues).</p>
<p>This is also where the <strong>contact file</strong> is created, as well as the HTTP server.</p>
<p>You can download the <a href="/2018/07/27/cylc-scheduler-internals-part-2/cylc-scheduler_configure-src.xml">source file</a> for the diagram used in this post, and edit it
with <a href="https://draw.io">draw.io</a>.</p><!-- html -->
    
<p class="postmetadata">
    
    <small>tags 
     [&nbsp;<a
        href="/tag/cylc"
        rel="tag">cylc</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/python"
        rel="tag">python</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/opensource"
        rel="tag">opensource</a>&nbsp;]&nbsp;
    
    </small>
    
    
</p>
</div>




<div class="ui raised padded container segment">
    <h2><a href="/2018/07/14/cylc-scheduler-internals-part-1" title="Permanent link">Cylc Scheduler Internals - Part 1</a></h2>
    <p><small>kinow</small> @ <small>Jul 14, 2018&nbsp;22:42:47</small></p>
    
    





<a href="https://twitter.com/share" class="twitter-share-button" data-url="https://kinoshita.eti.br/2018/07/14/cylc-scheduler-internals-part-1" data-text="Cylc Scheduler Internals - Part 1" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p='https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


    <p>This is the first post in a series of three (or maybe four later) based on diagrams
I collected while debugging the Cylc scheduler. The scheduler is called by the <code>cylc start</code>
utility.</p>
<p><em>NB: this is a post to remember things, not really expecting to give someone enough
information to be able to hack the Cylc Scheduler (though you can and would have fun!).</em></p>
<p>Instead of going at length on what happens (and there is quite a bit happening when
you run <code>cylc start my.suite</code>), I will use the following diagram, followed by a few paragraphs
to highlight certain parts. The code used was based on <a href="https://github.com/cylc/cylc/tree/7.7.1">Cylc 7.7.1</a>.</p>
<p style='text-align: center;'>
<a href="/2018/07/14/cylc-scheduler-internals-part-1/cylc-scheduler_cli-workflow.png">
<img style="display: inline; width: 100%;" class="ui image" src="/2018/07/14/cylc-scheduler-internals-part-1/cylc-scheduler_cli-workflow.png"  />
</a>
</p>

<p>When a Cylc command like <code>cylc start</code> is invoked, it actually gets translated into
<code>bin/cylc-$command_name</code>. <code>cylc-start</code> is a Shell file, that will simply call <code>cylc-run</code>.
<code>cylc-run</code> then imports <code>scheduler_cli</code>&#8230; but what you need to know is that in the end
<code>scheduler_cli</code> will create an instance of <code>Scheduler</code> with the right constructor
arguments, and call its <code>start</code> method.</p>
<p>After that point, you are at the left-most lifeline, on the <code>Scheduler</code> constructor
(i.e. the <strong>init</strong> method of the scheduler.py&#8217;s Scheduler class).</p>
<p>If you follow the method calls - which are hopefully easy to understand and follow -
you will find that the constructor merely creates a few objects, prepares the suite
information, and the suite database.</p>
<p>Then the <code>start</code> method kicks things off, interacting with previously created objects,
but also with some singletons for logging and configuration. Oh, that <code>Cylc</code> banner
is also printed here (in case you would like to customize it as in SpringBoot).</p>
<p>After that, if you are running the suite as daemon, it will be
<a href="http://code.activestate.com/recipes/66012-fork-a-daemon-process-on-unix/">daemonized</a>,
by forking the current process, but with Python.</p>
<p>One important step that happens here, is the initialization of the HTTP Server. This server
will be used to communicate with the <strong>Suite Server Program</strong>. It will be listening to
connections with the right endpoints available only after the <code>configure</code> method.</p>
<p>Lastly, we have <code>configure</code> and <code>run</code> methods, which are two very important methods to be discussed
in the next part of this series, as they are quite extensive, and deserve their own diagrams.</p>
<p>You can download the <a href="/2018/07/14/cylc-scheduler-internals-part-1/cylc-scheduler_cli-workflow-src.xml">source file</a> for the diagram used in this post, and edit it
with <a href="https://draw.io">draw.io</a>.</p><!-- html -->
    
<p class="postmetadata">
    
    <small>tags 
     [&nbsp;<a
        href="/tag/cylc"
        rel="tag">cylc</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/python"
        rel="tag">python</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/opensource"
        rel="tag">opensource</a>&nbsp;]&nbsp;
    
    </small>
    
    
</p>
</div>




<div id="navigation">
    
        &larr;&nbsp;<a href="/tag/cylc/2" id="navigation-next">Older Entries</a>
    
    
</div>



               </div>
            </div>
        </div>
        <div class="ui vertical footer segment">
            <div class="ui center aligned container">
                           <div id="copy" class="">
                <p>&copy; <a href="/about"><span
                            class="b">Bru</span><span
                            class="r">no de</span> <span
                            class="a">Paula</span> <span
                            class="s"></span><span
                            class="i">Kinos</span><span
                            class="l">hita</span></a>
                </p>
            </div>
            </div>
         </div>
    </div>
</body>
</html>
<script src="/js/jquery-2.2.3.min.js"  type="text/javascript"></script>
<script src="/css/semantic/dist/semantic.min.js"  type="text/javascript"></script>
<script src="/js/jquery.prettyPhoto.js"></script>
<script src="/js/site.js"></script>