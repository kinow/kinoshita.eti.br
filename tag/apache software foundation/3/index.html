  
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head profile="http://gmpg.org/xfn/11">
    <title>Bruno P. Kinoshita</title> 
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="description" content="Bruno de Paula Kinoshita personal web site" />
    <meta name="keywords"
        content="kinoshita, bruno de paula kinoshita, geek, geek stuff, java, python, c, c++, msn now playing, neural network, mackenzie, sao paulo, brasil, brazil, nerd, nerd stuff, cool, jenkins, illustration, quadrinhos, machine learning, linguistic, apache, open source, codigo livre, codigo aberto" />
    <meta name="author" content="" />
    <meta name="generator" content="PieCrust 3.2.1" />
    <meta name="template-engine" content="Twig" />
    <meta name="robots" content="all=index,follow" />
    <meta name="revisit-after" content="15 days" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta name="distribution" content="Global" />
    <meta name="url" content="/" />
    <meta name="copyright" content="Bruno de Paula Kinoshita" />
    <meta name="Googlebot" content="all" />
    <meta name="rating" content="general" />
    <meta http-equiv="expires" content="0" />
    <meta name="city" content="Sao Paulo" />
    <meta name="state" content="Brasil, Sao Paulo" />
    <meta http-equiv="content-language" content="en" />
    <meta http-equiv="imagetoolbar" content="no" />
    <meta id="page_favicon" href="/favicon.ico" rel="icon" type="image/x-icon" />
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link rel="alternate" type="application/rss+xml" title="Bruno P. Kinoshita &raquo; Feed" href="/feed.xml" />
    <link rel="stylesheet" href="/css/semantic/dist/semantic.min.css" type="text/css" media="screen, projection" />
    <link rel="stylesheet" href="/css/style.css" type="text/css" media="screen, projection" />
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="/css/blueprint/ie.css" type="text/css" media="screen, projection" />
    <![endif]-->
    <link rel="stylesheet" href="/css/prettyPhoto.css" type="text/css" media="all" />
</head>
<body id="body">
    <div class="ui vertical sidebar menu" id="toc">
        <nav class="menu" role="navigation">
    <div class="item">
        <a href="/" class="main-link">Kinoshita</a>
    </div>
    <div class="item">
        <a href="/art">Art</a>
    </div>
    <div class="item">
        <a href="/contact/">Contact</a>
    </div>
    <div class="item">
        <a href="/about/">About</a>
    </div>
</nav>
<img src="/img/bruno.jpg" title="Hmmmm" alt="My picture" width="134px" height="215px" />
    </div>
    <div class="ui black big launch right attached fixed button">
        <i class="content icon"></i>
        <span class="text">Menu</span>
    </div>
    <div class="ui fixed inverted main menu">
        <div class="ui container">
            <a class="launch icon item">
                <i class="content icon"></i>
            </a>
            <div class="item">
                
            </div>
        </div>
    </div>
    <div class="pusher">
        <div class="full height">
            <div class="toc">
                <div class="ui vertical sticky fixed top menu">
                    <nav class="menu" role="navigation">
    <div class="item">
        <a href="/" class="main-link">Kinoshita</a>
    </div>
    <div class="item">
        <a href="/art">Art</a>
    </div>
    <div class="item">
        <a href="/contact/">Contact</a>
    </div>
    <div class="item">
        <a href="/about/">About</a>
    </div>
</nav>
<img src="/img/bruno.jpg" title="Hmmmm" alt="My picture" width="134px" height="215px" />
                </div>
            </div>
            <div class="article">
                <div class="main container" role="main">
                    <!-- right fixed menu -->
                    <div class="ui dividing right rail" id="taxonomy">
                        <div class="ui sticky fixed top">
                            <br/>
                            <h4>Blog Taxonomy</h4>
                            <nav id="tag-cloud" class="sidebar-box" role="complementary">
                              
                              <span style="font-size: 23.0pt"><a href="/tag/apache%20software%20foundation">apache software foundation</a></span>&nbsp;(26)
                              
                              <span style="font-size: 14.0pt"><a href="/tag/cylc">cylc</a></span>&nbsp;(8)
                              
                              <span style="font-size: 17.0pt"><a href="/tag/illustrations">illustrations</a></span>&nbsp;(14)
                              
                              <span style="font-size: 27.5pt"><a href="/tag/java">java</a></span>&nbsp;(35)
                              
                              <span style="font-size: 23.0pt"><a href="/tag/jenkins">jenkins</a></span>&nbsp;(26)
                              
                              <span style="font-size: 31.0pt"><a href="/tag/opensource">opensource</a></span>&nbsp;(42)
                              
                              <span style="font-size: 27.5pt"><a href="/tag/programming">programming</a></span>&nbsp;(35)
                              
                              <span style="font-size: 18.5pt"><a href="/tag/python">python</a></span>&nbsp;(17)
                              
                              <span style="font-size: 24.5pt"><a href="/tag/software%20quality">software quality</a></span>&nbsp;(29)
                              
                              <span style="font-size: 16.5pt"><a href="/tag/testlink">testlink</a></span>&nbsp;(13)
                              
                            </nav>
                            
                        </div>
                    </div>
                

Posts tagged with 'apache software foundation'




<div class="ui raised padded container segment">
    <h2><a href="/2017/09/01/finding-base64-implementations-in-apache-software-foundation-projects" title="Permanent link">Finding Base64 implementations in Apache Software Foundation projects</a></h2>
    <p><small>kinow</small> @ <small>Sep 01, 2017&nbsp;20:23:03</small></p>
    
    





<a href="https://twitter.com/share" class="twitter-share-button" data-url="https://kinoshita.eti.br/2017/09/01/finding-base64-implementations-in-apache-software-foundation-projects" data-text="Finding Base64 implementations in Apache Software Foundation projects" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p='https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


    <p style='text-align: center;'>
<a href="https://kinow.deviantart.com/art/Grey-Warbler-702099183?ga_submit_new=10%3A1504263729">
<img style="display: inline" class="ui image" src="/2017/09/01/finding-base64-implementations-in-apache-software-foundation-projects/GreyWarbler.png" alt="NZ Grey Warbler (riroriro)" title="NZ Grey Warbler (riroriro)" />
</a>
<br/>
<small><a href="http://nzbirdsonline.org.nz/species/grey-warbler">New Zealand Grey Warbler (riroriro)</a></small>
</p>

<p>Some time ago while working in one of the many projects in the Apache Software Foundation (Apache Commons FileUpload if I remember well), I noticed that it had a Base64 implementation. What called my attention was that the project not using the <a href="https://github.com/apache/commons-codec/blob/c18b1923b3c1f897c7935d94fb9e443eabfff897/src/main/java/org/apache/commons/codec/binary/Base64.java">Apache Commons Codec</a> Base64 implementation.</p>
<p>While Apache Commons&#8217; mission is to create components that can be re-used across ASF projects, and also by other projects not necessarily under the ASF, it is understandable that some projects prefer to keep its dependencies to a minimum. It is normally a good software engineering practice to carefully manage your dependencies.</p>
<p>But would Apache Commons FileUpload be the only project in the ASF with its own Base64 implementation?</p>
<h3>What is Base64?</h3>
<p>Simply put, Base64 is a way to encode bytes to strings. It utilises a table, to convert parts of the binary input to certain numbers. These numbers match an entry in the table used by the Base64 implementation. There are several Base64 implementations, though some are obsolete now.</p>
<p>The input text &ldquo;<em>this is base64!</em>&rdquo; results in &ldquo;<em>dGhpcyBpcyBiYXNlNjQh</em>&rdquo;. It can be decoded and will result in the same input text. An image can also be encoded. Or a ZIP file. This is helpful for data transfer and storage.</p>
<p>Apache Commons Codec is well known to provide a Bse64 implementation, and used in several projects, both Open Source and in the industry. Its implementation is based on the <a href="https://www.ietf.org/rfc/rfc2045.txt">RFC-2045</a>.</p>
<p>Java 8 contains a Base64 implementation, so that may very well replace Apache Commons Coded use in some projects, though that may take some time. The Java 8 implementation supports the RFC-2045, RFC-4648, and <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Base64.html">has also</a> support to the URL and MIME formats.</p>
<h3>Searching for other Base64 implementations</h3>
<p>Using GitHub search, I looked for other Base64 implementations in the ASF projects. Here&#8217;s the result table with only the custom implementations found after going through some 15 pages in more than 100 pages with hits for &ldquo;base64&rdquo;.</p>
<table>
<thead>
<tr>
<th>Project &amp; link to implementation</th>
<th align="center">JVM</th>
<th align="right">Base64 implementation</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/apache/activemq-artemis/blob/master/artemis-commons/src/main/java/org/apache/activemq/artemis/utils/Base64.java">Apache ActiveMQ Artemis</a></td>
<td align="center">8</td>
<td align="right">RFC-3548, based on http://iharder.net/base64</td>
</tr>
<tr>
<td><a href="https://github.com/apache/incubator-asterixdb-hyracks/blob/3f849969f01effc9b6e7f22462ceb4b2bedabdc4/hyracks/hyracks-util/src/main/java/org/apache/hyracks/util/bytes/Base64Parser.java">Apache AsterixDB Hyracks (Incubator)</a></td>
<td align="center">8</td>
<td align="right">?</td>
</tr>
<tr>
<td><a href="https://github.com/apache/calcite-avatica/blob/4db1fb9c66db8ccebc9e96ce678154ec69c557f0/core/src/main/java/org/apache/calcite/avatica/util/Base64.java">Apache Calcite Avatica</a></td>
<td align="center">7</td>
<td align="right">RFC-3548, based on http://iharder.net/base64</td>
</tr>
<tr>
<td><a href="https://github.com/apache/cayenne/blob/bd1b109a943307a83078399c7a4d6aa53631a065/cayenne-server/src/main/java/org/apache/cayenne/util/Base64Codec.java">Apache Cayenne</a></td>
<td align="center">8</td>
<td align="right">RFC-2045 (based on codec)</td>
</tr>
<tr>
<td><a href="https://github.com/apache/chemistry-opencmis/blob/trunk/chemistry-opencmis-commons/chemistry-opencmis-commons-impl/src/main/java/org/apache/chemistry/opencmis/commons/impl/Base64.java">Apache Chemistry</a></td>
<td align="center">7</td>
<td align="right">RFC-3548, based on http://iharder.net/base64</td>
</tr>
<tr>
<td><a href="https://github.com/apache/commons-fileupload/blob/422caf46e5b7a950c639b8ba9fe41e16279b3aa9/src/main/java/org/apache/commons/fileupload/util/mime/Base64Decoder.java">Apache Commons FileUpload</a></td>
<td align="center">6</td>
<td align="right">?</td>
</tr>
<tr>
<td><a href="https://github.com/apache/commons-net/blob/trunk/src/main/java/org/apache/commons/net/util/Base64.java">Apache Commons Net</a></td>
<td align="center">6</td>
<td align="right">RFC-2045 (copy of codec?)</td>
</tr>
<tr>
<td><a href="https://github.com/apache/directory-kerby/blob/b7da10e3815a8ab84ab7ff4fa3572c92bfa9aef5/kerby-common/kerby-util/src/main/java/org/apache/kerby/util/Base64.java">Apache Directory Kerby</a></td>
<td align="center">7</td>
<td align="right">RFC-2045 (copy of codec?)</td>
</tr>
<tr>
<td><a href="https://github.com/apache/felix/blob/a4755e768329a29252b1d7d8e52537941768606d/webconsole-plugins/upnp/src/main/java/org/apache/felix/webconsole/plugins/upnp/internal/Base64.java">Apache Felix</a></td>
<td align="center">5 (?)</td>
<td align="right">RFC-2045 (copy of codec?)</td>
</tr>
<tr>
<td><a href="https://github.com/apache/hbase/blob/a66d491892514fd4a188d6ca87d6260d8ae46184/hbase-common/src/main/java/org/apache/hadoop/hbase/util/Base64.java">Apache HBase</a></td>
<td align="center">8</td>
<td align="right">RFC-3548, based on http://iharder.net/base64</td>
</tr>
<tr>
<td><a href="https://github.com/apache/jackrabbit/blob/adb1e79ae26aba5d068be56e5e9eb562344e5bb9/jackrabbit-jcr-commons/src/main/java/org/apache/jackrabbit/util/Base64.java">Apache Jackrabbit</a></td>
<td align="center">8 (?)</td>
<td align="right">?</td>
</tr>
<tr>
<td><a href="https://github.com/apache/james-project/blob/bab5ff434c407b98432cdc9af00b0263184de26a/server/protocols/protocols-smtp/src/test/java/org/apache/james/smtpserver/Base64.java">Apache James</a></td>
<td align="center">6</td>
<td align="right">RFC-2045 via javax.mail.internet.MimeUtility</td>
</tr>
<tr>
<td><a href="https://github.com/apache/james-mime4j/blob/cb48082fb7cbbfb111c926cc8ae953d7261c235c/core/src/main/java/org/apache/james/mime4j/codec/Base64OutputStream.java">Apache James Mime4J</a></td>
<td align="center">5</td>
<td align="right">RFC-2045 (based on codec)</td>
</tr>
<tr>
<td><a href="https://github.com/apache/ofbiz-framework/blob/29b815f1b969653da96995fed25e2cc52f25879d/framework/base/src/main/java/org/apache/ofbiz/base/util/Base64.java">Apache OFBiz</a></td>
<td align="center">8</td>
<td align="right">RFC-2045</td>
</tr>
<tr>
<td><a href="https://github.com/apache/pivot/blob/d9a21718f182d3c667b18b0f2c62f6ec1cd0e6dd/core/src/org/apache/pivot/util/Base64.java">Apache Pivot</a></td>
<td align="center">6</td>
<td align="right">RFC-2045</td>
</tr>
<tr>
<td><a href="https://github.com/apache/qpid-broker-j/blob/1c20cc32b17c58391b0aefcd00f74bc1b4253db9/broker-core/src/main/java/org/apache/qpid/server/util/Strings.java#L132">Apache Qpid</a></td>
<td align="center">8</td>
<td align="right">? uses javax.xml.bind.DatatypeConverter#parseBase64Binary()</td>
</tr>
<tr>
<td><a href="https://github.com/apache/shiro/blob/8acc82ab4775b3af546e3bbde928f299be62dc23/lang/src/main/java/org/apache/shiro/codec/Base64.java">Apache Shiro</a></td>
<td align="center">6</td>
<td align="right">RFC-2045 (based on commons)</td>
</tr>
<tr>
<td><a href="https://github.com/apache/tomcat/blob/trunk/java/org/apache/tomcat/util/codec/binary/Base64.java">Apache Tomcat</a></td>
<td align="center">8</td>
<td align="right">RFC-2045 (copy of codec?)</td>
</tr>
<tr>
<td><a href="https://github.com/apache/tomee/blob/8fc8d8011c5155e7f47ebc162cb88124bf4ca06e/container/openejb-core/src/main/java/org/apache/openejb/util/Base64.java">Apache TomEE</a></td>
<td align="center">7</td>
<td align="right">RFC-2045</td>
</tr>
<tr>
<td><a href="https://github.com/apache/tomee-site-ng/blob/8dbf7c5a4bdc6cd5249e00ff85d78a24fd76c7af/container/openejb-core/src/main/java/org/apache/openejb/util/Base64.java">Apache TomEE (Site-NG)</a></td>
<td align="center">6</td>
<td align="right">RFC-2045</td>
</tr>
<tr>
<td><a href="https://github.com/apache/incubator-trafodion/blob/b36003cf824bae6b0faf8b03c313f189991d5be1/core/rest/src/main/java/org/trafodion/rest/util/Base64.java">Apache Trafodion (Incubator)</a></td>
<td align="center">7</td>
<td align="right">RFC-3548, based on http://iharder.net/base64</td>
</tr>
<tr>
<td><a href="https://github.com/apache/incubator-wave/blob/master/wave/src/main/java/org/waveprotocol/wave/model/util/CharBase64.java">Apache Wave (Incubator)</a></td>
<td align="center">7</td>
<td align="right">RFC-3548 (?), based on http://iharder.net/base64</td>
</tr>
</tbody>
</table>
<h3>Notes and conclusions</h3>
<ul>
<li><strong>Projects using Java 8 can likely remove its own implementation in favour of the new JVM 8 implementation</strong>.</li>
<li>Some projects were already using <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Base64.Decoder.html">Java 8 Base64 implementation</a>.</li>
<li>Some projects were using Apache Commons Codec.</li>
<li>Some projects were using the Base64 implementation from http://iharder.net/base64, which claims to be very fast. It could be interesting to further investigate it. Perhaps projects where Base64 is used a lot, there could be a significant performance increase by using this version.</li>
<li>Even though most of these projects are not using Apache Commons Codec, some have either copied or based their implementations on Apache Commons Codec. Perhaps shading would be more effective? Or maybe adding it as a dependency&hellip;</li>
<li>I guess the Base64 implementations could be hidden from external users with /*protected*/, private scope. As they are probably not part of Apache Commons Net, or Apache Cayenne public API. Which will be solved eventually after Java 9&hellip;</li>
<li>Some implementations do not make it clear which RFC or standard they are following. Some derived the reference work (e.g. Apache Wave (Incubator) modified the iharder removing features&hellip;).</li>
<li>It could be that some of these projects that contain many dependencies like Cayenne and Pivot may even have Commons Codec in the class path as a transitive dependency. If so, it could be interesting to add it as a dependency and remove its own implementation, or simply use Java 8&#8217;s.</li>
<li>Some implementations like HBase and Trafodion were not using the latest version from http://iharder.net/base64. In the case of HBase and Trafodion, several invalid inputs have been fixed from 2.2.1 to 2.3.7.</li>
</ul>
<h3>Future work</h3>
<ul>
<li>I will try to investigate which of these projects that have a custom Base64 implementation and are using Java 8 can be updated to throw away its own version (時間があるときでしょう!).</li>
<li>The implementation from <a href="http://iharder.net/base64">http://iharder.net/base64</a> promises to be very fast, and Apache ActiveMQ Artemis adopted it. We could consider adding a similar <em>fast</em> version to Apache Commons Codec. This could be a reason for keeping its own Base64 implementation.</li>
<li>Java 8 Base64 provides Base64, MIME, and URL formats for encode and decoding. Perhaps we could add more formats to Apache Commons Codec too. Even <a href="https://github.com/apache/commons-codec/pull/3">custom formats</a>. This could be a reason for keeping Apache Commons Codec&#8217;s implementation.</li>
</ul>
<p>Happy encoding!</p>
<p>&hearts; Open Source</p><!-- html -->
    
<p class="postmetadata">
    
    <small>tags 
     [&nbsp;<a
        href="/tag/java"
        rel="tag">java</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/programming"
        rel="tag">programming</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/opensource"
        rel="tag">opensource</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/apache%20software%20foundation"
        rel="tag">apache software foundation</a>&nbsp;]&nbsp;
    
    </small>
    
    
</p>
</div>




<div class="ui raised padded container segment">
    <h2><a href="/2017/06/10/backward-compatibility-and-switch-statements-with-constant-expressions" title="Permanent link">Backward compatibility and switch statement with constant expressions</a></h2>
    <p><small>kinow</small> @ <small>Jun 10, 2017&nbsp;17:35:39</small></p>
    
    





<a href="https://twitter.com/share" class="twitter-share-button" data-url="https://kinoshita.eti.br/2017/06/10/backward-compatibility-and-switch-statements-with-constant-expressions" data-text="Backward compatibility and switch statement with constant expressions" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p='https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


    <p>Maintaining Open Source software can be challenging. Making sure you keep backward compatibility (not only binary) can be even more challenging. <a href="https://commons.apache.org/proper/commons-lang/">Apache Commons Lang</a> 3.6 release is happening right now thanks to <a href="http://www.benediktritter.de/">Benedikt Ritter</a>, and it is on its fourth Release Candidate (i.e. RC4).</p>
<p>A previous RC2 was cancelled due to <a href="http://commons.markmail.org/thread/57sqt2hkusegda73#query:+page:1+mid:dnwo5tjqo2e5bwuo+state:results">IBM JDK 8 compatibility</a>, more specifically the lazy initialization of ArrayList&#8217;s seems to be different in Oracle JDK and IBM JDK.</p>
<p>The RC3 was cancelled due to a <a href="https://github.com/apache/commons-lang/commit/18e692478dcf91fdceb9b9fdca7c61a1111d63aa">change</a> that could affect users using a switch statement.</p>
<p>The change was in the <em>CharEncoding</em> class. The issue was that this class has some constants, that stopped being <a href="http://docs.oracle.com/javase/specs/jls/se8/html/jls-15.html#jls-15.28">constant expressions</a>.</p>
<blockquote>A constant expression is an expression denoting a value of primitive type or a String that does not complete abruptly and is composed using only the following (&#8230;)</blockquote>

<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CharEncoding</span> <span class="o">{</span>
    <span class="c1">// ...</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">ISO_8859_1</span> <span class="o">=</span> <span class="s">&quot;ISO-8859-1&quot;</span><span class="o">;</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>

<p>The code above contains a constant (<em>static final</em>) variable, that is a constant expression. So users can safely use it in switch statements, and the Java compiler won&#8217;t complain about it.</p>
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CharEncoding</span> <span class="o">{</span>
    <span class="c1">// ...</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">ISO_8859_1</span> <span class="o">=</span> <span class="n">StandardCharsets</span><span class="o">.</span><span class="na">ISO_8859_1</span><span class="o">.</span><span class="na">name</span><span class="o">();</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>

<p>The code above is from the change that caused the regression. Any user that was using the ISO_8859_1 constant variable in a switch statement would get a compilation error (e.g. <em>case expressions must be constant expressions</em>) when updating to Apache Commons Lang 3.6. That is because the constant variable is not a constant expression.</p>
<p>I think I learned that some time ago, but if you asked me what was wrong with the change, and if it would break backward compatibility, I would probably fail to spot the issue. There are tools for that now (e.g. Clirr, japicmp) though they may miss some cases too.</p>
<p>Luckily in this case a user subscribed to the Apache Commons development mailing list spotted the issue and quickly reported it. It gets easier maintaining an Open Source project with the constructive feedback of users, like this one.</p>
<p>&hearts; Open Source</p><!-- html -->
    
<p class="postmetadata">
    
    <small>tags 
     [&nbsp;<a
        href="/tag/java"
        rel="tag">java</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/programming"
        rel="tag">programming</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/apache%20software%20foundation"
        rel="tag">apache software foundation</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/opensource"
        rel="tag">opensource</a>&nbsp;]&nbsp;
    
    </small>
    
    
</p>
</div>




<div class="ui raised padded container segment">
    <h2><a href="/2017/06/02/apache-commons-text-lookuptranslator" title="Permanent link">Apache Commons Text LookupTranslator</a></h2>
    <p><small>kinow</small> @ <small>Jun 02, 2017&nbsp;22:50:39</small></p>
    
    





<a href="https://twitter.com/share" class="twitter-share-button" data-url="https://kinoshita.eti.br/2017/06/02/apache-commons-text-lookuptranslator" data-text="Apache Commons Text LookupTranslator" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p='https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


    <p><a href="http://commons.apache.org/proper/commons-text/">Apache Commons Text</a> includes several algorithms for text processing. Today&#8217;s post is about one of the classes available since the 1.0 release, the <a href="http://commons.apache.org/proper/commons-text/apidocs/org/apache/commons/text/translate/LookupTranslator.html">LookupTranslator</a>.</p>
<p>It is used to translate text using a lookup table. Most users won&#8217;t necessarily be - knowingly - using this class. Most likely, they will use the <a href="http://commons.apache.org/proper/commons-text/apidocs/org/apache/commons/text/StringEscapeUtils.html">StringEscapeUtils</a>, which contains methods to escape and unescape CSV, JSON, XML, Java, and EcmaScript.</p>
<div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">original</span> <span class="o">=</span> <span class="s">&quot;He didn&#39;t say, \&quot;stop!\&quot;&quot;</span><span class="o">;</span>
<span class="n">String</span> <span class="n">expected</span> <span class="o">=</span> <span class="s">&quot;He didn&#39;t say, \\\&quot;stop!\\\&quot;&quot;</span><span class="o">;</span>
<span class="n">String</span> <span class="n">result</span>   <span class="o">=</span> <span class="n">StringEscapeUtils</span><span class="o">.</span><span class="na">escapeJava</span><span class="o">(</span><span class="n">original</span><span class="o">);</span>
</pre></div>

<p>StringEscapeUtils uses CharSequenceTranslator&#8217;s, including LookupTranslator. You can use it directly too, to escape other data your text may contain, special characters not supported by some third party library or system, or even a simpler case.</p>
<p>In other words, you would be creating your own StringEscapeUtils. Let&#8217;s say you have some text where numbers must never start with the zero digital, due to some restriction in the way you use that data later.</p>
<div class="highlight"><pre><span></span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">lookupTable</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
<span class="n">lookupTable</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;a&quot;</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">);</span>
<span class="kd">final</span> <span class="n">LookupTranslator</span> <span class="n">escapeNumber0</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LookupTranslator</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">[][]</span> <span class="o">{</span> <span class="o">{</span><span class="s">&quot;0&quot;</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">}</span> <span class="o">});</span>
<span class="n">String</span> <span class="n">escaped</span> <span class="o">=</span> <span class="n">escapeNumber0</span><span class="o">.</span><span class="na">translate</span><span class="o">(</span><span class="s">&quot;There are 02 texts waiting for analysis today...&quot;</span><span class="o">);</span>
</pre></div>

<p>That way the resulting text would be &#8220;There are 2 texts waiting for analysis today&#8221;, allowing you to proceed with the rest of your analysis. This is a very simple example, but hopefully you grokked how LookupTranslator works.</p>
<p>&hearts; Open Source</p><!-- html -->
    
<p class="postmetadata">
    
    <small>tags 
     [&nbsp;<a
        href="/tag/apache%20software%20foundation"
        rel="tag">apache software foundation</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/java"
        rel="tag">java</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/opensource"
        rel="tag">opensource</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/programming"
        rel="tag">programming</a>&nbsp;]&nbsp;
    
    </small>
    
    
</p>
</div>




<div class="ui raised padded container segment">
    <h2><a href="/2017/05/28/some-links-related-to-apache-commons-text" title="Permanent link">Some links related to Apache Commons Text</a></h2>
    <p><small>kinow</small> @ <small>May 28, 2017&nbsp;19:50:39</small></p>
    
    





<a href="https://twitter.com/share" class="twitter-share-button" data-url="https://kinoshita.eti.br/2017/05/28/some-links-related-to-apache-commons-text" data-text="Some links related to Apache Commons Text" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p='https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


    <p><a href="http://commons.apache.org/proper/commons-text/">Apache Commons Text</a> is one of the most recent new components in Apache Commons. It &#8220;is a library focused on algorithms working on strings&#8221;. I recently collected some links
under a bookmark folder that are in some way related to the project. In case you are interested,
check some of the links below.</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=bx3NOoroV-M">Morgan Wahl Text is More Complicated Than You Think Comparing and Sorting Unicode PyCon 2017</a> <iframe width="560" height="315" src="https://www.youtube.com/embed/bx3NOoroV-M?rel=0" frameborder="0" allowfullscreen></iframe><ul>
<li>Q: test [text] to check if our methods are OK with some examples in this talk)</li>
<li>Q: Canonical Decomposition, and code points comparisons; are we doing it? Are we doing it right?</li>
<li>Q: Do we have casefolding?</li>
<li>Q: Do we have multi-level sort?</li>
<li>Q: CLDR</li>
</ul>
</li>
<li><a href="https://www.youtube.com/watch?v=7m5JA3XaZ4k">Łukasz Langa Unicode what is the big deal PyCon 2017</a> <iframe width="560" height="315" src="https://www.youtube.com/embed/7m5JA3XaZ4k?rel=0" frameborder="0" allowfullscreen></iframe><ul>
<li>Q: Quite sure we have an issue to guess the encoding for a text&#8230;. there is a GPL library for that? Under Mozilla perhaps?</li>
</ul>
</li>
<li><a href="https://www.youtube.com/watch?v=kTS2b6pGElE">Jiaqi Liu Fuzzy Search Algorithms How and When to Use Them PyCon 2017</a> <iframe width="560" height="315" src="https://www.youtube.com/embed/kTS2b6pGElE?rel=0" frameborder="0" allowfullscreen></iframe><ul>
<li>Q: Does OpenNLP have N-GRAM&#8217;s? Would it make sense to have that in [text]?</li>
<li>Q: Where can we find some tokenizers? OpenNLP?</li>
</ul>
</li>
<li><a href="http://www-igm.univ-mlv.fr/~berstel/Lothaire/">Lothaire&#8217;s Books</a> like &#8220;Combinatorics on Words&#8221; and &#8220;Algebraic Combinatorics&#8221;.</li>
<li>Java tutorial lesson <a href="https://docs.oracle.com/javase/tutorial/i18n/text/">&#8220;Working with Text&#8221;</a></li>
<li>Mitzi Morris&#8217; <a href="https://www.amazon.com/Text-Processing-Java-Mitzi-Morris/dp/0988208725">Text Processing in Java book</a></li>
<li><a href="http://johannburkard.de/software/stringsearch/">StringSearch</a> java library.<ul>
<li><blockquote>&#8220;The Java language lacks fast string searching algorithms. StringSearch provides implementations of the Boyer-Moore and the Shift-Or (bit-parallel) algorithms. These algorithms are easily five to ten times faster than the na&iuml;ve implementation found in java.lang.String&#8221;.</blockquote></li>
</ul>
</li>
<li><a href="https://jakarta.apache.org/oro/">Jakarta Oro</a> (attic)<ul>
<li><blockquote>The Jakarta-ORO Java classes are a set of text-processing Java classes that provide Perl5 compatible regular expressions, AWK-like regular expressions, glob expressions, and utility classes for performing substitutions, splits, filtering filenames, etc. This library is the successor to the OROMatcher, AwkTools, PerlTools, and TextTools libraries originally from ORO, Inc. Despite little activity in the form of new development initiatives, issue reports, questions, and suggestions are responded to quickly.</blockquote></li>
<li>Discontinued, but is there anything useful in there? The attic has always interesting things after all&#8230;</li>
</ul>
</li>
<li><a href="http://textprocessing.org/">TextProcessing blog</a> - A Text Processing Portal for Humans</li>
<li><a href="https://github.com/twitter/twitter-text">twitter-text</a>, the Twitter Java (multi-language actually&#8230;) text processing library.</li>
<li>Python&#8217;s <a href="https://docs.python.org/3/library/text.html">text modules</a></li>
</ul>
<p>&hearts; Open Source</p><!-- html -->
    
<p class="postmetadata">
    
    <small>tags 
     [&nbsp;<a
        href="/tag/apache%20software%20foundation"
        rel="tag">apache software foundation</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/java"
        rel="tag">java</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/opensource"
        rel="tag">opensource</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/programming"
        rel="tag">programming</a>&nbsp;]&nbsp;
    
    </small>
    
    
</p>
</div>




<div class="ui raised padded container segment">
    <h2><a href="/2017/05/15/when-you-dont-realize-you-need-a-comparable" title="Permanent link">When you don't realize you need a Comparable</a></h2>
    <p><small>kinow</small> @ <small>May 15, 2017&nbsp;23:07:39</small></p>
    
    





<a href="https://twitter.com/share" class="twitter-share-button" data-url="https://kinoshita.eti.br/2017/05/15/when-you-dont-realize-you-need-a-comparable" data-text="When you don&#39;t realize you need a Comparable" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p='https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


    <p><a href="/2012/10/20/replacing-a-hashset-with-a-bitset">In 2012, I wrote</a> about how you always learn something new by following the <a href="http://www.apache.org/foundation/mailinglists.html">Apache dev mailing lists</a>.</p>
<p>After about five years, I am still learning, and still getting impressed by the knowledge of other
developers. Days ago I was massaging some code in <a href="https://github.com/apache/jena/pull/237">a pull request</a>
and a developer suggested me to simplify my code.</p>
<p>The suggestion was to make a class a <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Comparable.html">Comparable type</a>
to both simplify the code, and also have a better design. I immediately agreed, and looking back in hindsight,
it was the most logical choice. Yet, I simply did not think about that.</p>
<div class="highlight"><pre><span></span><span class="c1">// What the code was</span>
<span class="k">case</span> <span class="n">VSPACE_SORTKEY</span> <span class="o">:</span>
    <span class="kt">int</span> <span class="n">cmp</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">c1</span> <span class="o">=</span> <span class="n">nv1</span><span class="o">.</span><span class="na">getCollation</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">c2</span> <span class="o">=</span> <span class="n">nv2</span><span class="o">.</span><span class="na">getCollation</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">c1</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">c2</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">c1</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">c2</span><span class="o">))</span> <span class="o">{</span>
        <span class="c1">// locales are parsed. Here we could think about caching if necessary</span>
        <span class="n">Locale</span> <span class="n">desiredLocale</span> <span class="o">=</span> <span class="n">Locale</span><span class="o">.</span><span class="na">forLanguageTag</span><span class="o">(</span><span class="n">c1</span><span class="o">);</span>
        <span class="n">Collator</span> <span class="n">collator</span> <span class="o">=</span> <span class="n">Collator</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">desiredLocale</span><span class="o">);</span>
        <span class="n">cmp</span> <span class="o">=</span> <span class="n">collator</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="n">nv1</span><span class="o">.</span><span class="na">getString</span><span class="o">(),</span> <span class="n">nv2</span><span class="o">.</span><span class="na">getString</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">cmp</span> <span class="o">=</span> <span class="n">XSDFuncOp</span><span class="o">.</span><span class="na">compareString</span><span class="o">(</span><span class="n">nv1</span><span class="o">,</span> <span class="n">nv2</span><span class="o">)</span> <span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">cmp</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="c1">// What the code is now</span>
<span class="k">case</span> <span class="n">VSPACE_SORTKEY</span> <span class="o">:</span>
    <span class="k">return</span> <span class="o">((</span><span class="n">NodeValueSortKey</span><span class="o">)</span> <span class="n">nv1</span><span class="o">).</span><span class="na">compareTo</span><span class="o">((</span><span class="n">NodeValueSortKey</span><span class="o">)</span> <span class="n">nv2</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>

<p>This moved the logic to a method in the <code>NodeValueSortKey</code> class. This reduced the complexity
of the class with the <code>switch</code> statement. And it also made it easier to write unit tests.</p>
<p>If you are not involved in Open Source projects yet, I keep my suggestion from five years ago.
Find a project related to something you like, and start reading the code, lurk in the
mailing list or watch GitHub repositories.</p>
<p>You can always learn more!</p>
<p>&hearts; Open Source</p><!-- html -->
    
<p class="postmetadata">
    
    <small>tags 
     [&nbsp;<a
        href="/tag/apache%20software%20foundation"
        rel="tag">apache software foundation</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/java"
        rel="tag">java</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/opensource"
        rel="tag">opensource</a>&nbsp;]&nbsp;
    
     [&nbsp;<a
        href="/tag/programming"
        rel="tag">programming</a>&nbsp;]&nbsp;
    
    </small>
    
    
</p>
</div>




<div id="navigation">
    
        &larr;&nbsp;<a href="/tag/apache%20software%20foundation/4" id="navigation-next">Older Entries</a>
    
    
        &mdash; <a href="/tag/apache%20software%20foundation/2" id="navigation-next">Newer Entries</a>&nbsp;&rarr;
    
</div>



               </div>
            </div>
        </div>
        <div class="ui vertical footer segment" id="footer">
            <div class="ui center aligned container">
                           <div id="copy" class="">
                <p>&copy; <a href="/about"><span
                            class="b">Bru</span><span
                            class="r">no de</span> <span
                            class="a">Paula</span> <span
                            class="s"></span><span
                            class="i">Kinos</span><span
                            class="l">hita</span></a>
                </p>
            </div>
            </div>
         </div>
    </div>
</body>
</html>
<script src="/js/jquery-2.2.3.min.js"  type="text/javascript"></script>
<script src="/css/semantic/dist/semantic.min.js"  type="text/javascript"></script>
<script src="/js/jquery.prettyPhoto.js"></script>
<script src="/js/site.js"></script>