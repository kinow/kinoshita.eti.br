  
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head profile="http://gmpg.org/xfn/11">
    <title>Bruno P. Kinoshita &mdash; Tag</title> 
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="description" content="Bruno de Paula Kinoshita personal web site" />
    <meta name="keywords"
        content="kinoshita, bruno de paula kinoshita, geek, geek stuff, java, python, c, c++, msn now playing, neural network, mackenzie, sao paulo, brasil, brazil, nerd, nerd stuff, cool, jenkins, illustration, quadrinhos, machine learning, linguistic, apache, open source, codigo livre, codigo aberto" />
    <meta name="author" content="" />
    <meta name="generator" content="PieCrust 2.1.1" />
    <meta name="template-engine" content="Twig" />
    <meta name="robots" content="all=index,follow" />
    <meta name="revisit-after" content="15 days" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta name="distribution" content="Global" />
    <meta name="url" content="/" />
    <meta name="copyright" content="Bruno de Paula Kinoshita" />
    <meta name="Googlebot" content="all" />
    <meta name="rating" content="general" />
    <meta http-equiv="expires" content="0" />
    <meta name="city" content="Sao Paulo" />
    <meta name="state" content="Brasil, Sao Paulo" />
    <meta http-equiv="content-language" content="en" />
    <meta http-equiv="imagetoolbar" content="no" />
    <meta id="page_favicon" href="/favicon.ico" rel="icon" type="image/x-icon" />
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link rel="alternate" type="application/rss+xml" title="Bruno P. Kinoshita &raquo; Feed" href="/feed.xml" />
    <link rel="stylesheet" href="/css/semantic/dist/semantic.min.css" type="text/css" media="screen, projection" />
    <link rel="stylesheet" href="/css/style.css" type="text/css" media="screen, projection" />
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="/css/blueprint/ie.css" type="text/css" media="screen, projection" />
    <![endif]-->
    <link rel="stylesheet" href="/css/prettyPhoto.css" type="text/css" media="all" />
</head>
<body id="body">
    <div class="ui vertical sidebar menu" id="toc">
        <div class="menu">
    <div class="item">
        <a href="/" class="main-link">Kinoshita</a>
    </div>
    <div class="item">
        <a href="/art">Art</a>
    </div>
    <div class="item">
        <a href="/articles/">Articles</a>
    </div>
    <div class="item">
        <a href="/books/">Books</a>
    </div>
    <div class="item">
      <a href="/presentations/">Presentations</a>
    </div>
    <div class="item">
        <a href="/software/">Software</a>
    </div>
    <div class="item">
        <a href="/contact/">Contact</a>
    </div>
    <div class="item">
        <a href="/about/">About &#038; CV</a>
    </div>
</div>
<img src="/img/bruno.jpg" title="Hmmmm" alt="Hmmmm" width="134px" height="215px" />
    </div>
    <div class="ui black big launch right attached fixed button">
        <i class="content icon"></i>
        <span class="text">Menu</span>
    </div>
    <div class="ui fixed inverted main menu">
        <div class="ui container">
            <a class="launch icon item">
                <i class="content icon"></i>
            </a>
            <div class="item">
                Tag
            </div>
        </div>
    </div>
    <div class="pusher">
        <div class="full height">
            <div class="toc">
                <div class="ui vertical sticky fixed top menu">
                    <div class="menu">
    <div class="item">
        <a href="/" class="main-link">Kinoshita</a>
    </div>
    <div class="item">
        <a href="/art">Art</a>
    </div>
    <div class="item">
        <a href="/articles/">Articles</a>
    </div>
    <div class="item">
        <a href="/books/">Books</a>
    </div>
    <div class="item">
      <a href="/presentations/">Presentations</a>
    </div>
    <div class="item">
        <a href="/software/">Software</a>
    </div>
    <div class="item">
        <a href="/contact/">Contact</a>
    </div>
    <div class="item">
        <a href="/about/">About &#038; CV</a>
    </div>
</div>
<img src="/img/bruno.jpg" title="Hmmmm" alt="Hmmmm" width="134px" height="215px" />
                </div>
            </div>
            <div class="article">
                <div class="main container">

                
                    
                    <div class='ui padded container'>
                        <h1 class='topic'>Tag</h1>
                    </div>
                    
                    <p>Posts tagged with &#8216;opensource&#8217;</p>
<div class="ui raised padded container segment">
    <h2><a href="/2017/04/02/fixing-qt-warning-qlayout-attempting-to-add-qlayout-to-qwidget-which-already-has-a-layout" title="Permanent link">Fixing Qt warning &#8220;QLayout: Attempting to add QLayout &#8220;&#8221; to QWidget &#8220;&#8221;, which already has a layout&#8221;</a></h2>
    <p><small>kinow</small> @ <small>Apr 02, 2017&nbsp;12:01:03</small></p>







<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://kinoshita.eti.br/2017/04/02/fixing-qt-warning-qlayout-attempting-to-add-qlayout-to-qwidget-which-already-has-a-layout" data-text="Fixing Qt warning &#34;QLayout: Attempting to add QLayout &#34;&#34; to QWidget &#34;&#34;, which already has a layout&#34;" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


    <p>If you ever started Krita 3.x in your command line, and had a look at the console output,
you may noticed the following warning.</p>
<blockquote>
<p>QLayout: Attempting to add QLayout &#8220;&#8221; to QWidget &#8220;&#8221;, which already has a layout</p>
</blockquote>
<p>Krita recently <a href="https://krita.org/en/item/krita-3-1-3-alpha-released/">announced the release of 3.1.3-alpha-2</a>,
and while testing I saw this warning and
decided to investigate why this warning happens.</p>
<p>There was already
<a href="http://stackoverflow.com/a/25451334">a similar question posted on StackOverflow</a>. And the
best answer&#8217;s initial paragraph gave me a hint of what to look for.</p>
<blockquote>
<p>When you assign a widget as the parent of a QLayout by passing it into the constructor, the layout is automatically set as the layout for that widget. In your code you are not only doing this, but explicitly calling setlayout(). This is no problem when when the widget passed is the same. If they are different you will get an error because Qt tries to assign the second layout to your widget which has already had a layout set.</p>
</blockquote>
<p>So, somewhere in Krita code, there was a a QWidget being created, and layouts
were being added to it more than once. To find where the issue was happening was quite easy. A breakpoint at
<a href="https://github.com/KDE/krita/blob/9e2b8c5b07deccd4a616ad7930a91e8cc784a85b/krita/main.cc#L141">main.cc</a>
where the application is initialized, then step through a few times, until the message appeared in the
console.</p>
<p>Further investigation led me to the History docker (the one that shows undo steps)
<a href="https://github.com/KDE/krita/blob/9e2b8c5b07deccd4a616ad7930a91e8cc784a85b/plugins/dockers/historydocker/HistoryDock.cpp#L33">constructor</a>.</p>
<div class="highlight"><pre>    <span class="n">QVBoxLayout</span> <span class="o">*</span><span class="n">vl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="n">page</span><span class="p">);</span> <span class="c1">// layout being set to page</span>
    <span class="n">m_undoView</span> <span class="o">=</span> <span class="k">new</span> <span class="n">KisUndoView</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="n">vl</span><span class="o">-&gt;</span><span class="n">addWidget</span><span class="p">(</span><span class="n">m_undoView</span><span class="p">);</span>
    <span class="n">QHBoxLayout</span> <span class="o">*</span><span class="n">hl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QHBoxLayout</span><span class="p">(</span><span class="n">page</span><span class="p">);</span> <span class="c1">// layout being set to page again</span>
    <span class="n">hl</span><span class="o">-&gt;</span><span class="n">addSpacerItem</span><span class="p">(</span><span class="k">new</span> <span class="n">QSpacerItem</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>  <span class="n">QSizePolicy</span><span class="o">::</span><span class="n">Expanding</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="o">::</span><span class="n">Fixed</span><span class="p">));</span>
    <span class="n">m_bnConfigure</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QToolButton</span><span class="p">(</span><span class="n">page</span><span class="p">);</span>
    <span class="n">m_bnConfigure</span><span class="o">-&gt;</span><span class="n">setIcon</span><span class="p">(</span><span class="n">KisIconUtils</span><span class="o">::</span><span class="n">loadIcon</span><span class="p">(</span><span class="s">&quot;configure&quot;</span><span class="p">));</span>
    <span class="n">connect</span><span class="p">(</span><span class="n">m_bnConfigure</span><span class="p">,</span> <span class="n">SIGNAL</span><span class="p">(</span><span class="n">clicked</span><span class="p">(</span><span class="kt">bool</span><span class="p">)),</span> <span class="n">SLOT</span><span class="p">(</span><span class="n">configure</span><span class="p">()));</span>
    <span class="n">hl</span><span class="o">-&gt;</span><span class="n">addWidget</span><span class="p">(</span><span class="n">m_bnConfigure</span><span class="p">);</span>
    <span class="n">vl</span><span class="o">-&gt;</span><span class="n">addItem</span><span class="p">(</span><span class="n">hl</span><span class="p">);</span>

    <span class="n">setWidget</span><span class="p">(</span><span class="n">page</span><span class="p">);</span>
    <span class="n">setWindowTitle</span><span class="p">(</span><span class="n">i18n</span><span class="p">(</span><span class="s">&quot;Undo History&quot;</span><span class="p">));</span>
</pre></div>

<p>Here the QWidget created receives both QHBoxLayout and QVBoxLayout. Again, searching the Internet
a little bit, then came across this post with a good example of a QWidget with
QHBoxLayout and QVBoxLayout. Here&#8217;s what the constructor looks after the
<a href="https://bugs.kde.org/show_bug.cgi?id=378313">patch</a>
has been <a href="https://github.com/KDE/krita/commit/1d2343c0cacfb0b105fbe86c2bcef975a09b1041">applied</a>.</p>

<div class="highlight"><pre>    <span class="n">QVBoxLayout</span> <span class="o">*</span><span class="n">vl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="n">page</span><span class="p">);</span> <span class="c1">// layout being set to page</span>
    <span class="n">m_undoView</span> <span class="o">=</span> <span class="k">new</span> <span class="n">KisUndoView</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="n">vl</span><span class="o">-&gt;</span><span class="n">addWidget</span><span class="p">(</span><span class="n">m_undoView</span><span class="p">);</span>
    <span class="n">QHBoxLayout</span> <span class="o">*</span><span class="n">hl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QHBoxLayout</span><span class="p">();</span>
    <span class="n">hl</span><span class="o">-&gt;</span><span class="n">addSpacerItem</span><span class="p">(</span><span class="k">new</span> <span class="n">QSpacerItem</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>  <span class="n">QSizePolicy</span><span class="o">::</span><span class="n">Expanding</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="o">::</span><span class="n">Fixed</span><span class="p">));</span>
    <span class="n">m_bnConfigure</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QToolButton</span><span class="p">(</span><span class="n">page</span><span class="p">);</span>
    <span class="n">m_bnConfigure</span><span class="o">-&gt;</span><span class="n">setIcon</span><span class="p">(</span><span class="n">KisIconUtils</span><span class="o">::</span><span class="n">loadIcon</span><span class="p">(</span><span class="s">&quot;configure&quot;</span><span class="p">));</span>
    <span class="n">connect</span><span class="p">(</span><span class="n">m_bnConfigure</span><span class="p">,</span> <span class="n">SIGNAL</span><span class="p">(</span><span class="n">clicked</span><span class="p">(</span><span class="kt">bool</span><span class="p">)),</span> <span class="n">SLOT</span><span class="p">(</span><span class="n">configure</span><span class="p">()));</span>
    <span class="n">hl</span><span class="o">-&gt;</span><span class="n">addWidget</span><span class="p">(</span><span class="n">m_bnConfigure</span><span class="p">);</span>
    <span class="n">vl</span><span class="o">-&gt;</span><span class="n">addItem</span><span class="p">(</span><span class="n">hl</span><span class="p">);</span>
    <span class="n">vl</span><span class="o">-&gt;</span><span class="n">addLayout</span><span class="p">(</span><span class="n">hl</span><span class="p">);</span> <span class="c1">// horizontal layout added to the vertical layout</span>

    <span class="n">setWidget</span><span class="p">(</span><span class="n">page</span><span class="p">);</span>
    <span class="n">setWindowTitle</span><span class="p">(</span><span class="n">i18n</span><span class="p">(</span><span class="s">&quot;Undo History&quot;</span><span class="p">));</span>
</pre></div>

<p>That&#8217;s it. Learned something new in Qt. Not as important and useful as learning about
<a href="http://doc.qt.io/qt-4.8/signalsandslots.html">signals and slots</a>, but now I can focus
on other warnings in the console output of Krita.</p>

<p>And you? Have you tested <a href="https://krita.org/en/item/krita-3-1-3-alpha-released/">Krita 3.1.3 alpha</a> already?
What are you waiting for? :-)</p>

<p>&hearts; Open Source</p>

<!-- html -->

<p class="postmetadata">

    <small>tags 
     [&nbsp;<a
        href="/tag/c%2B%2B"
        rel="tag">c++</a>&nbsp;]&nbsp;

     [&nbsp;<a
        href="/tag/krita"
        rel="tag">krita</a>&nbsp;]&nbsp;

     [&nbsp;<a
        href="/tag/programming"
        rel="tag">programming</a>&nbsp;]&nbsp;

     [&nbsp;<a
        href="/tag/opensource"
        rel="tag">opensource</a>&nbsp;]&nbsp;

    </small>


    <br/>
    <small>posted in 
    [&nbsp;<a
        href="/blog"
        title="View all posts in blog"
        rel="category tag">blog</a>&nbsp;]&nbsp;
    category </small>

</p>

</div>

<div class="ui raised padded container segment">
    <h2><a href="/2017/03/26/simulating-less-memory-with-ulimit" title="Permanent link">Simulating less memory with ulimit</a></h2>
    <p><small>kinow</small> @ <small>Mar 26, 2017&nbsp;11:14:03</small></p>







<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://kinoshita.eti.br/2017/03/26/simulating-less-memory-with-ulimit" data-text="Simulating less memory with ulimit" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


    <p>These days I was trying to reproduce <a href="https://bugs.kde.org/show_bug.cgi?id=376382">a bug in Krita</a>
where it would crash when a user copied group layers between windows. It appeared that the user was
getting a segmentation fault due to the user&#8217;s computer running out of memory.</p>
<p>I could not reproduce the issue, but my computer has 16 GB. The first thing that came to my mind was
to create a virtual machine with less memory to reproduce the issue. But I decided to spend some time
looking for a <a href="http://wiki.c2.com/?LazinessImpatienceHubris">simpler way</a> of doing it.</p>
<p>Searching the web I found some suggestions that <code>ulimit</code> could work. After playing for a while with
<code>ulimit</code> and <code>htop</code>, and verifying the amount of memory necessary to open two files in two windows
in Krita, I came up with the following settings.</p>
<div class="highlight"><pre><span class="c"># 2550 mb in kb</span>
<span class="nb">ulimit</span> -v 2550000

<span class="c"># 2 gb in kb</span>
<span class="nb">ulimit</span> -m 2000000

<span class="c"># Confirm limits</span>
<span class="nb">ulimit</span> -a

gdb <span class="nv">$HOME</span>/Development/cpp/workspace/krita_install/bin/krita
</pre></div>

<p>Then after copying a few layers from one window to another, I successfully reproduced the issue,
and could include a backtrace in the Krita issue tracking system.</p>

<p>&hearts; Open Source</p>

<!-- html -->

<p class="postmetadata">

    <small>tags 
     [&nbsp;<a
        href="/tag/c%2B%2B"
        rel="tag">c++</a>&nbsp;]&nbsp;

     [&nbsp;<a
        href="/tag/krita"
        rel="tag">krita</a>&nbsp;]&nbsp;

     [&nbsp;<a
        href="/tag/programming"
        rel="tag">programming</a>&nbsp;]&nbsp;

     [&nbsp;<a
        href="/tag/opensource"
        rel="tag">opensource</a>&nbsp;]&nbsp;

    </small>


    <br/>
    <small>posted in 
    [&nbsp;<a
        href="/blog"
        title="View all posts in blog"
        rel="category tag">blog</a>&nbsp;]&nbsp;
    category </small>

</p>

</div>

<div class="ui raised padded container segment">
    <h2><a href="/2017/01/03/contributing-to-krita" title="Permanent link">Contributing to Krita</a></h2>
    <p><small>kinow</small> @ <small>Jan 03, 2017&nbsp;11:40:03</small></p>







<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://kinoshita.eti.br/2017/01/03/contributing-to-krita" data-text="Contributing to Krita" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


    <p>As I mentioned in the <a href="/2017/01/02/debugging-an-application-that-freezes-the-x-server">last post</a>, I have been learning Qt and using C and C++ again.
Since I used C and C++ more during university (about 10 years ago, phew), decided
to read real code.</p>
<p>I used Photoshop, Illustrator, and Fireworks a lot when I was younger and had more
time to spend drawing. But some time ago I switched to Inkscape for vector graphics,
which I use at work for presentations. So it was only natural to try Krita now.</p>
<p>Since I was going to try Krita, I thought why not check out and build from source, and then
in case I found any bugs, contribute back? Or maybe from time to time triage issues,
find low hanging ones, and send a patch?</p>
<p>Well, turns out the Krita project has a great community, and it is super easy to send
contributions. So far I submitted three patches, some were included in 3.x releases.</p>
<ul>
<li><a href="https://bugs.kde.org/show_bug.cgi?id=366741">https://bugs.kde.org/show_bug.cgi?id=366741</a></li>
<li><a href="https://bugs.kde.org/show_bug.cgi?id=364208">https://bugs.kde.org/show_bug.cgi?id=364208</a></li>
<li><a href="https://bugs.kde.org/show_bug.cgi?id=374451">https://bugs.kde.org/show_bug.cgi?id=374451</a></li>
</ul>
<p>While the patches are rather small, they are suggestions on how to fix memory
segmentation faults, or strange behaviours in the interface. For these issues,
I had to learn more about Qt components, signals and emitting events, and,
of course, work with pointers, arrays, Qt data structures, etc. In other words,
lots of (geek) fun!</p>
<p>In other words, by contributing to Krita, I am not only helping the project
and giving a little back to the community, but also refreshing my memory on
C and C++, and slowly learning Qt - which is not very hard if you worked with
Swing/AWT, Delphi, Visual Basic, Gtk, etc.</p>
<p>What are you waiting to contribute to Krita? The developers that maintain the
project answer tickets and questions posted to <a href="https://reddit.com/r/krita">reddit</a>
in a good time, and are extremely easy to work with.</p>
<p>Read more <a href="http://www.davidrevoy.com/article193/guide-building-krita-on-linux-for-cats">here</a> how to build from source, and
<a href="https://krita.org/en/get-involved/developers/">here</a> on how to submit patches.</p>
<p>Happy hacking!</p><!-- html -->

<p class="postmetadata">

    <small>tags 
     [&nbsp;<a
        href="/tag/c%2B%2B"
        rel="tag">c++</a>&nbsp;]&nbsp;

     [&nbsp;<a
        href="/tag/krita"
        rel="tag">krita</a>&nbsp;]&nbsp;

     [&nbsp;<a
        href="/tag/programming"
        rel="tag">programming</a>&nbsp;]&nbsp;

     [&nbsp;<a
        href="/tag/opensource"
        rel="tag">opensource</a>&nbsp;]&nbsp;

    </small>


    <br/>
    <small>posted in 
    [&nbsp;<a
        href="/blog"
        title="View all posts in blog"
        rel="category tag">blog</a>&nbsp;]&nbsp;
    category </small>

</p>
</div>

<div class="ui raised padded container segment">
    <h2><a href="/2017/01/02/debugging-an-application-that-freezes-the-x-server" title="Permanent link">Debugging an application that freezes the X server</a></h2>
    <p><small>kinow</small> @ <small>Jan 02, 2017&nbsp;00:39:03</small></p>







<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://kinoshita.eti.br/2017/01/02/debugging-an-application-that-freezes-the-x-server" data-text="Debugging an application that freezes the X server" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


    <p>Some time ago, I decided to start writing C++ again, and picked Krita for that.
Krita is written in C++ and Qt. The <a href="https://bugs.kde.org/show_bug.cgi?id=366741">bug I was working on</a>
involved a memory issue when changing the UI.</p>
<p>The problem was that this UI change would result in, not only Krita, but the whole
X server freezing. My set up was basically Ubuntu 16.04.1 LTS, with Eclipse, Qt5,
and the latest version of Krita checked out via git.</p>
<p>Initially I spent some time looking at the logs, tracing the binary, even downloaded
some Qt utility tools to look at the events and what was happening with the application
when it froze.</p>
<p>However, eventually I realized I was going to spend more time on this part of the
issue, rather than on the memory bug. So decided to look for a work-around.</p>
<p>Thankfully someone else blogged about a similar issue and saved me a lot of time :-)
Here&#8217;s how I did it, following the instructions in
<a href="http://www.geany.org/manual/gtk/gtk-faq/x462.html">this blog post</a>.</p>
<div class="highlight"><pre><span class="nv">$ </span>sudo apt-get install xnest -y
<span class="nv">$ </span><span class="nb">cd </span>krita_install/
<span class="nv">$ </span>Xnest :10
<span class="nv">$ </span>twm -display :10
<span class="nv">$ </span><span class="nb">export </span><span class="nv">DISPLAY</span><span class="o">=</span>:10
<span class="nv">$ </span>./krita
</pre></div>

<p>That&#8217;s it. You should have Krita running in a separate window, with Xnest, and within
this window the twm window manager running. So when it freezes, at least you can still
debug your application in Eclipse or whatever IDE you prefer.</p>
<p>Happy hacking!</p><!-- html -->

<p class="postmetadata">

    <small>tags 
     [&nbsp;<a
        href="/tag/c%2B%2B"
        rel="tag">c++</a>&nbsp;]&nbsp;

     [&nbsp;<a
        href="/tag/krita"
        rel="tag">krita</a>&nbsp;]&nbsp;

     [&nbsp;<a
        href="/tag/opensource"
        rel="tag">opensource</a>&nbsp;]&nbsp;

     [&nbsp;<a
        href="/tag/programming"
        rel="tag">programming</a>&nbsp;]&nbsp;

    </small>


    <br/>
    <small>posted in 
    [&nbsp;<a
        href="/blog"
        title="View all posts in blog"
        rel="category tag">blog</a>&nbsp;]&nbsp;
    category </small>

</p>
</div>

<div class="ui raised padded container segment">
    <h2><a href="/2012/10/20/replacing-a-hashset-with-a-bitset" title="Permanent link">Replacing a HashSet with a BitSet</a></h2>
    <p><small>kinow</small> @ <small>Oct 20, 2012&nbsp;19:51:39</small></p>







<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://kinoshita.eti.br/2012/10/20/replacing-a-hashset-with-a-bitset" data-text="Replacing a HashSet with a BitSet" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


    <p>I always read the messages in the <a href="http://www.apache.org/foundation/mailinglists.html" title="Apache mailing lists">Apache dev mailing lists</a>, including Apache Commons <a href="http://commons.apache.org/mail-lists.html" title="Apache Commons mailing lists">dev mailing list</a>. And you should too. There are always interesting discussions. Sometimes you participate, other times you only watch what&#8217;s happening, but in the end <strong>you always learn something new</strong>.</p>

<p>A few days ago, I found <a href="https://issues.apache.org/jira/browse/LANG-839" title="LANG-839">an issue</a> where it was being proposed to replace an unnecessary <a href="http://docs.oracle.com/javase/6/docs/api/java/util/HashSet.html" title="HashSet">HashSet</a> in <a href="http://commons.apache.org/lang/api-release/org/apache/commons/lang3/ArrayUtils.html" title="ArrayUtils">ArrayUtils</a>#removeElements() by a <a href="http://docs.oracle.com/javase/6/docs/api/java/util/BitSet.html" title="BitSet">BitSet</a>. Here&#8217;s how the code looked like: </p>

<div class="highlight"><pre><span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">toRemove</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;();</span>
<span class="k">for</span> <span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Character</span><span class="o">,</span> <span class="n">MutableInt</span><span class="o">&gt;</span> <span class="n">e</span> <span class="o">:</span> <span class="n">occurrences</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">Character</span> <span class="n">v</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">getKey</span><span class="o">();</span>
    <span class="kt">int</span> <span class="n">found</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">ct</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">getValue</span><span class="o">().</span><span class="na">intValue</span><span class="o">();</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ct</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="n">found</span> <span class="o">=</span> <span class="n">indexOf</span><span class="o">(</span><span class="n">array</span><span class="o">,</span> <span class="n">v</span><span class="o">.</span><span class="na">charValue</span><span class="o">(),</span> <span class="n">found</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">found</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">toRemove</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">found</span><span class="o">++);</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="k">return</span> <span class="o">(</span><span class="kt">char</span><span class="o">[])</span> <span class="n">removeAll</span><span class="o">((</span><span class="n">Object</span><span class="o">)</span><span class="n">array</span><span class="o">,</span> <span class="n">extractIndices</span><span class="o">(</span><span class="n">toRemove</span><span class="o">));</span>
</pre></div>

<p style="text-align: center"><a href="/2012/10/20/replacing-a-hashset-with-a-bitset/feather_small.gif"><img src="/2012/10/20/replacing-a-hashset-with-a-bitset/feather_small.gif" alt="" title="Apache Software Foundation" width="203" height="61" class="aligncenter size-full wp-image-1125" /></a></p>

<p>The HashSet created at line 1, in the code above, was used to store the array index of the elements that should be removed. And at line 13 there is a call to removeAll method, passing the indexes to be removed. And here&#8217;s how the new code looks like: </p>

<div class="highlight"><pre><span class="n">BitSet</span> <span class="n">toRemove</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BitSet</span><span class="o">();</span>
<span class="k">for</span> <span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Character</span><span class="o">,</span> <span class="n">MutableInt</span><span class="o">&gt;</span> <span class="n">e</span> <span class="o">:</span> <span class="n">occurrences</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">Character</span> <span class="n">v</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">getKey</span><span class="o">();</span>
    <span class="kt">int</span> <span class="n">found</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">ct</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">getValue</span><span class="o">().</span><span class="na">intValue</span><span class="o">();</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ct</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="n">found</span> <span class="o">=</span> <span class="n">indexOf</span><span class="o">(</span><span class="n">array</span><span class="o">,</span> <span class="n">v</span><span class="o">.</span><span class="na">charValue</span><span class="o">(),</span> <span class="n">found</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">found</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">toRemove</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">found</span><span class="o">++);</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="k">return</span> <span class="o">(</span><span class="kt">char</span><span class="o">[])</span> <span class="n">removeAll</span><span class="o">(</span><span class="n">array</span><span class="o">,</span> <span class="n">toRemove</span><span class="o">);</span>
</pre></div>

<p>The first difference is at line 1. Instead of a HashSet, it is now using a BitSet. And at line 10, instead of adding a new element to the HashSet, now it &#8220;sets&#8221; a bit in the set (the bit at the specified position is now true). But there are important changes at line 13. The method removeAll was changed, and now the array doesn&#8217;t require a cast anymore. And the it is not necessary to cast the elements from HashSet anymore, as now the bit in the index position of the set is set to true. So the extractIndices method could be removed.</p>

<p>The code got simpler. But that&#8217;s not all. At <a href="http://www.apache.org" title="Apache Software Foundation">Apache Software Foundation</a> you can find a lot of talented developers - that&#8217;s why I got so excited after joining them. Besides simplifying the code, the developer responsible for these changes (<strong>sebb</strong>) also pointed out that the new code <strong>consumes less memory and is faster</strong>. Ah! And he also wrote <strong>unit tests</strong><!-- html -->

<p class="postmetadata">

    <small>tags 
     [&nbsp;<a
        href="/tag/apache%20software%20foundation"
        rel="tag">apache software foundation</a>&nbsp;]&nbsp;

     [&nbsp;<a
        href="/tag/java"
        rel="tag">java</a>&nbsp;]&nbsp;

     [&nbsp;<a
        href="/tag/opensource"
        rel="tag">opensource</a>&nbsp;]&nbsp;

     [&nbsp;<a
        href="/tag/programming"
        rel="tag">programming</a>&nbsp;]&nbsp;

    </small>


</p>
</div>

<div id="navigation">

        &mdash; <a href="/tag/opensource/2" id="navigation-next">Newer Entries</a>&nbsp;&rarr;

</div>
                    <p class="postmetadata">
                        
                        
                    </p>
                
                </div>
            </div>
        </div>
        <div class="ui vertical footer segment">
            <div class="ui center aligned container">
                           <div id="copy" class="">
                <p>&copy; <a href="/about"><span
                            class="b">Bru</span><span
                            class="r">no de</span> <span
                            class="a">Paula</span> <span
                            class="s"></span><span
                            class="i">Kinos</span><span
                            class="l">hita</span></a>
                </p>
            </div>
            </div>
         </div>
    </div>
</body>
</html>
<script src="/js/jquery-2.2.3.min.js"  type="text/javascript"></script>
    <script src="/css/semantic/dist/semantic.min.js"  type="text/javascript"></script>
    <script src="/js/jquery.prettyPhoto.js"></script>
<script type="text/javascript" charset="utf-8">
  $(document).ready(function(){
    $("a[rel^='prettyPhoto']").prettyPhoto({
        social_tools: false,
        autoplay_slideshow: false, 
        hideflash: true, 
        autoplay: false, 
        overlay_gallery: false
    });

    $("#toc")
        .sidebar({
          dimPage          : true,
          transition       : 'overlay',
          mobileTransition : 'uncover'
        })
    ;

    $("#toc")
        .sidebar('attach events', '.launch.button, .view-ui, .launch.item')
    ;
  });
</script>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-32767310-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
