<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta property="og:title" content="Quickly Verifying jar Signatures For ASF Releases">
<meta property="og:description" content="The release process within the Apache Software Foundation includes a series of steps. Amongst these steps is the voting process. In Apache Commons, the release instructions includes a note on artefact signatures.
 During the course of the VOTE, make sure that one or more of the reviewers have verified the signatures and hash files included with the release artifacts. If no one specifically mentions having done that during the VOTE, ask on the dev list and make sure someone does this before you proceed with the release.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://kinoshita.eti.br/2017/10/14/quickly-verifying-jar-signatures-for-asf-releases.html"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2017-10-14T00:00:00+00:00">
<meta property="article:modified_time" content="2017-10-14T00:00:00+00:00">
<link rel=stylesheet type=text/css href=https://kinoshita.eti.br/sass/main.de6eddbd022e2ff31c7675270a2ccd00d63fa2c52ca6dc77e1a974bc7b0b7103.css integrity="sha256-3m7dvQIuL/McdnUnCizNANY/osUsptx34al0vHsLcQM=">
<title>kinow | Quickly Verifying jar Signatures For ASF Releases</title>
</head>
<body>
<header role=banner class=content>
<nav id=nav aria-label=Main role=navigation class=content>
<ul><li>
<a href=/><i data-feather=about></i> About</a>
</li><li>
<a href=/blog/><i data-feather=blog></i> Blog</a>
</li><li>
<a href=/portfolio/><i data-feather=portfolio></i> Portfolio</a>
</li>
</ul>
</nav>
</header>
<main>
<article class=content>
<h2>Quickly Verifying jar Signatures For ASF Releases</h2><div class=metadata>
<i data-feather=calendar></i>
<time datetime=2017-10-14>Oct 14, 2017</time>
</div>
<p>The release process within the Apache Software Foundation includes a series of steps. Amongst these
steps is the <a href=https://www.apache.org/foundation/voting.html>voting process</a>. In Apache Commons, the
<a href=https://commons.apache.org/releases/prepare.html>release instructions</a> includes a note on artefact
signatures.</p>
<blockquote>
<p>During the course of the VOTE, make sure that one or more of the reviewers have verified the signatures and hash files included with the release artifacts. If no one specifically mentions having done that during the VOTE, ask on the dev list and make sure someone does this before you proceed with the release.</p>
</blockquote>
<p>Tired of always having to manually check several artefacts, or having to come up with the correct
shell commands to iterate through a list of files, the other day I wrote a simple script to download
the KEYS file, import it, download all the artefacts, then iterate through them and verify the
signature.</p>
<p>Here&rsquo;s the script. Licensed under the GPL licence.</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:teal>#!/usr/bin/env bash
</span><span style=color:teal></span>
url=<span style=color:#00f>&#34;&#34;</span>

<span style=color:#080;font-style:italic># From: https://blog.mafr.de/2007/08/05/cmdline-options-in-shell-scripts/</span>
USAGE=<span style=color:#00f>&#34;Usage: `basename </span>$0<span style=color:#00f>` [-hv] https://repository.apache.org/.../commons/commons-configuration/2.2/&#34;</span>

<span style=color:#080;font-style:italic># Parse command line options.</span>
<span style=color:navy;font-weight:700>while</span> getopts hv: OPT; <span style=color:navy;font-weight:700>do</span>
    <span style=color:navy;font-weight:700>case</span> <span style=color:#00f>&#34;</span>$OPT<span style=color:#00f>&#34;</span> in
        h)
            echo $USAGE
            exit <span style=color:#00f>0</span>
            ;;
        v)
            echo <span style=color:#00f>&#34;`basename </span>$0<span style=color:#00f>` version 0.0.1&#34;</span>
            exit <span style=color:#00f>0</span>
            ;;
        <span style=color:#00f>\?</span>)
            <span style=color:#080;font-style:italic># getopts issues an error message</span>
            echo $USAGE &gt;&amp;<span style=color:#00f>2</span>
            exit <span style=color:#00f>1</span>
            ;;
    <span style=color:navy;font-weight:700>esac</span>
<span style=color:navy;font-weight:700>done</span>

<span style=color:#080;font-style:italic># Remove the switches we parsed above.</span>
shift <span style=color:#00f>`</span>expr $OPTIND - 1<span style=color:#00f>`</span>

<span style=color:#080;font-style:italic># We want at least one non-option argument. </span>
<span style=color:#080;font-style:italic># Remove this block if you don&#39;t need it.</span>
<span style=color:navy;font-weight:700>if</span> [ $# -eq <span style=color:#00f>0</span> ]; <span style=color:navy;font-weight:700>then</span>
    echo $USAGE &gt;&amp;amp;<span style=color:#00f>2</span>
    exit <span style=color:#00f>1</span>
<span style=color:navy;font-weight:700>fi</span>

<span style=color:#080;font-style:italic># Access additional arguments as usual through </span>
<span style=color:#080;font-style:italic># variables $@, $*, $1, $2, etc. or using this loop:</span>
URL=$1

echo <span style=color:#00f>&#34;url: </span><span style=color:#00f>${</span>URL<span style=color:#00f>}</span><span style=color:#00f>&#34;</span>

<span style=color:#080;font-style:italic># Use a local temporary directory</span>
BUILD_DIR=<span style=color:navy;font-weight:700>$(</span>mktemp -d<span style=color:navy;font-weight:700>)</span>
pushd <span style=color:#00f>&#34;</span>$BUILD_DIR<span style=color:#00f>&#34;</span>

echo <span style=color:#00f>&#34;build dir: </span><span style=color:#00f>${</span>BUILD_DIR<span style=color:#00f>}</span><span style=color:#00f>&#34;</span>

<span style=color:#080;font-style:italic># Download KEYS file</span>
KEYS_URL=https://www.apache.org/dist/commons/KEYS

echo <span style=color:#00f>&#34;importing KEYS from: </span><span style=color:#00f>${</span>KEYS_URL<span style=color:#00f>}</span><span style=color:#00f>&#34;</span>

wget <span style=color:#00f>&#34;</span>$KEYS_URL<span style=color:#00f>&#34;</span>
gpg --import KEYS

<span style=color:#080;font-style:italic># Download JARs and signature files</span>
echo <span style=color:#00f>&#34;downloading all jars and signature files...&#34;</span>

wget -r -nd -np -e robots=off --wait <span style=color:#00f>1</span> -R <span style=color:#00f>&#34;index.html*&#34;</span> <span style=color:#00f>&#34;</span><span style=color:#00f>${</span>URL<span style=color:#00f>}</span><span style=color:#00f>&#34;</span>

<span style=color:#080;font-style:italic># Check the files</span>
<span style=color:navy;font-weight:700>for</span> x in *.jar; <span style=color:navy;font-weight:700>do</span> gpg --verify <span style=color:#00f>&#34;</span><span style=color:#00f>${</span>x<span style=color:#00f>}</span><span style=color:#00f>&#34;</span>.asc; <span style=color:navy;font-weight:700>done</span>

<span style=color:#080;font-style:italic># EOF</span>
</code></pre></div><p>The script can be found at GitHub too: <a href=https://github.com/kinow/dork-scripts/tree/3c519a74f28c08310ce2e65f8e860d61fd0c5c07/gpg/asf-sigs>https://github.com/kinow/dork-scripts/tree/3c519a74f28c08310ce2e65f8e860d61fd0c5c07/gpg/asf-sigs</a></p>
<aside class=links>
<a class=previous href=https://kinoshita.eti.br/2017/09/13/removing-javadoc-svn-id-tags-with-shell-script.html>&#171; Previous</a>
<a class=next href=https://kinoshita.eti.br/2017/11/06/using-formatter-exclusions-with-eclipse.html>Next &#187;</a>
</aside>
</article>
</main>
<footer role=contentinfo>
<ul id=social-media-icons>
<li>
<a href=https://www.instagram.com/brunokinoshita/>
<img src=/assets/icons/instagram.png alt="Instagram link">
</a>
</li>
<li>
<a href=https://twitter.com/kinow/>
<img src=/assets/icons/twitter.png alt="Twitter link">
</a>
</li>
<li>
<a href=https://github.com/kinow/>
<img src=/assets/icons/github.png alt="GitHub link">
</a>
</li>
<li>
<a href=/feed.xml>
<img src=/assets/icons/news.png alt="RSS feed link">
</a>
</li>
</ul>
</footer>
</body>
</html>