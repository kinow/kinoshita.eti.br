<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:url" content="https://kinoshita.eti.br/2017/03/14/order-of-containers-in-docker-compose.html"><meta property="og:site_name" content="kinow"><meta property="og:title" content="Order of containers in Docker Compose"><meta property="og:description" content="In Docker Compose you are able to control the startup order of the containers via the depends_on statement. This is documented in Controlling startup order in Compose.
If you have a simple setup, with Tomcat and Postgres, sometimes Postgres will start first, but Compose will initialize Tomcat before Postgres has fully booted. When that happens, you may receive 401, 404, or other application errors.
You can fix it by combining depends_on with a healthcheck."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-03-14T00:00:00+00:00"><meta property="article:modified_time" content="2024-06-24T12:37:43+02:00"><meta property="article:tag" content="Docker"><meta property="og:image" content="https://kinoshita.eti.br/assets/photos/about/2023-me-closeup.png"><meta property="fb:admins" content="bruno.kinoshita"><meta name=twitter:title content="Order of containers in Docker Compose"><meta name=twitter:description content="In Docker Compose you are able to control the startup order of the containers via the depends_on statement. This is documented in Controlling startup order in Compose.
If you have a simple setup, with Tomcat and Postgres, sometimes Postgres will start first, but Compose will initialize Tomcat before Postgres has fully booted. When that happens, you may receive 401, 404, or other application errors.
You can fix it by combining depends_on with a healthcheck."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kinoshita.eti.br/assets/photos/about/2023-me-closeup.png"><meta name=twitter:site content="@kinow"><link rel=alternate type=application/rss+xml href=https://kinoshita.eti.br/2017/03/14/order-of-containers-in-docker-compose/feed.xml title=kinow><link rel=stylesheet type=text/css href=https://kinoshita.eti.br/sass/main.c3626db3678f53e4a53e3e75c7b2fe34bb46566f00eb84692501404d0064c32a.css integrity="sha256-w2Jts2ePU+SlPj51x7L+NLtGVm8A64RpJQFATQBkwyo="><title>kinow | Order of containers in Docker Compose</title><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"posts","name":"Order of containers in Docker Compose","headline":"Order of containers in Docker Compose","alternativeHeadline":"","description":"In Docker Compose you are able to control the startup order of the containers via the depends_on statement. This is documented in Controlling startup order in Compose.\nIf you have a simple setup, with Tomcat and Postgres, sometimes Postgres will start first, but Compose will initialize Tomcat before Postgres has fully booted. When that happens, you may receive 401, 404, or other application errors.\nYou can fix it by combining depends_on with a healthcheck.","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/kinoshita.eti.br\/2017\/03\/14\/order-of-containers-in-docker-compose.html"},"author":{"@type":"Person","name":"Bruno P. Kinoshita"},"creator":{"@type":"Person","name":"Bruno P. Kinoshita"},"accountablePerson":{"@type":"Person","name":"Bruno P. Kinoshita"},"copyrightHolder":"kinow","copyrightYear":"2017","dateCreated":"2017-03-14T00:00:00.00Z","datePublished":"2017-03-14T00:00:00.00Z","dateModified":"2024-06-24T12:37:43.00Z","publisher":{"@type":"Organization","name":"kinow","url":"https://kinoshita.eti.br/","logo":{"@type":"ImageObject","url":"https:\/\/kinoshita.eti.br\/","width":"32","height":"32"}},"image":"https://kinoshita.eti.br/","url":"https:\/\/kinoshita.eti.br\/2017\/03\/14\/order-of-containers-in-docker-compose.html","wordCount":"247","genre":["docker"],"keywords":[]}</script></head><body><header role=banner class=content><nav id=nav aria-label=Main role=navigation class=content><ul><li><a href=/><i data-feather=about></i> About</a></li><li><a href=/blog/><i data-feather=blog></i> Blog</a></li><li><a href=/portfolio/><i data-feather=portfolio></i> Portfolio</a></li></ul></nav></header><main><article class=content><h1>Order of containers in Docker Compose</h1><div class=metadata><i data-feather=calendar></i>
<time datetime=2017-03-14>Mar 14, 2017</time></div><aside><nav id=TableOfContents></nav></aside><p>In Docker Compose you are able to control the startup order of the containers via
the <em>depends_on</em> statement. This is documented in <a href=https://docs.docker.com/compose/startup-order/>Controlling startup order in Compose</a>.</p><p>If you have a simple setup, with Tomcat and Postgres, sometimes Postgres will start first, but Compose
will initialize Tomcat before Postgres has fully booted. When that happens, you may receive 401, 404, or other
application errors.</p><p>You can fix it by combining <em>depends_on</em> with a <em>healthcheck</em>. For example:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#177500># File: docker-compose.yml</span>
</span></span><span style=display:flex><span>version: <span style=color:#c41a16>&#39;2.1&#39;</span>
</span></span><span style=display:flex><span>services:
</span></span><span style=display:flex><span>  db:
</span></span><span style=display:flex><span>    container_name: twpg
</span></span><span style=display:flex><span>    build:
</span></span><span style=display:flex><span>      context: .
</span></span><span style=display:flex><span>      dockerfile: Dockerfile.postgres
</span></span><span style=display:flex><span>    restart: always
</span></span><span style=display:flex><span>    ports:
</span></span><span style=display:flex><span>      - <span style=color:#c41a16>&#34;5432:5432&#34;</span>
</span></span><span style=display:flex><span>    healthcheck:
</span></span><span style=display:flex><span>      test: <span style=color:#c41a16>&#34;pg_isready -h localhost -p 5432 -q -U postgres&#34;</span>
</span></span><span style=display:flex><span>      interval: 10s
</span></span><span style=display:flex><span>      timeout: 5s
</span></span><span style=display:flex><span>      retries: <span style=color:#1c01ce>5</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  web:
</span></span><span style=display:flex><span>    container_name: twtc
</span></span><span style=display:flex><span>    build:
</span></span><span style=display:flex><span>      context: .
</span></span><span style=display:flex><span>      dockerfile: Dockerfile.tomcat
</span></span><span style=display:flex><span>    restart: always
</span></span><span style=display:flex><span>    depends_on:
</span></span><span style=display:flex><span>      db:
</span></span><span style=display:flex><span>        condition: service_healthy
</span></span><span style=display:flex><span>    links:
</span></span><span style=display:flex><span>      - db
</span></span><span style=display:flex><span>    ports:
</span></span><span style=display:flex><span>      - <span style=color:#c41a16>&#34;80:8080&#34;</span>
</span></span></code></pre></div><p>In the example docker-compose.yml, there are two containers, <em>db</em> and <em>web</em>. web is running
a Tomcat, and db is running Postgres. Web depends on db (see depends_on), and uses a condition
<em>service_healthy</em>. Which indicates it depends that that container is healthy.</p><p>The <em>healthcheck</em> entry under the db container settings define how to check whether Postgres
is running or not. In this case, we are using <em>pg_isready</em>, which is available in the
vanilla Postgres 9 container.</p><p>It will try 5 times, with a 10 seconds interval, and will time out after 5 seconds. You may
have to tune these parameters for your application.</p><p>This code snippet is from a
<a href=https://github.com/Foxoncz/docker-thingworx/pull/3/files>pull request submitted to Foxoncz/docker-thingworx</a>.</p><p>â™¥ Open Source</p><p>Categories:
<a href=/categories/blog.html>Blog</a></p><p>Tags:
<a href=/tags/docker.html>Docker</a></p><aside class=links><a class=previous href=https://kinoshita.eti.br/2017/02/28/using-aws-mfa-without-a-mobile-phone.html>&#171; Previous</a><a class=next href=https://kinoshita.eti.br/2017/03/15/using-google-natural-language-api-in-an-aws-elastic-beanstalk-application.html>Next &#187;</a></aside></article></main><footer role=contentinfo><ul id=social-media-icons><li><a href=https://www.instagram.com/brunokinoshita/><img src=/assets/icons/instagram.png alt="Instagram link"></a></li><li><a href=https://twitter.com/kinow/><img src=/assets/icons/twitter.png alt="Twitter link"></a></li><li><a href=https://github.com/kinow/><img src=/assets/icons/github.png alt="GitHub link"></a></li><li><a href=/feed.xml><img src=/assets/icons/news.png alt="RSS feed link"></a></li></ul></footer></body></html>