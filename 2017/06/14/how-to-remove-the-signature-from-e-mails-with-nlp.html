<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:url" content="https://kinoshita.eti.br/2017/06/14/how-to-remove-the-signature-from-e-mails-with-nlp.html"><meta property="og:site_name" content="kinow"><meta property="og:title" content="How to remove the signature from e-mails with NLP?"><meta property="og:description" content="Some time ago I stumbled across EmailParser, a Python utility to remove e-mail signatures. Here&amp;rsquo;s a sample input e-mail from the project documentation.
Wendy – thanks for the intro! Moving you to bcc. Hi Vincent – nice to meet you over email. Apologize for the late reply, I was on PTO for a couple weeks and this is my first week back in office. As Wendy mentioned, I am leading an AR/VR taskforce at Foobar Retail Solutions."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-06-14T00:00:00+00:00"><meta property="article:modified_time" content="2024-04-21T16:41:21+02:00"><meta property="article:tag" content="Python"><meta property="article:tag" content="Programming"><meta property="article:tag" content="Natural Language Processing"><meta property="article:tag" content="Opensource"><meta property="og:image" content="https://kinoshita.eti.br/assets/photos/about/2023-me-closeup.png"><meta property="fb:admins" content="bruno.kinoshita"><meta name=twitter:title content="How to remove the signature from e-mails with NLP?"><meta name=twitter:description content="Some time ago I stumbled across EmailParser, a Python utility to remove e-mail signatures. Here&rsquo;s a sample input e-mail from the project documentation.
Wendy – thanks for the intro! Moving you to bcc. Hi Vincent – nice to meet you over email. Apologize for the late reply, I was on PTO for a couple weeks and this is my first week back in office. As Wendy mentioned, I am leading an AR/VR taskforce at Foobar Retail Solutions."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kinoshita.eti.br/assets/photos/about/2023-me-closeup.png"><meta name=twitter:site content="@kinow"><link rel=alternate type=application/rss+xml href=https://kinoshita.eti.br/2017/06/14/how-to-remove-the-signature-from-e-mails-with-nlp/feed.xml title=kinow><link rel=stylesheet type=text/css href=https://kinoshita.eti.br/sass/main.1e768395a672116b3eff41b3123d9aafb8a9302476085be5fb658a4b93613f57.css integrity="sha256-HnaDlaZyEWs+/0GzEj2ar7ipMCR2CFvl+2WKS5NhP1c="><title>kinow | How to remove the signature from e-mails with NLP?</title><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"posts","name":"How to remove the signature from e-mails with NLP?","headline":"How to remove the signature from e-mails with NLP?","alternativeHeadline":"","description":"Some time ago I stumbled across EmailParser, a Python utility to remove e-mail signatures. Here\u0026rsquo;s a sample input e-mail from the project documentation.\nWendy – thanks for the intro! Moving you to bcc. Hi Vincent – nice to meet you over email. Apologize for the late reply, I was on PTO for a couple weeks and this is my first week back in office. As Wendy mentioned, I am leading an AR\/VR taskforce at Foobar Retail Solutions.","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/kinoshita.eti.br\/2017\/06\/14\/how-to-remove-the-signature-from-e-mails-with-nlp.html"},"author":{"@type":"Person","name":"Bruno P. Kinoshita"},"creator":{"@type":"Person","name":"Bruno P. Kinoshita"},"accountablePerson":{"@type":"Person","name":"Bruno P. Kinoshita"},"copyrightHolder":"kinow","copyrightYear":"2017","dateCreated":"2017-06-14T00:00:00.00Z","datePublished":"2017-06-14T00:00:00.00Z","dateModified":"2024-04-21T16:41:21.00Z","publisher":{"@type":"Organization","name":"kinow","url":"https://kinoshita.eti.br/","logo":{"@type":"ImageObject","url":"https:\/\/kinoshita.eti.br\/","width":"32","height":"32"}},"image":"https://kinoshita.eti.br/","url":"https:\/\/kinoshita.eti.br\/2017\/06\/14\/how-to-remove-the-signature-from-e-mails-with-nlp.html","wordCount":"628","genre":["python","programming","natural language processing","opensource"],"keywords":[]}</script></head><body><header role=banner class=content><nav id=nav aria-label=Main role=navigation class=content><ul><li><a href=/><i data-feather=about></i> About</a></li><li><a href=/blog/><i data-feather=blog></i> Blog</a></li><li><a href=/portfolio/><i data-feather=portfolio></i> Portfolio</a></li></ul></nav></header><main><article class=content><h1>How to remove the signature from e-mails with NLP?</h1><div class=metadata><i data-feather=calendar></i>
<time datetime=2017-06-14>Jun 14, 2017</time></div><aside><nav id=TableOfContents></nav></aside><p>Some time ago I stumbled across <a href=https://github.com/mynameisvinn/EmailParser>EmailParser</a>, a Python utility to remove e-mail signatures. Here&rsquo;s a sample input e-mail from the project documentation.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Wendy – thanks for the intro! Moving you to bcc.
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>Hi Vincent – nice to meet you over email. Apologize for the late reply, I was on PTO for a couple weeks and this is my first week back in office. As Wendy mentioned, I am leading an AR/VR taskforce at Foobar Retail Solutions. The goal of the taskforce is to better understand how AR/VR can apply to retail/commerce and if/what is the role of a shopping center in AR/VR applications for retail.
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>Wendy mentioned that you would be a great person to speak to since you are close to what is going on in this space. Would love to set up some time to chat via phone next week. What does your availability look like on Monday or Wednesday?
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>Best,
</span></span><span style=display:flex><span>Joe Smith
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>Joe Smith | Strategy &amp; Business Development
</span></span><span style=display:flex><span>111 Market St. Suite 111| San Francisco, CA 94103
</span></span><span style=display:flex><span>M: 111.111.1111| joe@foobar.com
</span></span></code></pre></div><p>And here&rsquo;s what it looks like afterwards.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Wendy – thanks for the intro! Moving you to bcc.
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>Hi Vincent – nice to meet you over email. Apologize for the late reply, I was on PTO for a couple weeks and this is my first week back in office. As Wendy mentioned, I am leading an AR/VR taskforce at Foobar Retail Solutions. The goal of the taskforce is to better understand how AR/VR can apply to retail/commerce and if/what is the role of a shopping center in AR/VR applications for retail.
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>Wendy mentioned that you would be a great person to speak to since you are close to what is going on in this space. Would love to set up some time to chat via phone next week. What does your availability look like on Monday or Wednesday?
</span></span></code></pre></div><p>As you can see, it removed all the lines after the main part of the message (i.e. after the three paragraphs). Here&rsquo;s what the Python code looks like.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>&gt;&gt;&gt;</span> <span style=color:#a90d91>from</span> <span style=color:#000>Parser</span> <span style=color:#a90d91>import</span> <span style=color:#000>read_email</span>, <span style=color:#000>strip</span>, <span style=color:#000>prob_block</span>
</span></span><span style=display:flex><span><span style=color:#000>&gt;&gt;&gt;</span> <span style=color:#a90d91>from</span> <span style=color:#000>spacy.en</span> <span style=color:#a90d91>import</span> <span style=color:#000>English</span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>&gt;&gt;&gt;</span> <span style=color:#000>pos</span> <span style=color:#000>=</span> <span style=color:#000>English</span>()  <span style=color:#177500># part-of-speech tagger</span>
</span></span><span style=display:flex><span><span style=color:#000>&gt;&gt;&gt;</span> <span style=color:#000>msg_raw</span> <span style=color:#000>=</span> <span style=color:#000>read_email</span>(<span style=color:#c41a16>&#39;emails/test1.txt&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#000>&gt;&gt;&gt;</span> <span style=color:#000>msg_stripped</span> <span style=color:#000>=</span> <span style=color:#000>strip</span>(<span style=color:#000>msg_raw</span>)  <span style=color:#177500># preprocessing text before POS tagging</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500># iterate through lines, write to file if not signature block</span>
</span></span><span style=display:flex><span><span style=color:#000>&gt;&gt;&gt;</span> <span style=color:#000>generate_text</span>(<span style=color:#000>msg_stripped</span>, <span style=color:#1c01ce>.9</span>, <span style=color:#000>pos_tagger</span>, <span style=color:#c41a16>&#39;emails/test1_clean.txt&#39;</span>) 
</span></span></code></pre></div><p>What got me interested about this utility was the use of NLP. I couldn&rsquo;t imagine how someone could use NLP for that. And I liked the simplicity of the approach, which is not perfect, but can be useful someday.</p><p>After the imports in the code, it creates a <a href=https://en.wikipedia.org/wiki/Part_of_speech>Part of Speech</a> tagger using <a href=https://spacy.io/>spaCy</a> NLP library, reads the e-mail from a file, and sripts and creates an array with each paragraph of the message.</p><p>The magic happens in the <code>generate_text</code> function, which receives the <strong>array of paragraphs</strong>, a <strong>threshold</strong>, the <strong>POS tagger</strong>, and the <strong>output destination</strong>. Here&rsquo;s what the function does.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>for each message
</span></span><span style=display:flex><span>    if probability ( signature block | message ) &lt; threshold
</span></span><span style=display:flex><span>        write to output file
</span></span></code></pre></div><p>And the formula for calculating the probability is quite simple too.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>1. For a given paragraph (message block), find all the sentences in it.
</span></span><span style=display:flex><span>2. Then for each word (token) in the sentence, count the number of times a non-verb appears.
</span></span><span style=display:flex><span>3. Return the proportion of non-verbs per sentence, i.e. number of non-verbs / number of sentences.
</span></span></code></pre></div><p>In summary, it discards blocks that do not contain enough verbs to be considered a message block, being treated as signature blocks instead.</p><p>Never thought about using an approach like this. It may definitely be helpful when doing data analysis, information retrieval, or scraping data from the web. Not necessarily with e-mails and signatures, but you got the gist of it.</p><p>♥ Open Source</p><p>Categories:
<a href=/categories/blog.html>Blog</a></p><p>Tags:
<a href=/tags/python.html>Python</a>,
<a href=/tags/programming.html>Programming</a>,
<a href=/tags/natural-language-processing.html>Natural Language Processing</a>,
<a href=/tags/opensource.html>Opensource</a></p><aside class=links><a class=previous href=https://kinoshita.eti.br/2017/06/10/backward-compatibility-and-switch-statement-with-constant-expressions.html>&#171; Previous</a><a class=next href=https://kinoshita.eti.br/2017/06/27/drawing-archer.html>Next &#187;</a></aside></article></main><footer role=contentinfo><ul id=social-media-icons><li><a href=https://www.instagram.com/brunokinoshita/><img src=/assets/icons/instagram.png alt="Instagram link"></a></li><li><a href=https://twitter.com/kinow/><img src=/assets/icons/twitter.png alt="Twitter link"></a></li><li><a href=https://github.com/kinow/><img src=/assets/icons/github.png alt="GitHub link"></a></li><li><a href=/feed.xml><img src=/assets/icons/news.png alt="RSS feed link"></a></li></ul></footer></body></html>