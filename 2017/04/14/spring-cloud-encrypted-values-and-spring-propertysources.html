<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:url" content="https://kinoshita.eti.br/2017/04/14/spring-cloud-encrypted-values-and-spring-propertysources.html"><meta property="og:site_name" content="kinow"><meta property="og:title" content="Spring Cloud encrypted values and Spring PropertySources"><meta property="og:description" content="As I could not find any documentation for that, I decided to write it as a note to myself in case I use the encryption and decryption with Spring Cloud again.
In Spring and Spring Boot, you normally have multiple sources of properties, like multiple properties files, environment properties and variables, and so it goes. In the Spring API, these are represented as PropertySource&amp;rsquo;s.
In a Spring Boot application, you would be used to overriding certain properties by defining environments and using an application-production."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-04-14T00:00:00+00:00"><meta property="article:modified_time" content="2024-07-24T17:43:59+02:00"><meta property="article:tag" content="Java"><meta property="article:tag" content="Programming"><meta property="article:tag" content="Opensource"><meta property="og:image" content="https://kinoshita.eti.br/assets/photos/about/2023-me-closeup.png"><meta property="fb:admins" content="bruno.kinoshita"><meta name=twitter:title content="Spring Cloud encrypted values and Spring PropertySources"><meta name=twitter:description content="As I could not find any documentation for that, I decided to write it as a note to myself in case I use the encryption and decryption with Spring Cloud again.
In Spring and Spring Boot, you normally have multiple sources of properties, like multiple properties files, environment properties and variables, and so it goes. In the Spring API, these are represented as PropertySource&rsquo;s.
In a Spring Boot application, you would be used to overriding certain properties by defining environments and using an application-production."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kinoshita.eti.br/assets/photos/about/2023-me-closeup.png"><meta name=twitter:site content="@kinow"><link rel=alternate type=application/rss+xml href=https://kinoshita.eti.br/2017/04/14/spring-cloud-encrypted-values-and-spring-propertysources/feed.xml title=kinow><link rel=stylesheet type=text/css href=https://kinoshita.eti.br/sass/main.84655682aa42a26b14ea59649da35e622383c94bca7a62d17b2cc6c559ed1efb.css integrity="sha256-hGVWgqpComsU6llknaNeYiODyUvKemLReyzGxVntHvs="><title>kinow | Spring Cloud encrypted values and Spring PropertySources</title><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"posts","name":"Spring Cloud encrypted values and Spring PropertySources","headline":"Spring Cloud encrypted values and Spring PropertySources","alternativeHeadline":"","description":"As I could not find any documentation for that, I decided to write it as a note to myself in case I use the encryption and decryption with Spring Cloud again.\nIn Spring and Spring Boot, you normally have multiple sources of properties, like multiple properties files, environment properties and variables, and so it goes. In the Spring API, these are represented as PropertySource\u0026rsquo;s.\nIn a Spring Boot application, you would be used to overriding certain properties by defining environments and using an application-production.","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/kinoshita.eti.br\/2017\/04\/14\/spring-cloud-encrypted-values-and-spring-propertysources.html"},"author":{"@type":"Person","name":""},"creator":{"@type":"Person","name":""},"accountablePerson":{"@type":"Person","name":""},"copyrightHolder":"kinow","copyrightYear":"2017","dateCreated":"2017-04-14T00:00:00.00Z","datePublished":"2017-04-14T00:00:00.00Z","dateModified":"2024-07-24T17:43:59.00Z","publisher":{"@type":"Organization","name":"kinow","url":"https://kinoshita.eti.br/","logo":{"@type":"ImageObject","url":"https:\/\/kinoshita.eti.br\/","width":"32","height":"32"}},"image":"https://kinoshita.eti.br/","url":"https:\/\/kinoshita.eti.br\/2017\/04\/14\/spring-cloud-encrypted-values-and-spring-propertysources.html","wordCount":"316","genre":["java","programming","opensource"],"keywords":[]}</script></head><body><header role=banner class=content><nav id=nav aria-label=Main role=navigation class=content><ul><li><a href=/><i data-feather=about></i> About</a></li><li><a href=/blog/><i data-feather=blog></i> Blog</a></li><li><a href=/portfolio/><i data-feather=portfolio></i> Portfolio</a></li></ul></nav></header><main><article class=content><h1>Spring Cloud encrypted values and Spring PropertySources</h1><div class=metadata><i data-feather=calendar></i>
<time datetime=2017-04-14>Apr 14, 2017</time></div><aside><nav id=TableOfContents></nav></aside><p>As I could not find any documentation for that, I decided to write it as a note to myself
in case I use the
<a href=https://cloud.spring.io/spring-cloud-config/spring-cloud-config.html#_encryption_and_decryption>encryption and decryption</a>
with Spring Cloud again.</p><p>In Spring and Spring Boot, you normally have multiple sources of properties, like multiple
properties files, environment properties and variables, and so it goes. In the Spring API,
these are represented as
<a href=http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/context/annotation/PropertySource.html>PropertySource</a>&rsquo;s.</p><p>In a Spring Boot application, you would be used to overriding certain properties
by defining environments and using an application-production.properties file, or
overriding values with environment properties.</p><p>This is common in
<a href=https://aws.amazon.com/blogs/devops/deploying-a-spring-boot-application-on-aws-using-aws-elastic-beanstalk/>Spring Boot applications deployed to Amazon Elastic Beanstalk</a>.</p><p>Some time ago another team at work found that overriding did not always work when you have
encrypted values in your properties files. Even if you specified new values in the
Amazon Elastic Beanstalk application configuration.</p><p>Yesterday, while debugging the issue and reading Spring Cloud source code, I found its
<a href=https://github.com/spring-cloud/spring-cloud-commons/blob/9675df02f6a2c01766711f7dee3c4d2818b7d716/spring-cloud-context/src/main/java/org/springframework/cloud/bootstrap/encrypt/EnvironmentDecryptApplicationInitializer.java#L44>EnvironmentDecryptApplicationInitializer</a>.</p><p>It basically iterates through all loaded property sources, looking for values that start with
{cipher}. Then it calls the
<a href=http://docs.spring.io/spring-security/site/docs/current/apidocs/org/springframework/security/crypto/encrypt/TextEncryptor.html>Spring Security TextEncryptor</a>
defined in the application.</p><p>Finally, it creates a new property source, called decrypted, with the decrypted values. So when
your application looks for a property called XPTO, and if it has been encrypted, it will
find the value in the decrypted propery source, regardless of whether you tried to override it or
not.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#177500># Property sources listed in Eclipse IDE</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>[</span>
</span></span><span style=display:flex><span>  servletConfigInitParams,
</span></span><span style=display:flex><span>  servletContextInitParams,
</span></span><span style=display:flex><span>  systemProperties,
</span></span><span style=display:flex><span>  systemEnvironment,
</span></span><span style=display:flex><span>  random,
</span></span><span style=display:flex><span>  applicationConfigurationProperties,
</span></span><span style=display:flex><span>  springCloudClientHostInfo,
</span></span><span style=display:flex><span>  defaultProperties
</span></span><span style=display:flex><span><span style=color:#000>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500># When using encrypted values</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>[</span>
</span></span><span style=display:flex><span>  decrypted, &lt;-------- created by Spring Cloud, with decrypted values. Prepended to the list of property sources
</span></span><span style=display:flex><span>  servletConfigInitParams,
</span></span><span style=display:flex><span>  servletContextInitParams,
</span></span><span style=display:flex><span>  systemProperties,
</span></span><span style=display:flex><span>  systemEnvironment,
</span></span><span style=display:flex><span>  random,
</span></span><span style=display:flex><span>  applicationConfigurationProperties,
</span></span><span style=display:flex><span>  springCloudClientHostInfo,
</span></span><span style=display:flex><span>  defaultProperties
</span></span><span style=display:flex><span><span style=color:#000>]</span>
</span></span></code></pre></div><p>So in case you have encrypted values in your Spring application (and you are using Spring Cloud,
of course) remember that these values will have higher priority, and can only be overriden by other
encrypted values.</p><p>â™¥ Open Source</p><p>Categories:
<a href=/categories/blog.html>Blog</a></p><p>Tags:
<a href=/tags/java.html>Java</a>,
<a href=/tags/programming.html>Programming</a>,
<a href=/tags/opensource.html>Opensource</a></p><aside class=links><a class=previous href=https://kinoshita.eti.br/2017/04/14/writing-a-binary-parser-in-python-numpy-vs.-construct.html>&#171; Previous</a><a class=next href=https://kinoshita.eti.br/2017/04/17/troubleshooting-a-jenkins-plug-in-compatibility-issue.html>Next &#187;</a></aside></article></main><footer role=contentinfo><ul id=social-media-icons><li><a href=https://www.instagram.com/brunokinoshita/><img src=/assets/icons/instagram.png alt="Instagram link"></a></li><li><a href=https://twitter.com/kinow/><img src=/assets/icons/twitter.png alt="Twitter link"></a></li><li><a href=https://github.com/kinow/><img src=/assets/icons/github.png alt="GitHub link"></a></li><li><a href=/feed.xml><img src=/assets/icons/news.png alt="RSS feed link"></a></li></ul></footer></body></html>