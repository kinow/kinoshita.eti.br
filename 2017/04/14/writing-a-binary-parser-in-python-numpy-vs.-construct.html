<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta property="og:title" content="Writing a binary parser in Python: NumPy vs. Construct">
<meta property="og:description" content="Some time ago I worked with researchers to write a parser for an old data format. The data was generated by device (radiosonde) using the vendor (Vaisala) specific binary format.
One of the researchers told me someone had written a parser for his work, and shared it on GitHub. To be honest, that was my first time parsing data in binary with Python. Did that before with C, C++, Perl, and Java, but never with Python.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://kinoshita.eti.br/2017/04/14/writing-a-binary-parser-in-python-numpy-vs.-construct.html"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2017-04-14T00:00:00+00:00">
<meta property="article:modified_time" content="2017-04-14T00:00:00+00:00">
<link rel=stylesheet type=text/css href=https://kinoshita.eti.br/sass/main.de6eddbd022e2ff31c7675270a2ccd00d63fa2c52ca6dc77e1a974bc7b0b7103.css integrity="sha256-3m7dvQIuL/McdnUnCizNANY/osUsptx34al0vHsLcQM=">
<title>kinow | Writing a binary parser in Python: NumPy vs. Construct</title>
</head>
<body>
<header role=banner class=content>
<nav id=nav aria-label=Main role=navigation class=content>
<ul><li>
<a href=/><i data-feather=about></i> About</a>
</li><li>
<a href=/blog/><i data-feather=blog></i> Blog</a>
</li><li>
<a href=/portfolio/><i data-feather=portfolio></i> Portfolio</a>
</li>
</ul>
</nav>
</header>
<main>
<article class=content>
<h1>Writing a binary parser in Python: NumPy vs. Construct</h1><div class=metadata>
<i data-feather=calendar></i>
<time datetime=2017-04-14>Apr 14, 2017</time>
</div>
<p>Some time ago I worked with researchers to write a parser for an old data format. The data
was generated by device (radiosonde) using the vendor (Vaisala) specific binary format.</p>
<p>One of the researchers told me someone had written a parser for his work, and shared it
on GitHub. To be honest, that was my first time parsing data in binary with Python. Did
that before with C, C++, Perl, and Java, but never with Python.</p>
<p>The code on GitHub used <a href=http://www.numpy.org/>NumPy</a> and looked similar to this one.</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:navy;font-weight:700>import</span> numpy <span style=color:navy;font-weight:700>as</span> np

parse_header = np.dtype( [ ((<span style=color:#00f>&#39;field_a&#39;</span>, <span style=color:#00f>&#39;b1&#39;</span>), (<span style=color:#00f>&#39;field_b&#39;</span>, <span style=color:#00f>&#39;17b1&#39;</span>) ] )

<span style=color:navy;font-weight:700>with</span> open(<span style=color:#00f>&#39;input.dat&#39;</span>, <span style=color:#00f>&#39;rb&#39;</span>) <span style=color:navy;font-weight:700>as</span> f:
    header = np.fromfile(f, dtype=parse_header, count=<span style=color:#00f>1</span>)
    <span style=color:#080;font-style:italic># ...</span>
</code></pre></div><p>And it indeed worked fine. But in the end I used the code - after contacting the author and letting
him know what I was about to do - as reference together with an old specification document
for the format, and created a parser with <a href=https://construct.readthedocs.io/en/latest/>Construct</a>.</p>
<p>From Construct&rsquo;s website:</p>
<blockquote>
<p>Construct is a powerful declarative parser (and builder) for binary data.</p>
</blockquote>
<p>This is what the code with construct looked like.</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:navy;font-weight:700>from</span> construct <span style=color:navy;font-weight:700>import</span> *

parse_header = Struct(<span style=color:#00f>&#34;parse_header&#34;</span>,
    Enum(Byte(<span style=color:#00f>&#34;file_ready&#34;</span>),
        READY = <span style=color:#00f>1</span>,
        NOT_READY = <span style=color:#00f>0</span>,
        _default_ = <span style=color:#00f>&#34;UNKNOWN&#34;</span>,
    ),
    Bytes(<span style=color:#00f>&#34;reserved&#34;</span>, <span style=color:#00f>17</span>)
)

<span style=color:#080;font-style:italic># ...</span>

parse_contents = Struct(<span style=color:#00f>&#34;parse_contents&#34;</span>,
    parse_header,
    Range(mincount=<span style=color:#00f>1</span>, maxcout=<span style=color:#00f>5</span>, subcon=pre_data),
    OptionalGreedyRange(detailed_data)
)

<span style=color:navy;font-weight:700>with</span> open(<span style=color:#00f>&#39;input.dat&#39;</span>, <span style=color:#00f>&#39;rb&#39;</span>) <span style=color:navy;font-weight:700>as</span> f:
    parse_results = parse_contents.parse_stream(fid)
    <span style=color:#080;font-style:italic># ...</span>
</code></pre></div><p>Writing the parser with NumPy or Construct would achieve the same result. However, in the end
this came down to personal preference, and my point of view as Software Engineer. This is the
description of NumPy.</p>
<blockquote>
<p>NumPy is the fundamental package for scientific computing with Python.</p>
</blockquote>
<p>NumPy is a project tailored for scientific computing, with a focus on linear algebra,
N-dimensional arrays, and so it goes. While it contains code that can parse binary data,
the footprint added to a project that includes it as dependency is quite big.</p>
<p>The parser written with NumPy wasn&rsquo;t using 5% of the NumPy code base. Probably less than 1%. Updates
to NumPy could break the application compatibility, even if the update came due to some new
matrix operation added to NumPy through some external and missing dependency.</p>
<p>In Java something similar happens with Google Guava. While I use it some times, most of the
times I find myself using one of the Apache Commons libraries, or another dependency
with just what I need. To avoid including unnecessary code to my application.</p>
<p>If you prefer to use NumPy that&rsquo;s fine too :-) I just had the time enough to rewrite it
instead of using the NumPy (took a couple of hours). In other cases it may still
make sense to use another tool or library, even if it was not made specifically for the
job ¯\<em>(ツ)</em>/¯</p>
<p>♥ Open Source</p>
<aside class=links>
<a class=previous href=https://kinoshita.eti.br/2017/04/02/fixing-qt-warning-qlayout-attempting-to-add-qlayout-to-qwidget-which-already-has-a-layout.html>&#171; Previous</a>
<a class=next href=https://kinoshita.eti.br/2017/04/14/spring-cloud-encrypted-values-and-spring-propertysources.html>Next &#187;</a>
</aside>
</article>
</main>
<footer role=contentinfo>
<ul id=social-media-icons>
<li>
<a href=https://www.instagram.com/brunokinoshita/>
<img src=/assets/icons/instagram.png alt="Instagram link">
</a>
</li>
<li>
<a href=https://twitter.com/kinow/>
<img src=/assets/icons/twitter.png alt="Twitter link">
</a>
</li>
<li>
<a href=https://github.com/kinow/>
<img src=/assets/icons/github.png alt="GitHub link">
</a>
</li>
<li>
<a href=/feed.xml>
<img src=/assets/icons/news.png alt="RSS feed link">
</a>
</li>
</ul>
</footer>
</body>
</html>