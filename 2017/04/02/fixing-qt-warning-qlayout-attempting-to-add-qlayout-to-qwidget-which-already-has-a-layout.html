<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Fixing Qt warning “QLayout: Attempting to add QLayout “” to QWidget “”, which already has a layout” | Bruno P. Kinoshita</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Fixing Qt warning “QLayout: Attempting to add QLayout “” to QWidget “”, which already has a layout”" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="If you ever started Krita 3.x in your command line, and had a look at the console output, you may noticed the following warning. QLayout: Attempting to add QLayout “” to QWidget “”, which already has a layout Krita recently announced the release of 3.1.3-alpha-2, and while testing I saw this warning and decided to investigate why this warning happens. There was already a similar question posted on StackOverflow. And the best answer’s initial paragraph gave me a hint of what to look for. When you assign a widget as the parent of a QLayout by passing it into the constructor, the layout is automatically set as the layout for that widget. In your code you are not only doing this, but explicitly calling setlayout(). This is no problem when when the widget passed is the same. If they are different you will get an error because Qt tries to assign the second layout to your widget which has already had a layout set. So, somewhere in Krita code, there was a a QWidget being created, and layouts were being added to it more than once. To find where the issue was happening was quite easy. A breakpoint at main.cc where the application is initialized, then step through a few times, until the message appeared in the console. Further investigation led me to the History docker (the one that shows undo steps) constructor. QVBoxLayout *vl = new QVBoxLayout(page); // layout being set to page m_undoView = new KisUndoView(this); vl-&gt;addWidget(m_undoView); QHBoxLayout *hl = new QHBoxLayout(page); // layout being set to page again hl-&gt;addSpacerItem(new QSpacerItem(10, 1, QSizePolicy::Expanding, QSizePolicy::Fixed)); m_bnConfigure = new QToolButton(page); m_bnConfigure-&gt;setIcon(KisIconUtils::loadIcon(&quot;configure&quot;)); connect(m_bnConfigure, SIGNAL(clicked(bool)), SLOT(configure())); hl-&gt;addWidget(m_bnConfigure); vl-&gt;addItem(hl); setWidget(page); setWindowTitle(i18n(&quot;Undo History&quot;)); Here the QWidget created receives both QHBoxLayout and QVBoxLayout. Again, searching the Internet a little bit, then came across this post with a good example of a QWidget with QHBoxLayout and QVBoxLayout. Here’s what the constructor looks after the patch has been applied. QVBoxLayout *vl = new QVBoxLayout(page); // layout being set to page m_undoView = new KisUndoView(this); vl-&gt;addWidget(m_undoView); QHBoxLayout *hl = new QHBoxLayout(); hl-&gt;addSpacerItem(new QSpacerItem(10, 1, QSizePolicy::Expanding, QSizePolicy::Fixed)); m_bnConfigure = new QToolButton(page); m_bnConfigure-&gt;setIcon(KisIconUtils::loadIcon(&quot;configure&quot;)); connect(m_bnConfigure, SIGNAL(clicked(bool)), SLOT(configure())); hl-&gt;addWidget(m_bnConfigure); vl-&gt;addItem(hl); vl-&gt;addLayout(hl); // horizontal layout added to the vertical layout setWidget(page); setWindowTitle(i18n(&quot;Undo History&quot;)); That’s it. Learned something new in Qt. Not as important and useful as learning about signals and slots, but now I can focus on other warnings in the console output of Krita. And you? Have you tested Krita 3.1.3 alpha already? What are you waiting for? :-) ♥ Open Source" />
<meta property="og:description" content="If you ever started Krita 3.x in your command line, and had a look at the console output, you may noticed the following warning. QLayout: Attempting to add QLayout “” to QWidget “”, which already has a layout Krita recently announced the release of 3.1.3-alpha-2, and while testing I saw this warning and decided to investigate why this warning happens. There was already a similar question posted on StackOverflow. And the best answer’s initial paragraph gave me a hint of what to look for. When you assign a widget as the parent of a QLayout by passing it into the constructor, the layout is automatically set as the layout for that widget. In your code you are not only doing this, but explicitly calling setlayout(). This is no problem when when the widget passed is the same. If they are different you will get an error because Qt tries to assign the second layout to your widget which has already had a layout set. So, somewhere in Krita code, there was a a QWidget being created, and layouts were being added to it more than once. To find where the issue was happening was quite easy. A breakpoint at main.cc where the application is initialized, then step through a few times, until the message appeared in the console. Further investigation led me to the History docker (the one that shows undo steps) constructor. QVBoxLayout *vl = new QVBoxLayout(page); // layout being set to page m_undoView = new KisUndoView(this); vl-&gt;addWidget(m_undoView); QHBoxLayout *hl = new QHBoxLayout(page); // layout being set to page again hl-&gt;addSpacerItem(new QSpacerItem(10, 1, QSizePolicy::Expanding, QSizePolicy::Fixed)); m_bnConfigure = new QToolButton(page); m_bnConfigure-&gt;setIcon(KisIconUtils::loadIcon(&quot;configure&quot;)); connect(m_bnConfigure, SIGNAL(clicked(bool)), SLOT(configure())); hl-&gt;addWidget(m_bnConfigure); vl-&gt;addItem(hl); setWidget(page); setWindowTitle(i18n(&quot;Undo History&quot;)); Here the QWidget created receives both QHBoxLayout and QVBoxLayout. Again, searching the Internet a little bit, then came across this post with a good example of a QWidget with QHBoxLayout and QVBoxLayout. Here’s what the constructor looks after the patch has been applied. QVBoxLayout *vl = new QVBoxLayout(page); // layout being set to page m_undoView = new KisUndoView(this); vl-&gt;addWidget(m_undoView); QHBoxLayout *hl = new QHBoxLayout(); hl-&gt;addSpacerItem(new QSpacerItem(10, 1, QSizePolicy::Expanding, QSizePolicy::Fixed)); m_bnConfigure = new QToolButton(page); m_bnConfigure-&gt;setIcon(KisIconUtils::loadIcon(&quot;configure&quot;)); connect(m_bnConfigure, SIGNAL(clicked(bool)), SLOT(configure())); hl-&gt;addWidget(m_bnConfigure); vl-&gt;addItem(hl); vl-&gt;addLayout(hl); // horizontal layout added to the vertical layout setWidget(page); setWindowTitle(i18n(&quot;Undo History&quot;)); That’s it. Learned something new in Qt. Not as important and useful as learning about signals and slots, but now I can focus on other warnings in the console output of Krita. And you? Have you tested Krita 3.1.3 alpha already? What are you waiting for? :-) ♥ Open Source" />
<link rel="canonical" href="https://kinoshita.eti.br/2017/04/02/fixing-qt-warning-qlayout-attempting-to-add-qlayout-to-qwidget-which-already-has-a-layout.html" />
<meta property="og:url" content="https://kinoshita.eti.br/2017/04/02/fixing-qt-warning-qlayout-attempting-to-add-qlayout-to-qwidget-which-already-has-a-layout.html" />
<meta property="og:site_name" content="Bruno P. Kinoshita" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-04-02T00:00:00+13:00" />
<script type="application/ld+json">
{"description":"If you ever started Krita 3.x in your command line, and had a look at the console output, you may noticed the following warning. QLayout: Attempting to add QLayout “” to QWidget “”, which already has a layout Krita recently announced the release of 3.1.3-alpha-2, and while testing I saw this warning and decided to investigate why this warning happens. There was already a similar question posted on StackOverflow. And the best answer’s initial paragraph gave me a hint of what to look for. When you assign a widget as the parent of a QLayout by passing it into the constructor, the layout is automatically set as the layout for that widget. In your code you are not only doing this, but explicitly calling setlayout(). This is no problem when when the widget passed is the same. If they are different you will get an error because Qt tries to assign the second layout to your widget which has already had a layout set. So, somewhere in Krita code, there was a a QWidget being created, and layouts were being added to it more than once. To find where the issue was happening was quite easy. A breakpoint at main.cc where the application is initialized, then step through a few times, until the message appeared in the console. Further investigation led me to the History docker (the one that shows undo steps) constructor. QVBoxLayout *vl = new QVBoxLayout(page); // layout being set to page m_undoView = new KisUndoView(this); vl-&gt;addWidget(m_undoView); QHBoxLayout *hl = new QHBoxLayout(page); // layout being set to page again hl-&gt;addSpacerItem(new QSpacerItem(10, 1, QSizePolicy::Expanding, QSizePolicy::Fixed)); m_bnConfigure = new QToolButton(page); m_bnConfigure-&gt;setIcon(KisIconUtils::loadIcon(&quot;configure&quot;)); connect(m_bnConfigure, SIGNAL(clicked(bool)), SLOT(configure())); hl-&gt;addWidget(m_bnConfigure); vl-&gt;addItem(hl); setWidget(page); setWindowTitle(i18n(&quot;Undo History&quot;)); Here the QWidget created receives both QHBoxLayout and QVBoxLayout. Again, searching the Internet a little bit, then came across this post with a good example of a QWidget with QHBoxLayout and QVBoxLayout. Here’s what the constructor looks after the patch has been applied. QVBoxLayout *vl = new QVBoxLayout(page); // layout being set to page m_undoView = new KisUndoView(this); vl-&gt;addWidget(m_undoView); QHBoxLayout *hl = new QHBoxLayout(); hl-&gt;addSpacerItem(new QSpacerItem(10, 1, QSizePolicy::Expanding, QSizePolicy::Fixed)); m_bnConfigure = new QToolButton(page); m_bnConfigure-&gt;setIcon(KisIconUtils::loadIcon(&quot;configure&quot;)); connect(m_bnConfigure, SIGNAL(clicked(bool)), SLOT(configure())); hl-&gt;addWidget(m_bnConfigure); vl-&gt;addItem(hl); vl-&gt;addLayout(hl); // horizontal layout added to the vertical layout setWidget(page); setWindowTitle(i18n(&quot;Undo History&quot;)); That’s it. Learned something new in Qt. Not as important and useful as learning about signals and slots, but now I can focus on other warnings in the console output of Krita. And you? Have you tested Krita 3.1.3 alpha already? What are you waiting for? :-) ♥ Open Source","@type":"BlogPosting","url":"https://kinoshita.eti.br/2017/04/02/fixing-qt-warning-qlayout-attempting-to-add-qlayout-to-qwidget-which-already-has-a-layout.html","headline":"Fixing Qt warning “QLayout: Attempting to add QLayout “” to QWidget “”, which already has a layout”","dateModified":"2017-04-02T00:00:00+13:00","datePublished":"2017-04-02T00:00:00+13:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://kinoshita.eti.br/2017/04/02/fixing-qt-warning-qlayout-attempting-to-add-qlayout-to-qwidget-which-already-has-a-layout.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/main.css"><link type="application/atom+xml" rel="alternate" href="https://kinoshita.eti.br/feed.xml" title="Bruno P. Kinoshita" /><link href="https://unpkg.com/pattern.css" rel="stylesheet">

</head>
<body>
<div id="mobile-menu"><div class="menu">
  <ul class="menu">
    <li class="item">
      <h1 id="kinow">KINOW</h1>
    </li>
    <li class="item">
      <a href="/" class="">About</a>
    </li>
    <li class="item">
      <a href="/blog/" class="current">Blog</a>
    </li>
    <li class="item">
      <a href="/portfolio/" class="">Portfolio</a>
    </li>
  </ul>
</div>
</div>
<div id="wrapper">
  <div id="sidebar"><div class="menu">
  <ul class="menu">
    <li class="item">
      <h1 id="kinow">KINOW</h1>
    </li>
    <li class="item">
      <a href="/" class="">About</a>
    </li>
    <li class="item">
      <a href="/blog/" class="current">Blog</a>
    </li>
    <li class="item">
      <a href="/portfolio/" class="">Portfolio</a>
    </li>
  </ul>
</div>
</div>
  <div id="content">
    <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Fixing Qt warning &quot;QLayout: Attempting to add QLayout &quot;&quot; to QWidget &quot;&quot;, which already has a layout&quot;</h1>
    <span class="post-meta">
      <time class="dt-published" datetime="2017-04-02T00:00:00+13:00" itemprop="datePublished">Apr 2, 2017
      </time>
      <span>&mdash; star date: -305668.49.</span>
      <span>
        Number of words: 658.
      </span></span>
  </header>

  


  <div class="post-content e-content" itemprop="articleBody">
    <p>If you ever started Krita 3.x in your command line, and had a look at the console output,
you may noticed the following warning.</p>

<blockquote>
  <p>QLayout: Attempting to add QLayout “” to QWidget “”, which already has a layout</p>
</blockquote>

<p>Krita recently <a href="https://krita.org/en/item/krita-3-1-3-alpha-released/">announced the release of 3.1.3-alpha-2</a>,
and while testing I saw this warning and
decided to investigate why this warning happens.</p>

<p>There was already
<a href="http://stackoverflow.com/a/25451334">a similar question posted on StackOverflow</a>. And the
best answer’s initial paragraph gave me a hint of what to look for.</p>

<blockquote>
  <p>When you assign a widget as the parent of a QLayout by passing it into the constructor, the layout is automatically set as the layout for that widget. In your code you are not only doing this, but explicitly calling setlayout(). This is no problem when when the widget passed is the same. If they are different you will get an error because Qt tries to assign the second layout to your widget which has already had a layout set.</p>
</blockquote>

<p>So, somewhere in Krita code, there was a a QWidget being created, and layouts
were being added to it more than once. To find where the issue was happening was quite easy. A breakpoint at
<a href="https://github.com/KDE/krita/blob/9e2b8c5b07deccd4a616ad7930a91e8cc784a85b/krita/main.cc#L141">main.cc</a>
where the application is initialized, then step through a few times, until the message appeared in the
console.</p>

<p>Further investigation led me to the History docker (the one that shows undo steps)
<a href="https://github.com/KDE/krita/blob/9e2b8c5b07deccd4a616ad7930a91e8cc784a85b/plugins/dockers/historydocker/HistoryDock.cpp#L33">constructor</a>.</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">QVBoxLayout</span> <span class="o">*</span><span class="n">vl</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">QVBoxLayout</span><span class="p">(</span><span class="n">page</span><span class="p">);</span> <span class="c1">// layout being set to page</span>
    <span class="n">m_undoView</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">KisUndoView</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="n">vl</span><span class="o">-&gt;</span><span class="n">addWidget</span><span class="p">(</span><span class="n">m_undoView</span><span class="p">);</span>
    <span class="n">QHBoxLayout</span> <span class="o">*</span><span class="n">hl</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">QHBoxLayout</span><span class="p">(</span><span class="n">page</span><span class="p">);</span> <span class="c1">// layout being set to page again</span>
    <span class="n">hl</span><span class="o">-&gt;</span><span class="n">addSpacerItem</span><span class="p">(</span><span class="k">new</span> <span class="nf">QSpacerItem</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>  <span class="n">QSizePolicy</span><span class="o">::</span><span class="n">Expanding</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="o">::</span><span class="n">Fixed</span><span class="p">));</span>
    <span class="n">m_bnConfigure</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">QToolButton</span><span class="p">(</span><span class="n">page</span><span class="p">);</span>
    <span class="n">m_bnConfigure</span><span class="o">-&gt;</span><span class="n">setIcon</span><span class="p">(</span><span class="n">KisIconUtils</span><span class="o">::</span><span class="n">loadIcon</span><span class="p">(</span><span class="s">"configure"</span><span class="p">));</span>
    <span class="n">connect</span><span class="p">(</span><span class="n">m_bnConfigure</span><span class="p">,</span> <span class="n">SIGNAL</span><span class="p">(</span><span class="n">clicked</span><span class="p">(</span><span class="kt">bool</span><span class="p">)),</span> <span class="n">SLOT</span><span class="p">(</span><span class="n">configure</span><span class="p">()));</span>
    <span class="n">hl</span><span class="o">-&gt;</span><span class="n">addWidget</span><span class="p">(</span><span class="n">m_bnConfigure</span><span class="p">);</span>
    <span class="n">vl</span><span class="o">-&gt;</span><span class="n">addItem</span><span class="p">(</span><span class="n">hl</span><span class="p">);</span>

    <span class="n">setWidget</span><span class="p">(</span><span class="n">page</span><span class="p">);</span>
    <span class="n">setWindowTitle</span><span class="p">(</span><span class="n">i18n</span><span class="p">(</span><span class="s">"Undo History"</span><span class="p">));</span>
</code></pre></div></div>

<p>Here the QWidget created receives both QHBoxLayout and QVBoxLayout. Again, searching the Internet
a little bit, then came across this post with a good example of a QWidget with
QHBoxLayout and QVBoxLayout. Here’s what the constructor looks after the
<a href="https://bugs.kde.org/show_bug.cgi?id=378313">patch</a>
has been <a href="https://github.com/KDE/krita/commit/1d2343c0cacfb0b105fbe86c2bcef975a09b1041">applied</a>.</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">QVBoxLayout</span> <span class="o">*</span><span class="n">vl</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">QVBoxLayout</span><span class="p">(</span><span class="n">page</span><span class="p">);</span> <span class="c1">// layout being set to page</span>
    <span class="n">m_undoView</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">KisUndoView</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="n">vl</span><span class="o">-&gt;</span><span class="n">addWidget</span><span class="p">(</span><span class="n">m_undoView</span><span class="p">);</span>
    <span class="n">QHBoxLayout</span> <span class="o">*</span><span class="n">hl</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">QHBoxLayout</span><span class="p">();</span>
    <span class="n">hl</span><span class="o">-&gt;</span><span class="n">addSpacerItem</span><span class="p">(</span><span class="k">new</span> <span class="nf">QSpacerItem</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>  <span class="n">QSizePolicy</span><span class="o">::</span><span class="n">Expanding</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="o">::</span><span class="n">Fixed</span><span class="p">));</span>
    <span class="n">m_bnConfigure</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">QToolButton</span><span class="p">(</span><span class="n">page</span><span class="p">);</span>
    <span class="n">m_bnConfigure</span><span class="o">-&gt;</span><span class="n">setIcon</span><span class="p">(</span><span class="n">KisIconUtils</span><span class="o">::</span><span class="n">loadIcon</span><span class="p">(</span><span class="s">"configure"</span><span class="p">));</span>
    <span class="n">connect</span><span class="p">(</span><span class="n">m_bnConfigure</span><span class="p">,</span> <span class="n">SIGNAL</span><span class="p">(</span><span class="n">clicked</span><span class="p">(</span><span class="kt">bool</span><span class="p">)),</span> <span class="n">SLOT</span><span class="p">(</span><span class="n">configure</span><span class="p">()));</span>
    <span class="n">hl</span><span class="o">-&gt;</span><span class="n">addWidget</span><span class="p">(</span><span class="n">m_bnConfigure</span><span class="p">);</span>
    <span class="n">vl</span><span class="o">-&gt;</span><span class="n">addItem</span><span class="p">(</span><span class="n">hl</span><span class="p">);</span>
    <span class="n">vl</span><span class="o">-&gt;</span><span class="n">addLayout</span><span class="p">(</span><span class="n">hl</span><span class="p">);</span> <span class="c1">// horizontal layout added to the vertical layout</span>

    <span class="n">setWidget</span><span class="p">(</span><span class="n">page</span><span class="p">);</span>
    <span class="n">setWindowTitle</span><span class="p">(</span><span class="n">i18n</span><span class="p">(</span><span class="s">"Undo History"</span><span class="p">));</span>
</code></pre></div></div>

<p>That’s it. Learned something new in Qt. Not as important and useful as learning about
<a href="http://doc.qt.io/qt-4.8/signalsandslots.html">signals and slots</a>, but now I can focus
on other warnings in the console output of Krita.</p>

<p>And you? Have you tested <a href="https://krita.org/en/item/krita-3-1-3-alpha-released/">Krita 3.1.3 alpha</a> already?
What are you waiting for? :-)</p>

<p>♥ Open Source</p>

  </div>

  <div class="tags">
    <p>
      Published Apr 2, 2017 in &ldquo;blog&rdquo; and tagged&nbsp;<a class="label" href="/tags#c++">c++</a>,&nbsp;<a class="label" href="/tags#krita">krita</a>,&nbsp;<a class="label" href="/tags#programming">programming</a>,&nbsp;<a class="label" href="/tags#opensource">opensource</a>. Number of words: 658.
    </p>
  </div>

  <a class="u-url" href="/2017/04/02/fixing-qt-warning-qlayout-attempting-to-add-qlayout-to-qwidget-which-already-has-a-layout.html" hidden></a>
</article>

  </div>
</div>
</body>
</html>
