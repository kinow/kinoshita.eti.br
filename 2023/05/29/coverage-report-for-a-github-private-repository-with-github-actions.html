<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:url" content="https://kinoshita.eti.br/2023/05/29/coverage-report-for-a-github-private-repository-with-github-actions.html"><meta property="og:site_name" content="kinow"><meta property="og:title" content="Coverage report for a GitHub private repository with GitHub Actions"><meta property="og:description" content="Normally when you add test coverage to a GitHub repository, the reporting part boils down to a simple call to some API that will post to a third-party external service like Coveralls or Codecov. Many are already on the GitHub Actions Market Place and a few lines of YAML are enough.
A Codecov coverage report We had to report the test coverage of a private GitHub repository of a project I am working on at the moment, that could not have integration with other services besides GitHub."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-05-29T20:36:52+03:00"><meta property="article:modified_time" content="2025-06-12T13:29:07+02:00"><meta property="article:tag" content="Opensource"><meta property="article:tag" content="Programming"><meta property="article:tag" content="Coverage"><meta property="article:tag" content="Software Quality"><meta property="article:tag" content="Github"><meta property="article:tag" content="Github Actions"><meta property="og:image" content="https://kinoshita.eti.br/assets/posts/2023-05-29-coverage-report-for-a-github-private-repository-with-github-actions/coverage.png"><meta property="fb:admins" content="bruno.kinoshita"><meta name=twitter:title content="Coverage report for a GitHub private repository with GitHub Actions"><meta name=twitter:description content="Normally when you add test coverage to a GitHub repository, the reporting part boils down to a simple call to some API that will post to a third-party external service like Coveralls or Codecov. Many are already on the GitHub Actions Market Place and a few lines of YAML are enough.
A Codecov coverage report We had to report the test coverage of a private GitHub repository of a project I am working on at the moment, that could not have integration with other services besides GitHub."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kinoshita.eti.br/assets/posts/2023-05-29-coverage-report-for-a-github-private-repository-with-github-actions/coverage.png"><meta name=twitter:site content="@kinow"><link rel=alternate type=application/rss+xml href=https://kinoshita.eti.br/2023/05/29/coverage-report-for-a-github-private-repository-with-github-actions/feed.xml title=kinow><link rel=stylesheet type=text/css href=https://kinoshita.eti.br/sass/main.ecb27dc5d5ced6616f17336fdf32a78aff8278ec4b599f9e5cdc5bb8a09a9f28.css integrity="sha256-7LJ9xdXO1mFvFzNv3zKniv+CeOxLWZ+eXNxbuKCanyg="><title>kinow | Coverage report for a GitHub private repository with GitHub Actions</title><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"posts","name":"Coverage report for a GitHub private repository with GitHub Actions","headline":"Coverage report for a GitHub private repository with GitHub Actions","alternativeHeadline":"","description":"Normally when you add test coverage to a GitHub repository, the reporting part boils down to a simple call to some API that will post to a third-party external service like Coveralls or Codecov. Many are already on the GitHub Actions Market Place and a few lines of YAML are enough.\nA Codecov coverage report We had to report the test coverage of a private GitHub repository of a project I am working on at the moment, that could not have integration with other services besides GitHub.","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/kinoshita.eti.br\/2023\/05\/29\/coverage-report-for-a-github-private-repository-with-github-actions.html"},"author":{"@type":"Person","name":""},"creator":{"@type":"Person","name":""},"accountablePerson":{"@type":"Person","name":""},"copyrightHolder":"kinow","copyrightYear":"2023","dateCreated":"2023-05-29T20:36:52.00Z","datePublished":"2023-05-29T20:36:52.00Z","dateModified":"2025-06-12T13:29:07.00Z","publisher":{"@type":"Organization","name":"kinow","url":"https://kinoshita.eti.br/","logo":{"@type":"ImageObject","url":"https:\/\/kinoshita.eti.br\/","width":"32","height":"32"}},"image":["https://kinoshita.eti.br/assets/posts/2023-05-29-coverage-report-for-a-github-private-repository-with-github-actions/coverage.png"],"url":"https:\/\/kinoshita.eti.br\/2023\/05\/29\/coverage-report-for-a-github-private-repository-with-github-actions.html","wordCount":"825","genre":["opensource","programming","coverage","software quality","github","github actions","python"],"keywords":[]}</script></head><body><header role=banner class=content><nav id=nav aria-label=Main role=navigation class=content><ul style=position:relative><li><a href=/><i data-feather=about></i> About</a></li><li><a href=/blog/><i data-feather=blog></i> Blog</a></li><li><a href=/portfolio/><i data-feather=portfolio></i> Portfolio</a></li><li style=position:absolute;right:0;bottom:-.75rem;text-align:right><span style=text-transform:uppercase;font-weight:700;font-size:3rem;color:#fffefa;line-height:normal;letter-spacing:-.1rem>Kinow</span></li></ul></nav></header><main><article class=content><h1>Coverage report for a GitHub private repository with GitHub Actions</h1><div class=metadata><i data-feather=calendar></i>
<time datetime=2023-05-29>May 29, 2023</time></div><aside><nav id=TableOfContents></nav></aside><p>Normally when you add test coverage to a GitHub repository, the reporting part
boils down to a simple call to some API that will post to a third-party external
service like Coveralls or Codecov. Many are already on the GitHub Actions
Market Place and a few lines of YAML are enough.</p><figure class=feature><img src=/assets/posts/2023-05-29-coverage-report-for-a-github-private-repository-with-github-actions/coverage.png alt title width height><figcaption>A Codecov coverage report</figcaption></figure><p>We had to report the test coverage of a private GitHub repository of a project
I am working on at the moment, that could not have integration with other services
besides GitHub. So no Coveralls and no Codecov.</p><p>Our initial solution was to run the unit tests with coverage (using <code>pytest</code> and <code>pytest-cov</code>)
using GitHub Actions, like we were already doing, create an XML coverage with
<code>pytest-cov</code>, which is compatible with Cobertura&rsquo;s XML. This XML file was used
by <a href=https://github.com/aconrad/pycobertura>pycobertura</a>, a Python utility that
reads Cobertura XML and produces HTML or Markdown report.</p><p>Then, using GitHub REST API and the GitHub Actions client, a job in our GitHub actions
pipeline posts the coverage report as a Markdown comment to the current pull request.</p><p>But later we realized that <code>pycobertura</code> is not able to parse <a href=https://github.com/aconrad/pycobertura/issues/167>branch coverage</a>. It only works with line
coverage.</p><p>The final solution was then to use <code>pytest-cov</code> and produce its HTML output,
use <a href=https://github.com/mgdm/htmlq><code>htmlq</code></a> to extract the HTML coverage table,
convert it to Markdown with <a href=https://github.com/jgm/pandoc/>Pandoc</a>, and
then post the result as the new Markdown comment to the pull requests.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1>  1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2>  2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3>  3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4>  4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5>  5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6><a style=outline:none;text-decoration:none;color:inherit href=#6>  6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7><a style=outline:none;text-decoration:none;color:inherit href=#7>  7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8><a style=outline:none;text-decoration:none;color:inherit href=#8>  8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9><a style=outline:none;text-decoration:none;color:inherit href=#9>  9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10><a style=outline:none;text-decoration:none;color:inherit href=#10> 10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11><a style=outline:none;text-decoration:none;color:inherit href=#11> 11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12><a style=outline:none;text-decoration:none;color:inherit href=#12> 12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13><a style=outline:none;text-decoration:none;color:inherit href=#13> 13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14><a style=outline:none;text-decoration:none;color:inherit href=#14> 14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15><a style=outline:none;text-decoration:none;color:inherit href=#15> 15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=16><a style=outline:none;text-decoration:none;color:inherit href=#16> 16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=17><a style=outline:none;text-decoration:none;color:inherit href=#17> 17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=18><a style=outline:none;text-decoration:none;color:inherit href=#18> 18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=19><a style=outline:none;text-decoration:none;color:inherit href=#19> 19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=20><a style=outline:none;text-decoration:none;color:inherit href=#20> 20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=21><a style=outline:none;text-decoration:none;color:inherit href=#21> 21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=22><a style=outline:none;text-decoration:none;color:inherit href=#22> 22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=23><a style=outline:none;text-decoration:none;color:inherit href=#23> 23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=24><a style=outline:none;text-decoration:none;color:inherit href=#24> 24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=25><a style=outline:none;text-decoration:none;color:inherit href=#25> 25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=26><a style=outline:none;text-decoration:none;color:inherit href=#26> 26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=27><a style=outline:none;text-decoration:none;color:inherit href=#27> 27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=28><a style=outline:none;text-decoration:none;color:inherit href=#28> 28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=29><a style=outline:none;text-decoration:none;color:inherit href=#29> 29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=30><a style=outline:none;text-decoration:none;color:inherit href=#30> 30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=31><a style=outline:none;text-decoration:none;color:inherit href=#31> 31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=32><a style=outline:none;text-decoration:none;color:inherit href=#32> 32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=33><a style=outline:none;text-decoration:none;color:inherit href=#33> 33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=34><a style=outline:none;text-decoration:none;color:inherit href=#34> 34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=35><a style=outline:none;text-decoration:none;color:inherit href=#35> 35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=36><a style=outline:none;text-decoration:none;color:inherit href=#36> 36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=37><a style=outline:none;text-decoration:none;color:inherit href=#37> 37</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=38><a style=outline:none;text-decoration:none;color:inherit href=#38> 38</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=39><a style=outline:none;text-decoration:none;color:inherit href=#39> 39</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=40><a style=outline:none;text-decoration:none;color:inherit href=#40> 40</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=41><a style=outline:none;text-decoration:none;color:inherit href=#41> 41</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=42><a style=outline:none;text-decoration:none;color:inherit href=#42> 42</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=43><a style=outline:none;text-decoration:none;color:inherit href=#43> 43</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=44><a style=outline:none;text-decoration:none;color:inherit href=#44> 44</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=45><a style=outline:none;text-decoration:none;color:inherit href=#45> 45</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=46><a style=outline:none;text-decoration:none;color:inherit href=#46> 46</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=47><a style=outline:none;text-decoration:none;color:inherit href=#47> 47</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=48><a style=outline:none;text-decoration:none;color:inherit href=#48> 48</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=49><a style=outline:none;text-decoration:none;color:inherit href=#49> 49</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=50><a style=outline:none;text-decoration:none;color:inherit href=#50> 50</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=51><a style=outline:none;text-decoration:none;color:inherit href=#51> 51</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=52><a style=outline:none;text-decoration:none;color:inherit href=#52> 52</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=53><a style=outline:none;text-decoration:none;color:inherit href=#53> 53</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=54><a style=outline:none;text-decoration:none;color:inherit href=#54> 54</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=55><a style=outline:none;text-decoration:none;color:inherit href=#55> 55</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=56><a style=outline:none;text-decoration:none;color:inherit href=#56> 56</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=57><a style=outline:none;text-decoration:none;color:inherit href=#57> 57</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=58><a style=outline:none;text-decoration:none;color:inherit href=#58> 58</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=59><a style=outline:none;text-decoration:none;color:inherit href=#59> 59</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=60><a style=outline:none;text-decoration:none;color:inherit href=#60> 60</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=61><a style=outline:none;text-decoration:none;color:inherit href=#61> 61</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=62><a style=outline:none;text-decoration:none;color:inherit href=#62> 62</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=63><a style=outline:none;text-decoration:none;color:inherit href=#63> 63</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=64><a style=outline:none;text-decoration:none;color:inherit href=#64> 64</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=65><a style=outline:none;text-decoration:none;color:inherit href=#65> 65</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=66><a style=outline:none;text-decoration:none;color:inherit href=#66> 66</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=67><a style=outline:none;text-decoration:none;color:inherit href=#67> 67</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=68><a style=outline:none;text-decoration:none;color:inherit href=#68> 68</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=69><a style=outline:none;text-decoration:none;color:inherit href=#69> 69</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=70><a style=outline:none;text-decoration:none;color:inherit href=#70> 70</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=71><a style=outline:none;text-decoration:none;color:inherit href=#71> 71</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=72><a style=outline:none;text-decoration:none;color:inherit href=#72> 72</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=73><a style=outline:none;text-decoration:none;color:inherit href=#73> 73</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=74><a style=outline:none;text-decoration:none;color:inherit href=#74> 74</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=75><a style=outline:none;text-decoration:none;color:inherit href=#75> 75</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=76><a style=outline:none;text-decoration:none;color:inherit href=#76> 76</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=77><a style=outline:none;text-decoration:none;color:inherit href=#77> 77</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=78><a style=outline:none;text-decoration:none;color:inherit href=#78> 78</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=79><a style=outline:none;text-decoration:none;color:inherit href=#79> 79</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=80><a style=outline:none;text-decoration:none;color:inherit href=#80> 80</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=81><a style=outline:none;text-decoration:none;color:inherit href=#81> 81</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=82><a style=outline:none;text-decoration:none;color:inherit href=#82> 82</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=83><a style=outline:none;text-decoration:none;color:inherit href=#83> 83</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=84><a style=outline:none;text-decoration:none;color:inherit href=#84> 84</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=85><a style=outline:none;text-decoration:none;color:inherit href=#85> 85</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=86><a style=outline:none;text-decoration:none;color:inherit href=#86> 86</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=87><a style=outline:none;text-decoration:none;color:inherit href=#87> 87</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=88><a style=outline:none;text-decoration:none;color:inherit href=#88> 88</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=89><a style=outline:none;text-decoration:none;color:inherit href=#89> 89</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=90><a style=outline:none;text-decoration:none;color:inherit href=#90> 90</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=91><a style=outline:none;text-decoration:none;color:inherit href=#91> 91</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=92><a style=outline:none;text-decoration:none;color:inherit href=#92> 92</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=93><a style=outline:none;text-decoration:none;color:inherit href=#93> 93</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=94><a style=outline:none;text-decoration:none;color:inherit href=#94> 94</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=95><a style=outline:none;text-decoration:none;color:inherit href=#95> 95</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=96><a style=outline:none;text-decoration:none;color:inherit href=#96> 96</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=97><a style=outline:none;text-decoration:none;color:inherit href=#97> 97</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=98><a style=outline:none;text-decoration:none;color:inherit href=#98> 98</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=99><a style=outline:none;text-decoration:none;color:inherit href=#99> 99</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=100><a style=outline:none;text-decoration:none;color:inherit href=#100>100</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=101><a style=outline:none;text-decoration:none;color:inherit href=#101>101</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=102><a style=outline:none;text-decoration:none;color:inherit href=#102>102</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=103><a style=outline:none;text-decoration:none;color:inherit href=#103>103</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=104><a style=outline:none;text-decoration:none;color:inherit href=#104>104</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=105><a style=outline:none;text-decoration:none;color:inherit href=#105>105</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#177500># File: .github/workflows/ci.yml</span>
</span></span><span style=display:flex><span><span style=color:#000>name</span>: <span style=color:#1c01ce>project demo</span>
</span></span><span style=display:flex><span><span style=color:#000>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#000>push</span>:
</span></span><span style=display:flex><span>  <span style=color:#000>pull_request</span>:
</span></span><span style=display:flex><span>  <span style=color:#000>workflow_dispatch</span>:
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#000>permissions</span>:
</span></span><span style=display:flex><span>  <span style=color:#000>content</span>: <span style=color:#1c01ce>read</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#000>demo_test</span>:
</span></span><span style=display:flex><span>    <span style=color:#000>env</span>:
</span></span><span style=display:flex><span>      <span style=color:#000>COVERAGE_ENABLED</span>: <span style=color:#a90d91>true</span>
</span></span><span style=display:flex><span>    <span style=color:#000>runs-on</span>: <span style=color:#1c01ce>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#000>permissions</span>:
</span></span><span style=display:flex><span>      <span style=color:#000>contents</span>: <span style=color:#1c01ce>read</span>
</span></span><span style=display:flex><span>      <span style=color:#000>issues</span>: <span style=color:#1c01ce>write</span>
</span></span><span style=display:flex><span>      <span style=color:#000>pull-requests</span>: <span style=color:#1c01ce>write</span>
</span></span><span style=display:flex><span>    <span style=color:#000>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#000>uses</span>: <span style=color:#1c01ce>actions/checkout@v3</span>
</span></span><span style=display:flex><span>      - <span style=color:#000>uses</span>: <span style=color:#1c01ce>mamba-org/provision-with-micromamba@v15</span>
</span></span><span style=display:flex><span>        <span style=color:#000>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#000>environment-file</span>: <span style=color:#1c01ce>environment.yml </span> <span style=color:#177500># includes pandoc</span>
</span></span><span style=display:flex><span>          <span style=color:#000>cache-download</span>: <span style=color:#a90d91>true</span>
</span></span><span style=display:flex><span>          <span style=color:#000>channels</span>: <span style=color:#1c01ce>conda-forge</span>
</span></span><span style=display:flex><span>      - <span style=color:#000>name</span>: <span style=color:#1c01ce>Install htmlq</span>
</span></span><span style=display:flex><span>        <span style=color:#000>if</span>: <span style=color:#1c01ce>${{ env.COVERAGE_ENABLED }}</span>
</span></span><span style=display:flex><span>        <span style=color:#000>uses</span>: <span style=color:#1c01ce>baptiste0928/cargo-install@v2</span>
</span></span><span style=display:flex><span>        <span style=color:#000>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#000>crate</span>: <span style=color:#1c01ce>htmlq</span>
</span></span><span style=display:flex><span>          <span style=color:#000>cache-key</span>: <span style=color:#1c01ce>cargo-coverage</span>
</span></span><span style=display:flex><span>      - <span style=color:#000>run</span>: <span style=color:#1c01ce>cargo install htmlq</span>
</span></span><span style=display:flex><span>        <span style=color:#000>if</span>: <span style=color:#1c01ce>${{ env.COVERAGE_ENABLED }}</span>
</span></span><span style=display:flex><span>      - <span style=color:#000>run</span>: |<span style=color:#c41a16>
</span></span></span><span style=display:flex><span><span style=color:#c41a16>          # Produce the HTML report.
</span></span></span><span style=display:flex><span><span style=color:#c41a16>          pytest --cov=demo --cov-report=html --cov-report=xml --cov-branch -m &#34;demo&#34;
</span></span></span><span style=display:flex><span><span style=color:#c41a16>
</span></span></span><span style=display:flex><span><span style=color:#c41a16>          if [[ ${COVERAGE_ENABLED} ]]; then
</span></span></span><span style=display:flex><span><span style=color:#c41a16>            # Extract the top header of the pytest HTML report.
</span></span></span><span style=display:flex><span><span style=color:#c41a16>            # Passes the HTML through htmlq, extracting the first H1 displayed.
</span></span></span><span style=display:flex><span><span style=color:#c41a16>            # Uses tr to delete breaklines and squeeze-repeats blank spaces,
</span></span></span><span style=display:flex><span><span style=color:#c41a16>            # saving space - this is used for an HTTP REST request to GitHub API.
</span></span></span><span style=display:flex><span><span style=color:#c41a16>            COV_HEADER=$(cat htmlcov/index.html | htmlq --pretty &#39;header &gt; div &gt; h1:first-of-type&#39; | tr -d &#39;\n&#39; | tr -s &#39; &#39;)
</span></span></span><span style=display:flex><span><span style=color:#c41a16>          
</span></span></span><span style=display:flex><span><span style=color:#c41a16>            # Extract the table of the pytest HTML report.
</span></span></span><span style=display:flex><span><span style=color:#c41a16>            # Passes the HTML through htmlq, extracting the table element.
</span></span></span><span style=display:flex><span><span style=color:#c41a16>            # Uses tr to delete breaklines and squeeze-repeats blank spaces.
</span></span></span><span style=display:flex><span><span style=color:#c41a16>            # Then calls sed with an expression that replaces the HTML a
</span></span></span><span style=display:flex><span><span style=color:#c41a16>            # elements by only its text.
</span></span></span><span style=display:flex><span><span style=color:#c41a16>            COV_TABLE=$(cat htmlcov/index.html | htmlq --pretty &#39;table&#39; | tr -d &#39;\n&#39; | tr -s &#39; &#39; | sed &#39;s|&lt;a[^&gt;]*&gt;\([^&lt;]*\)&lt;/a&gt;|\1|g&#39;)
</span></span></span><span style=display:flex><span><span style=color:#c41a16>          
</span></span></span><span style=display:flex><span><span style=color:#c41a16>            # Produce a simplified HTML report.
</span></span></span><span style=display:flex><span><span style=color:#c41a16>            echo &#34;${COV_HEADER}${COV_TABLE}&#34; &gt; coverage.html
</span></span></span><span style=display:flex><span><span style=color:#c41a16>          
</span></span></span><span style=display:flex><span><span style=color:#c41a16>            # Now simply use pandoc to convert HTML to Markdown.
</span></span></span><span style=display:flex><span><span style=color:#c41a16>            pandoc --from html --to &#39;markdown_strict+pipe_tables&#39; coverage.html -o coverage.md
</span></span></span><span style=display:flex><span><span style=color:#c41a16>          fi</span>          
</span></span><span style=display:flex><span>      - <span style=color:#000>name</span>: <span style=color:#1c01ce>Public coverage (stdout)</span>
</span></span><span style=display:flex><span>        <span style=color:#177500># Publish the coverage reports in only one matrix job run.</span>
</span></span><span style=display:flex><span>        <span style=color:#177500># Only run if **NOT** running in a pull request (see step below).</span>
</span></span><span style=display:flex><span>        <span style=color:#000>if</span>: <span style=color:#1c01ce>${{ github.event_name != &#39;pull_request&#39; &amp;&amp; env.COVERAGE_ENABLED }}</span>
</span></span><span style=display:flex><span>        <span style=color:#000>run</span>: |<span style=color:#c41a16>
</span></span></span><span style=display:flex><span><span style=color:#c41a16>          cat coverage.md</span>          
</span></span><span style=display:flex><span>      - <span style=color:#000>name</span>: <span style=color:#1c01ce>Publish coverage reports (bot)</span>
</span></span><span style=display:flex><span>        <span style=color:#177500># Only run if running in a pull request.</span>
</span></span><span style=display:flex><span>        <span style=color:#177500># See for more: https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#example-using-contexts</span>
</span></span><span style=display:flex><span>        <span style=color:#000>if</span>: <span style=color:#1c01ce>${{ github.event_name == &#39;pull_request&#39; &amp;&amp; env.COVERAGE_ENABLED }}</span>
</span></span><span style=display:flex><span>        <span style=color:#177500># Comment on an issue or pull request using GH Actions tooling:</span>
</span></span><span style=display:flex><span>        <span style=color:#177500># https://github.com/actions/github-script#comment-on-an-issue</span>
</span></span><span style=display:flex><span>        <span style=color:#000>uses</span>: <span style=color:#1c01ce>actions/github-script@v6</span>
</span></span><span style=display:flex><span>        <span style=color:#000>id</span>: <span style=color:#1c01ce>coverage-report</span>
</span></span><span style=display:flex><span>        <span style=color:#000>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#000>github-token</span>: <span style=color:#1c01ce>${{secrets.GITHUB_TOKEN}}</span>
</span></span><span style=display:flex><span>          <span style=color:#177500># Based on: https://github.com/actions/github-script/blob/060d68304cc19ea84d828af10e34b9c6ca7bdb31/.github/workflows/pull-request-test.yml</span>
</span></span><span style=display:flex><span>          <span style=color:#000>script</span>: |<span style=color:#c41a16>
</span></span></span><span style=display:flex><span><span style=color:#c41a16>            // Get the existing comments.
</span></span></span><span style=display:flex><span><span style=color:#c41a16>            const {data: comments} = await github.rest.issues.listComments({
</span></span></span><span style=display:flex><span><span style=color:#c41a16>              owner: context.repo.owner,
</span></span></span><span style=display:flex><span><span style=color:#c41a16>              repo: context.repo.repo,
</span></span></span><span style=display:flex><span><span style=color:#c41a16>              issue_number: context.payload.number,
</span></span></span><span style=display:flex><span><span style=color:#c41a16>            })
</span></span></span><span style=display:flex><span><span style=color:#c41a16>            
</span></span></span><span style=display:flex><span><span style=color:#c41a16>            // Find any comment already made by the bot.
</span></span></span><span style=display:flex><span><span style=color:#c41a16>            const botComment = comments.find(comment =&gt; comment.user.id === 41898282)
</span></span></span><span style=display:flex><span><span style=color:#c41a16>            const fs = require(&#34;fs&#34;).promises
</span></span></span><span style=display:flex><span><span style=color:#c41a16>            const commentBody = await fs.readFile(&#34;coverage.md&#34;, &#34;utf8&#34;)
</span></span></span><span style=display:flex><span><span style=color:#c41a16>            
</span></span></span><span style=display:flex><span><span style=color:#c41a16>            if (botComment) {
</span></span></span><span style=display:flex><span><span style=color:#c41a16>              console.log(`Updating comment in ${context.repo.owner}/${context.repo.repo}, comment ID: ${botComment.id}`)
</span></span></span><span style=display:flex><span><span style=color:#c41a16>              await github.rest.issues.updateComment({
</span></span></span><span style=display:flex><span><span style=color:#c41a16>                owner: context.repo.owner,
</span></span></span><span style=display:flex><span><span style=color:#c41a16>                repo: context.repo.repo,
</span></span></span><span style=display:flex><span><span style=color:#c41a16>                comment_id: botComment.id,
</span></span></span><span style=display:flex><span><span style=color:#c41a16>                body: commentBody
</span></span></span><span style=display:flex><span><span style=color:#c41a16>              })
</span></span></span><span style=display:flex><span><span style=color:#c41a16>            } else {
</span></span></span><span style=display:flex><span><span style=color:#c41a16>              console.log(`Creating comment in ${context.repo.owner}/${context.repo.repo}`)
</span></span></span><span style=display:flex><span><span style=color:#c41a16>              await github.rest.issues.createComment({
</span></span></span><span style=display:flex><span><span style=color:#c41a16>                owner: context.repo.owner,
</span></span></span><span style=display:flex><span><span style=color:#c41a16>                repo: context.repo.repo,
</span></span></span><span style=display:flex><span><span style=color:#c41a16>                issue_number: context.issue.number,
</span></span></span><span style=display:flex><span><span style=color:#c41a16>                body: commentBody
</span></span></span><span style=display:flex><span><span style=color:#c41a16>              })
</span></span></span><span style=display:flex><span><span style=color:#c41a16>            }</span>            </span></span></code></pre></td></tr></table></div></div><p>Now the GitHub bot will write a comment to your current pull request with the
Markdown you produced with <code>htmlq</code> and some Shell script. If you update the
pull request, the bot will re-use the existing comment, updating it, which is
convenient as GitHub UI gives you a nice diff for your coverage reports.</p><p>Categories:
<a href=/categories/opensource.html>Opensource</a>,
<a href=/categories/programming.html>Programming</a></p><p>Tags:
<a href=/tags/opensource.html>Opensource</a>,
<a href=/tags/programming.html>Programming</a>,
<a href=/tags/coverage.html>Coverage</a>,
<a href=/tags/software-quality.html>Software Quality</a>,
<a href=/tags/github.html>Github</a>,
<a href=/tags/github-actions.html>Github Actions</a>,
<a href=/tags/python.html>Python</a></p><aside class=links><a class=previous href=https://kinoshita.eti.br/2022/10/26/r/functionalprogramming-turned-10.html>&#171; Previous</a><a class=next href=https://kinoshita.eti.br/2024/04/28/logo-java-ring.html>Next &#187;</a></aside></article></main><footer role=contentinfo><ul id=social-media-icons><li><a href=https://www.instagram.com/brunokinoshita/><img src=/assets/icons/instagram.png alt="Instagram link"></a></li><li><a href=https://bsky.app/profile/kinow.bsky.social><img src=/assets/icons/bluesky.png alt="BlueSky link"></a></li><li><a href=https://twitter.com/kinow/><img src=/assets/icons/twitter.png alt="Twitter link"></a></li><li><a href=https://github.com/kinow/><img src=/assets/icons/github.png alt="GitHub link"></a></li><li><a href=/feed.xml><img src=/assets/icons/news.png alt="RSS feed link"></a></li></ul></footer></body></html>